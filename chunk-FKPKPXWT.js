import{a as j,g as H,i as R,j as Q,k as q,l as N,m as $}from"./chunk-IQL2UJ6C.js";import{a as y,e as U}from"./chunk-IO7LDB7E.js";import{$b as u,Ac as F,Eb as E,G as b,Ga as c,Ha as m,Ia as P,Jc as I,Ob as G,Ra as S,Rb as z,Sa as V,ac as f,bd as B,dd as W,ea as C,fc as O,hc as g,ic as p,jc as T,kc as k,l as M,o as X,pb as d,qc as D,ra as _,rc as A,va as x,wa as v}from"./chunk-WSOERDLG.js";X();var Y=["resizer"],J=["resizable",""],K=["*"];function L(l,s){if(l&1){let e=O();P(),u(0,"g")(1,"line",1),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("top",i))}),f(),u(2,"line",2),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("left",i))}),f(),u(3,"line",3),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("bottom",i))}),f(),u(4,"line",4),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("right",i))}),f(),u(5,"rect",5),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("top-left",i))}),f(),u(6,"rect",6),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("top-right",i))}),f(),u(7,"rect",7),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("bottom-left",i))}),f(),u(8,"rect",8),g("pointerStart",function(i){c(e);let t=p();return m(t.startResize("bottom-right",i))}),f()()}if(l&2){let e=p();d(),z("x1",e.lineGap)("y1",-e.gap())("x2",e.model.size().width-e.lineGap)("y2",-e.gap())("stroke",e.resizerColor()),d(),z("x1",-e.gap())("y1",e.lineGap)("x2",-e.gap())("y2",e.model.size().height-e.lineGap)("stroke",e.resizerColor()),d(),z("x1",e.lineGap)("y1",e.model.size().height+e.gap())("x2",e.model.size().width-e.lineGap)("y2",e.model.size().height+e.gap())("stroke",e.resizerColor()),d(),z("x1",e.model.size().width+e.gap())("y1",e.lineGap)("x2",e.model.size().width+e.gap())("y2",e.model.size().height-e.lineGap)("stroke",e.resizerColor()),d(),z("x",-(e.handleSize/2)-e.gap())("y",-(e.handleSize/2)-e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),d(),z("x",e.model.size().width-e.handleSize/2+e.gap())("y",-(e.handleSize/2)-e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),d(),z("x",-(e.handleSize/2)-e.gap())("y",e.model.size().height-e.handleSize/2+e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),d(),z("x",e.model.size().width-e.handleSize/2+e.gap())("y",e.model.size().height-e.handleSize/2+e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor())}}var fe=(()=>{class l{get model(){return this.nodeAccessor.model()}constructor(){this.nodeAccessor=_(Q),this.rootPointer=_(q),this.viewportService=_(H),this.spacePointContext=_(N),this.hostRef=_(V),this.resizable=S(),this.resizerColor=S("#2e414c"),this.gap=S(1.5),this.resizer=E.required("resizer"),this.lineGap=3,this.handleSize=6,this.resizeSide=null,this.zoom=B(()=>this.viewportService.readableViewport().zoom??0),this.minWidth=0,this.minHeight=0,this.resizeOnGlobalMouseMove=this.rootPointer.pointerMovement$.pipe(b(()=>this.resizeSide!==null),b(e=>e.movementX!==0||e.movementY!==0),C(e=>this.resize(e)),y()).subscribe(),this.endResizeOnGlobalMouseUp=this.rootPointer.documentPointerEnd$.pipe(C(()=>this.endResize()),y()).subscribe(),W(()=>{let e=this.resizable();typeof e=="boolean"?this.model.resizable.set(e):this.model.resizable.set(!0)},{allowSignalWrites:!0})}ngOnInit(){this.model.resizerTemplate.set(this.resizer())}ngAfterViewInit(){this.minWidth=+getComputedStyle(this.hostRef.nativeElement).minWidth.replace("px","")||0,this.minHeight=+getComputedStyle(this.hostRef.nativeElement).minHeight.replace("px","")||0}startResize(e,r){r.stopPropagation(),this.resizeSide=e,this.model.resizing.set(!0)}resize(e){if(!this.resizeSide||this.isResizeConstrained(e))return;let r=Z(e.movementX,e.movementY,this.zoom()),{x:i,y:t,width:n,height:o}=te(ee(this.resizeSide,this.model,r),this.model,this.resizeSide,this.minWidth,this.minHeight);this.model.setPoint({x:i,y:t},!1),this.model.size.set({width:n,height:o})}endResize(){this.resizeSide=null,this.model.resizing.set(!1)}isResizeConstrained({x:e,y:r,movementX:i,movementY:t}){let n=this.spacePointContext.documentPointToFlowPoint({x:e,y:r});return!!(this.resizeSide?.includes("right")&&(i>0&&n.x<this.model.point().x+this.model.size().width||i<0&&n.x>this.model.point().x+this.model.size().width)||this.resizeSide?.includes("left")&&(i<0&&n.x>this.model.point().x||i>0&&n.x<this.model.point().x)||this.resizeSide?.includes("bottom")&&(t>0&&n.y<this.model.point().y+this.model.size().height||t<0&&n.y>this.model.point().y+this.model.size().height)||this.resizeSide?.includes("top")&&(t<0&&n.y>this.model.point().y||t>0&&n.y<this.model.point().y))}static{this.\u0275fac=function(r){return new(r||l)}}static{this.\u0275cmp=v({type:l,selectors:[["","resizable",""]],viewQuery:function(r,i){r&1&&D(i.resizer,Y,5),r&2&&A()},inputs:{resizable:[x.SignalBased,"resizable"],resizerColor:[x.SignalBased,"resizerColor"],gap:[x.SignalBased,"gap"]},standalone:!0,features:[F],attrs:J,ngContentSelectors:K,decls:3,vars:0,consts:[["resizer",""],["stroke-width","2",1,"top",3,"pointerStart"],["stroke-width","2",1,"left",3,"pointerStart"],["stroke-width","2",1,"bottom",3,"pointerStart"],["stroke-width","2",1,"right",3,"pointerStart"],[1,"top-left",3,"pointerStart"],[1,"top-right",3,"pointerStart"],[1,"bottom-left",3,"pointerStart"],[1,"bottom-right",3,"pointerStart"]],template:function(r,i){r&1&&(T(),G(0,L,9,40,"ng-template",null,0,I),k(2))},dependencies:[$],styles:[".top[_ngcontent-%COMP%]{cursor:n-resize}.left[_ngcontent-%COMP%]{cursor:w-resize}.right[_ngcontent-%COMP%]{cursor:e-resize}.bottom[_ngcontent-%COMP%]{cursor:s-resize}.top-left[_ngcontent-%COMP%]{cursor:nw-resize}.top-right[_ngcontent-%COMP%]{cursor:ne-resize}.bottom-left[_ngcontent-%COMP%]{cursor:sw-resize}.bottom-right[_ngcontent-%COMP%]{cursor:se-resize}"]})}}return M([U],l.prototype,"ngAfterViewInit",null),l})();function Z(l,s,e){return{offsetX:R(l/e),offsetY:R(s/e)}}function ee(l,s,e){let{offsetX:r,offsetY:i}=e,{x:t,y:n}=s.point(),{width:o,height:a}=s.size();switch(l){case"left":return{x:t+r,y:n,width:o-r,height:a};case"right":return{x:t,y:n,width:o+r,height:a};case"top":return{x:t,y:n+i,width:o,height:a-i};case"bottom":return{x:t,y:n,width:o,height:a+i};case"top-left":return{x:t+r,y:n+i,width:o-r,height:a-i};case"top-right":return{x:t,y:n+i,width:o+r,height:a-i};case"bottom-left":return{x:t+r,y:n,width:o-r,height:a+i};case"bottom-right":return{x:t,y:n,width:o+r,height:a+i}}}function te(l,s,e,r,i){let{x:t,y:n,width:o,height:a}=l;o=Math.max(o,0),a=Math.max(a,0),o=Math.max(r,o),a=Math.max(i,a),t=Math.min(t,s.point().x+s.size().width-r),n=Math.min(n,s.point().y+s.size().height-i);let w=s.parent();w&&(t=Math.max(t,0),n=Math.max(n,0),t===0&&(o=s.point().x+s.size().width),n===0&&(a=s.point().y+s.size().height),o=Math.min(o,w.size().width-s.point().x),a=Math.min(a,w.size().height-s.point().y));let h=j(s.children());return h&&(e.includes("left")&&(t=Math.min(t,s.point().x+s.size().width-(h.x+h.width)),o=Math.max(o,h.x+h.width)),e.includes("right")&&(o=Math.max(o,h.x+h.width)),e.includes("bottom")&&(a=Math.max(a,h.y+h.height)),e.includes("top")&&(n=Math.min(n,s.point().y+s.size().height-(h.y+h.height)),a=Math.max(a,h.y+h.height))),{x:t,y:n,width:o,height:a}}export{fe as a};
