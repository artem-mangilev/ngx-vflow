import{a as I,b as z,c as L,d as Q,e as q,v as B}from"./chunk-SZWW3JWR.js";import{Ba as b,Bb as T,Hb as _,Ja as c,Lc as G,Ma as u,Sb as s,Tb as S,Ub as x,Vb as k,Yb as F,Zb as C,Zc as r,ac as V,bc as W,cc as h,dc as y,ec as a,fc as P,gc as $,hb as H,ic as N,lc as j,mb as o,mc as m,oa as p,uc as D,va as v,vb as O,vc as E,wa as w,xa as l,ya as M}from"./chunk-75CTPCD6.js";var g=class{constructor(){this.template=u(null)}};var A=["minimap"];function R(e,d){if(e&1&&(l(),h(0,"foreignObject"),M(),h(1,"default-node",4),a(2,"div",5),y()()),e&2){let t=m().$implicit;s("transform",t.pointTransform())("width",t.width())("height",t.height()),o(),x("width",t.width(),"px")("height",t.height(),"px")("max-width",t.width(),"px")("max-height",t.height(),"px"),S("selected",t.selected()),o(),S("outerHTML",t.text(),H)}}function J(e,d){if(e&1&&(l(),a(0,"rect",6)),e&2){let t=m().$implicit;x("stroke",t.color())("fill",t.color()),k("default-group-node_selected",t.selected()),s("transform",t.pointTransform())("width",t.width())("height",t.height())}}function K(e,d){if(e&1&&(l(),P(0),_(1,R,3,13,":svg:foreignObject")(2,J,1,9,":svg:rect",3),$()),e&2){let t=d.$implicit;o(),C(t.rawNode.type==="default"||t.rawNode.type==="html-template"||t.isComponentType?1:-1),o(),C(t.rawNode.type==="default-group"||t.rawNode.type==="template-group"?2:-1)}}function U(e,d){if(e&1){let t=N();l(),a(0,"rect",1),h(1,"svg",2),j("mouseover",function(){v(t);let n=m();return w(n.hovered.set(!0))})("mouseleave",function(){v(t);let n=m();return w(n.hovered.set(!1))}),a(2,"rect"),h(3,"g"),a(4,"rect"),V(5,K,3,2,":svg:ng-container",null,F().trackNodes,!0),y()()}if(e&2){let t=m();s("x",t.minimapPoint().x)("y",t.minimapPoint().y)("width",t.minimapWidth())("height",t.minimapHeight())("stroke",t.strokeColor()),o(),s("x",t.minimapPoint().x)("y",t.minimapPoint().y)("width",t.minimapWidth())("height",t.minimapHeight()),o(),s("width",t.minimapWidth())("height",t.minimapHeight())("fill",t.maskColor()),o(),s("transform",t.minimapTransform()),o(),s("fill",t.viewportColor())("transform",t.viewportTransform())("width",t.minimapWidth())("height",t.minimapHeight()),o(),W(t.entitiesService.nodes())}}var lt=(()=>{class e{constructor(){this.entitiesService=p(z),this.flowSettingsService=p(Q),this.viewportService=p(q),this.injector=p(b),this.maskColor=c("rgba(215, 215, 215, 0.6)"),this.strokeColor=c("rgb(200, 200, 200)"),this.position=c("bottom-right"),this.scaleOnHover=c(!1),this.minimap=O.required("minimap"),this.minimapOffset=10,this.minimapScale=r(()=>this.scaleOnHover()&&this.hovered()?.4:.2),this.viewportColor=r(()=>{let t=this.flowSettingsService.background();return t.type==="dots"||t.type==="solid"?t.color??"#fff":"#fff"}),this.hovered=u(!1),this.minimapPoint=r(()=>{switch(this.position()){case"top-left":return{x:this.minimapOffset,y:this.minimapOffset};case"top-right":return{x:this.flowSettingsService.computedFlowWidth()-this.minimapWidth()-this.minimapOffset,y:this.minimapOffset};case"bottom-left":return{x:this.minimapOffset,y:this.flowSettingsService.computedFlowHeight()-this.minimapHeight()-this.minimapOffset};case"bottom-right":return{x:this.flowSettingsService.computedFlowWidth()-this.minimapWidth()-this.minimapOffset,y:this.flowSettingsService.computedFlowHeight()-this.minimapHeight()-this.minimapOffset}}}),this.minimapWidth=r(()=>this.flowSettingsService.computedFlowWidth()*this.minimapScale()),this.minimapHeight=r(()=>this.flowSettingsService.computedFlowHeight()*this.minimapScale()),this.viewportTransform=r(()=>{let t=this.viewportService.readableViewport(),i=1/t.zoom,n=-(t.x*this.minimapScale())*i;n/=this.minimapScale();let f=-(t.y*this.minimapScale())*i;return f/=this.minimapScale(),i/=this.minimapScale(),`translate(${n}, ${f}) scale(${i})`}),this.boundsViewport=r(()=>{let t=this.entitiesService.nodes();return L(I(t),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),-1/0,1.5,0)}),this.minimapTransform=r(()=>{let t=this.boundsViewport(),i=t.x*this.minimapScale(),n=t.y*this.minimapScale(),f=t.zoom*this.minimapScale();return`translate(${i} ${n}) scale(${f})`})}ngOnInit(){let t=new g;t.template.set(this.minimap()),this.entitiesService.minimap.set(t)}trackNodes(t,{rawNode:i}){return i}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=T({type:e,selectors:[["mini-map"]],viewQuery:function(i,n){i&1&&D(n.minimap,A,5),i&2&&E()},inputs:{maskColor:[1,"maskColor"],strokeColor:[1,"strokeColor"],position:[1,"position"],scaleOnHover:[1,"scaleOnHover"]},decls:2,vars:0,consts:[["minimap",""],["fill","none"],[3,"mouseover","mouseleave"],["rx","5","ry","5",1,"default-group-node",3,"default-group-node_selected","stroke","fill"],[3,"selected"],[3,"outerHTML"],["rx","5","ry","5",1,"default-group-node"]],template:function(i,n){i&1&&_(0,U,7,17,"ng-template",null,0,G)},dependencies:[B],styles:[".default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}"],changeDetection:0})}}return e})();export{lt as a};
