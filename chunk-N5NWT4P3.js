import{a as Bt,b as be,c as Ni,d as dt,e as Wt,f as Vi}from"./chunk-NQNYWDMR.js";import{d as Ri,g as Ce,h as ki,i as Oi}from"./chunk-VGERMNDJ.js";import{$ as xt,$b as ct,Ba as me,Bb as U,Ca as ze,D as le,Db as M,Dc as Tt,F as X,Fa as ue,Gb as bi,H as D,Hb as T,Hc as Ht,I as fi,Ia as lt,Ic as Et,Ja as k,K as gi,Ka as Y,Lc as zi,M as vi,Ma as l,O as yi,Q as st,Sb as w,Tb as N,Ub as we,V as Ee,Vb as Ze,Wb as Ti,Xc as Qe,Y as Ye,Yb as qe,Yc as m,Z as Ue,Zb as v,Zc as ye,_ as ve,_b as Hi,aa as te,ac as ce,ad as Z,bc as de,bd as q,c as di,ca as P,cc as b,cd as x,dc as z,dd as Dt,ea as Si,ec as F,f as pi,g as We,hb as xi,hc as ae,ia as $,ic as ne,j as Xe,k as jt,l as hi,lb as Lt,lc as A,m as rt,mb as g,mc as d,nc as _t,oa as s,ob as Fe,oc as bt,p as mi,q as _e,rb as _i,s as ui,sa as at,ta as wi,tc as je,uc as Le,va as j,vb as Ie,vc as Ae,w as y,wa as L,wb as $e,xa as S,xc as Ei,ya as De,za as Ci,zc as Di}from"./chunk-7JBMCLDE.js";import{b as Je,d as At,j as Gt,k as Mi}from"./chunk-IGMHS2AO.js";import{a as W,b as J,j as ci}from"./chunk-K4ALXBGI.js";var Xt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["ng-template","edge",""]]})}}return t})(),Yt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["ng-template","connection",""]]})}}return t})(),Ut=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["ng-template","edgeLabelHtml",""]]})}}return t})(),Zt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["ng-template","nodeHtml",""]]})}}return t})(),qt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["ng-template","nodeSvg",""]]})}}return t})(),Qt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["ng-template","groupNode",""]]})}}return t})();function pt(t){try{return new Proxy(t,{apply:()=>{}})(),!0}catch{return!1}}function ht(t){return Object.prototype.isPrototypeOf.call(Ni,t)}function R(t){return t!==void 0}var B={point:{x:0,y:0},width:100,height:50,draggable:!0,parentId:null,preview:{style:{}},selected:!1,color:"#1b262c",resizable:!1,text:"",data:{}};function Fi(t){return ht(t.type)?!0:pt(t.type)}function Wr(t){return t.type==="html-template"}function Xr(t){return t.type==="default-group"}function On(t,o){return o?{id:t.id,point:l(t.point),draggable:l(t.draggable??B.draggable),parentId:l(t.parentId??B.parentId),preview:l(t.preview??B.preview),selected:l(t.selected??B.selected)}:{id:t.id,point:l(t.point),draggable:R(t.draggable)?l(t.draggable):void 0,parentId:R(t.parentId)?l(t.parentId):void 0,preview:R(t.preview)?l(t.preview):void 0,selected:R(t.selected)?l(t.selected):void 0}}function Pi(t,o={useDefaults:!0}){let e=On(t,o.useDefaults);if(t.type==="default")return o.useDefaults?J(W({},e),{type:"default",text:l(t.text??""),width:l(t.width??B.width),height:l(t.height??B.height)}):J(W({},e),{type:"default",text:R(t.text)?l(t.text):void 0,width:R(t.width)?l(t.width):void 0,height:R(t.height)?l(t.height):void 0});if(t.type==="html-template")return o.useDefaults?J(W({},e),{type:"html-template",data:l(t.data??B.data),width:l(t.width??B.width),height:l(t.height??B.height)}):J(W({},e),{type:"html-template",data:R(t.data)?l(t.data):void 0,width:R(t.width)?l(t.width):void 0,height:R(t.height)?l(t.height):void 0});if(t.type==="svg-template"){let i=l(t.width),n=l(t.height);return o.useDefaults?J(W({},e),{type:"svg-template",width:i,height:n,data:l(t.data??B.data)}):J(W({},e),{type:"svg-template",width:i,height:n,data:R(t.data)?l(t.data):void 0})}if(t.type==="default-group"){let i=l(t.width),n=l(t.height);return o.useDefaults?J(W({},e),{type:"default-group",width:i,height:n,color:l(t.color??B.color),resizable:l(t.resizable??B.resizable)}):J(W({},e),{type:"default-group",width:i,height:n,color:R(t.color)?l(t.color):void 0,resizable:R(t.resizable)?l(t.resizable):void 0})}if(t.type==="template-group"){let i=l(t.width),n=l(t.height);return o.useDefaults?J(W({},e),{type:"template-group",width:i,height:n,data:l(t.data??B.data)}):J(W({},e),{type:"template-group",width:i,height:n,data:R(t.data)?l(t.data):void 0})}if(ht(t.type)||pt(t.type))return o.useDefaults?J(W({},e),{type:t.type,data:l(t.data??B.data),width:l(t.width??B.width),height:l(t.height??B.height)}):J(W({},e),{type:t.type,data:R(t.data)?l(t.data):void 0,width:R(t.width)?l(t.width):void 0,height:R(t.height)?l(t.height):void 0});throw new Error(`Unknown node type for node with id ${t.id}`)}function Yr(t,o={useDefaults:!0}){return o.useDefaults?t.map(e=>Pi(e,{useDefaults:!0})):t.map(e=>Pi(e,{useDefaults:!1}))}var oe={type:"default",curve:"bezier",data:{},edgeLabels:{},markers:{},reconnectable:!1,floating:!1,selected:!1};function Ii(t,o={useDefaults:!0}){return o.useDefaults?{id:t.id,type:t.type??oe.type,source:t.source,target:t.target,sourceHandle:t.sourceHandle??"",targetHandle:t.targetHandle??"",curve:l(t.curve??oe.curve),data:l(t.data??oe.data),edgeLabels:l(t.edgeLabels??oe.edgeLabels),markers:l(t.markers??oe.markers),reconnectable:l(t.reconnectable??oe.reconnectable),floating:l(t.floating??oe.floating),selected:l(t.selected??oe.selected)}:{id:t.id,type:t.type,source:t.source,target:t.target,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle,curve:R(t.curve)?l(t.curve):void 0,data:R(t.data)?l(t.data):void 0,edgeLabels:R(t.edgeLabels)?l(t.edgeLabels):void 0,markers:R(t.markers)?l(t.markers):void 0,reconnectable:R(t.reconnectable)?l(t.reconnectable):void 0,floating:R(t.floating)?l(t.floating):void 0,selected:R(t.selected)?l(t.selected):void 0}}function Jr(t,o={useDefaults:!0}){return o.useDefaults?t.map(e=>Ii(e,{useDefaults:!0})):t.map(e=>Ii(e,{useDefaults:!1}))}var ie=(()=>{class t{constructor(){this.status=l({state:"idle",payload:null}),this.status$=x(this.status).pipe(Ue({bufferSize:1,refCount:!0}))}setIdleStatus(){this.status.set({state:"idle",payload:null})}setConnectionStartStatus(e,i){this.status.set({state:"connection-start",payload:{source:e,sourceHandle:i}})}setReconnectionStartStatus(e,i,n){this.status.set({state:"reconnection-start",payload:{source:e,sourceHandle:i,oldEdge:n}})}setConnectionValidationStatus(e,i,n,r,a){this.status.set({state:"connection-validation",payload:{source:i,target:n,sourceHandle:r,targetHandle:a,valid:e}})}setReconnectionValidationStatus(e,i,n,r,a,c){this.status.set({state:"reconnection-validation",payload:{source:i,target:n,sourceHandle:r,targetHandle:a,valid:e,oldEdge:c}})}setConnectionReleaseStatus(e,i,n,r){this.status.set({state:"connection-release",payload:{source:e,target:i,sourceHandle:n,targetHandle:r}})}setConnectionReleaseValidatedStatus(e,i,n,r,a){this.status.set({state:"connection-release-validated",payload:{source:e,target:i,sourceHandle:n,targetHandle:r,valid:a}})}setConnectionDroppedStatus(e,i){this.status.set({state:"connection-dropped",payload:{source:e,sourceHandle:i}})}setReconnectionReleaseStatus(e,i,n,r,a){this.status.set({state:"reconnection-release",payload:{source:e,target:i,sourceHandle:n,targetHandle:r,oldEdge:a}})}setReconnectionReleaseValidatedStatus(e,i,n,r,a,c){this.status.set({state:"reconnection-release-validated",payload:{source:e,target:i,sourceHandle:n,targetHandle:r,oldEdge:a,valid:c}})}setReconnectionDroppedStatus(e,i,n){this.status.set({state:"reconnection-dropped",payload:{source:e,sourceHandle:i,oldEdge:n}})}setNodeDragStartStatus(e){this.status.set({state:"node-drag-start",payload:{node:e}})}setNodeDragEndStatus(e){this.status.set({state:"node-drag-end",payload:{node:e}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();function Jt(t){return t.state==="node-drag-start"}function $i(t){return t.state==="node-drag-end"}var Ke=class{constructor(o){this.settings=o,this.curve=o.curve??"bezier",this.type=o.type??"default",this.mode=o.mode??"strict",this.allowSelfConnections=o.allowSelfConnections??!1;let e=[];this.allowSelfConnections||e.push(Mn),this.mode==="strict"&&e.push(Nn),this.mode==="loose"&&e.push(Vn),o.validator&&e.push(o.validator),this.validator=i=>e.every(n=>n(i))}},Mn=t=>t.source!==t.target,Nn=t=>t.sourceHandleType!==t.targetHandleType,Vn=t=>t.sourceHandle!==void 0&&t.targetHandle!==void 0;function Te(t){return t.split("").reduce((o,e)=>(o=(o<<5)-o+e.charCodeAt(0),o&o),0)}var G=(()=>{class t{constructor(){this.nodes=l([],{equal:(e,i)=>!e.length&&!i.length?!0:e===i}),this.rawNodes=m(()=>this.nodes().map(e=>e.rawNode)),this.edges=l([],{equal:(e,i)=>!e.length&&!i.length?!0:e===i}),this.rawEdges=m(()=>this.edges().map(e=>e.edge)),this.validEdges=m(()=>{let e=this.nodes();return this.edges().filter(i=>e.includes(i.source())&&e.includes(i.target()))}),this.connection=l(new Ke({})),this.markers=m(()=>{let e=new Map;this.validEdges().forEach(n=>{let r=n.markers();if(r?.start){let a=Te(JSON.stringify(r.start));e.set(a,r.start)}if(r?.end){let a=Te(JSON.stringify(r.end));e.set(a,r.end)}});let i=this.connection().settings.marker;if(i){let n=Te(JSON.stringify(i));e.set(n,i)}return e}),this.entities=m(()=>[...this.nodes(),...this.edges()]),this.minimap=l(null)}getNode(e){return this.nodes().find(({rawNode:i})=>i.id===e)}getDetachedEdges(){return this.edges().filter(e=>e.detached())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();function Kt(t){let o=t.sourceHandle.rawHandle.type,e=t.targetHandle.rawHandle.type;if(o===e)return{source:t.source,sourceHandle:t.sourceHandle,target:t.target,targetHandle:t.targetHandle};let i={};return o==="source"?(i.source=t.source,i.sourceHandle=t.sourceHandle):(i.source=t.target,i.sourceHandle=t.targetHandle),e==="target"?(i.target=t.target,i.targetHandle=t.targetHandle):(i.target=t.source,i.targetHandle=t.sourceHandle),i}function ji(t){return{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}}}function Li(t){return{valid:t.payload.valid,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:t.payload.target.rawNode,handle:{id:t.payload.targetHandle.rawHandle.id,type:t.payload.targetHandle.rawHandle.type,position:t.payload.targetHandle.rawHandle.position}}}}function Ai(t){return{valid:null,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:null,handle:null}}}function Gi(t){return{edge:t.payload.oldEdge.edge,node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}}}function Bi(t){return{valid:t.payload.valid,edge:t.payload.oldEdge.edge,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:t.payload.target.rawNode,handle:{id:t.payload.targetHandle.rawHandle.id,type:t.payload.targetHandle.rawHandle.type,position:t.payload.targetHandle.rawHandle.position}}}}function Wi(t){return{valid:null,edge:t.payload.oldEdge.edge,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:null,handle:null}}}var zt=(()=>{class t{constructor(){this.statusService=s(ie),this.flowEntitiesService=s(G),this.connectStart=q(this.statusService.status$.pipe(D(e=>e.state==="connection-start"),y(ji))),this.connect=q(this.statusService.status$.pipe(D(e=>e.state==="connection-release"),y(e=>Xi(e,this.isStrictMode())),P(e=>{let i=this.statusService.status();this.statusService.setConnectionReleaseValidatedStatus(i.payload.source,i.payload.target,i.payload.sourceHandle,i.payload.targetHandle,this.flowEntitiesService.connection().validator(e))}),D(e=>this.flowEntitiesService.connection().validator(e)))),this.connectEnd=q(X(this.statusService.status$.pipe(D(e=>e.state==="connection-release-validated"),y(Li)),this.statusService.status$.pipe(D(e=>e.state==="connection-dropped"),y(Ai))).pipe(P(()=>this.statusService.setIdleStatus()))),this.reconnectStart=q(this.statusService.status$.pipe(D(e=>e.state==="reconnection-start"),y(Gi))),this.reconnect=q(x(this.statusService.status).pipe(D(e=>e.state==="reconnection-release"),y(e=>{let i=Xi(e,this.isStrictMode()),n=e.payload.oldEdge.edge;return{connection:i,oldEdge:n}}),P(({connection:e})=>{let i=this.statusService.status();this.statusService.setReconnectionReleaseValidatedStatus(i.payload.source,i.payload.target,i.payload.sourceHandle,i.payload.targetHandle,i.payload.oldEdge,this.flowEntitiesService.connection().validator(e))}),D(({connection:e})=>this.flowEntitiesService.connection().validator(e)))),this.reconnectEnd=q(X(this.statusService.status$.pipe(D(e=>e.state==="reconnection-release-validated"),y(Bi)),this.statusService.status$.pipe(D(e=>e.state==="reconnection-dropped"),y(Wi))).pipe(P(()=>this.statusService.setIdleStatus()))),this.isStrictMode=m(()=>this.flowEntitiesService.connection().mode==="strict")}startConnection(e){this.statusService.setConnectionStartStatus(e.parentNode,e)}startReconnection(e,i){this.statusService.setReconnectionStartStatus(e.parentNode,e,i)}validateConnection(e){let i=this.statusService.status();if(i.state==="connection-start"||i.state==="reconnection-start"){let n=i.state==="reconnection-start",r=i.payload.source,a=e.parentNode,c=i.payload.sourceHandle,f=e;if(this.isStrictMode()){let p=Kt({source:i.payload.source,sourceHandle:i.payload.sourceHandle,target:e.parentNode,targetHandle:e});r=p.source,a=p.target,c=p.sourceHandle,f=p.targetHandle}let u=this.flowEntitiesService.connection().validator({source:r.rawNode.id,target:a.rawNode.id,sourceHandle:c.rawHandle.id,targetHandle:f.rawHandle.id,sourceHandleType:c.rawHandle.type,targetHandleType:f.rawHandle.type});e.state.set(u?"valid":"invalid"),n?this.statusService.setReconnectionValidationStatus(u,i.payload.source,e.parentNode,i.payload.sourceHandle,e,i.payload.oldEdge):this.statusService.setConnectionValidationStatus(u,i.payload.source,e.parentNode,i.payload.sourceHandle,e)}}resetValidateConnection(e){e.state.set("idle");let i=this.statusService.status();(i.state==="connection-validation"||i.state==="reconnection-validation")&&(i.state==="reconnection-validation"?this.statusService.setReconnectionStartStatus(i.payload.source,i.payload.sourceHandle,i.payload.oldEdge):this.statusService.setConnectionStartStatus(i.payload.source,i.payload.sourceHandle))}endConnection(){let e=this.statusService.status();if(e.state==="connection-validation"||e.state==="reconnection-validation"){let i=e.state==="reconnection-validation",n=e.payload.source,r=e.payload.sourceHandle,a=e.payload.target,c=e.payload.targetHandle;i?this.statusService.setReconnectionReleaseStatus(n,a,r,c,e.payload.oldEdge):this.statusService.setConnectionReleaseStatus(n,a,r,c)}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","connectStart",""],["","connect",""],["","connectEnd",""],["","reconnectStart",""],["","reconnect",""],["","reconnectEnd",""]],outputs:{connectStart:"connectStart",connect:"connect",connectEnd:"connectEnd",reconnectStart:"reconnectStart",reconnect:"reconnect",reconnectEnd:"reconnectEnd"}})}}return t})();function Xi(t,o){let e=t.payload.source,i=t.payload.target,n=t.payload.sourceHandle,r=t.payload.targetHandle;if(o){let p=Kt({source:t.payload.source,sourceHandle:t.payload.sourceHandle,target:t.payload.target,targetHandle:t.payload.targetHandle});e=p.source,i=p.target,n=p.sourceHandle,r=p.targetHandle}let a=e.rawNode.id,c=i.rawNode.id,f=n.rawHandle.id,u=r.rawHandle.id;return{source:a,target:c,sourceHandle:f,targetHandle:u,sourceHandleType:n.rawHandle.type,targetHandleType:r.rawHandle.type}}mi();var Re=(()=>{class t{constructor(){this.host=s(Y).nativeElement,this.initialTouch$=new We,this.prevTouchEvent=null,this.mouseMovement$=le(this.host,"mousemove").pipe(y(e=>({x:e.clientX,y:e.clientY,movementX:e.movementX,movementY:e.movementY,target:e.target,originalEvent:e})),_e(jt),Ye()),this.touchMovement$=X(this.initialTouch$,le(this.host,"touchmove")).pipe(P(e=>e.preventDefault()),y(e=>{let i=e.touches[0]?.clientX??0,n=e.touches[0]?.clientY??0,r=this.prevTouchEvent?e.touches[0].pageX-this.prevTouchEvent.touches[0].pageX:0,a=this.prevTouchEvent?e.touches[0].pageY-this.prevTouchEvent.touches[0].pageY:0,c=document.elementFromPoint(i,n);return{x:i,y:n,movementX:r,movementY:a,target:c,originalEvent:e}}),P(e=>this.prevTouchEvent=e.originalEvent),_e(jt),Ye()),this.pointerMovement$=X(this.mouseMovement$,this.touchMovement$),this.touchEnd$=le(this.host,"touchend").pipe(y(e=>{let i=e.changedTouches[0]?.clientX??0,n=e.changedTouches[0]?.clientY??0,r=document.elementFromPoint(i,n);return{x:i,y:n,target:r,originalEvent:e}}),P(()=>this.prevTouchEvent=null),Ye()),this.mouseUp$=le(this.host,"mouseup").pipe(y(e=>{let i=e.clientX,n=e.clientY,r=e.target;return{x:i,y:n,target:r,originalEvent:e}}),Ye()),this.documentPointerEnd$=X(le(document,"mouseup"),le(document,"touchend")).pipe(Ye())}setInitialTouch(e){this.initialTouch$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["svg","rootPointer",""]]})}}return t})();var Yi=(t,o)=>{let e=Math.max(0,Math.min(t.x+t.width,o.x+o.width)-Math.max(t.x,o.x)),i=Math.max(0,Math.min(t.y+t.height,o.y+o.height)-Math.max(t.y,o.y));return Math.ceil(e*i)};function Rt(t){if(t.length===0)return{x:0,y:0,width:0,height:0};let o={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return t.forEach(e=>{let i=Pn(e);o=In(o,i)}),Fn(o)}function Ui(t,o,e){let i=o.find(r=>r.rawNode.id===t);if(!i)return[];let n=mt(i);return o.filter(r=>{if(r.rawNode.id===t)return!1;let a=Yi(mt(r),n);return e?.partially?a>0:a>=n.width*n.height})}function Pn(t){return{x:t.point().x,y:t.point().y,x2:t.point().x+t.size().width,y2:t.point().y+t.size().height}}function mt(t){return{x:t.globalPoint().x,y:t.globalPoint().y,width:t.width(),height:t.height()}}function Fn({x:t,y:o,x2:e,y2:i}){return{x:t,y:o,width:e-t,height:i-o}}function In(t,o){return{x:Math.min(t.x,o.x),y:Math.min(t.y,o.y),x2:Math.max(t.x2,o.x2),y2:Math.max(t.y2,o.y2)}}function Zi(t,o,e,i,n,r){let a=o/(t.width*(1+r)),c=e/(t.height*(1+r)),f=Math.min(a,c),u=$n(f,i,n),p=t.x+t.width/2,O=t.y+t.height/2,h=o/2-p*u,_=e/2-O*u;return{x:h,y:_,zoom:u}}function $n(t,o=0,e=1){return Math.min(Math.max(t,o),e)}function jn(t,o,e){let i=t.zoom;return{x:-t.x/i,y:-t.y/i,width:o/i,height:e/i}}function qi(t,o,e,i){let n=jn(o,e,i);return!(t.x+t.width<n.x||t.x>n.x+n.width||t.y+t.height<n.y||t.y>n.y+n.height)}var Qi={detachedGroupsLayer:!1,virtualization:!1,virtualizationZoomThreshold:.5,lazyLoadTrigger:"immediate"};var V=(()=>{class t{constructor(){this.entitiesSelectable=l(!0),this.elevateNodesOnSelect=l(!0),this.elevateEdgesOnSelect=l(!0),this.autoPan=l(!0),this.view=l([400,400]),this.computedFlowWidth=l(0),this.computedFlowHeight=l(0),this.minZoom=l(.5),this.maxZoom=l(3),this.background=l({type:"solid",color:"#fff"}),this.snapGrid=l([1,1]),this.optimization=l(Qi),this.selectionMode=l("default")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var K=(()=>{class t{constructor(){this.entitiesService=s(G),this.flowSettingsService=s(V),this.writableViewport=l({changeType:"initial",state:t.getDefaultViewport(),duration:0}),this.readableViewport=l(t.getDefaultViewport()),this.viewportChangeEnd$=new We}static getDefaultViewport(){return{zoom:1,x:0,y:0}}fitView(e={padding:.1,duration:0,nodes:[]}){let i=this.getBoundsNodes(e.nodes??[]),n=Zi(Rt(i),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom(),e.padding??.1),r=e.duration??0;this.writableViewport.set({changeType:"absolute",state:n,duration:r})}triggerViewportChangeEvent(e){e==="end"&&this.viewportChangeEnd$.next()}getBoundsNodes(e){return e?.length?e.map(i=>this.entitiesService.nodes().find(({rawNode:n})=>n.id===i)).filter(i=>!!i):this.entitiesService.nodes()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var et=t=>Math.round(t*100)/100;var xe=(()=>{class t{constructor(){this.element=s(Y).nativeElement}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["svg","rootSvgRef",""]]})}}return t})();var ke=(()=>{class t{constructor(){this.pointerMovementDirective=s(Re),this.rootSvg=s(xe).element,this.host=s(Y).nativeElement,this.viewportService=s(K),this.svgCurrentSpacePoint=m(()=>{this.viewportService.readableViewport();let e=this.currentPoint();return e?this.documentPointToFlowPoint({x:e.x,y:e.y}):{x:0,y:0}}),this.currentPoint=Dt(this.pointerMovementDirective.pointerMovement$)}documentPointToFlowPoint(e){let i=this.rootSvg.createSVGPoint();return i.x=e.x,i.y=e.y,i.matrixTransform(this.host.getScreenCTM().inverse())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["g","spacePointContext",""]]})}}return t})();function Ji(t){return window.TouchEvent&&t instanceof TouchEvent}var tt=(()=>{class t{constructor(){this.hostElement=s(Y).nativeElement,this.pointerMovementDirective=s(Re),this.pointerOver=lt(),this.pointerOut=lt(),this.pointerStart=lt(),this.pointerEnd=lt(),this.wasPointerOver=!1,this.touchEnd=this.pointerMovementDirective.touchEnd$.pipe(D(({target:e})=>e===this.hostElement),P(({originalEvent:e})=>this.pointerEnd.emit(e)),Z()).subscribe(),this.touchOverOut=this.pointerMovementDirective.touchMovement$.pipe(P(({target:e,originalEvent:i})=>{this.handleTouchOverAndOut(e,i)}),Z()).subscribe()}onPointerStart(e){this.pointerStart.emit(e),Ji(e)&&this.pointerMovementDirective.setInitialTouch(e)}onPointerEnd(e){this.pointerEnd.emit(e)}onMouseOver(e){this.pointerOver.emit(e)}onMouseOut(e){this.pointerOut.emit(e)}handleTouchOverAndOut(e,i){e===this.hostElement?(this.pointerOver.emit(i),this.wasPointerOver=!0):(this.wasPointerOver&&this.pointerOut.emit(i),this.wasPointerOver=!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","pointerStart",""],["","pointerEnd",""],["","pointerOver",""],["","pointerOut",""]],hostBindings:function(i,n){i&1&&A("mousedown",function(a){return n.onPointerStart(a)})("touchstart",function(a){return n.onPointerStart(a)})("mouseup",function(a){return n.onPointerEnd(a)})("mouseover",function(a){return n.onMouseOver(a)})("mouseout",function(a){return n.onMouseOut(a)})},outputs:{pointerOver:"pointerOver",pointerOut:"pointerOut",pointerStart:"pointerStart",pointerEnd:"pointerEnd"}})}}return t})();function re(t,o){return Math.ceil(t/o)*o}var Ln=["resizer"],An=["resizable",""],Gn=["*"];function Bn(t,o){if(t&1){let e=ne();S(),b(0,"g")(1,"line",1),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("top",n))}),z(),b(2,"line",2),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("left",n))}),z(),b(3,"line",3),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("bottom",n))}),z(),b(4,"line",4),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("right",n))}),z(),b(5,"rect",5),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("top-left",n))}),z(),b(6,"rect",6),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("top-right",n))}),z(),b(7,"rect",7),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("bottom-left",n))}),z(),b(8,"rect",8),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("bottom-right",n))}),z()()}if(t&2){let e=d();g(),w("x1",e.lineGap)("y1",-e.gap())("x2",e.model.size().width-e.lineGap)("y2",-e.gap())("stroke",e.resizerColor()),g(),w("x1",-e.gap())("y1",e.lineGap)("x2",-e.gap())("y2",e.model.size().height-e.lineGap)("stroke",e.resizerColor()),g(),w("x1",e.lineGap)("y1",e.model.size().height+e.gap())("x2",e.model.size().width-e.lineGap)("y2",e.model.size().height+e.gap())("stroke",e.resizerColor()),g(),w("x1",e.model.size().width+e.gap())("y1",e.lineGap)("x2",e.model.size().width+e.gap())("y2",e.model.size().height-e.lineGap)("stroke",e.resizerColor()),g(),w("x",-(e.handleSize/2)-e.gap())("y",-(e.handleSize/2)-e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),g(),w("x",e.model.size().width-e.handleSize/2+e.gap())("y",-(e.handleSize/2)-e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),g(),w("x",-(e.handleSize/2)-e.gap())("y",e.model.size().height-e.handleSize/2+e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),g(),w("x",e.model.size().width-e.handleSize/2+e.gap())("y",e.model.size().height-e.handleSize/2+e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor())}}var Ki=(()=>{class t{get model(){return this.nodeAccessor.model()}constructor(){this.nodeAccessor=s(be),this.rootPointer=s(Re),this.viewportService=s(K),this.spacePointContext=s(ke),this.settingsService=s(V),this.hostRef=s(Y),this.resizable=k(),this.resizerColor=k("#2e414c"),this.gap=k(1.5),this.resizer=Ie.required("resizer"),this.lineGap=3,this.handleSize=6,this.resizeSide=null,this.zoom=m(()=>this.viewportService.readableViewport().zoom??0),this.minWidth=0,this.minHeight=0,this.maxWidth=1/0,this.maxHeight=1/0,this.resizeOnGlobalMouseMove=this.rootPointer.pointerMovement$.pipe(D(()=>this.resizeSide!==null),D(e=>e.movementX!==0||e.movementY!==0),P(e=>this.resize(e)),Z()).subscribe(),this.endResizeOnGlobalMouseUp=this.rootPointer.documentPointerEnd$.pipe(P(()=>this.endResize()),Z()).subscribe(),ye(()=>{let e=this.resizable();typeof e=="boolean"?this.model.resizable.set(e):this.model.resizable.set(!0)},{allowSignalWrites:!0})}ngOnInit(){this.model.controlledByResizer.set(!0),this.model.resizerTemplate.set(this.resizer())}ngOnDestroy(){this.model.controlledByResizer.set(!1)}ngAfterViewInit(){this.minWidth=+getComputedStyle(this.hostRef.nativeElement).minWidth.replace("px","")||0,this.minHeight=+getComputedStyle(this.hostRef.nativeElement).minHeight.replace("px","")||0,this.maxWidth=+getComputedStyle(this.hostRef.nativeElement).maxWidth.replace("px","")||1/0,this.maxHeight=+getComputedStyle(this.hostRef.nativeElement).maxHeight.replace("px","")||1/0}startResize(e,i){i.stopPropagation(),this.resizeSide=e,this.model.resizing.set(!0)}resize(e){if(!this.resizeSide)return;let i=Wn(e.movementX,e.movementY,this.zoom()),n=this.applyResize(this.resizeSide,this.model,i,this.getDistanceToEdge(e)),{x:r,y:a,width:c,height:f}=Xn(n,this.model,this.resizeSide,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);this.model.setPoint({x:r,y:a}),this.model.width.set(c),this.model.height.set(f)}endResize(){this.resizeSide=null,this.model.resizing.set(!1)}getDistanceToEdge(e){let i=this.spacePointContext.documentPointToFlowPoint({x:e.x,y:e.y}),{x:n,y:r}=this.model.globalPoint();return{left:i.x-n,right:i.x-(n+this.model.width()),top:i.y-r,bottom:i.y-(r+this.model.height())}}applyResize(e,i,n,r){let{x:a,y:c}=i.point(),f=i.width(),u=i.height(),[p,O]=this.settingsService.snapGrid();switch(e){case"left":{let h=n.x+r.left,_=re(a+h,p),C=_-a;return{x:_,y:c,width:f-C,height:u}}case"right":{let h=n.x+r.right,_=re(f+h,p);return{x:a,y:c,width:_,height:u}}case"top":{let h=n.y+r.top,_=re(c+h,O),C=_-c;return{x:a,y:_,width:f,height:u-C}}case"bottom":{let h=n.y+r.bottom,_=re(u+h,O);return{x:a,y:c,width:f,height:_}}case"top-left":{let h=n.x+r.left,_=n.y+r.top,C=re(a+h,p),E=re(c+_,O),I=C-a,ee=E-c;return{x:C,y:E,width:f-I,height:u-ee}}case"top-right":{let h=n.x+r.right,_=n.y+r.top,C=re(c+_,O),E=C-c;return{x:a,y:C,width:re(f+h,p),height:u-E}}case"bottom-left":{let h=n.x+r.left,_=n.y+r.bottom,C=re(a+h,p),E=C-a;return{x:C,y:c,width:f-E,height:re(u+_,O)}}case"bottom-right":{let h=n.x+r.right,_=n.y+r.bottom;return{x:a,y:c,width:re(f+h,p),height:re(u+_,O)}}}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["","resizable",""]],viewQuery:function(i,n){i&1&&Le(n.resizer,Ln,5),i&2&&Ae()},inputs:{resizable:[1,"resizable"],resizerColor:[1,"resizerColor"],gap:[1,"gap"]},attrs:An,ngContentSelectors:Gn,decls:3,vars:0,consts:[["resizer",""],["stroke-width","2",1,"top",3,"pointerStart"],["stroke-width","2",1,"left",3,"pointerStart"],["stroke-width","2",1,"bottom",3,"pointerStart"],["stroke-width","2",1,"right",3,"pointerStart"],[1,"top-left",3,"pointerStart"],[1,"top-right",3,"pointerStart"],[1,"bottom-left",3,"pointerStart"],[1,"bottom-right",3,"pointerStart"]],template:function(i,n){i&1&&(_t(),T(0,Bn,9,40,"ng-template",null,0,zi),bt(2))},dependencies:[tt],styles:[".top[_ngcontent-%COMP%]{cursor:n-resize}.left[_ngcontent-%COMP%]{cursor:w-resize}.right[_ngcontent-%COMP%]{cursor:e-resize}.bottom[_ngcontent-%COMP%]{cursor:s-resize}.top-left[_ngcontent-%COMP%]{cursor:nw-resize}.top-right[_ngcontent-%COMP%]{cursor:ne-resize}.bottom-left[_ngcontent-%COMP%]{cursor:sw-resize}.bottom-right[_ngcontent-%COMP%]{cursor:se-resize}"],changeDetection:0})}}return rt([dt],t.prototype,"ngAfterViewInit",null),t})();function Wn(t,o,e){return{x:et(t/e),y:et(o/e)}}function Xn(t,o,e,i,n,r,a){let{x:c,y:f,width:u,height:p}=t;u=Math.max(u,0),p=Math.max(p,0),u=Math.max(i,u),p=Math.max(n,p),u=Math.min(r,u),p=Math.min(a,p),c=Math.min(c,o.point().x+o.width()-i),f=Math.min(f,o.point().y+o.height()-n),c=Math.max(c,o.point().x+o.width()-r),f=Math.max(f,o.point().y+o.height()-a);let O=o.parent();if(O){let _=O.width(),C=O.height(),E=o.point().x,I=o.point().y;c=Math.max(c,0),f=Math.max(f,0),e.includes("left")&&c===0&&(u=Math.min(u,E+o.width())),e.includes("top")&&f===0&&(p=Math.min(p,I+o.height())),u=Math.min(u,_-c),p=Math.min(p,C-f)}let h=Rt(o.children());return h&&(e.includes("left")&&(c=Math.min(c,o.point().x+o.width()-(h.x+h.width)),u=Math.max(u,h.x+h.width)),e.includes("right")&&(u=Math.max(u,h.x+h.width)),e.includes("bottom")&&(p=Math.max(p,h.y+h.height)),e.includes("top")&&(f=Math.min(f,o.point().y+o.height()-(h.y+h.height)),p=Math.max(p,h.y+h.height))),{x:c,y:f,width:u,height:p}}function ei(){let t=window.navigator.userAgent.toLowerCase(),o=/(macintosh|macintel|macppc|mac68k|macos)/i,e=/(win32|win64|windows|wince)/i,i=/(iphone|ipad|ipod)/i,n=null;return o.test(t)?n="macos":i.test(t)?n="ios":e.test(t)?n="windows":/android/.test(t)?n="android":!n&&/linux/.test(t)&&(n="linux"),n}var ut=(()=>{class t{constructor(){this.actions=l({multiSelection:[ei()==="macos"?"MetaLeft":"ControlLeft",ei()==="macos"?"MetaRight":"ControlRight"]}),this.actionsActive={multiSelection:!1},x(this.actions).pipe(te(()=>X(le(document,"keydown").pipe(P(e=>{for(let i in this.actions())(this.actions()[i]??[]).includes(e.code)&&(this.actionsActive[i]=!0)})),le(document,"keyup").pipe(P(e=>{for(let i in this.actions())(this.actions()[i]??[]).includes(e.code)&&(this.actionsActive[i]=!1)})))),Z()).subscribe()}setShortcuts(e){this.actions.update(i=>W(W({},i),e))}isActiveAction(e){return this.actionsActive[e]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var kt=class{select(o,e){o?.selected()||(e.isMultiSelectionActive||e.entities.forEach(i=>i.selected.set(!1)),o&&o.selected.set(!0))}handleViewportChange(o,e){let{start:i,end:n,target:r,delta:a}=o,c=Math.abs(n.x-i.x),f=Math.abs(n.y-i.y),u=c<a&&f<a,p=!r.closest(".selectable");u&&p&&this.select(null,e)}};var Ot=class{select(){}handleViewportChange(){}};var Oe=(()=>{class t{constructor(){this.flowEntitiesService=s(G),this.keyboardService=s(ut),this.flowSettingsService=s(V),this.strategies={default:new kt,manual:new Ot},this.currentStrategy=m(()=>this.strategies[this.flowSettingsService.selectionMode()]),this.viewport$=new We,this.viewportChangeSub=this.viewport$.pipe(P(({start:e,end:i,target:n})=>{e&&i&&n&&this.currentStrategy().handleViewportChange({start:e,end:i,target:n,delta:t.delta},{entities:this.flowEntitiesService.entities(),isMultiSelectionActive:this.keyboardService.isActiveAction("multiSelection")})}),Z()).subscribe()}static{this.delta=6}setViewport(e){this.viewport$.next(e)}select(e){this.currentStrategy().select(e,{entities:this.flowEntitiesService.entities(),isMultiSelectionActive:this.keyboardService.isActiveAction("multiSelection")})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var Mt=(()=>{class t{constructor(){this.rootSvg=s(xe).element,this.host=s(Y).nativeElement,this.selectionService=s(Oe),this.viewportService=s(K),this.flowSettingsService=s(V),this.zone=s(ue),this.rootSvgSelection=Je(this.rootSvg),this.transform=l(""),this.viewportForSelection={},this.manualViewportChangeEffect=ye(()=>{let e=this.viewportService.writableViewport(),i=e.state;if(e.changeType!=="initial"){if(R(i.zoom)&&!R(i.x)&&!R(i.y)){this.rootSvgSelection.transition().duration(e.duration).call(this.zoomBehavior.scaleTo,i.zoom);return}if(R(i.x)&&R(i.y)&&!R(i.zoom)){let n=Qe(this.viewportService.readableViewport).zoom;this.rootSvgSelection.transition().duration(e.duration).call(this.zoomBehavior.transform,Gt.translate(i.x,i.y).scale(n));return}if(R(i.x)&&R(i.y)&&R(i.zoom)){this.rootSvgSelection.transition().duration(e.duration).call(this.zoomBehavior.transform,Gt.translate(i.x,i.y).scale(i.zoom));return}}},{allowSignalWrites:!0}),this.handleZoom=({transform:e})=>{this.viewportService.readableViewport.set(ti(e)),this.transform.set(e.toString())},this.handleZoomStart=({transform:e})=>{this.viewportForSelection={start:ti(e)}},this.handleZoomEnd=({transform:e,sourceEvent:i})=>{this.zone.run(()=>{this.viewportForSelection=J(W({},this.viewportForSelection),{end:ti(e),target:Yn(i)}),this.viewportService.triggerViewportChangeEvent("end"),this.selectionService.setViewport(this.viewportForSelection)})},this.filterCondition=e=>e.type==="mousedown"||e.type==="touchstart"?e.target.closest(".vflow-node")===null:!0}ngOnInit(){this.zone.runOutsideAngular(()=>{this.zoomBehavior=Mi().scaleExtent([this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom()]).filter(this.filterCondition).on("start",this.handleZoomStart).on("zoom",this.handleZoom).on("end",this.handleZoomEnd),this.rootSvgSelection.call(this.zoomBehavior).on("dblclick.zoom",null)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["g","mapContext",""]],hostVars:1,hostBindings:function(i,n){i&2&&w("transform",n.transform())}})}}return t})(),ti=t=>({zoom:t.k,x:t.x,y:t.y}),Yn=t=>{if(t instanceof Event&&t.target instanceof Element)return t.target};var Nt=(()=>{class t{constructor(){this.entitiesService=s(G),this.settingsService=s(V),this.flowStatusService=s(ie),this.viewportService=s(K),this.injector=s(me)}enable(e,i){Je(e).call(this.getDragBehavior(i))}disable(e){Je(e).call(At().on("drag",null))}destroy(e){Je(e).on(".drag",null)}getDragBehavior(e){let i=[],n=[],r=null,a=c=>e.dragHandlesCount()?!!c.target.closest(".vflow-drag-handle"):!0;return At().filter(a).on("start",c=>{i=this.getDragNodes(e),this.flowStatusService.setNodeDragStartStatus(e),n=i.map(f=>({x:f.point().x-c.x,y:f.point().y-c.y})),r=this.moveNodesOnAutoPan$(i)}).on("drag",c=>{i.forEach((f,u)=>{let p={x:et(c.x+n[u].x),y:et(c.y+n[u].y)};this.alignToGrid(p),this.moveNode(f,p)})}).on("end",()=>{r?.unsubscribe(),r=null,this.flowStatusService.setNodeDragEndStatus(e)})}getDragNodes(e){return e.selected()?this.entitiesService.nodes().filter(i=>i.selected()&&i.draggable()):[e]}moveNode(e,i){let n=e.parent();n&&(i.x=Math.min(n.width()-e.width(),i.x),i.x=Math.max(0,i.x),i.y=Math.min(n.height()-e.height(),i.y),i.y=Math.max(0,i.y)),e.setPoint(i)}alignToGrid(e){let[i,n]=this.settingsService.snapGrid();return i>1&&(e.x=re(e.x,i)),n>1&&(e.y=re(e.y,n)),e}moveNodesOnAutoPan$(e){return x(this.viewportService.readableViewport,{injector:this.injector}).pipe(ve(1),Ee(),D(([i,n])=>i.x!==n.x||i.y!==n.y)).subscribe(([i,n])=>{let r=n.x-i.x,a=n.y-i.y,c=n.zoom,f=-r/c,u=-a/c;e.forEach(p=>{let O={x:p.point().x+f,y:p.point().y+u};this.moveNode(p,O)})})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();function ii(t,o){let e=t.reduce((i,n)=>(i[n.rawNode.id]=n,i),{});o.forEach(i=>{i.source.set(e[i.edge.source]),i.target.set(e[i.edge.target])})}function en(t,o,e){!o&&wi(t);let i=o??s(me);return e?at(i,e):i}function Me(t,o){let e=en(Me,o?.injector),i;return m(()=>(i||(i=Qe(()=>Dt(t,J(W({},o),{injector:e})))),i()))}function tn(t){return t.rawNode.type==="default-group"||t.rawNode.type==="template-group"}var pe=(()=>{class t{constructor(){this.flowEntitiesService=s(G),this.flowSettingsService=s(V),this.viewportService=s(K),this.nodes=m(()=>this.flowSettingsService.optimization().virtualization?this.viewportNodesAfterInteraction().sort((e,i)=>e.renderOrder()-i.renderOrder()):[...this.flowEntitiesService.nodes()].sort((e,i)=>e.renderOrder()-i.renderOrder())),this.groups=m(()=>this.nodes().filter(e=>!!e.children().length||tn(e))),this.nonGroups=m(()=>this.nodes().filter(e=>!this.groups().includes(e))),this.viewportNodes=m(()=>{let e=this.flowEntitiesService.nodes(),i=this.viewportService.readableViewport(),n=this.flowSettingsService.computedFlowWidth(),r=this.flowSettingsService.computedFlowHeight();return e.filter(a=>{let{x:c,y:f}=a.globalPoint(),u=a.width(),p=a.height();return qi({x:c,y:f,width:u,height:p},i,n,r)})}),this.viewportNodesAfterInteraction=Me(X(x(this.flowEntitiesService.nodes).pipe(_e(Xe),D(e=>!!e.length)),this.viewportService.viewportChangeEnd$.pipe(vi(300))).pipe(y(()=>{let e=this.viewportService.readableViewport(),i=this.flowSettingsService.optimization().virtualizationZoomThreshold;return e.zoom<i?[]:this.viewportNodes()})),{initialValue:[]}),this.maxOrder=m(()=>Math.max(...this.flowEntitiesService.nodes().map(e=>e.renderOrder())))}pullNode(e){e.renderOrder.set(this.maxOrder()+1),e.children().forEach(i=>this.pullNode(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();function Ge(t,o){o||(o={equal:Object.is});let e;return m(()=>e=t(e),o)}var Vt=class{constructor(o){this.rawNode=o,this.entitiesService=s(G),this.settingsService=s(V),this.nodeRenderingService=s(pe),this.isVisible=l(!1),this.point=l({x:0,y:0}),this.width=l(B.width),this.height=l(B.height),this.size=m(()=>({width:this.width(),height:this.height()})),this.styleWidth=m(()=>this.controlledByResizer()?`${this.width()}px`:"100%"),this.styleHeight=m(()=>this.controlledByResizer()?`${this.height()}px`:"100%"),this.foWidth=m(()=>this.width()+2),this.foHeight=m(()=>this.height()+2),this.renderOrder=l(0),this.selected=l(!1),this.preview=l({style:{}}),this.globalPoint=m(()=>{let e=this.parent(),i=this.point().x,n=this.point().y;for(;e!==null;)i+=e.point().x,n+=e.point().y,e=e.parent();return{x:i,y:n}}),this.pointTransform=m(()=>`translate(${this.globalPoint().x}, ${this.globalPoint().y})`),this.handles=l([]),this.draggable=l(!0),this.dragHandlesCount=l(0),this.magnetRadius=20,this.isComponentType=Fi(this.rawNode),this.shouldLoad=Ge(e=>{if(e||this.settingsService.optimization().lazyLoadTrigger==="immediate")return!0;if(this.settingsService.optimization().lazyLoadTrigger==="viewport"){if(ht(this.rawNode.type))return!0;if(pt(this.rawNode.type)||this.rawNode.type==="html-template"||this.rawNode.type==="svg-template"||this.rawNode.type==="template-group")return this.nodeRenderingService.viewportNodes().includes(this)}return!0}),this.componentInstance$=x(this.shouldLoad).pipe(D(Boolean),te(()=>this.rawNode.type()),gi(()=>ui(this.rawNode.type)),Ue(1)),this.text=l(B.text),this.componentTypeInputs={node:this.rawNode},this.parent=m(()=>this.entitiesService.nodes().find(e=>e.rawNode.id===this.parentId())??null),this.children=m(()=>this.entitiesService.nodes().filter(e=>e.parentId()===this.rawNode.id)),this.color=l(B.color),this.controlledByResizer=l(!1),this.resizable=l(B.resizable),this.resizing=l(!1),this.resizerTemplate=l(null),this.context={$implicit:{}},this.parentId=l(B.parentId),o.point&&(this.point=o.point),o.width&&(this.width=o.width),o.height&&(this.height=o.height),o.draggable&&(this.draggable=o.draggable),o.parentId&&(this.parentId=o.parentId),o.preview&&(this.preview=o.preview),o.selected&&(this.selected=o.selected),o.type==="default-group"&&o.color&&(this.color=o.color),o.type==="default-group"&&o.resizable&&(this.resizable=o.resizable),o.type==="default"&&o.text&&(this.text=o.text),o.type==="html-template"&&(this.context={$implicit:{node:o,data:o.data??l(B.data),selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}}),o.type==="svg-template"&&(this.context={$implicit:{node:o,data:o.data??l(B.data),selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),o.type==="template-group"&&(this.context={$implicit:{node:o,data:o.data??l(B.data),selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),this.point$=x(this.point),this.width$=x(this.width),this.height$=x(this.height),this.size$=x(this.size),this.selected$=x(this.selected),this.handles$=x(this.handles)}setPoint(o){this.point.set(o)}};var it=class{constructor(o){this.edgeLabel=o,this.size=l({width:0,height:0})}};function Se(t,o,e){return{x:(1-e)*t.x+e*o.x,y:(1-e)*t.y+e*o.y}}function ft({sourcePoint:t,targetPoint:o}){return{path:`M ${t.x},${t.y}L ${o.x},${o.y}`,labelPoints:{start:Se(t,o,.15),center:Se(t,o,.5),end:Se(t,o,.85)}}}function gt({sourcePoint:t,targetPoint:o,sourcePosition:e,targetPosition:i}){let n={x:t.x-o.x,y:t.y-o.y},r=nn(t,e,n),a=nn(o,i,n),c=`M${t.x},${t.y} C${r.x},${r.y} ${a.x},${a.y} ${o.x},${o.y}`;return Un(c,t,o,r,a)}function nn(t,o,e){let i={x:0,y:0};switch(o){case"top":i.y=1;break;case"bottom":i.y=-1;break;case"right":i.x=1;break;case"left":i.x=-1;break}let n={x:e.x*Math.abs(i.x),y:e.y*Math.abs(i.y)},a=.25*25*Math.sqrt(Math.abs(n.x+n.y));return{x:t.x+i.x*a,y:t.y-i.y*a}}function Un(t,o,e,i,n){return{path:t,labelPoints:{start:oi(o,e,i,n,.1),center:oi(o,e,i,n,.5),end:oi(o,e,i,n,.9)}}}function oi(t,o,e,i,n){let r=Se(t,e,n),a=Se(e,i,n),c=Se(i,o,n);return Se(Se(r,a,n),Se(a,c,n),n)}var on={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1}};function Zn(t,o){let e=Math.abs(o.x-t.x)/2,i=o.x<t.x?o.x+e:o.x-e,n=Math.abs(o.y-t.y)/2,r=o.y<t.y?o.y+n:o.y-n;return[i,r,e,n]}var qn=({source:t,sourcePosition:o="bottom",target:e})=>o==="left"||o==="right"?t.x<e.x?{x:1,y:0}:{x:-1,y:0}:t.y<e.y?{x:0,y:1}:{x:0,y:-1},rn=(t,o)=>Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2));function Qn({source:t,sourcePosition:o="bottom",target:e,targetPosition:i="top",offset:n}){let r=on[o],a=on[i],c={x:t.x+r.x*n,y:t.y+r.y*n},f={x:e.x+a.x*n,y:e.y+a.y*n},u=qn({source:c,sourcePosition:o,target:f}),p=u.x!==0?"x":"y",O=u[p],h=[],_,C,E={x:0,y:0},I={x:0,y:0},[ee,fe]=Zn(t,e);if(r[p]*a[p]===-1){_=ee,C=fe;let se=[{x:_,y:c.y},{x:_,y:f.y}],Q=[{x:c.x,y:C},{x:f.x,y:C}];r[p]===O?h=p==="x"?se:Q:h=p==="x"?Q:se}else{let se=[{x:c.x,y:f.y}],Q=[{x:f.x,y:c.y}];if(p==="x"?h=r.x===O?Q:se:h=r.y===O?se:Q,o===i){let He=Math.abs(t[p]-e[p]);if(He<=n){let Pe=Math.min(n-1,n-He);r[p]===O?E[p]=(c[p]>t[p]?-1:1)*Pe:I[p]=(f[p]>e[p]?-1:1)*Pe}}if(o!==i){let He=p==="x"?"y":"x",Pe=r[p]===a[He],ai=c[He]>f[He],li=c[He]<f[He];(r[p]===1&&(!Pe&&ai||Pe&&li)||r[p]!==1&&(!Pe&&li||Pe&&ai))&&(h=p==="x"?se:Q)}let ge={x:c.x+E.x,y:c.y+E.y},he={x:f.x+I.x,y:f.y+I.y},Rn=Math.max(Math.abs(ge.x-h[0].x),Math.abs(he.x-h[0].x)),kn=Math.max(Math.abs(ge.y-h[0].y),Math.abs(he.y-h[0].y));Rn>=kn?(_=(ge.x+he.x)/2,C=h[0].y):(_=h[0].x,C=(ge.y+he.y)/2)}return[[t,{x:c.x+E.x,y:c.y+E.y},...h,{x:f.x+I.x,y:f.y+I.y},e],_,C]}function Jn(t,o,e,i){let n=Math.min(rn(t,o)/2,rn(o,e)/2,i),{x:r,y:a}=o;if(t.x===r&&r===e.x||t.y===a&&a===e.y)return`L${r} ${a}`;if(t.y===a){let u=t.x<e.x?-1:1,p=t.y<e.y?1:-1;return`L ${r+n*u},${a}Q ${r},${a} ${r},${a+n*p}`}let c=t.x<e.x?1:-1,f=t.y<e.y?-1:1;return`L ${r},${a+n*f}Q ${r},${a} ${r+n*c},${a}`}function Ne({sourcePoint:t,targetPoint:o,sourcePosition:e,targetPosition:i},n=5){let[r,a,c]=Qn({source:t,sourcePosition:e,target:o,targetPosition:i,offset:20}),f=r.reduce((C,E,I)=>{let ee="";return I>0&&I<r.length-1?ee=Jn(r[I-1],E,r[I+1],n):ee=`${I===0?"M":"L"}${E.x} ${E.y}`,C+=ee,C},""),u=r.length;if(u<2)return{path:f,labelPoints:{start:{x:a,y:c},center:{x:a,y:c},end:{x:a,y:c}}};let p=new Array(u-1),O=new Array(u);O[0]=0;let h=0;for(let C=0;C<u-1;C++){let E=r[C+1].x-r[C].x,I=r[C+1].y-r[C].y,ee=Math.sqrt(E*E+I*I);p[C]=ee,h+=ee,O[C+1]=h}let _=C=>{let E=h*C;if(E<=0)return r[0];if(E>=h)return r[u-1];let I=0,ee=u-1;for(;I<ee-1;){let he=I+ee>>>1;O[he]<E?I=he:ee=he}let fe=O[I],se=(E-fe)/p[I],Q=r[I],ge=r[I+1];return{x:Q.x+(ge.x-Q.x)*se,y:Q.y+(ge.y-Q.y)*se}};return{path:f,labelPoints:{start:_(.15),center:{x:a,y:c},end:_(.85)}}}var Pt=class{constructor(o){this.edge=o,this.flowEntitiesService=s(G),this.source=l(void 0),this.target=l(void 0),this.curve=l(oe.curve),this.reconnectable=l(oe.reconnectable),this.floating=l(oe.floating),this.markers=l(oe.markers),this.edgeLabels=l(oe.edgeLabels),this.selected=l(oe.selected),this.selected$=x(this.selected),this.shouldLoad=m(()=>(this.source()?.shouldLoad()??!1)&&(this.target()?.shouldLoad()??!1)),this.renderOrder=l(0),this.detached=m(()=>{let e=this.source(),i=this.target();if(!e||!i)return!0;let n=!1,r=!1;return this.edge.sourceHandle?n=!!e.handles().find(a=>a.rawHandle.id===this.edge.sourceHandle):n=!!e.handles().find(a=>a.rawHandle.type==="source"),this.edge.targetHandle?r=!!i.handles().find(a=>a.rawHandle.id===this.edge.targetHandle):r=!!i.handles().find(a=>a.rawHandle.type==="target"),!n||!r}),this.detached$=x(this.detached),this.path=m(()=>{let e=this.sourceHandle(),i=this.targetHandle();if(!e||!i)return{path:""};let n=this.getPathFactoryParams(e,i),r=this.curve();switch(r){case"straight":return ft(n);case"bezier":return gt(n);case"smooth-step":return Ne(n);case"step":return Ne(n,0);default:return r(n)}}),this.sourceHandle=Ge(e=>{let i=null;return this.floating()?i=this.closestHandles().sourceHandle:this.edge.sourceHandle?i=this.source()?.handles().find(n=>n.rawHandle.id===this.edge.sourceHandle)??null:i=this.source()?.handles().find(n=>n.rawHandle.type==="source")??null,i===null?e:i}),this.targetHandle=Ge(e=>{let i=null;return this.floating()?i=this.closestHandles().targetHandle:this.edge.targetHandle?i=this.target()?.handles().find(n=>n.rawHandle.id===this.edge.targetHandle)??null:i=this.target()?.handles().find(n=>n.rawHandle.type==="target")??null,i===null?e:i}),this.closestHandles=m(()=>{let e=this.source(),i=this.target();if(!e||!i)return{sourceHandle:null,targetHandle:null};let n=this.flowEntitiesService.connection().mode==="strict"?e.handles().filter(u=>u.rawHandle.type==="source"):e.handles(),r=this.flowEntitiesService.connection().mode==="strict"?i.handles().filter(u=>u.rawHandle.type==="target"):i.handles();if(n.length===0||r.length===0)return{sourceHandle:null,targetHandle:null};let a=1/0,c=null,f=null;for(let u of n)for(let p of r){let O=u.pointAbsolute(),h=p.pointAbsolute(),_=Math.sqrt(Math.pow(O.x-h.x,2)+Math.pow(O.y-h.y,2));_<a&&(a=_,c=u,f=p)}return{sourceHandle:c,targetHandle:f}}),this.markerStartUrl=m(()=>{let e=this.markers()?.start;return e?`url(#${Te(JSON.stringify(e))})`:""}),this.markerEndUrl=m(()=>{let e=this.markers()?.end;return e?`url(#${Te(JSON.stringify(e))})`:""}),this.labelModels=m(()=>{let e={},i=this.edgeLabels();return i?.start&&(e.start=new it(i.start)),i?.center&&(e.center=new it(i.center)),i?.end&&(e.end=new it(i.end)),e}),this.type=o.type??oe.type,o.curve&&(this.curve=o.curve),o.reconnectable&&(this.reconnectable=o.reconnectable),o.floating&&(this.floating=o.floating),o.selected&&(this.selected=o.selected),o.markers&&(this.markers=o.markers),o.edgeLabels&&(this.edgeLabels=o.edgeLabels),this.context={$implicit:{edge:this.edge,data:this.edge.data??l({}),path:m(()=>this.path().path),markerStart:this.markerStartUrl,markerEnd:this.markerEndUrl,selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}},this.selected$=x(this.selected)}getPathFactoryParams(o,e){return{mode:"edge",edge:this.edge,sourcePoint:o.pointAbsolute(),targetPoint:e.pointAbsolute(),sourcePosition:o.rawHandle.position,targetPosition:e.rawHandle.position,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}};var vt=class{static nodes(o,e){let i=new Map;return e.forEach(n=>i.set(n.rawNode,n)),o.map(n=>i.get(n)??new Vt(n))}static edges(o,e){let i=new Map;return e.forEach(n=>i.set(n.edge,n)),o.map(n=>i.has(n)?i.get(n):new Pt(n))}};var Kn=25,yt=(()=>{class t{constructor(){this.entitiesService=s(G),this.nodesPositionChange$=x(this.entitiesService.nodes).pipe(te(e=>X(...e.map(i=>i.point$.pipe(ve(1),y(()=>i))))),y(e=>[{type:"position",id:e.rawNode.id,point:e.point()},...this.entitiesService.nodes().filter(i=>i!==e&&i.selected()).map(i=>({type:"position",id:i.rawNode.id,point:i.point()}))])),this.nodeSizeChange$=x(this.entitiesService.nodes).pipe(te(e=>X(...e.map(i=>i.size$.pipe(ve(1),y(()=>i))))),y(e=>[{type:"size",id:e.rawNode.id,size:e.size()}])),this.nodeAddChange$=x(this.entitiesService.nodes).pipe(Ee(),y(([e,i])=>i.filter(n=>!e.includes(n))),D(e=>!!e.length),y(e=>e.map(i=>({type:"add",id:i.rawNode.id})))),this.nodeRemoveChange$=x(this.entitiesService.nodes).pipe(Ee(),y(([e,i])=>e.filter(n=>!i.includes(n))),D(e=>!!e.length),y(e=>e.map(i=>({type:"remove",id:i.rawNode.id})))),this.nodeSelectedChange$=x(this.entitiesService.nodes).pipe(te(e=>X(...e.map(i=>i.selected$.pipe(st(),ve(1),y(()=>i))))),y(e=>[{type:"select",id:e.rawNode.id,selected:e.selected()}])),this.changes$=X(this.nodesPositionChange$,this.nodeSizeChange$,this.nodeAddChange$,this.nodeRemoveChange$,this.nodeSelectedChange$).pipe(_e(Xe,Kn))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var eo=(t,o)=>t.length===o.length&&[...new Set([...t,...o])].every(e=>t.filter(i=>i===e).length===o.filter(i=>i===e).length),St=(()=>{class t{constructor(){this.entitiesService=s(G),this.edgeDetachedChange$=X(x(m(()=>{let e=this.entitiesService.nodes();return Qe(this.entitiesService.edges).filter(({source:n,target:r})=>!e.includes(n())||!e.includes(r()))})),x(this.entitiesService.edges).pipe(te(e=>fi(...e.map(i=>i.detached$.pipe(y(()=>i))))),y(e=>e.filter(i=>i.detached())),ve(2))).pipe(st(eo),D(e=>!!e.length),y(e=>e.map(({edge:i})=>({type:"detached",id:i.id})))),this.edgeAddChange$=x(this.entitiesService.edges).pipe(Ee(),y(([e,i])=>i.filter(n=>!e.includes(n))),D(e=>!!e.length),y(e=>e.map(({edge:i})=>({type:"add",id:i.id})))),this.edgeRemoveChange$=x(this.entitiesService.edges).pipe(Ee(),y(([e,i])=>e.filter(n=>!i.includes(n))),D(e=>!!e.length),y(e=>e.map(({edge:i})=>({type:"remove",id:i.id})))),this.edgeSelectChange$=x(this.entitiesService.edges).pipe(te(e=>X(...e.map(i=>i.selected$.pipe(st(),ve(1),y(()=>i))))),y(e=>[{type:"select",id:e.edge.id,selected:e.selected()}])),this.changes$=X(this.edgeDetachedChange$,this.edgeAddChange$,this.edgeRemoveChange$,this.edgeSelectChange$).pipe(_e(Xe))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var sn=(()=>{class t{constructor(){this.nodesChangeService=s(yt),this.edgesChangeService=s(St),this.nodesChanges=q(this.nodesChangeService.changes$),this.nodesChangesPosition=q(this.nodeChangesOfType("position"),{alias:"nodesChanges.position"}),this.nodesChangesSize=q(this.nodeChangesOfType("size"),{alias:"nodesChanges.size"}),this.nodesChangesAdd=q(this.nodeChangesOfType("add"),{alias:"nodesChanges.add"}),this.nodesChangesRemove=q(this.nodeChangesOfType("remove"),{alias:"nodesChanges.remove"}),this.nodesChangesSelect=q(this.nodeChangesOfType("select"),{alias:"nodesChanges.select"}),this.edgesChanges=q(this.edgesChangeService.changes$),this.edgesChangesDetached=q(this.edgeChangesOfType("detached"),{alias:"edgesChanges.detached"}),this.edgesChangesAdd=q(this.edgeChangesOfType("add"),{alias:"edgesChanges.add"}),this.edgesChangesRemove=q(this.edgeChangesOfType("remove"),{alias:"edgesChanges.remove"}),this.edgesChangesSelect=q(this.edgeChangesOfType("select"),{alias:"edgesChanges.select"})}nodeChangesOfType(e){return this.nodesChangeService.changes$.pipe(y(i=>i.filter(n=>n.type===e)),D(i=>!!i.length))}edgeChangesOfType(e){return this.edgesChangeService.changes$.pipe(y(i=>i.filter(n=>n.type===e)),D(i=>!!i.length))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","changesController",""]],outputs:{nodesChanges:"nodesChanges",nodesChangesPosition:"nodesChanges.position",nodesChangesSize:"nodesChanges.size",nodesChangesAdd:"nodesChanges.add",nodesChangesRemove:"nodesChanges.remove",nodesChangesSelect:"nodesChanges.select",edgesChanges:"edgesChanges",edgesChangesDetached:"edgesChanges.detached",edgesChangesAdd:"edgesChanges.add",edgesChangesRemove:"edgesChanges.remove",edgesChangesSelect:"edgesChanges.select"}})}}return t})();function an(t){return typeof t=="string"?{type:"solid",color:t}:t}mi();var Ft=(()=>{class t{constructor(){this.toolbars=l([]),this.nodeToolbarsMap=m(()=>{let e=new Map;return this.toolbars().forEach(i=>{let n=e.get(i.node)??[];e.set(i.node,[...n,i])}),e})}addToolbar(e){this.toolbars.update(i=>[...i,e])}removeToolbar(e){this.toolbars.update(i=>i.filter(n=>n!==e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return rt([dt],t.prototype,"addToolbar",null),rt([dt],t.prototype,"removeToolbar",null),t})();function Ve(t,o){return new di(e=>{let i=new ResizeObserver(n=>{o.run(()=>e.next(n))});return t.forEach(n=>i.observe(n)),()=>i.disconnect()})}var io=["edgeLabelWrapper"],no=["edgeLabel",""];function oo(t,o){t&1&&ae(0)}function ro(t,o){if(t&1&&(S(),b(0,"foreignObject"),De(),b(1,"div",1,0),T(3,oo,1,0,"ng-container",2),z()()),t&2){let e=d(2),i=d();w("x",i.edgeLabelPoint().x)("y",i.edgeLabelPoint().y)("width",e.size().width)("height",e.size().height),g(3),N("ngTemplateOutlet",o)("ngTemplateOutletContext",i.getLabelContext())}}function so(t,o){if(t&1&&T(0,ro,4,6,":svg:foreignObject"),t&2){let e,i=d(2);v((e=i.htmlTemplate())?0:-1,e)}}function ao(t,o){if(t&1&&(S(),b(0,"foreignObject"),De(),b(1,"div",1,0),Ei(3),z()()),t&2){let e=d(),i=d();w("x",i.edgeLabelPoint().x)("y",i.edgeLabelPoint().y)("width",e.size().width)("height",e.size().height),g(),Ti(i.edgeLabelStyle()),g(2),Di(" ",e.edgeLabel.text," ")}}function lo(t,o){if(t&1&&T(0,so,1,1)(1,ao,4,7,":svg:foreignObject"),t&2){let e=o,i=d();v(e.edgeLabel.type==="html-template"&&i.htmlTemplate()?0:-1),g(),v(e.edgeLabel.type==="default"?1:-1)}}var ln=(()=>{class t{constructor(){this.zone=s(ue),this.destroyRef=s(ze),this.settingsService=s(V),this.model=k.required(),this.edgeModel=k.required(),this.point=k({x:0,y:0}),this.htmlTemplate=k(),this.edgeLabelWrapperRef=Ie.required("edgeLabelWrapper"),this.edgeLabelPoint=m(()=>{let e=this.point(),{width:i,height:n}=this.model().size();return{x:e.x-i/2,y:e.y-n/2}}),this.edgeLabelStyle=m(()=>{let e=this.model().edgeLabel;if(e.type==="default"&&e.style){let i=this.settingsService.background(),n="transparent";return i.type==="dots"&&(n=i.backgroundColor??"#fff"),i.type==="solid"&&(n=i.color),e.style.backgroundColor=e.style.backgroundColor??n,e.style}return null})}ngAfterViewInit(){let e=this.edgeLabelWrapperRef().nativeElement;Ve([e],this.zone).pipe(xt(null),P(()=>{let i=e.clientWidth+2,n=e.clientHeight+2;this.model().size.set({width:i,height:n})}),Z(this.destroyRef)).subscribe()}getLabelContext(){return{$implicit:{edge:this.edgeModel().edge,label:this.model().edgeLabel}}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["g","edgeLabel",""]],viewQuery:function(i,n){i&1&&Le(n.edgeLabelWrapperRef,io,5),i&2&&Ae()},inputs:{model:[1,"model"],edgeModel:[1,"edgeModel"],point:[1,"point"],htmlTemplate:[1,"htmlTemplate"]},attrs:no,decls:1,vars:1,consts:[["edgeLabelWrapper",""],[1,"edge-label-wrapper"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(i,n){if(i&1&&T(0,lo,2,2),i&2){let r;v((r=n.model())?0:-1,r)}},dependencies:[Ce],styles:[".edge-label-wrapper[_ngcontent-%COMP%]{width:max-content;margin-top:1px;margin-left:1px}"],changeDetection:0})}}return t})();var Be=(()=>{class t{constructor(){this.flowEntitiesService=s(G),this.flowSettingsService=s(V),this.edges=m(()=>this.flowSettingsService.optimization().virtualization?this.viewportEdges().sort((e,i)=>e.renderOrder()-i.renderOrder()):[...this.flowEntitiesService.validEdges()].sort((e,i)=>e.renderOrder()-i.renderOrder())),this.viewportEdges=m(()=>this.flowEntitiesService.validEdges().filter(e=>{let i=e.sourceHandle(),n=e.targetHandle();return i&&n})),this.maxOrder=m(()=>Math.max(...this.flowEntitiesService.validEdges().map(e=>e.renderOrder())))}pull(e){e.renderOrder()!==0&&this.maxOrder()===e.renderOrder()||e.renderOrder.set(this.maxOrder()+1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();var co=["edge",""];function po(t,o){if(t&1){let e=ne();S(),F(0,"path",0),b(1,"path",1),A("click",function(){j(e);let n=d();return n.select(),L(n.pull())}),z()}if(t&2){let e=d();Ze("edge_selected",e.model().selected()),w("d",e.model().path().path)("marker-start",e.model().markerStartUrl())("marker-end",e.model().markerEndUrl()),g(),w("d",e.model().path().path)}}function ho(t,o){if(t&1&&ae(0,2),t&2){let e=d(2);N("ngTemplateOutlet",o)("ngTemplateOutletContext",e.model().context)("ngTemplateOutletInjector",e.injector)}}function mo(t,o){if(t&1&&T(0,ho,1,3,"ng-container",2),t&2){let e,i=d();v((e=i.edgeTemplate())?0:-1,e)}}function uo(t,o){if(t&1&&(S(),F(0,"g",3)),t&2){let e=d(),i=d();N("model",e)("point",o)("edgeModel",i.model())("htmlTemplate",i.edgeLabelHtmlTemplate())}}function fo(t,o){if(t&1&&T(0,uo,1,4,":svg:g",3),t&2){let e,i=d();v((e=(e=i.model().path().labelPoints)==null?null:e.start)?0:-1,e)}}function go(t,o){if(t&1&&(S(),F(0,"g",3)),t&2){let e=d(),i=d();N("model",e)("point",o)("edgeModel",i.model())("htmlTemplate",i.edgeLabelHtmlTemplate())}}function vo(t,o){if(t&1&&T(0,go,1,4,":svg:g",3),t&2){let e,i=d();v((e=(e=i.model().path().labelPoints)==null?null:e.center)?0:-1,e)}}function yo(t,o){if(t&1&&(S(),F(0,"g",3)),t&2){let e=d(),i=d();N("model",e)("point",o)("edgeModel",i.model())("htmlTemplate",i.edgeLabelHtmlTemplate())}}function So(t,o){if(t&1&&T(0,yo,1,4,":svg:g",3),t&2){let e,i=d();v((e=(e=i.model().path().labelPoints)==null?null:e.end)?0:-1,e)}}function wo(t,o){if(t&1){let e=ne();S(),b(0,"circle",5),A("pointerStart",function(n){j(e);let r=d(2);return L(r.startReconnection(n,r.model().targetHandle()))}),z()}if(t&2){let e=d(2);w("cx",e.model().sourceHandle().pointAbsolute().x)("cy",e.model().sourceHandle().pointAbsolute().y)}}function Co(t,o){if(t&1){let e=ne();S(),b(0,"circle",5),A("pointerStart",function(n){j(e);let r=d(2);return L(r.startReconnection(n,r.model().sourceHandle()))}),z()}if(t&2){let e=d(2);w("cx",e.model().targetHandle().pointAbsolute().x)("cy",e.model().targetHandle().pointAbsolute().y)}}function xo(t,o){if(t&1&&T(0,wo,1,2,":svg:circle",4)(1,Co,1,2,":svg:circle",4),t&2){let e=d();v(e.model().reconnectable()===!0||e.model().reconnectable()==="source"?0:-1),g(),v(e.model().reconnectable()===!0||e.model().reconnectable()==="target"?1:-1)}}var cn=(()=>{class t{constructor(){this.injector=s(me),this.selectionService=s(Oe),this.flowSettingsService=s(V),this.flowStatusService=s(ie),this.edgeRenderingService=s(Be),this.connectionController=s(zt,{optional:!0}),this.model=k.required(),this.edgeTemplate=k(),this.edgeLabelHtmlTemplate=k(),this.isReconnecting=m(()=>{let e=this.flowStatusService.status();return(e.state==="reconnection-start"||e.state==="reconnection-validation")&&e.payload.oldEdge===this.model()})}select(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}pull(){this.flowSettingsService.elevateEdgesOnSelect()&&this.edgeRenderingService.pull(this.model())}startReconnection(e,i){e.stopPropagation(),this.connectionController?.startReconnection(i,this.model())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["g","edge",""]],hostAttrs:[1,"selectable"],hostVars:2,hostBindings:function(i,n){i&2&&we("visibility",n.isReconnecting()?"hidden":"visible")},inputs:{model:[1,"model"],edgeTemplate:[1,"edgeTemplate"],edgeLabelHtmlTemplate:[1,"edgeLabelHtmlTemplate"]},attrs:co,decls:6,vars:6,consts:[[1,"edge"],[1,"interactive-edge",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["edgeLabel","",3,"model","point","edgeModel","htmlTemplate"],["r","10",1,"reconnect-handle"],["r","10",1,"reconnect-handle",3,"pointerStart"]],template:function(i,n){if(i&1&&T(0,po,2,6)(1,mo,1,1)(2,fo,1,1)(3,vo,1,1)(4,So,1,1)(5,xo,2,2),i&2){let r,a,c;v(n.model().type==="default"?0:-1),g(),v(n.model().type==="template"&&n.edgeTemplate()?1:-1),g(),v((r=n.model().labelModels().start)?2:-1,r),g(),v((a=n.model().labelModels().center)?3:-1,a),g(),v((c=n.model().labelModels().end)?4:-1,c),g(),v(n.model().sourceHandle()&&n.model().targetHandle()?5:-1)}},dependencies:[Ce,ln,tt],styles:[".edge[_ngcontent-%COMP%]{fill:none;stroke-width:2;stroke:#b1b1b7}.edge_selected[_ngcontent-%COMP%]{stroke-width:2.5;stroke:#0f4c75}.interactive-edge[_ngcontent-%COMP%]{fill:none;stroke-width:20;stroke:transparent}.reconnect-handle[_ngcontent-%COMP%]{fill:transparent;cursor:move}"],changeDetection:0})}}return t})();var dn=(()=>{class t{constructor(){this.handleModel=k.required({alias:"handleSizeController"}),this.handleWrapper=s(Y)}ngAfterViewInit(){let e=this.handleWrapper.nativeElement,i=e.getBBox(),n=_o(e);this.handleModel().size.set({width:i.width+n,height:i.height+n})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","handleSizeController",""]],inputs:{handleModel:[1,"handleSizeController","handleModel"]}})}}return t})();function _o(t){let o=t.firstElementChild;if(o){let e=getComputedStyle(o).strokeWidth,i=Number(e.replace("px",""));return isNaN(i)?0:i}return 0}var bo=["*"],pn=(()=>{class t{constructor(){this.selected=k(!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["default-node"]],hostVars:2,hostBindings:function(i,n){i&2&&Ze("selected",n.selected())},inputs:{selected:[1,"selected"]},ngContentSelectors:bo,decls:1,vars:0,template:function(i,n){i&1&&(_t(),bt(0))},styles:["[_nghost-%COMP%]{border:1.5px solid #1b262c;border-radius:5px;display:flex;align-items:center;justify-content:center;color:#000;background-color:#fff}.selected[_nghost-%COMP%]{border-width:2px}"],changeDetection:0})}}return t})();var hn=(()=>{class t{constructor(){this.nodeAccessor=s(be),this.zone=s(ue),this.destroyRef=s(ze),this.hostElementRef=s(Y)}ngOnInit(){this.nodeAccessor.model().handles$.pipe(te(i=>Ve([...i.map(n=>n.hostReference),this.hostElementRef.nativeElement],this.zone).pipe(y(()=>i))),P(i=>{i.forEach(n=>n.updateHost())}),Z(this.destroyRef)).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","nodeHandlesController",""]]})}}return t})();var mn=(()=>{class t{constructor(){this.nodeAccessor=s(be),this.zone=s(ue),this.destroyRef=s(ze),this.hostElementRef=s(Y)}ngOnInit(){let e=this.nodeAccessor.model(),i=this.hostElementRef.nativeElement;X(Ve([i],this.zone)).pipe(xt(null),D(()=>!e.resizing()),P(()=>{e.width.set(i.clientWidth),e.height.set(i.clientHeight)}),Z(this.destroyRef)).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","nodeResizeController",""]]})}}return t})();var To=["node",""];function Ho(t,o){if(t&1){let e=ne();S(),b(0,"foreignObject",3),A("click",function(){j(e);let n=d();return n.pullNode(),L(n.selectNode())}),De(),b(1,"default-node",4),F(2,"div",5)(3,"handle",6)(4,"handle",7),z()()}if(t&2){let e=d();w("width",e.model().foWidth())("height",e.model().foHeight()),g(),we("width",e.model().styleWidth())("height",e.model().styleHeight())("max-width",e.model().styleWidth())("max-height",e.model().styleHeight()),N("selected",e.model().selected()),g(),N("outerHTML",e.model().text(),xi)}}function Eo(t,o){if(t&1){let e=ne();S(),b(0,"foreignObject",3),A("click",function(){j(e);let n=d();return L(n.pullNode())}),De(),b(1,"div",8),ae(2,9),z()()}if(t&2){let e,i=d();w("width",i.model().foWidth())("height",i.model().foHeight()),g(),we("width",i.model().styleWidth())("height",i.model().styleHeight()),g(),N("ngTemplateOutlet",(e=i.nodeTemplate())!==null&&e!==void 0?e:null)("ngTemplateOutletContext",i.model().context)("ngTemplateOutletInjector",i.injector)}}function Do(t,o){if(t&1){let e=ne();S(),b(0,"g",10),A("click",function(){j(e);let n=d();return L(n.pullNode())}),ae(1,9),z()}if(t&2){let e,i=d();g(),N("ngTemplateOutlet",(e=i.nodeSvgTemplate())!==null&&e!==void 0?e:null)("ngTemplateOutletContext",i.model().context)("ngTemplateOutletInjector",i.injector)}}function zo(t,o){if(t&1){let e=ne();S(),b(0,"foreignObject",3),A("click",function(){j(e);let n=d(2);return L(n.pullNode())}),De(),b(1,"div",8),ae(2,11),z()()}if(t&2){let e=d(2);w("width",e.model().foWidth())("height",e.model().foHeight()),g(),we("width",e.model().styleWidth())("height",e.model().styleHeight()),g(),N("ngComponentOutlet",o)("ngComponentOutletInputs",e.model().componentTypeInputs)("ngComponentOutletInjector",e.injector)}}function Ro(t,o){if(t&1&&(T(0,zo,3,9,":svg:foreignObject",0),Ht(1,"async")),t&2){let e,i=d();v((e=Et(1,1,i.model().componentInstance$))?0:-1,e)}}function ko(t,o){if(t&1){let e=ne();S(),b(0,"rect",12),A("click",function(){j(e);let n=d();return n.pullNode(),L(n.selectNode())}),z()}if(t&2){let e=d();we("stroke",e.model().color())("fill",e.model().color()),Ze("default-group-node_selected",e.model().selected()),N("resizable",e.model().resizable())("gap",3)("resizerColor",e.model().color()),w("width",e.model().size().width)("height",e.model().size().height)}}function Oo(t,o){if(t&1){let e=ne();S(),b(0,"g",10),A("click",function(){j(e);let n=d();return L(n.pullNode())}),ae(1,9),z()}if(t&2){let e,i=d();g(),N("ngTemplateOutlet",(e=i.groupNodeTemplate())!==null&&e!==void 0?e:null)("ngTemplateOutletContext",i.model().context)("ngTemplateOutletInjector",i.injector)}}function Mo(t,o){}function No(t,o){if(t&1&&T(0,Mo,0,0,"ng-template",13),t&2){let e=d();N("ngTemplateOutlet",e)}}function Vo(t,o){if(t&1&&T(0,No,1,1,null,13),t&2){let e=d();v(e.model().resizable()?0:-1)}}function Po(t,o){if(t&1){let e=ne();S(),b(0,"circle",17),A("pointerStart",function(n){j(e);let r=d().$implicit,a=d();return L(a.startConnection(n,r))})("pointerEnd",function(){j(e);let n=d(2);return L(n.endConnection())}),z()}if(t&2){let e=d().$implicit;w("cx",e.hostOffset().x)("cy",e.hostOffset().y)("stroke-width",e.strokeWidth)}}function Fo(t,o){if(t&1){let e=ne();S(),b(0,"g",18),A("pointerStart",function(n){j(e);let r=d().$implicit,a=d();return L(a.startConnection(n,r))})("pointerEnd",function(){j(e);let n=d(2);return L(n.endConnection())}),z()}if(t&2){let e=d().$implicit;N("handleSizeController",e)}}function Io(t,o){t&1&&(S(),ae(0))}function $o(t,o){if(t&1){let e=ne();S(),b(0,"g",18),A("pointerStart",function(n){j(e);let r=d().$implicit,a=d();return L(a.startConnection(n,r))})("pointerEnd",function(){j(e);let n=d(2);return L(n.endConnection())}),T(1,Io,1,0,"ng-container",19),z()}if(t&2){let e=d().$implicit;N("handleSizeController",e),g(),N("ngTemplateOutlet",e.template)("ngTemplateOutletContext",e.templateContext)}}function jo(t,o){if(t&1){let e=ne();S(),b(0,"circle",20),A("pointerEnd",function(){j(e);let n=d().$implicit,r=d();return r.endConnection(),L(r.resetValidateConnection(n))})("pointerOver",function(){j(e);let n=d().$implicit,r=d();return L(r.validateConnection(n))})("pointerOut",function(){j(e);let n=d().$implicit,r=d();return L(r.resetValidateConnection(n))}),z()}if(t&2){let e=d().$implicit,i=d();w("r",i.model().magnetRadius)("cx",e.hostOffset().x)("cy",e.hostOffset().y)}}function Lo(t,o){if(t&1&&T(0,Po,1,3,":svg:circle",14)(1,Fo,1,1,":svg:g",15)(2,$o,2,3,":svg:g",15)(3,jo,1,3,":svg:circle",16),t&2){let e=o.$implicit,i=d();v(e.template===void 0?0:-1),g(),v(e.template===null?1:-1),g(),v(e.template?2:-1),g(),v(i.showMagnet()?3:-1)}}function Ao(t,o){if(t&1&&(S(),b(0,"foreignObject"),De(),ae(1,13),z()),t&2){let e=o.$implicit;w("width",e.size().width)("height",e.size().height)("transform",e.transform()),g(),N("ngTemplateOutlet",e.template())}}var un=(()=>{class t{constructor(){this.injector=s(me),this.handleService=s(Wt),this.draggableService=s(Nt),this.flowStatusService=s(ie),this.nodeRenderingService=s(pe),this.flowSettingsService=s(V),this.selectionService=s(Oe),this.hostRef=s(Y),this.nodeAccessor=s(be),this.overlaysService=s(Ft),this.connectionController=s(zt,{optional:!0}),this.model=k.required(),this.nodeTemplate=k(),this.nodeSvgTemplate=k(),this.groupNodeTemplate=k(),this.showMagnet=m(()=>this.flowStatusService.status().state==="connection-start"||this.flowStatusService.status().state==="connection-validation"||this.flowStatusService.status().state==="reconnection-start"||this.flowStatusService.status().state==="reconnection-validation"),this.toolbars=m(()=>this.overlaysService.nodeToolbarsMap().get(this.model()))}ngOnInit(){this.model().isVisible.set(!0),this.nodeAccessor.model.set(this.model()),this.handleService.node.set(this.model()),ye(()=>{this.model().draggable()?this.draggableService.enable(this.hostRef.nativeElement,this.model()):this.draggableService.disable(this.hostRef.nativeElement)},{injector:this.injector})}ngOnDestroy(){this.model().isVisible.set(!1),this.draggableService.destroy(this.hostRef.nativeElement)}startConnection(e,i){e.stopPropagation(),this.connectionController?.startConnection(i)}validateConnection(e){this.connectionController?.validateConnection(e)}resetValidateConnection(e){this.connectionController?.resetValidateConnection(e)}endConnection(){this.connectionController?.endConnection()}pullNode(){this.flowSettingsService.elevateNodesOnSelect()&&this.nodeRenderingService.pullNode(this.model())}selectNode(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["g","node",""]],hostAttrs:[1,"vflow-node"],inputs:{model:[1,"model"],nodeTemplate:[1,"nodeTemplate"],nodeSvgTemplate:[1,"nodeSvgTemplate"],groupNodeTemplate:[1,"groupNodeTemplate"]},features:[Tt([Wt,be])],attrs:To,decls:11,vars:7,consts:[[1,"selectable"],["nodeHandlesController","",1,"selectable"],["rx","5","ry","5",1,"default-group-node",3,"resizable","gap","resizerColor","default-group-node_selected","stroke","fill"],[1,"selectable",3,"click"],["nodeHandlesController","",3,"selected"],[3,"outerHTML"],["type","source","position","right"],["type","target","position","left"],["nodeHandlesController","","nodeResizeController","",1,"wrapper"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["nodeHandlesController","",1,"selectable",3,"click"],[3,"ngComponentOutlet","ngComponentOutletInputs","ngComponentOutletInjector"],["rx","5","ry","5",1,"default-group-node",3,"click","resizable","gap","resizerColor"],[3,"ngTemplateOutlet"],["r","5",1,"default-handle"],[3,"handleSizeController"],[1,"magnet"],["r","5",1,"default-handle",3,"pointerStart","pointerEnd"],[3,"pointerStart","pointerEnd","handleSizeController"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"magnet",3,"pointerEnd","pointerOver","pointerOut"]],template:function(i,n){if(i&1&&(T(0,Ho,5,12,":svg:foreignObject",0)(1,Eo,3,9,":svg:foreignObject",0)(2,Do,2,3,":svg:g",1)(3,Ro,2,3)(4,ko,1,11,":svg:rect",2)(5,Oo,2,3,":svg:g",1)(6,Vo,1,1),ce(7,Lo,4,4,null,null,ct),ce(9,Ao,2,4,":svg:foreignObject",null,ct)),i&2){let r;v(n.model().rawNode.type==="default"?0:-1),g(),v(n.model().rawNode.type==="html-template"&&n.nodeTemplate()?1:-1),g(),v(n.model().rawNode.type==="svg-template"&&n.nodeSvgTemplate()?2:-1),g(),v(n.model().isComponentType?3:-1),g(),v(n.model().rawNode.type==="default-group"?4:-1),g(),v(n.model().rawNode.type==="template-group"&&n.groupNodeTemplate()?5:-1),g(),v((r=n.model().resizerTemplate())?6:-1,r),g(),de(n.model().handles()),g(2),de(n.toolbars())}},dependencies:[tt,pn,Vi,Ce,Ri,Ki,dn,hn,mn,ki],styles:[".magnet[_ngcontent-%COMP%]{opacity:0}.wrapper[_ngcontent-%COMP%]{display:table-cell}.default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}.default-handle[_ngcontent-%COMP%]{stroke:#fff;fill:#1b262c}"],changeDetection:0})}}return t})();var Go=["connection",""];function Bo(t,o){if(t&1&&(S(),F(0,"path",0)),t&2){let e=d(2);w("d",o)("marker-end",e.markerUrl())("stroke",e.defaultColor)}}function Wo(t,o){if(t&1&&T(0,Bo,1,3,":svg:path",0),t&2){let e,i=d();v((e=i.path())?0:-1,e)}}function Xo(t,o){t&1&&ae(0)}function Yo(t,o){if(t&1&&T(0,Xo,1,0,"ng-container",1),t&2){let e=d(2);N("ngTemplateOutlet",o)("ngTemplateOutletContext",e.getContext())}}function Uo(t,o){if(t&1&&T(0,Yo,1,2,"ng-container"),t&2){let e,i=d();v((e=i.template())?0:-1,e)}}var gn=(()=>{class t{constructor(){this.flowStatusService=s(ie),this.spacePointContext=s(ke),this.flowEntitiesService=s(G),this.model=k.required(),this.template=k(),this.path=m(()=>{let e=this.flowStatusService.status(),i=this.model().curve;if(e.state==="connection-start"||e.state==="reconnection-start"){let n=e.payload.sourceHandle,r=n.pointAbsolute(),a=n.rawHandle.position,c=this.spacePointContext.svgCurrentSpacePoint(),f=fn(n.rawHandle.position),u=this.getPathFactoryParams(r,c,a,f);switch(i){case"straight":return ft(u).path;case"bezier":return gt(u).path;case"smooth-step":return Ne(u).path;case"step":return Ne(u,0).path;default:return i(u).path}}if(e.state==="connection-validation"||e.state==="reconnection-validation"){let n=e.payload.sourceHandle,r=n.pointAbsolute(),a=n.rawHandle.position,c=e.payload.targetHandle,f=e.payload.valid?c.pointAbsolute():this.spacePointContext.svgCurrentSpacePoint(),u=e.payload.valid?c.rawHandle.position:fn(n.rawHandle.position),p=this.getPathFactoryParams(r,f,a,u);switch(i){case"straight":return ft(p).path;case"bezier":return gt(p).path;case"smooth-step":return Ne(p).path;case"step":return Ne(p,0).path;default:return i(p).path}}return null}),this.markerUrl=m(()=>{let e=this.model().settings.marker;return e?`url(#${Te(JSON.stringify(e))})`:""}),this.defaultColor="rgb(177, 177, 183)"}getContext(){return{$implicit:{path:this.path,marker:this.markerUrl}}}getPathFactoryParams(e,i,n,r){return{mode:"connection",sourcePoint:e,targetPoint:i,sourcePosition:n,targetPosition:r,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["g","connection",""]],inputs:{model:[1,"model"],template:[1,"template"]},attrs:Go,decls:2,vars:2,consts:[["fill","none","stroke-width","2"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(i,n){i&1&&T(0,Wo,1,1)(1,Uo,1,1),i&2&&(v(n.model().type==="default"?0:-1),g(),v(n.model().type==="template"?1:-1))},dependencies:[Ce],encapsulation:2,changeDetection:0})}}return t})();function fn(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}}function vn(){return String.fromCharCode(65+Math.floor(Math.random()*26))+Date.now()}var Zo=["background",""];function qo(t,o){if(t&1&&(S(),b(0,"pattern",0),F(1,"circle"),z(),F(2,"rect",1)),t&2){let e=d();w("id",e.patternId)("x",e.x())("y",e.y())("width",e.scaledGap())("height",e.scaledGap()),g(),w("cx",e.patternSize())("cy",e.patternSize())("r",e.patternSize())("fill",e.patternColor()),g(),w("fill",e.patternUrl)}}function Qo(t,o){if(t&1&&(S(),b(0,"pattern",0),F(1,"image"),z(),F(2,"rect",1)),t&2){let e=d(2);w("id",e.patternId)("x",e.imageX())("y",e.imageY())("width",e.scaledImageWidth())("height",e.scaledImageHeight()),g(),w("href",e.bgImageSrc())("width",e.scaledImageWidth())("height",e.scaledImageHeight()),g(),w("fill",e.patternUrl)}}function Jo(t,o){if(t&1&&(S(),F(0,"image")),t&2){let e=d(2);w("x",e.imageX())("y",e.imageY())("width",e.scaledImageWidth())("height",e.scaledImageHeight())("href",e.bgImageSrc())}}function Ko(t,o){if(t&1&&T(0,Qo,3,9)(1,Jo,1,5,":svg:image"),t&2){let e=d();v(e.repeated()?0:-1),g(),v(e.repeated()?-1:1)}}var er="#fff",tr=20,ir=2,yn="rgb(177, 177, 183)",Sn=.1,nr=!0,wn=(()=>{class t{constructor(){this.viewportService=s(K),this.rootSvg=s(xe).element,this.settingsService=s(V),this.backgroundSignal=this.settingsService.background,this.scaledGap=m(()=>{let e=this.backgroundSignal();return e.type==="dots"?this.viewportService.readableViewport().zoom*(e.gap??tr):0}),this.x=m(()=>this.viewportService.readableViewport().x%this.scaledGap()),this.y=m(()=>this.viewportService.readableViewport().y%this.scaledGap()),this.patternColor=m(()=>{let e=this.backgroundSignal();return e.type==="dots"?e.color??yn:yn}),this.patternSize=m(()=>{let e=this.backgroundSignal();return e.type==="dots"?this.viewportService.readableViewport().zoom*(e.size??ir)/2:0}),this.bgImageSrc=m(()=>{let e=this.backgroundSignal();return e.type==="image"?e.src:""}),this.imageSize=Me(x(this.backgroundSignal).pipe(te(()=>or(this.bgImageSrc())),y(e=>({width:e.naturalWidth,height:e.naturalHeight}))),{initialValue:{width:0,height:0}}),this.scaledImageWidth=m(()=>{let e=this.backgroundSignal();if(e.type==="image"){let i=e.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().width*i*(e.scale??Sn)}return 0}),this.scaledImageHeight=m(()=>{let e=this.backgroundSignal();if(e.type==="image"){let i=e.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().height*i*(e.scale??Sn)}return 0}),this.imageX=m(()=>{let e=this.backgroundSignal();return e.type==="image"?e.repeat?e.fixed?0:this.viewportService.readableViewport().x%this.scaledImageWidth():e.fixed?0:this.viewportService.readableViewport().x:0}),this.imageY=m(()=>{let e=this.backgroundSignal();return e.type==="image"?e.repeat?e.fixed?0:this.viewportService.readableViewport().y%this.scaledImageHeight():e.fixed?0:this.viewportService.readableViewport().y:0}),this.repeated=m(()=>{let e=this.backgroundSignal();return e.type==="image"&&(e.repeat??nr)}),this.patternId=vn(),this.patternUrl=`url(#${this.patternId})`,ye(()=>{let e=this.backgroundSignal();e.type==="dots"&&(this.rootSvg.style.backgroundColor=e.backgroundColor??er),e.type==="solid"&&(this.rootSvg.style.backgroundColor=e.color)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["g","background",""]],attrs:Zo,decls:2,vars:2,consts:[["patternUnits","userSpaceOnUse"],["x","0","y","0","width","100%","height","100%"]],template:function(i,n){i&1&&T(0,qo,3,10)(1,Ko,2,2),i&2&&(v(n.backgroundSignal().type==="dots"?0:-1),g(),v(n.backgroundSignal().type==="image"?1:-1))},encapsulation:2,changeDetection:0})}}return t})();function or(t){let o=new Image;return o.src=t,new Promise(e=>{o.onload=()=>e(o)})}var rr=["flowDefs",""];function sr(t,o){if(t&1&&(S(),F(0,"polyline",3)),t&2){let e,i,n,r=d().$implicit,a=d();we("stroke",(e=r.value.color)!==null&&e!==void 0?e:a.defaultColor)("stroke-width",(i=r.value.strokeWidth)!==null&&i!==void 0?i:2)("fill",(n=r.value.color)!==null&&n!==void 0?n:a.defaultColor)}}function ar(t,o){if(t&1&&(S(),F(0,"polyline",4)),t&2){let e,i,n=d().$implicit,r=d();we("stroke",(e=n.value.color)!==null&&e!==void 0?e:r.defaultColor)("stroke-width",(i=n.value.strokeWidth)!==null&&i!==void 0?i:2)}}function lr(t,o){if(t&1&&(S(),b(0,"marker",0),T(1,sr,1,6,":svg:polyline",1)(2,ar,1,4,":svg:polyline",2),z()),t&2){let e,i,n,r,a=o.$implicit;w("id",a.key)("markerWidth",(e=a.value.width)!==null&&e!==void 0?e:16.5)("markerHeight",(i=a.value.height)!==null&&i!==void 0?i:16.5)("orient",(n=a.value.orient)!==null&&n!==void 0?n:"auto-start-reverse")("markerUnits",(r=a.value.markerUnits)!==null&&r!==void 0?r:"userSpaceOnUse"),g(),v(a.value.type==="arrow-closed"||!a.value.type?1:-1),g(),v(a.value.type==="arrow"?2:-1)}}var Cn=(()=>{class t{constructor(){this.markers=k.required(),this.defaultColor="rgb(177, 177, 183)"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["defs","flowDefs",""]],inputs:{markers:[1,"markers"]},attrs:rr,decls:3,vars:2,consts:[["viewBox","-10 -10 20 20","refX","0","refY","0"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed",3,"stroke","stroke-width","fill"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default",3,"stroke","stroke-width"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default"]],template:function(i,n){i&1&&(ce(0,lr,3,7,":svg:marker",0,ct),Ht(2,"keyvalue")),i&2&&de(Et(2,0,n.markers()))},dependencies:[Oi],styles:[".marker__arrow_default[_ngcontent-%COMP%]{stroke-width:1px;stroke-linecap:round;stroke-linejoin:round;fill:none}.marker__arrow_closed[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}"],changeDetection:0})}}return t})();var xn=(()=>{class t{constructor(){this.host=s(Y),this.flowSettingsService=s(V),this.flowWidth=m(()=>{let e=this.flowSettingsService.view();return e==="auto"?"100%":e[0]}),this.flowHeight=m(()=>{let e=this.flowSettingsService.view();return e==="auto"?"100%":e[1]}),Ve([this.host.nativeElement],s(ue)).pipe(P(([e])=>{this.flowSettingsService.computedFlowWidth.set(e.contentRect.width),this.flowSettingsService.computedFlowHeight.set(e.contentRect.height)}),Z()).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["svg","flowSizeController",""]],hostVars:2,hostBindings:function(i,n){i&2&&w("width",n.flowWidth())("height",n.flowHeight())}})}}return t})();var _n=(()=>{class t{constructor(){this.flowStatusService=s(ie)}resetConnection(){let e=this.flowStatusService.status();e.state==="connection-start"&&this.flowStatusService.setConnectionDroppedStatus(e.payload.source,e.payload.sourceHandle),e.state==="reconnection-start"&&this.flowStatusService.setReconnectionDroppedStatus(e.payload.source,e.payload.sourceHandle,e.payload.oldEdge)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["svg","rootSvgContext",""]],hostBindings:function(i,n){i&1&&A("mouseup",function(){return n.resetConnection()},!1,Lt)("touchend",function(){return n.resetConnection()},!1,Lt)("contextmenu",function(){return n.resetConnection()})}})}}return t})();function wt(t,o){let e=[];for(let i of o){let{x:n,y:r}=i.globalPoint();t.x>=n&&t.x<=n+i.width()&&t.y>=r&&t.y<=r+i.height()&&e.push({x:t.x-n,y:t.y-r,spaceNodeId:i.rawNode.id})}return e.reverse(),e.push({spaceNodeId:null,x:t.x,y:t.y}),e}var Ct=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})(),bn=(()=>{class t extends Ct{shouldRenderNode(e){return!e.isVisible()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Ci(t)))(n||t)}})()}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();function Tn(t,o){if(Object.keys(o.preview().style).length){pr(t,o);return}if(o.rawNode.type==="default"){cr(t,o);return}if(o.rawNode.type==="default-group"){dr(t,o);return}hr(t,o)}function cr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height();Hn(t,o,5),t.fillStyle="white",t.fill(),t.strokeStyle="#1b262c",t.lineWidth=1.5,t.stroke(),t.fillStyle="black",t.font="14px Arial",t.textAlign="center",t.textBaseline="middle";let r=e.x+i/2,a=e.y+n/2;t.fillText(o.text(),r,a)}function dr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height();t.globalAlpha=.05,t.fillStyle=o.color(),t.fillRect(e.x,e.y,i,n),t.globalAlpha=1,t.strokeStyle=o.color(),t.lineWidth=1.5,t.strokeRect(e.x,e.y,i,n)}function pr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height(),r=o.preview().style;if(r.borderRadius){let a=parseFloat(r.borderRadius);Hn(t,o,a)}else t.beginPath(),t.rect(e.x,e.y,i,n),t.closePath();r.backgroundColor&&(t.fillStyle=r.backgroundColor),r.borderColor&&(t.strokeStyle=r.borderColor),r.borderWidth&&(t.lineWidth=parseFloat(r.borderWidth)),t.fill(),t.stroke()}function hr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height();t.fillStyle="rgb(0 0 0 / 10%)",t.fillRect(e.x,e.y,i,n)}function Hn(t,o,e){let i=o.globalPoint(),n=o.width(),r=o.height();t.beginPath(),t.moveTo(i.x+e,i.y),t.lineTo(i.x+n-e,i.y),t.quadraticCurveTo(i.x+n,i.y,i.x+n,i.y+e),t.lineTo(i.x+n,i.y+r-e),t.quadraticCurveTo(i.x+n,i.y+r,i.x+n-e,i.y+r),t.lineTo(i.x+e,i.y+r),t.quadraticCurveTo(i.x,i.y+r,i.x,i.y+r-e),t.lineTo(i.x,i.y+e),t.quadraticCurveTo(i.x,i.y,i.x+e,i.y),t.closePath()}var mr=["previewFlow",""],En=(()=>{class t{constructor(){this.viewportService=s(K),this.renderStrategy=s(Ct),this.nodeRenderingService=s(pe),this.renderer2=s(_i),this.element=s(Y).nativeElement,this.ctx=this.element.getContext("2d"),this.width=k(0),this.height=k(0),this.dpr=window.devicePixelRatio,ye(()=>{this.renderer2.setProperty(this.element,"width",this.width()*this.dpr),this.renderer2.setProperty(this.element,"height",this.height()*this.dpr),this.renderer2.setStyle(this.element,"width",`${this.width()}px`),this.renderer2.setStyle(this.element,"height",`${this.height()}px`),this.ctx.scale(this.dpr,this.dpr)}),ye(()=>{let e=this.viewportService.readableViewport();this.ctx.clearRect(0,0,this.width(),this.height()),this.ctx.save(),this.ctx.setTransform(e.zoom*this.dpr,0,0,e.zoom*this.dpr,e.x*this.dpr,e.y*this.dpr);for(let i=0;i<this.nodeRenderingService.viewportNodes().length;i++){let n=this.nodeRenderingService.viewportNodes()[i];this.renderStrategy.shouldRenderNode(n)&&Tn(this.ctx,n)}this.ctx.restore()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["canvas","previewFlow",""]],inputs:{width:[1,"width"],height:[1,"height"]},attrs:mr,decls:0,vars:0,template:function(i,n){},encapsulation:2,changeDetection:0})}}return t})();var ri=(()=>{class t{constructor(){this.nodeRenderingService=s(pe),this.edgeRenderingService=s(Be),this.flowEntitiesService=s(G),this.settingsService=s(V),this.flowInitialized=l(!1),s(ue).runOutsideAngular(()=>ci(this,null,function*(){yield ur(2),this.flowInitialized.set(!0)}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac})}}return t})();function ur(t){return new Promise(o=>{let e=0;function i(){e++,e<t?requestAnimationFrame(i):o()}requestAnimationFrame(i)})}function si(t){return J(W({},t),{left:t.x,right:t.x+t.width,top:t.y,bottom:t.y+t.height})}var fr=["alignmentHelper",""];function gr(t,o){if(t&1&&(S(),F(0,"line")),t&2){let e=o.$implicit,i=d(3);w("stroke",i.lineColor())("stroke-dasharray",e.isCenter?4:null)("x1",e.x)("y1",e.y)("x2",e.x2)("y2",e.y2)}}function vr(t,o){t&1&&ce(0,gr,1,6,":svg:line",null,Hi),t&2&&de(o.lines)}function yr(t,o){if(t&1&&T(0,vr,2,0),t&2){let e,i=d();v((e=i.intersections())?0:-1,e)}}var Dn=(()=>{class t{constructor(){this.nodeRenderingService=s(pe),this.flowStatus=s(ie),this.tolerance=k(10),this.lineColor=k("#1b262c"),this.isNodeDragging=m(()=>Jt(this.flowStatus.status())),this.intersections=Ge(e=>{let i=this.flowStatus.status();if(Jt(i)){let n=i.payload.node,r=si(mt(n)),a=this.nodeRenderingService.viewportNodes().filter(h=>h!==n).filter(h=>!n.children().includes(h)).map(h=>si(mt(h))),c=[],f=r.x,u=r.y,p=1/0,O=1/0;return a.forEach(h=>{let _=r.left+r.width/2,C=h.left+h.width/2;for(let[ee,fe,ot,se]of[[_,C,C-r.width/2,!0],[r.left,h.left,h.left,!1],[r.left,h.right,h.right,!1],[r.right,h.left,h.left-r.width,!1],[r.right,h.right,h.right-r.width,!1]]){let Q=Math.abs(ee-fe);if(Q<=this.tolerance()){let ge=Math.min(r.top,h.top),he=Math.max(r.bottom,h.bottom);if(c.push({x:fe,y:ge,x2:fe,y2:he,isCenter:se}),Q<p&&(p=Q,f=ot),se)break}}let E=r.top+r.height/2,I=h.top+h.height/2;for(let[ee,fe,ot,se]of[[E,I,I-r.height/2,!0],[r.top,h.top,h.top,!1],[r.top,h.bottom,h.bottom,!1],[r.bottom,h.top,h.top-r.height,!1],[r.bottom,h.bottom,h.bottom-r.height,!1]]){let Q=Math.abs(ee-fe);if(Q<=this.tolerance()){let ge=Math.min(r.left,h.left),he=Math.max(r.right,h.right);if(c.push({x:ge,y:fe,x2:he,y2:fe,isCenter:se}),Q<O&&(O=Q,u=ot),se)break}}}),{lines:c,snappedX:f,snappedY:u}}return e}),x(this.flowStatus.status).pipe(D($i),y(e=>e.payload.node),y(e=>[e,this.intersections()]),P(([e,i])=>{if(i){let n={x:i.snappedX,y:i.snappedY},r=e.parent()?[e.parent()]:[];e.setPoint(wt(n,r)[0])}}),Z()).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["g","alignmentHelper",""]],inputs:{tolerance:[1,"tolerance"],lineColor:[1,"lineColor"]},attrs:fr,decls:1,vars:1,template:function(i,n){i&1&&T(0,yr,1,1),i&2&&v(n.isNodeDragging()?0:-1)},encapsulation:2,changeDetection:0})}}return t})();var nt=48,It=10,Sr=["node-drag-start","connection-start","reconnection-start"],zn=(()=>{class t{constructor(){this.statusService=s(ie),this.viewportService=s(K),this.flowSettingsService=s(V),this.rootSvg=s(xe).element,this.injector=s(me),this.destroyRef=s(ze),this.documentPoint$=X(le(document,"pointerdown",{capture:!0}),le(document,"pointermove",{capture:!0})).pipe(y(e=>({x:e.clientX,y:e.clientY})),y(e=>this.toViewportPoint(e)),Ue({bufferSize:1,refCount:!0}))}ngOnInit(){this.flowSettingsService.autoPan()&&x(this.statusService.status,{injector:this.injector}).pipe(te(e=>Sr.includes(e.state)?this.documentPoint$.pipe(yi(1),te(()=>pi().pipe(Si(this.documentPoint$),y(([,i])=>i),P(i=>this.pan(i))))):hi),Z(this.destroyRef)).subscribe()}toViewportPoint(e){let i=this.rootSvg.getBoundingClientRect();return{x:e.x-i.left,y:e.y-i.top}}pan(e){let i=this.viewportService.readableViewport(),{x:n,y:r,zoom:a}=i,c=this.flowSettingsService.computedFlowWidth(),f=this.flowSettingsService.computedFlowHeight(),u=e.x,p=c-e.x,O=e.y,h=f-e.y,_=0,C=0;if(u<nt){let E=It*$t(u);_+=E}if(p<nt){let E=It*$t(p);_-=E}if(O<nt){let E=It*$t(O);C+=E}if(h<nt){let E=It*$t(h);C-=E}(_!==0||C!==0)&&this.viewportService.writableViewport.set({changeType:"absolute",state:{x:n+_,y:r+C,zoom:a},duration:0})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=M({type:t,selectors:[["","autoPan",""]]})}}return t})();function wr(t){return Math.max(0,Math.min(1,t))}function $t(t){let o=wr((nt-t)/nt);return o*o}function Cr(t,o){t&1&&(S(),F(0,"g",8))}function xr(t,o){if(t&1&&(S(),F(0,"g",9)),t&2){let e=d();N("tolerance",e.tolerance)("lineColor",e.lineColor)}}function _r(t,o){t&1&&T(0,Cr,1,0,":svg:g",8)(1,xr,1,2,":svg:g",9),t&2&&v(o===!0?0:1)}function br(t,o){if(t&1&&(S(),F(0,"g",10)),t&2){let e,i=o.$implicit,n=d(2);N("model",i)("groupNodeTemplate",(e=n.groupNodeTemplateDirective())==null?null:e.templateRef),w("transform",i.pointTransform())}}function Tr(t,o){if(t&1&&(S(),F(0,"g",11)),t&2){let e,i,n=o.$implicit,r=d(2);N("model",n)("edgeTemplate",(e=r.edgeTemplateDirective())==null?null:e.templateRef)("edgeLabelHtmlTemplate",(i=r.edgeLabelHtmlDirective())==null?null:i.templateRef)}}function Hr(t,o){if(t&1&&(S(),F(0,"g",12)),t&2){let e,i,n=o.$implicit,r=d(2);N("model",n)("nodeTemplate",(e=r.nodeTemplateDirective())==null?null:e.templateRef)("nodeSvgTemplate",(i=r.nodeSvgTemplateDirective())==null?null:i.templateRef),w("transform",n.pointTransform())}}function Er(t,o){if(t&1&&(ce(0,br,1,3,":svg:g",10,qe().trackNodes,!0),ce(2,Tr,1,3,":svg:g",11,qe().trackEdges,!0),ce(4,Hr,1,4,":svg:g",12,qe().trackNodes,!0)),t&2){let e=d();de(e.groups()),g(2),de(e.edgeModels()),g(2),de(e.nonGroups())}}function Dr(t,o){if(t&1&&(S(),F(0,"g",11)),t&2){let e,i,n=o.$implicit,r=d(2);N("model",n)("edgeTemplate",(e=r.edgeTemplateDirective())==null?null:e.templateRef)("edgeLabelHtmlTemplate",(i=r.edgeLabelHtmlDirective())==null?null:i.templateRef)}}function zr(t,o){if(t&1&&(S(),F(0,"g",13)),t&2){let e,i,n,r=o.$implicit,a=d(2);N("model",r)("nodeTemplate",(e=a.nodeTemplateDirective())==null?null:e.templateRef)("nodeSvgTemplate",(i=a.nodeSvgTemplateDirective())==null?null:i.templateRef)("groupNodeTemplate",(n=a.groupNodeTemplateDirective())==null?null:n.templateRef),w("transform",r.pointTransform())}}function Rr(t,o){if(t&1&&(ce(0,Dr,1,3,":svg:g",11,qe().trackEdges,!0),ce(2,zr,1,5,":svg:g",13,qe().trackNodes,!0)),t&2){let e=d();de(e.edgeModels()),g(2),de(e.nodeModels())}}function kr(t,o){t&1&&(S(),ae(0,6)),t&2&&N("ngTemplateOutlet",o.template())}function Or(t,o){if(t&1&&F(0,"canvas",7),t&2){let e=d();N("width",e.flowWidth())("height",e.flowHeight())}}var bm=(()=>{class t{constructor(){this.viewportService=s(K),this.flowEntitiesService=s(G),this.nodesChangeService=s(yt),this.edgesChangeService=s(St),this.nodeRenderingService=s(pe),this.edgeRenderingService=s(Be),this.flowSettingsService=s(V),this.componentEventBusService=s(Bt),this.keyboardService=s(ut),this.injector=s(me),this.flowRenderingService=s(ri),this.alignmentHelper=k(!1),this.nodeModels=this.nodeRenderingService.nodes,this.groups=this.nodeRenderingService.groups,this.nonGroups=this.nodeRenderingService.nonGroups,this.edgeModels=this.edgeRenderingService.edges,this.componentNodeEvent=q(this.componentEventBusService.event$),this.nodeTemplateDirective=$e(Zt),this.nodeSvgTemplateDirective=$e(qt),this.groupNodeTemplateDirective=$e(Qt),this.edgeTemplateDirective=$e(Xt),this.edgeLabelHtmlDirective=$e(Ut),this.connectionTemplateDirective=$e(Yt),this.mapContext=Ie(Mt),this.spacePointContext=Ie.required(ke),this.viewport=this.viewportService.readableViewport.asReadonly(),this.nodesChange=Me(this.nodesChangeService.changes$,{initialValue:[]}),this.edgesChange=Me(this.edgesChangeService.changes$,{initialValue:[]}),this.initialized=this.flowRenderingService.flowInitialized.asReadonly(),this.viewportChange$=x(this.viewportService.readableViewport).pipe(ve(1)),this.nodesChange$=this.nodesChangeService.changes$,this.edgesChange$=this.edgesChangeService.changes$,this.initialized$=x(this.flowRenderingService.flowInitialized),this.markers=this.flowEntitiesService.markers,this.minimap=this.flowEntitiesService.minimap,this.flowOptimization=this.flowSettingsService.optimization,this.flowWidth=this.flowSettingsService.computedFlowWidth,this.flowHeight=this.flowSettingsService.computedFlowHeight}set view(e){this.flowSettingsService.view.set(e)}set minZoom(e){this.flowSettingsService.minZoom.set(e)}set maxZoom(e){this.flowSettingsService.maxZoom.set(e)}set background(e){this.flowSettingsService.background.set(an(e))}set optimization(e){this.flowSettingsService.optimization.update(i=>W(W({},i),e))}set entitiesSelectable(e){this.flowSettingsService.entitiesSelectable.set(e)}set selectionMode(e){this.flowSettingsService.selectionMode.set(e)}set keyboardShortcuts(e){this.keyboardService.setShortcuts(e)}set connection(e){this.flowEntitiesService.connection.set(e)}get connection(){return this.flowEntitiesService.connection()}set snapGrid(e){this.flowSettingsService.snapGrid.set(e)}set elevateNodesOnSelect(e){this.flowSettingsService.elevateNodesOnSelect.set(e)}set elevateEdgesOnSelect(e){this.flowSettingsService.elevateEdgesOnSelect.set(e)}set autoPan(e){this.flowSettingsService.autoPan.set(e)}set nodes(e){let i=at(this.injector,()=>vt.nodes(e,this.flowEntitiesService.nodes()));ii(i,this.flowEntitiesService.edges()),this.flowEntitiesService.nodes.set(i),i.forEach(n=>this.nodeRenderingService.pullNode(n))}set edges(e){let i=at(this.injector,()=>vt.edges(e,this.flowEntitiesService.edges()));ii(this.flowEntitiesService.nodes(),i),this.flowEntitiesService.edges.set(i)}viewportTo(e){this.viewportService.writableViewport.set({changeType:"absolute",state:e,duration:0})}zoomTo(e){this.viewportService.writableViewport.set({changeType:"absolute",state:{zoom:e},duration:0})}panTo(e){this.viewportService.writableViewport.set({changeType:"absolute",state:e,duration:0})}fitView(e){this.viewportService.fitView(e)}getNode(e){return this.flowEntitiesService.getNode(e)?.rawNode}getDetachedEdges(){return this.flowEntitiesService.getDetachedEdges().map(e=>e.edge)}documentPointToFlowPoint(e,i){let n=this.spacePointContext().documentPointToFlowPoint(e);return i?.spaces?wt(n,this.nodeRenderingService.groups()):n}getIntesectingNodes(e,i={partially:!0}){return Ui(e,this.nodeModels(),i).map(n=>n.rawNode)}toNodeSpace(e,i){let n=this.nodeModels().find(a=>a.rawNode.id===e);if(!n)return{x:1/0,y:1/0};if(i===null)return n.globalPoint();let r=this.nodeModels().find(a=>a.rawNode.id===i);return r?wt(n.globalPoint(),[r])[0]:{x:1/0,y:1/0}}trackNodes(e,{rawNode:i}){return i}trackEdges(e,{edge:i}){return i}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=U({type:t,selectors:[["vflow"]],contentQueries:function(i,n,r){i&1&&(je(r,n.nodeTemplateDirective,Zt,5),je(r,n.nodeSvgTemplateDirective,qt,5),je(r,n.groupNodeTemplateDirective,Qt,5),je(r,n.edgeTemplateDirective,Xt,5),je(r,n.edgeLabelHtmlDirective,Ut,5),je(r,n.connectionTemplateDirective,Yt,5)),i&2&&Ae(6)},viewQuery:function(i,n){i&1&&(Le(n.mapContext,Mt,5),Le(n.spacePointContext,ke,5)),i&2&&Ae(2)},inputs:{view:"view",minZoom:"minZoom",maxZoom:"maxZoom",background:"background",optimization:"optimization",entitiesSelectable:"entitiesSelectable",selectionMode:"selectionMode",keyboardShortcuts:"keyboardShortcuts",connection:[2,"connection","connection",e=>new Ke(e)],snapGrid:"snapGrid",elevateNodesOnSelect:"elevateNodesOnSelect",elevateEdgesOnSelect:"elevateEdgesOnSelect",autoPan:"autoPan",nodes:"nodes",alignmentHelper:[1,"alignmentHelper"],edges:"edges"},outputs:{componentNodeEvent:"componentNodeEvent"},features:[Tt([Nt,K,ie,G,yt,St,pe,Be,Oe,V,Bt,ut,Ft,{provide:Ct,useClass:bn},ri]),bi([{directive:sn,outputs:["nodesChanges","nodesChanges","nodesChanges.position","nodesChanges.position","nodesChanges.size","nodesChanges.size","nodesChanges.add","nodesChanges.add","nodesChanges.remove","nodesChanges.remove","nodesChanges.select","nodesChanges.select","edgesChanges","edgesChanges","edgesChanges.detached","edgesChanges.detached","edgesChanges.add","edgesChanges.add","edgesChanges.remove","edgesChanges.remove","edgesChanges.select","edgesChanges.select"]}])],decls:11,vars:8,consts:[["flow",""],["rootSvgRef","","rootSvgContext","","rootPointer","","flowSizeController","",1,"root-svg"],["flowDefs","",3,"markers"],["background",""],["mapContext","","spacePointContext","","autoPan",""],["connection","",3,"model","template"],[3,"ngTemplateOutlet"],["previewFlow","",1,"preview-flow",3,"width","height"],["alignmentHelper",""],["alignmentHelper","",3,"tolerance","lineColor"],["node","",3,"model","groupNodeTemplate"],["edge","",3,"model","edgeTemplate","edgeLabelHtmlTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate","groupNodeTemplate"]],template:function(i,n){if(i&1&&(S(),b(0,"svg",1,0),F(2,"defs",2)(3,"g",3),b(4,"g",4),T(5,_r,2,1),F(6,"g",5),T(7,Er,6,0)(8,Rr,4,0),z(),T(9,kr,1,1,":svg:ng-container",6),z(),T(10,Or,1,2,"canvas",7)),i&2){let r,a,c;g(2),N("markers",n.markers()),g(3),v((r=n.alignmentHelper())?5:-1,r),g(),N("model",n.connection)("template",(a=n.connectionTemplateDirective())==null?null:a.templateRef),g(),v(n.flowOptimization().detachedGroupsLayer?7:-1),g(),v(n.flowOptimization().detachedGroupsLayer?-1:8),g(),v((c=n.minimap())?9:-1,c),g(),v(n.flowOptimization().virtualization?10:-1)}},dependencies:[xe,_n,Re,xn,Cn,wn,Mt,ke,gn,un,cn,Ce,En,Dn,zn],styles:["[_nghost-%COMP%]{display:grid;grid-template-columns:1fr;width:100%;height:100%;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]     *{box-sizing:border-box}.root-svg[_ngcontent-%COMP%]{grid-row-start:1;grid-column-start:1}.preview-flow[_ngcontent-%COMP%]{pointer-events:none;grid-row-start:1;grid-column-start:1}"],changeDetection:0})}}return t})();export{Rt as a,G as b,Zi as c,V as d,K as e,Oe as f,Xt as g,Ut as h,Zt as i,qt as j,Qt as k,Wr as l,Xr as m,Yr as n,Ii as o,Jr as p,Ft as q,Ve as r,zt as s,Be as t,cn as u,pn as v,Ki as w,un as x,bm as y};
