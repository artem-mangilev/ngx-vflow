<svg:rect
  *ngIf="nodeModel.node.type === 'default'"
  #nodeContent
  width="50"
  height="50"
/>

<svg:foreignObject
  *ngIf="nodeModel.node.type === 'html-template' && nodeHtmlTemplate"
  [attr.width]="nodeModel.width()"
  [attr.height]="nodeModel.height()"
>
  <div #htmlWrapper class="wrapper">
    <ng-container
      *ngTemplateOutlet="nodeHtmlTemplate; context: { $implicit: nodeModel.node }"
    />
  </div>
</svg:foreignObject>

<ng-container *ngIf="handleTemplate">
  <svg:g (mousedown)="startConnection($event)">
    <ng-container *ngTemplateOutlet="handleTemplate; context: getHandleContext('source')" />
  </svg:g>

  <svg:g
    #targetHandle
    (mouseup)="endConnection(); resetValidateTargetHandle()"
    (mouseover)="validateTargetHandle()"
    (mouseout)="resetValidateTargetHandle()"
  >
    <ng-container *ngTemplateOutlet="handleTemplate; context: getHandleContext('target')" />
  </svg:g>
</ng-container>

<ng-container *ngIf="!handleTemplate">
  <svg:circle
    [attr.cx]="nodeModel.sourcePoint().x"
    [attr.cy]="nodeModel.sourcePoint().y"
    r="5"
    stroke="white"
    stroke-width="3"
    fill="red"
    (mousedown)="startConnection($event)"
  />

  <svg:circle
    #targetHandle
    [attr.cx]="nodeModel.targetPoint().x"
    [attr.cy]="nodeModel.targetPoint().y"
    r="5"
    stroke="white"
    fill="red"
    (mouseup)="endConnection()"
  />
</ng-container>


