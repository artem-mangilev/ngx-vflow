import{a as ve,b as L,c as B,d as $n,e as Ni,f as Ke,g as ko,h as Do,i as on,j as Ei,k as Mo}from"./chunk-NA7FJBPQ.js";import{b as Eo,g as Xe,h as zo,i as Oo}from"./chunk-QMHLIXQX.js";import{$ as go,$b as R,Ac as ue,C as Ge,Da as en,Db as b,E as me,Ea as vo,Eb as wt,Ec as Pn,Fb as _t,Fc as Vn,G as K,Ga as U,Gb as wo,H as po,Ha as Z,Hb as _o,Ia as D,Ib as Co,Ic as No,J as mo,Ja as it,Ka as Rn,L as fo,Ma as ot,Oa as $t,Ob as A,Pb as k,Qa as tn,Qb as Y,R as Jt,Ra as W,Rb as je,Sa as oe,Sb as At,Tb as So,Vb as Lt,W as Pt,Wb as E,Yb as nn,Zb as He,_ as Vt,_b as Fe,aa as Qe,ac as $,ad as y,ba as Mn,bc as ee,bd as Bt,c as co,ca as Se,cd as Pe,ea as ie,ec as be,f as Ht,fc as ye,hc as J,i as Ft,ic as m,j as bi,jc as In,ka as q,kb as xo,kc as Hn,l as Kt,nb as Ti,o as uo,p as Ze,pb as w,pc as Ct,qc as St,r as ho,ra as u,rc as bt,sb as yt,tc as bo,v as F,va as j,vc as To,wa as de,wb as yo,ya as X,yb as Oe,zc as Fn}from"./chunk-Z42XPK5A.js";import{a as ze,b as It,i as lo}from"./chunk-ODLL2QMY.js";var zi=(()=>{class e{constructor(){this.templateRef=u(yt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["ng-template","edge",""]],standalone:!0})}}return e})(),Oi=(()=>{class e{constructor(){this.templateRef=u(yt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["ng-template","connection",""]],standalone:!0})}}return e})(),ki=(()=>{class e{constructor(){this.templateRef=u(yt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["ng-template","edgeLabelHtml",""]],standalone:!0})}}return e})(),Di=(()=>{class e{constructor(){this.templateRef=u(yt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["ng-template","nodeHtml",""]],standalone:!0})}}return e})(),Mi=(()=>{class e{constructor(){this.templateRef=u(yt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["ng-template","nodeSvg",""]],standalone:!0})}}return e})(),Ri=(()=>{class e{constructor(){this.templateRef=u(yt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["ng-template","groupNode",""]],standalone:!0})}}return e})();function Tt(e){try{return new Proxy(e,{apply:()=>{}})(),!0}catch{return!1}}var Ro=(()=>{class e extends ko{constructor(){super(...arguments),this.node=W.required()}ngOnInit(){let t=this.node().data;t&&(this.data=t),super.ngOnInit()}static{this.\u0275fac=(()=>{let t;return function(o){return(t||(t=Rn(e)))(o||e)}})()}static{this.\u0275dir=X({type:e,inputs:{node:[j.SignalBased,"node"]},features:[wo]})}}return e})();function An(e){return Object.prototype.isPrototypeOf.call(Do,e)}function Ln(e){return Object.prototype.isPrototypeOf.call(Ro,e)}function Io(e){return typeof e.point=="function"}function Ho(e){return An(e.type)?!0:Tt(e.type)&&!Tt(e.point)}function Fo(e){return Ln(e.type)?!0:Tt(e.type)&&Tt(e.point)}function Nu(e){return e.type==="html-template"}function Eu(e){return e.type==="default-group"}var ke=(()=>{class e{constructor(){this.status=b({state:"idle",payload:null})}setIdleStatus(){this.status.set({state:"idle",payload:null})}setConnectionStartStatus(t,n){this.status.set({state:"connection-start",payload:{source:t,sourceHandle:n}})}setReconnectionStartStatus(t,n,o){this.status.set({state:"reconnection-start",payload:{source:t,sourceHandle:n,oldEdge:o}})}setConnectionValidationStatus(t,n,o,r,s){this.status.set({state:"connection-validation",payload:{source:n,target:o,sourceHandle:r,targetHandle:s,valid:t}})}setReconnectionValidationStatus(t,n,o,r,s,a){this.status.set({state:"reconnection-validation",payload:{source:n,target:o,sourceHandle:r,targetHandle:s,valid:t,oldEdge:a}})}setConnectionEndStatus(t,n,o,r){this.status.set({state:"connection-end",payload:{source:t,target:n,sourceHandle:o,targetHandle:r}})}setReconnectionEndStatus(t,n,o,r,s){this.status.set({state:"reconnection-end",payload:{source:t,target:n,sourceHandle:o,targetHandle:r,oldEdge:s}})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var Gt=class{constructor(i){this.settings=i,this.curve=i.curve??"bezier",this.type=i.type??"default",this.mode=i.mode??"strict";let t=this.getValidators(i);this.validator=n=>t.every(o=>o(n))}getValidators(i){let t=[];return t.push(la),this.mode==="loose"&&t.push(ca),i.validator&&t.push(i.validator),t}},la=e=>e.source!==e.target,ca=e=>e.sourceHandle!==void 0&&e.targetHandle!==void 0;function Je(e){return e.split("").reduce((i,t)=>(i=(i<<5)-i+t.charCodeAt(0),i&i),0)}var te=(()=>{class e{constructor(){this.nodes=b([],{equal:(t,n)=>!t.length&&!n.length?!0:t===n}),this.rawNodes=y(()=>this.nodes().map(t=>t.rawNode)),this.edges=b([],{equal:(t,n)=>!t.length&&!n.length?!0:t===n}),this.rawEdges=y(()=>this.edges().map(t=>t.edge)),this.validEdges=y(()=>{let t=this.nodes();return this.edges().filter(n=>t.includes(n.source())&&t.includes(n.target()))}),this.connection=b(new Gt({})),this.markers=y(()=>{let t=new Map;this.validEdges().forEach(o=>{if(o.edge.markers?.start){let r=Je(JSON.stringify(o.edge.markers.start));t.set(r,o.edge.markers.start)}if(o.edge.markers?.end){let r=Je(JSON.stringify(o.edge.markers.end));t.set(r,o.edge.markers.end)}});let n=this.connection().settings.marker;if(n){let o=Je(JSON.stringify(n));t.set(o,n)}return t}),this.entities=y(()=>[...this.nodes(),...this.edges()]),this.minimap=b(null)}getNode(t){return this.nodes().find(({rawNode:n})=>n.id===t)}getDetachedEdges(){return this.edges().filter(t=>t.detached())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();function Ii(e){let i={};return e.sourceHandle.rawHandle.type==="source"?(i.source=e.source,i.sourceHandle=e.sourceHandle):(i.source=e.target,i.sourceHandle=e.targetHandle),e.targetHandle.rawHandle.type==="target"?(i.target=e.target,i.targetHandle=e.targetHandle):(i.target=e.source,i.targetHandle=e.sourceHandle),i}var Bn=(()=>{class e{constructor(){this.statusService=u(ke),this.flowEntitiesService=u(te),this.onConnect=L(B(this.statusService.status).pipe(K(t=>t.state==="connection-end"),F(t=>Po(t,this.isStrictMode())),ie(()=>this.statusService.setIdleStatus()),K(t=>this.flowEntitiesService.connection().validator(t)))),this.onReconnect=L(B(this.statusService.status).pipe(K(t=>t.state==="reconnection-end"),F(t=>{let n=Po(t,this.isStrictMode()),o=t.payload.oldEdge.edge;return{connection:n,oldEdge:o}}),ie(()=>this.statusService.setIdleStatus()),K(({connection:t})=>this.flowEntitiesService.connection().validator(t)))),this.isStrictMode=y(()=>this.flowEntitiesService.connection().mode==="strict")}startConnection(t){this.statusService.setConnectionStartStatus(t.parentNode,t)}startReconnection(t,n){this.statusService.setReconnectionStartStatus(t.parentNode,t,n)}validateConnection(t){let n=this.statusService.status();if(n.state==="connection-start"||n.state==="reconnection-start"){let o=n.state==="reconnection-start",r=n.payload.source,s=t.parentNode,a=n.payload.sourceHandle,l=t;if(this.isStrictMode()){let d=Ii({source:n.payload.source,sourceHandle:n.payload.sourceHandle,target:t.parentNode,targetHandle:t});r=d.source,s=d.target,a=d.sourceHandle,l=d.targetHandle}let c=this.flowEntitiesService.connection().validator({source:r.rawNode.id,target:s.rawNode.id,sourceHandle:a.rawHandle.id,targetHandle:l.rawHandle.id});t.state.set(c?"valid":"invalid"),o?this.statusService.setReconnectionValidationStatus(c,n.payload.source,t.parentNode,n.payload.sourceHandle,t,n.payload.oldEdge):this.statusService.setConnectionValidationStatus(c,n.payload.source,t.parentNode,n.payload.sourceHandle,t)}}resetValidateConnection(t){t.state.set("idle");let n=this.statusService.status();(n.state==="connection-validation"||n.state==="reconnection-validation")&&(n.state==="reconnection-validation"?this.statusService.setReconnectionStartStatus(n.payload.source,n.payload.sourceHandle,n.payload.oldEdge):this.statusService.setConnectionStartStatus(n.payload.source,n.payload.sourceHandle))}endConnection(){let t=this.statusService.status();if(t.state==="connection-validation"||t.state==="reconnection-validation"){let n=t.state==="reconnection-validation",o=t.payload.source,r=t.payload.sourceHandle,s=t.payload.target,a=t.payload.targetHandle;n?this.statusService.setReconnectionEndStatus(o,s,r,a,t.payload.oldEdge):this.statusService.setConnectionEndStatus(o,s,r,a)}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["","onConnect",""],["","onReconnect",""]],outputs:{onConnect:"onConnect",onReconnect:"onReconnect"},standalone:!0})}}return e})();function Po(e,i){let t=e.payload.source,n=e.payload.target,o=e.payload.sourceHandle,r=e.payload.targetHandle;if(i){let d=Ii({source:e.payload.source,sourceHandle:e.payload.sourceHandle,target:e.payload.target,targetHandle:e.payload.targetHandle});t=d.source,n=d.target,o=d.sourceHandle,r=d.targetHandle}let s=t.rawNode.id,a=n.rawNode.id,l=o.rawHandle.id,c=r.rawHandle.id;return{source:s,target:a,sourceHandle:l,targetHandle:c}}uo();var rt=(()=>{class e{constructor(){this.host=u(oe).nativeElement,this.initialTouch$=new Ht,this.prevTouchEvent=null,this.mouseMovement$=Ge(this.host,"mousemove").pipe(F(t=>({x:t.clientX,y:t.clientY,movementX:t.movementX,movementY:t.movementY,target:t.target,originalEvent:t})),Ze(bi),Vt()),this.touchMovement$=me(this.initialTouch$,Ge(this.host,"touchmove")).pipe(ie(t=>t.preventDefault()),F(t=>{let n=t.touches[0]?.clientX??0,o=t.touches[0]?.clientY??0,r=this.prevTouchEvent?t.touches[0].pageX-this.prevTouchEvent.touches[0].pageX:0,s=this.prevTouchEvent?t.touches[0].pageY-this.prevTouchEvent.touches[0].pageY:0,a=document.elementFromPoint(n,o);return{x:n,y:o,movementX:r,movementY:s,target:a,originalEvent:t}}),ie(t=>this.prevTouchEvent=t.originalEvent),Ze(bi),Vt()),this.pointerMovement$=me(this.mouseMovement$,this.touchMovement$),this.touchEnd$=Ge(this.host,"touchend").pipe(F(t=>{let n=t.changedTouches[0]?.clientX??0,o=t.changedTouches[0]?.clientY??0,r=document.elementFromPoint(n,o);return{x:n,y:o,target:r,originalEvent:t}}),ie(()=>this.prevTouchEvent=null),Vt()),this.mouseUp$=Ge(this.host,"mouseup").pipe(F(t=>{let n=t.clientX,o=t.clientY,r=t.target;return{x:n,y:o,target:r,originalEvent:t}}),Vt()),this.documentPointerEnd$=me(Ge(document,"mouseup"),Ge(document,"touchend")).pipe(Vt())}setInitialTouch(t){this.initialTouch$.next(t)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["svg","rootPointer",""]],standalone:!0})}}return e})();var Vo=(e,i)=>{let t=Math.max(0,Math.min(e.x+e.width,i.x+i.width)-Math.max(e.x,i.x)),n=Math.max(0,Math.min(e.y+e.height,i.y+i.height)-Math.max(e.y,i.y));return Math.ceil(t*n)};function Gn(e){if(e.length===0)return{x:0,y:0,width:0,height:0};let i={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(t=>{let n=da(t);i=ha(i,n)}),ua(i)}function Ao(e,i,t){let n=i.find(r=>r.rawNode.id===e);if(!n)return[];let o=$o(n);return i.filter(r=>{if(r.rawNode.id===e)return!1;let s=Vo($o(r),o);return t?.partially?s>0:s>=o.width*o.height})}function da(e){return{x:e.point().x,y:e.point().y,x2:e.point().x+e.size().width,y2:e.point().y+e.size().height}}function $o(e){return{x:e.globalPoint().x,y:e.globalPoint().y,width:e.width(),height:e.height()}}function ua({x:e,y:i,x2:t,y2:n}){return{x:e,y:i,width:t-e,height:n-i}}function ha(e,i){return{x:Math.min(e.x,i.x),y:Math.min(e.y,i.y),x2:Math.max(e.x2,i.x2),y2:Math.max(e.y2,i.y2)}}function Lo(e,i,t,n,o,r){let s=i/(e.width*(1+r)),a=t/(e.height*(1+r)),l=Math.min(s,a),c=pa(l,n,o),d=e.x+e.width/2,f=e.y+e.height/2,h=i/2-d*c,g=t/2-f*c;return{x:h,y:g,zoom:c}}function pa(e,i=0,t=1){return Math.min(Math.max(e,i),t)}function ma(e,i,t){let n=e.zoom;return{x:-e.x/n,y:-e.y/n,width:i/n,height:t/n}}function Bo(e,i,t,n){let o=ma(i,t,n);return!(e.x+e.width<o.x||e.x>o.x+o.width||e.y+e.height<o.y||e.y>o.y+o.height)}var Go={detachedGroupsLayer:!1,virtualization:!1,virtualizationZoomThreshold:.5,lazyLoadTrigger:"immediate"};var Q=(()=>{class e{constructor(){this.entitiesSelectable=b(!0),this.elevateNodesOnSelect=b(!0),this.elevateEdgesOnSelect=b(!0),this.view=b([400,400]),this.computedFlowWidth=b(0),this.computedFlowHeight=b(0),this.minZoom=b(.5),this.maxZoom=b(3),this.background=b({type:"solid",color:"#fff"}),this.snapGrid=b([1,1]),this.optimization=b(Go)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var Ee=(()=>{class e{constructor(){this.entitiesService=u(te),this.flowSettingsService=u(Q),this.writableViewport=b({changeType:"initial",state:e.getDefaultViewport(),duration:0}),this.readableViewport=b(e.getDefaultViewport()),this.viewportChangeEnd$=new Ht}static getDefaultViewport(){return{zoom:1,x:0,y:0}}fitView(t={padding:.1,duration:0,nodes:[]}){let n=this.getBoundsNodes(t.nodes??[]),o=Lo(Gn(n),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom(),t.padding??.1),r=t.duration??0;this.writableViewport.set({changeType:"absolute",state:o,duration:r})}triggerViewportChangeEvent(t){t==="end"&&this.viewportChangeEnd$.next()}getBoundsNodes(t){return t?.length?t.map(n=>this.entitiesService.nodes().find(({rawNode:o})=>o.id===n)).filter(n=>!!n):this.entitiesService.nodes()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var jt=e=>Math.round(e*100)/100;var st=(()=>{class e{constructor(){this.element=u(oe).nativeElement}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["svg","rootSvgRef",""]],standalone:!0})}}return e})();var at=(()=>{class e{constructor(){this.pointerMovementDirective=u(rt),this.rootSvg=u(st).element,this.host=u(oe).nativeElement,this.svgCurrentSpacePoint=y(()=>{let t=this.pointerMovement();return t?this.documentPointToFlowPoint({x:t.x,y:t.y}):{x:0,y:0}}),this.pointerMovement=$n(this.pointerMovementDirective.pointerMovement$)}documentPointToFlowPoint(t){let n=this.rootSvg.createSVGPoint();return n.x=t.x,n.y=t.y,n.matrixTransform(this.host.getScreenCTM().inverse())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["g","spacePointContext",""]],standalone:!0})}}return e})();function jo(e){return window.TouchEvent&&e instanceof TouchEvent}var Xt=(()=>{class e{constructor(){this.hostElement=u(oe).nativeElement,this.pointerMovementDirective=u(rt),this.pointerOver=tn(),this.pointerOut=tn(),this.pointerStart=tn(),this.pointerEnd=tn(),this.wasPointerOver=!1,this.touchEnd=this.pointerMovementDirective.touchEnd$.pipe(K(({target:t})=>t===this.hostElement),ie(({originalEvent:t})=>this.pointerEnd.emit(t)),ve()).subscribe(),this.touchOverOut=this.pointerMovementDirective.touchMovement$.pipe(ie(({target:t,originalEvent:n})=>{this.handleTouchOverAndOut(t,n)}),ve()).subscribe()}onPointerStart(t){this.pointerStart.emit(t),jo(t)&&this.pointerMovementDirective.setInitialTouch(t)}onPointerEnd(t){this.pointerEnd.emit(t)}onMouseOver(t){this.pointerOver.emit(t)}onMouseOut(t){this.pointerOut.emit(t)}handleTouchOverAndOut(t,n){t===this.hostElement?(this.pointerOver.emit(n),this.wasPointerOver=!0):(this.wasPointerOver&&this.pointerOut.emit(n),this.wasPointerOver=!1)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["","pointerStart",""],["","pointerEnd",""],["","pointerOver",""],["","pointerOut",""]],hostBindings:function(n,o){n&1&&J("mousedown",function(s){return o.onPointerStart(s)})("touchstart",function(s){return o.onPointerStart(s)})("mouseup",function(s){return o.onPointerEnd(s)})("mouseover",function(s){return o.onMouseOver(s)})("mouseout",function(s){return o.onMouseOut(s)})},outputs:{pointerOver:"pointerOver",pointerOut:"pointerOut",pointerStart:"pointerStart",pointerEnd:"pointerEnd"},standalone:!0})}}return e})();function _e(e,i){return Math.ceil(e/i)*i}var fa=["resizer"],ga=["resizable",""],va=["*"];function xa(e,i){if(e&1){let t=ye();D(),R(0,"g")(1,"line",1),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("top",o))}),$(),R(2,"line",2),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("left",o))}),$(),R(3,"line",3),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("bottom",o))}),$(),R(4,"line",4),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("right",o))}),$(),R(5,"rect",5),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("top-left",o))}),$(),R(6,"rect",6),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("top-right",o))}),$(),R(7,"rect",7),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("bottom-left",o))}),$(),R(8,"rect",8),J("pointerStart",function(o){U(t);let r=m();return Z(r.startResize("bottom-right",o))}),$()()}if(e&2){let t=m();w(),k("x1",t.lineGap)("y1",-t.gap())("x2",t.model.size().width-t.lineGap)("y2",-t.gap())("stroke",t.resizerColor()),w(),k("x1",-t.gap())("y1",t.lineGap)("x2",-t.gap())("y2",t.model.size().height-t.lineGap)("stroke",t.resizerColor()),w(),k("x1",t.lineGap)("y1",t.model.size().height+t.gap())("x2",t.model.size().width-t.lineGap)("y2",t.model.size().height+t.gap())("stroke",t.resizerColor()),w(),k("x1",t.model.size().width+t.gap())("y1",t.lineGap)("x2",t.model.size().width+t.gap())("y2",t.model.size().height-t.lineGap)("stroke",t.resizerColor()),w(),k("x",-(t.handleSize/2)-t.gap())("y",-(t.handleSize/2)-t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor()),w(),k("x",t.model.size().width-t.handleSize/2+t.gap())("y",-(t.handleSize/2)-t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor()),w(),k("x",-(t.handleSize/2)-t.gap())("y",t.model.size().height-t.handleSize/2+t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor()),w(),k("x",t.model.size().width-t.handleSize/2+t.gap())("y",t.model.size().height-t.handleSize/2+t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor())}}var Xo=(()=>{class e{get model(){return this.nodeAccessor.model()}constructor(){this.nodeAccessor=u(Ke),this.rootPointer=u(rt),this.viewportService=u(Ee),this.spacePointContext=u(at),this.settingsService=u(Q),this.hostRef=u(oe),this.resizable=W(),this.resizerColor=W("#2e414c"),this.gap=W(1.5),this.resizer=wt.required("resizer"),this.lineGap=3,this.handleSize=6,this.resizeSide=null,this.zoom=y(()=>this.viewportService.readableViewport().zoom??0),this.minWidth=0,this.minHeight=0,this.maxWidth=1/0,this.maxHeight=1/0,this.resizeOnGlobalMouseMove=this.rootPointer.pointerMovement$.pipe(K(()=>this.resizeSide!==null),K(t=>t.movementX!==0||t.movementY!==0),ie(t=>this.resize(t)),ve()).subscribe(),this.endResizeOnGlobalMouseUp=this.rootPointer.documentPointerEnd$.pipe(ie(()=>this.endResize()),ve()).subscribe(),Pe(()=>{let t=this.resizable();typeof t=="boolean"?this.model.resizable.set(t):this.model.resizable.set(!0)},{allowSignalWrites:!0})}ngOnInit(){this.model.controlledByResizer.set(!0),this.model.resizerTemplate.set(this.resizer())}ngOnDestroy(){this.model.controlledByResizer.set(!1)}ngAfterViewInit(){this.minWidth=+getComputedStyle(this.hostRef.nativeElement).minWidth.replace("px","")||0,this.minHeight=+getComputedStyle(this.hostRef.nativeElement).minHeight.replace("px","")||0,this.maxWidth=+getComputedStyle(this.hostRef.nativeElement).maxWidth.replace("px","")||1/0,this.maxHeight=+getComputedStyle(this.hostRef.nativeElement).maxHeight.replace("px","")||1/0}startResize(t,n){n.stopPropagation(),this.resizeSide=t,this.model.resizing.set(!0)}resize(t){if(!this.resizeSide)return;let n=ya(t.movementX,t.movementY,this.zoom()),o=this.applyResize(this.resizeSide,this.model,n,this.getDistanceToEdge(t)),{x:r,y:s,width:a,height:l}=wa(o,this.model,this.resizeSide,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);this.model.setPoint({x:r,y:s}),this.model.width.set(a),this.model.height.set(l)}endResize(){this.resizeSide=null,this.model.resizing.set(!1)}getDistanceToEdge(t){let n=this.spacePointContext.documentPointToFlowPoint({x:t.x,y:t.y}),{x:o,y:r}=this.model.globalPoint();return{left:n.x-o,right:n.x-(o+this.model.width()),top:n.y-r,bottom:n.y-(r+this.model.height())}}applyResize(t,n,o,r){let{x:s,y:a}=n.point(),l=n.width(),c=n.height(),[d,f]=this.settingsService.snapGrid();switch(t){case"left":{let h=o.x+r.left,g=_e(s+h,d),_=g-s;return{x:g,y:a,width:l-_,height:c}}case"right":{let h=o.x+r.right,g=_e(l+h,d);return{x:s,y:a,width:g,height:c}}case"top":{let h=o.y+r.top,g=_e(a+h,f),_=g-a;return{x:s,y:g,width:l,height:c-_}}case"bottom":{let h=o.y+r.bottom,g=_e(c+h,f);return{x:s,y:a,width:l,height:g}}case"top-left":{let h=o.x+r.left,g=o.y+r.top,_=_e(s+h,d),N=_e(a+g,f),z=_-s,C=N-a;return{x:_,y:N,width:l-z,height:c-C}}case"top-right":{let h=o.x+r.right,g=o.y+r.top,_=_e(a+g,f),N=_-a;return{x:s,y:_,width:_e(l+h,d),height:c-N}}case"bottom-left":{let h=o.x+r.left,g=o.y+r.bottom,_=_e(s+h,d),N=_-s;return{x:_,y:a,width:l-N,height:_e(c+g,f)}}case"bottom-right":{let h=o.x+r.right,g=o.y+r.bottom;return{x:s,y:a,width:_e(l+h,d),height:_e(c+g,f)}}}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["","resizable",""]],viewQuery:function(n,o){n&1&&St(o.resizer,fa,5),n&2&&bt()},inputs:{resizable:[j.SignalBased,"resizable"],resizerColor:[j.SignalBased,"resizerColor"],gap:[j.SignalBased,"gap"]},standalone:!0,features:[ue],attrs:ga,ngContentSelectors:va,decls:3,vars:0,consts:[["resizer",""],["stroke-width","2",1,"top",3,"pointerStart"],["stroke-width","2",1,"left",3,"pointerStart"],["stroke-width","2",1,"bottom",3,"pointerStart"],["stroke-width","2",1,"right",3,"pointerStart"],[1,"top-left",3,"pointerStart"],[1,"top-right",3,"pointerStart"],[1,"bottom-left",3,"pointerStart"],[1,"bottom-right",3,"pointerStart"]],template:function(n,o){n&1&&(In(),A(0,xa,9,40,"ng-template",null,0,No),Hn(2))},dependencies:[Xt],styles:[".top[_ngcontent-%COMP%]{cursor:n-resize}.left[_ngcontent-%COMP%]{cursor:w-resize}.right[_ngcontent-%COMP%]{cursor:e-resize}.bottom[_ngcontent-%COMP%]{cursor:s-resize}.top-left[_ngcontent-%COMP%]{cursor:nw-resize}.top-right[_ngcontent-%COMP%]{cursor:ne-resize}.bottom-left[_ngcontent-%COMP%]{cursor:sw-resize}.bottom-right[_ngcontent-%COMP%]{cursor:se-resize}"],changeDetection:0})}}return Kt([on],e.prototype,"ngAfterViewInit",null),e})();function ya(e,i,t){return{x:jt(e/t),y:jt(i/t)}}function wa(e,i,t,n,o,r,s){let{x:a,y:l,width:c,height:d}=e;c=Math.max(c,0),d=Math.max(d,0),c=Math.max(n,c),d=Math.max(o,d),c=Math.min(r,c),d=Math.min(s,d),a=Math.min(a,i.point().x+i.width()-n),l=Math.min(l,i.point().y+i.height()-o),a=Math.max(a,i.point().x+i.width()-r),l=Math.max(l,i.point().y+i.height()-s);let f=i.parent();if(f){let g=f.width(),_=f.height(),N=i.point().x,z=i.point().y;a=Math.max(a,0),l=Math.max(l,0),t.includes("left")&&a===0&&(c=Math.min(c,N+i.width())),t.includes("top")&&l===0&&(d=Math.min(d,z+i.height())),c=Math.min(c,g-a),d=Math.min(d,_-l)}let h=Gn(i.children());return h&&(t.includes("left")&&(a=Math.min(a,i.point().x+i.width()-(h.x+h.width)),c=Math.max(c,h.x+h.width)),t.includes("right")&&(c=Math.max(c,h.x+h.width)),t.includes("bottom")&&(d=Math.max(d,h.y+h.height)),t.includes("top")&&(l=Math.min(l,i.point().y+i.height()-(h.y+h.height)),d=Math.max(d,h.y+h.height))),{x:a,y:l,width:c,height:d}}var jn="http://www.w3.org/1999/xhtml",Hi={svg:"http://www.w3.org/2000/svg",xhtml:jn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function et(e){var i=e+="",t=i.indexOf(":");return t>=0&&(i=e.slice(0,t))!=="xmlns"&&(e=e.slice(t+1)),Hi.hasOwnProperty(i)?{space:Hi[i],local:e}:e}function _a(e){return function(){var i=this.ownerDocument,t=this.namespaceURI;return t===jn&&i.documentElement.namespaceURI===jn?i.createElement(e):i.createElementNS(t,e)}}function Ca(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Xn(e){var i=et(e);return(i.local?Ca:_a)(i)}function Sa(){}function Nt(e){return e==null?Sa:function(){return this.querySelector(e)}}function Wo(e){typeof e!="function"&&(e=Nt(e));for(var i=this._groups,t=i.length,n=new Array(t),o=0;o<t;++o)for(var r=i[o],s=r.length,a=n[o]=new Array(s),l,c,d=0;d<s;++d)(l=r[d])&&(c=e.call(l,l.__data__,d,r))&&("__data__"in l&&(c.__data__=l.__data__),a[d]=c);return new re(n,this._parents)}function Fi(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ba(){return[]}function rn(e){return e==null?ba:function(){return this.querySelectorAll(e)}}function Ta(e){return function(){return Fi(e.apply(this,arguments))}}function Yo(e){typeof e=="function"?e=Ta(e):e=rn(e);for(var i=this._groups,t=i.length,n=[],o=[],r=0;r<t;++r)for(var s=i[r],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(e.call(l,l.__data__,c,s)),o.push(l));return new re(n,o)}function sn(e){return function(){return this.matches(e)}}function Wn(e){return function(i){return i.matches(e)}}var Na=Array.prototype.find;function Ea(e){return function(){return Na.call(this.children,e)}}function za(){return this.firstElementChild}function qo(e){return this.select(e==null?za:Ea(typeof e=="function"?e:Wn(e)))}var Oa=Array.prototype.filter;function ka(){return Array.from(this.children)}function Da(e){return function(){return Oa.call(this.children,e)}}function Uo(e){return this.selectAll(e==null?ka:Da(typeof e=="function"?e:Wn(e)))}function Zo(e){typeof e!="function"&&(e=sn(e));for(var i=this._groups,t=i.length,n=new Array(t),o=0;o<t;++o)for(var r=i[o],s=r.length,a=n[o]=[],l,c=0;c<s;++c)(l=r[c])&&e.call(l,l.__data__,c,r)&&a.push(l);return new re(n,this._parents)}function Yn(e){return new Array(e.length)}function Qo(){return new re(this._enter||this._groups.map(Yn),this._parents)}function an(e,i){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=i}an.prototype={constructor:an,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,i){return this._parent.insertBefore(e,i)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ko(e){return function(){return e}}function Ma(e,i,t,n,o,r){for(var s=0,a,l=i.length,c=r.length;s<c;++s)(a=i[s])?(a.__data__=r[s],n[s]=a):t[s]=new an(e,r[s]);for(;s<l;++s)(a=i[s])&&(o[s]=a)}function Ra(e,i,t,n,o,r,s){var a,l,c=new Map,d=i.length,f=r.length,h=new Array(d),g;for(a=0;a<d;++a)(l=i[a])&&(h[a]=g=s.call(l,l.__data__,a,i)+"",c.has(g)?o[a]=l:c.set(g,l));for(a=0;a<f;++a)g=s.call(e,r[a],a,r)+"",(l=c.get(g))?(n[a]=l,l.__data__=r[a],c.delete(g)):t[a]=new an(e,r[a]);for(a=0;a<d;++a)(l=i[a])&&c.get(h[a])===l&&(o[a]=l)}function Ia(e){return e.__data__}function Jo(e,i){if(!arguments.length)return Array.from(this,Ia);var t=i?Ra:Ma,n=this._parents,o=this._groups;typeof e!="function"&&(e=Ko(e));for(var r=o.length,s=new Array(r),a=new Array(r),l=new Array(r),c=0;c<r;++c){var d=n[c],f=o[c],h=f.length,g=Ha(e.call(d,d&&d.__data__,c,n)),_=g.length,N=a[c]=new Array(_),z=s[c]=new Array(_),C=l[c]=new Array(h);t(d,f,N,z,C,g,i);for(var ae=0,he=0,x,O;ae<_;++ae)if(x=N[ae]){for(ae>=he&&(he=ae+1);!(O=z[he])&&++he<_;);x._next=O||null}}return s=new re(s,n),s._enter=a,s._exit=l,s}function Ha(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function er(){return new re(this._exit||this._groups.map(Yn),this._parents)}function tr(e,i,t){var n=this.enter(),o=this,r=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),i!=null&&(o=i(o),o&&(o=o.selection())),t==null?r.remove():t(r),n&&o?n.merge(o).order():o}function nr(e){for(var i=e.selection?e.selection():e,t=this._groups,n=i._groups,o=t.length,r=n.length,s=Math.min(o,r),a=new Array(o),l=0;l<s;++l)for(var c=t[l],d=n[l],f=c.length,h=a[l]=new Array(f),g,_=0;_<f;++_)(g=c[_]||d[_])&&(h[_]=g);for(;l<o;++l)a[l]=t[l];return new re(a,this._parents)}function ir(){for(var e=this._groups,i=-1,t=e.length;++i<t;)for(var n=e[i],o=n.length-1,r=n[o],s;--o>=0;)(s=n[o])&&(r&&s.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(s,r),r=s);return this}function or(e){e||(e=Fa);function i(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r){for(var s=t[r],a=s.length,l=o[r]=new Array(a),c,d=0;d<a;++d)(c=s[d])&&(l[d]=c);l.sort(i)}return new re(o,this._parents).order()}function Fa(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function rr(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function sr(){return Array.from(this)}function ar(){for(var e=this._groups,i=0,t=e.length;i<t;++i)for(var n=e[i],o=0,r=n.length;o<r;++o){var s=n[o];if(s)return s}return null}function lr(){let e=0;for(let i of this)++e;return e}function cr(){return!this.node()}function dr(e){for(var i=this._groups,t=0,n=i.length;t<n;++t)for(var o=i[t],r=0,s=o.length,a;r<s;++r)(a=o[r])&&e.call(a,a.__data__,r,o);return this}function Pa(e){return function(){this.removeAttribute(e)}}function Va(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $a(e,i){return function(){this.setAttribute(e,i)}}function Aa(e,i){return function(){this.setAttributeNS(e.space,e.local,i)}}function La(e,i){return function(){var t=i.apply(this,arguments);t==null?this.removeAttribute(e):this.setAttribute(e,t)}}function Ba(e,i){return function(){var t=i.apply(this,arguments);t==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,t)}}function ur(e,i){var t=et(e);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((i==null?t.local?Va:Pa:typeof i=="function"?t.local?Ba:La:t.local?Aa:$a)(t,i))}function qn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ga(e){return function(){this.style.removeProperty(e)}}function ja(e,i,t){return function(){this.style.setProperty(e,i,t)}}function Xa(e,i,t){return function(){var n=i.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,t)}}function hr(e,i,t){return arguments.length>1?this.each((i==null?Ga:typeof i=="function"?Xa:ja)(e,i,t??"")):lt(this.node(),e)}function lt(e,i){return e.style.getPropertyValue(i)||qn(e).getComputedStyle(e,null).getPropertyValue(i)}function Wa(e){return function(){delete this[e]}}function Ya(e,i){return function(){this[e]=i}}function qa(e,i){return function(){var t=i.apply(this,arguments);t==null?delete this[e]:this[e]=t}}function pr(e,i){return arguments.length>1?this.each((i==null?Wa:typeof i=="function"?qa:Ya)(e,i)):this.node()[e]}function mr(e){return e.trim().split(/^|\s+/)}function Pi(e){return e.classList||new fr(e)}function fr(e){this._node=e,this._names=mr(e.getAttribute("class")||"")}fr.prototype={add:function(e){var i=this._names.indexOf(e);i<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var i=this._names.indexOf(e);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function gr(e,i){for(var t=Pi(e),n=-1,o=i.length;++n<o;)t.add(i[n])}function vr(e,i){for(var t=Pi(e),n=-1,o=i.length;++n<o;)t.remove(i[n])}function Ua(e){return function(){gr(this,e)}}function Za(e){return function(){vr(this,e)}}function Qa(e,i){return function(){(i.apply(this,arguments)?gr:vr)(this,e)}}function xr(e,i){var t=mr(e+"");if(arguments.length<2){for(var n=Pi(this.node()),o=-1,r=t.length;++o<r;)if(!n.contains(t[o]))return!1;return!0}return this.each((typeof i=="function"?Qa:i?Ua:Za)(t,i))}function Ka(){this.textContent=""}function Ja(e){return function(){this.textContent=e}}function el(e){return function(){var i=e.apply(this,arguments);this.textContent=i??""}}function yr(e){return arguments.length?this.each(e==null?Ka:(typeof e=="function"?el:Ja)(e)):this.node().textContent}function tl(){this.innerHTML=""}function nl(e){return function(){this.innerHTML=e}}function il(e){return function(){var i=e.apply(this,arguments);this.innerHTML=i??""}}function wr(e){return arguments.length?this.each(e==null?tl:(typeof e=="function"?il:nl)(e)):this.node().innerHTML}function ol(){this.nextSibling&&this.parentNode.appendChild(this)}function _r(){return this.each(ol)}function rl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Cr(){return this.each(rl)}function Sr(e){var i=typeof e=="function"?e:Xn(e);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function sl(){return null}function br(e,i){var t=typeof e=="function"?e:Xn(e),n=i==null?sl:typeof i=="function"?i:Nt(i);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function al(){var e=this.parentNode;e&&e.removeChild(this)}function Tr(){return this.each(al)}function ll(){var e=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(e,this.nextSibling):e}function cl(){var e=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(e,this.nextSibling):e}function Nr(e){return this.select(e?cl:ll)}function Er(e){return arguments.length?this.property("__data__",e):this.node().__data__}function dl(e){return function(i){e.call(this,i,this.__data__)}}function ul(e){return e.trim().split(/^|\s+/).map(function(i){var t="",n=i.indexOf(".");return n>=0&&(t=i.slice(n+1),i=i.slice(0,n)),{type:i,name:t}})}function hl(e){return function(){var i=this.__on;if(i){for(var t=0,n=-1,o=i.length,r;t<o;++t)r=i[t],(!e.type||r.type===e.type)&&r.name===e.name?this.removeEventListener(r.type,r.listener,r.options):i[++n]=r;++n?i.length=n:delete this.__on}}}function pl(e,i,t){return function(){var n=this.__on,o,r=dl(i);if(n){for(var s=0,a=n.length;s<a;++s)if((o=n[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=r,o.options=t),o.value=i;return}}this.addEventListener(e.type,r,t),o={type:e.type,name:e.name,value:i,listener:r,options:t},n?n.push(o):this.__on=[o]}}function zr(e,i,t){var n=ul(e+""),o,r=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,d;l<c;++l)for(o=0,d=a[l];o<r;++o)if((s=n[o]).type===d.type&&s.name===d.name)return d.value}return}for(a=i?pl:hl,o=0;o<r;++o)this.each(a(n[o],i,t));return this}function Or(e,i,t){var n=qn(e),o=n.CustomEvent;typeof o=="function"?o=new o(i,t):(o=n.document.createEvent("Event"),t?(o.initEvent(i,t.bubbles,t.cancelable),o.detail=t.detail):o.initEvent(i,!1,!1)),e.dispatchEvent(o)}function ml(e,i){return function(){return Or(this,e,i)}}function fl(e,i){return function(){return Or(this,e,i.apply(this,arguments))}}function kr(e,i){return this.each((typeof i=="function"?fl:ml)(e,i))}function*Dr(){for(var e=this._groups,i=0,t=e.length;i<t;++i)for(var n=e[i],o=0,r=n.length,s;o<r;++o)(s=n[o])&&(yield s)}var Vi=[null];function re(e,i){this._groups=e,this._parents=i}function Mr(){return new re([[document.documentElement]],Vi)}function gl(){return this}re.prototype=Mr.prototype={constructor:re,select:Wo,selectAll:Yo,selectChild:qo,selectChildren:Uo,filter:Zo,data:Jo,enter:Qo,exit:er,join:tr,merge:nr,selection:gl,order:ir,sort:or,call:rr,nodes:sr,node:ar,size:lr,empty:cr,each:dr,attr:ur,style:hr,property:pr,classed:xr,text:yr,html:wr,raise:_r,lower:Cr,append:Sr,insert:br,remove:Tr,clone:Nr,datum:Er,on:zr,dispatch:kr,[Symbol.iterator]:Dr};var tt=Mr;function fe(e){return typeof e=="string"?new re([[document.querySelector(e)]],[document.documentElement]):new re([[e]],Vi)}function Rr(e){let i;for(;i=e.sourceEvent;)e=i;return e}function De(e,i){if(e=Rr(e),i===void 0&&(i=e.currentTarget),i){var t=i.ownerSVGElement||i;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(i.getScreenCTM().inverse()),[n.x,n.y]}if(i.getBoundingClientRect){var o=i.getBoundingClientRect();return[e.clientX-o.left-i.clientLeft,e.clientY-o.top-i.clientTop]}}return[e.pageX,e.pageY]}var vl={value:()=>{}};function Hr(){for(var e=0,i=arguments.length,t={},n;e<i;++e){if(!(n=arguments[e]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new Un(t)}function Un(e){this._=e}function xl(e,i){return e.trim().split(/^|\s+/).map(function(t){var n="",o=t.indexOf(".");if(o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}Un.prototype=Hr.prototype={constructor:Un,on:function(e,i){var t=this._,n=xl(e+"",t),o,r=-1,s=n.length;if(arguments.length<2){for(;++r<s;)if((o=(e=n[r]).type)&&(o=yl(t[o],e.name)))return o;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++r<s;)if(o=(e=n[r]).type)t[o]=Ir(t[o],e.name,i);else if(i==null)for(o in t)t[o]=Ir(t[o],e.name,null);return this},copy:function(){var e={},i=this._;for(var t in i)e[t]=i[t].slice();return new Un(e)},call:function(e,i){if((o=arguments.length-2)>0)for(var t=new Array(o),n=0,o,r;n<o;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],n=0,o=r.length;n<o;++n)r[n].value.apply(i,t)},apply:function(e,i,t){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],o=0,r=n.length;o<r;++o)n[o].value.apply(i,t)}};function yl(e,i){for(var t=0,n=e.length,o;t<n;++t)if((o=e[t]).name===i)return o.value}function Ir(e,i,t){for(var n=0,o=e.length;n<o;++n)if(e[n].name===i){e[n]=vl,e=e.slice(0,n).concat(e.slice(n+1));break}return t!=null&&e.push({name:i,value:t}),e}var Et=Hr;var Fr={passive:!1},zt={capture:!0,passive:!1};function Zn(e){e.stopImmediatePropagation()}function ct(e){e.preventDefault(),e.stopImmediatePropagation()}function ln(e){var i=e.document.documentElement,t=fe(e).on("dragstart.drag",ct,zt);"onselectstart"in i?t.on("selectstart.drag",ct,zt):(i.__noselect=i.style.MozUserSelect,i.style.MozUserSelect="none")}function cn(e,i){var t=e.document.documentElement,n=fe(e).on("dragstart.drag",null);i&&(n.on("click.drag",ct,zt),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}var dn=e=>()=>e;function un(e,{sourceEvent:i,subject:t,target:n,identifier:o,active:r,x:s,y:a,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:i,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}un.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function wl(e){return!e.ctrlKey&&!e.button}function _l(){return this.parentNode}function Cl(e,i){return i??{x:e.x,y:e.y}}function Sl(){return navigator.maxTouchPoints||"ontouchstart"in this}function Qn(){var e=wl,i=_l,t=Cl,n=Sl,o={},r=Et("start","drag","end"),s=0,a,l,c,d,f=0;function h(x){x.on("mousedown.drag",g).filter(n).on("touchstart.drag",z).on("touchmove.drag",C,Fr).on("touchend.drag touchcancel.drag",ae).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(x,O){if(!(d||!e.call(this,x,O))){var P=he(this,i.call(this,x,O),x,O,"mouse");P&&(fe(x.view).on("mousemove.drag",_,zt).on("mouseup.drag",N,zt),ln(x.view),Zn(x),c=!1,a=x.clientX,l=x.clientY,P("start",x))}}function _(x){if(ct(x),!c){var O=x.clientX-a,P=x.clientY-l;c=O*O+P*P>f}o.mouse("drag",x)}function N(x){fe(x.view).on("mousemove.drag mouseup.drag",null),cn(x.view,c),ct(x),o.mouse("end",x)}function z(x,O){if(e.call(this,x,O)){var P=x.changedTouches,G=i.call(this,x,O),pe=P.length,Ce,le;for(Ce=0;Ce<pe;++Ce)(le=he(this,G,x,O,P[Ce].identifier,P[Ce]))&&(Zn(x),le("start",x,P[Ce]))}}function C(x){var O=x.changedTouches,P=O.length,G,pe;for(G=0;G<P;++G)(pe=o[O[G].identifier])&&(ct(x),pe("drag",x,O[G]))}function ae(x){var O=x.changedTouches,P=O.length,G,pe;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),G=0;G<P;++G)(pe=o[O[G].identifier])&&(Zn(x),pe("end",x,O[G]))}function he(x,O,P,G,pe,Ce){var le=r.copy(),ce=De(Ce||P,O),vt,xt,p;if((p=t.call(x,new un("beforestart",{sourceEvent:P,target:h,identifier:pe,active:s,x:ce[0],y:ce[1],dx:0,dy:0,dispatch:le}),G))!=null)return vt=p.x-ce[0]||0,xt=p.y-ce[1]||0,function S(v,T,M){var I=ce,H;switch(v){case"start":o[pe]=S,H=s++;break;case"end":delete o[pe],--s;case"drag":ce=De(M||T,O),H=s;break}le.call(v,x,new un(v,{sourceEvent:T,subject:p,target:h,identifier:pe,active:H,x:ce[0]+vt,y:ce[1]+xt,dx:ce[0]-I[0],dy:ce[1]-I[1],dispatch:le}),G)}}return h.filter=function(x){return arguments.length?(e=typeof x=="function"?x:dn(!!x),h):e},h.container=function(x){return arguments.length?(i=typeof x=="function"?x:dn(x),h):i},h.subject=function(x){return arguments.length?(t=typeof x=="function"?x:dn(x),h):t},h.touchable=function(x){return arguments.length?(n=typeof x=="function"?x:dn(!!x),h):n},h.on=function(){var x=r.on.apply(r,arguments);return x===r?h:x},h.clickDistance=function(x){return arguments.length?(f=(x=+x)*x,h):Math.sqrt(f)},h}function Kn(e,i,t){e.prototype=i.prototype=t,t.constructor=e}function $i(e,i){var t=Object.create(e.prototype);for(var n in i)t[n]=i[n];return t}function mn(){}var hn=.7,ti=1/hn,Wt="\\s*([+-]?\\d+)\\s*",pn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",We="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bl=/^#([0-9a-f]{3,8})$/,Tl=new RegExp(`^rgb\\(${Wt},${Wt},${Wt}\\)$`),Nl=new RegExp(`^rgb\\(${We},${We},${We}\\)$`),El=new RegExp(`^rgba\\(${Wt},${Wt},${Wt},${pn}\\)$`),zl=new RegExp(`^rgba\\(${We},${We},${We},${pn}\\)$`),Ol=new RegExp(`^hsl\\(${pn},${We},${We}\\)$`),kl=new RegExp(`^hsla\\(${pn},${We},${We},${pn}\\)$`),Pr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Kn(mn,dt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Vr,formatHex:Vr,formatHex8:Dl,formatHsl:Ml,formatRgb:$r,toString:$r});function Vr(){return this.rgb().formatHex()}function Dl(){return this.rgb().formatHex8()}function Ml(){return Xr(this).formatHsl()}function $r(){return this.rgb().formatRgb()}function dt(e){var i,t;return e=(e+"").trim().toLowerCase(),(i=bl.exec(e))?(t=i[1].length,i=parseInt(i[1],16),t===6?Ar(i):t===3?new Ne(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):t===8?Jn(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):t===4?Jn(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=Tl.exec(e))?new Ne(i[1],i[2],i[3],1):(i=Nl.exec(e))?new Ne(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=El.exec(e))?Jn(i[1],i[2],i[3],i[4]):(i=zl.exec(e))?Jn(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=Ol.exec(e))?Gr(i[1],i[2]/100,i[3]/100,1):(i=kl.exec(e))?Gr(i[1],i[2]/100,i[3]/100,i[4]):Pr.hasOwnProperty(e)?Ar(Pr[e]):e==="transparent"?new Ne(NaN,NaN,NaN,0):null}function Ar(e){return new Ne(e>>16&255,e>>8&255,e&255,1)}function Jn(e,i,t,n){return n<=0&&(e=i=t=NaN),new Ne(e,i,t,n)}function Rl(e){return e instanceof mn||(e=dt(e)),e?(e=e.rgb(),new Ne(e.r,e.g,e.b,e.opacity)):new Ne}function Yt(e,i,t,n){return arguments.length===1?Rl(e):new Ne(e,i,t,n??1)}function Ne(e,i,t,n){this.r=+e,this.g=+i,this.b=+t,this.opacity=+n}Kn(Ne,Yt,$i(mn,{brighter(e){return e=e==null?ti:Math.pow(ti,e),new Ne(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?hn:Math.pow(hn,e),new Ne(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ne(kt(this.r),kt(this.g),kt(this.b),ni(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Lr,formatHex:Lr,formatHex8:Il,formatRgb:Br,toString:Br}));function Lr(){return`#${Ot(this.r)}${Ot(this.g)}${Ot(this.b)}`}function Il(){return`#${Ot(this.r)}${Ot(this.g)}${Ot(this.b)}${Ot((isNaN(this.opacity)?1:this.opacity)*255)}`}function Br(){let e=ni(this.opacity);return`${e===1?"rgb(":"rgba("}${kt(this.r)}, ${kt(this.g)}, ${kt(this.b)}${e===1?")":`, ${e})`}`}function ni(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function kt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ot(e){return e=kt(e),(e<16?"0":"")+e.toString(16)}function Gr(e,i,t,n){return n<=0?e=i=t=NaN:t<=0||t>=1?e=i=NaN:i<=0&&(e=NaN),new Ve(e,i,t,n)}function Xr(e){if(e instanceof Ve)return new Ve(e.h,e.s,e.l,e.opacity);if(e instanceof mn||(e=dt(e)),!e)return new Ve;if(e instanceof Ve)return e;e=e.rgb();var i=e.r/255,t=e.g/255,n=e.b/255,o=Math.min(i,t,n),r=Math.max(i,t,n),s=NaN,a=r-o,l=(r+o)/2;return a?(i===r?s=(t-n)/a+(t<n)*6:t===r?s=(n-i)/a+2:s=(i-t)/a+4,a/=l<.5?r+o:2-r-o,s*=60):a=l>0&&l<1?0:s,new Ve(s,a,l,e.opacity)}function Wr(e,i,t,n){return arguments.length===1?Xr(e):new Ve(e,i,t,n??1)}function Ve(e,i,t,n){this.h=+e,this.s=+i,this.l=+t,this.opacity=+n}Kn(Ve,Wr,$i(mn,{brighter(e){return e=e==null?ti:Math.pow(ti,e),new Ve(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?hn:Math.pow(hn,e),new Ve(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,i=isNaN(e)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*i,o=2*t-n;return new Ne(Ai(e>=240?e-240:e+120,o,n),Ai(e,o,n),Ai(e<120?e+240:e-120,o,n),this.opacity)},clamp(){return new Ve(jr(this.h),ei(this.s),ei(this.l),ni(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=ni(this.opacity);return`${e===1?"hsl(":"hsla("}${jr(this.h)}, ${ei(this.s)*100}%, ${ei(this.l)*100}%${e===1?")":`, ${e})`}`}}));function jr(e){return e=(e||0)%360,e<0?e+360:e}function ei(e){return Math.max(0,Math.min(1,e||0))}function Ai(e,i,t){return(e<60?i+(t-i)*e/60:e<180?t:e<240?i+(t-i)*(240-e)/60:i)*255}function Li(e,i,t,n,o){var r=e*e,s=r*e;return((1-3*e+3*r-s)*i+(4-6*r+3*s)*t+(1+3*e+3*r-3*s)*n+s*o)/6}function Yr(e){var i=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,i-1):Math.floor(t*i),o=e[n],r=e[n+1],s=n>0?e[n-1]:2*o-r,a=n<i-1?e[n+2]:2*r-o;return Li((t-n/i)*i,s,o,r,a)}}function qr(e){var i=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*i),o=e[(n+i-1)%i],r=e[n%i],s=e[(n+1)%i],a=e[(n+2)%i];return Li((t-n/i)*i,o,r,s,a)}}var Bi=e=>()=>e;function Hl(e,i){return function(t){return e+t*i}}function Fl(e,i,t){return e=Math.pow(e,t),i=Math.pow(i,t)-e,t=1/t,function(n){return Math.pow(e+n*i,t)}}function Ur(e){return(e=+e)==1?ii:function(i,t){return t-i?Fl(i,t,e):Bi(isNaN(i)?t:i)}}function ii(e,i){var t=i-e;return t?Hl(e,t):Bi(isNaN(e)?i:e)}var oi=function e(i){var t=Ur(i);function n(o,r){var s=t((o=Yt(o)).r,(r=Yt(r)).r),a=t(o.g,r.g),l=t(o.b,r.b),c=ii(o.opacity,r.opacity);return function(d){return o.r=s(d),o.g=a(d),o.b=l(d),o.opacity=c(d),o+""}}return n.gamma=e,n}(1);function Zr(e){return function(i){var t=i.length,n=new Array(t),o=new Array(t),r=new Array(t),s,a;for(s=0;s<t;++s)a=Yt(i[s]),n[s]=a.r||0,o[s]=a.g||0,r[s]=a.b||0;return n=e(n),o=e(o),r=e(r),a.opacity=1,function(l){return a.r=n(l),a.g=o(l),a.b=r(l),a+""}}}var Pl=Zr(Yr),Vl=Zr(qr);function Me(e,i){return e=+e,i=+i,function(t){return e*(1-t)+i*t}}var ji=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Gi=new RegExp(ji.source,"g");function $l(e){return function(){return e}}function Al(e){return function(i){return e(i)+""}}function Xi(e,i){var t=ji.lastIndex=Gi.lastIndex=0,n,o,r,s=-1,a=[],l=[];for(e=e+"",i=i+"";(n=ji.exec(e))&&(o=Gi.exec(i));)(r=o.index)>t&&(r=i.slice(t,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,l.push({i:s,x:Me(n,o)})),t=Gi.lastIndex;return t<i.length&&(r=i.slice(t),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?Al(l[0].x):$l(i):(i=l.length,function(c){for(var d=0,f;d<i;++d)a[(f=l[d]).i]=f.x(c);return a.join("")})}var Qr=180/Math.PI,ri={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Wi(e,i,t,n,o,r){var s,a,l;return(s=Math.sqrt(e*e+i*i))&&(e/=s,i/=s),(l=e*t+i*n)&&(t-=e*l,n-=i*l),(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a,l/=a),e*n<i*t&&(e=-e,i=-i,l=-l,s=-s),{translateX:o,translateY:r,rotate:Math.atan2(i,e)*Qr,skewX:Math.atan(l)*Qr,scaleX:s,scaleY:a}}var si;function Kr(e){let i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return i.isIdentity?ri:Wi(i.a,i.b,i.c,i.d,i.e,i.f)}function Jr(e){return e==null?ri:(si||(si=document.createElementNS("http://www.w3.org/2000/svg","g")),si.setAttribute("transform",e),(e=si.transform.baseVal.consolidate())?(e=e.matrix,Wi(e.a,e.b,e.c,e.d,e.e,e.f)):ri)}function es(e,i,t,n){function o(c){return c.length?c.pop()+" ":""}function r(c,d,f,h,g,_){if(c!==f||d!==h){var N=g.push("translate(",null,i,null,t);_.push({i:N-4,x:Me(c,f)},{i:N-2,x:Me(d,h)})}else(f||h)&&g.push("translate("+f+i+h+t)}function s(c,d,f,h){c!==d?(c-d>180?d+=360:d-c>180&&(c+=360),h.push({i:f.push(o(f)+"rotate(",null,n)-2,x:Me(c,d)})):d&&f.push(o(f)+"rotate("+d+n)}function a(c,d,f,h){c!==d?h.push({i:f.push(o(f)+"skewX(",null,n)-2,x:Me(c,d)}):d&&f.push(o(f)+"skewX("+d+n)}function l(c,d,f,h,g,_){if(c!==f||d!==h){var N=g.push(o(g)+"scale(",null,",",null,")");_.push({i:N-4,x:Me(c,f)},{i:N-2,x:Me(d,h)})}else(f!==1||h!==1)&&g.push(o(g)+"scale("+f+","+h+")")}return function(c,d){var f=[],h=[];return c=e(c),d=e(d),r(c.translateX,c.translateY,d.translateX,d.translateY,f,h),s(c.rotate,d.rotate,f,h),a(c.skewX,d.skewX,f,h),l(c.scaleX,c.scaleY,d.scaleX,d.scaleY,f,h),c=d=null,function(g){for(var _=-1,N=h.length,z;++_<N;)f[(z=h[_]).i]=z.x(g);return f.join("")}}}var Yi=es(Kr,"px, ","px)","deg)"),qi=es(Jr,", ",")",")");var Ll=1e-12;function ts(e){return((e=Math.exp(e))+1/e)/2}function Bl(e){return((e=Math.exp(e))-1/e)/2}function Gl(e){return((e=Math.exp(2*e))-1)/(e+1)}var Ui=function e(i,t,n){function o(r,s){var a=r[0],l=r[1],c=r[2],d=s[0],f=s[1],h=s[2],g=d-a,_=f-l,N=g*g+_*_,z,C;if(N<Ll)C=Math.log(h/c)/i,z=function(G){return[a+G*g,l+G*_,c*Math.exp(i*G*C)]};else{var ae=Math.sqrt(N),he=(h*h-c*c+n*N)/(2*c*t*ae),x=(h*h-c*c-n*N)/(2*h*t*ae),O=Math.log(Math.sqrt(he*he+1)-he),P=Math.log(Math.sqrt(x*x+1)-x);C=(P-O)/i,z=function(G){var pe=G*C,Ce=ts(O),le=c/(t*ae)*(Ce*Gl(i*pe+O)-Bl(O));return[a+le*g,l+le*_,c*Ce/ts(i*pe+O)]}}return z.duration=C*1e3*i/Math.SQRT2,z}return o.rho=function(r){var s=Math.max(.001,+r),a=s*s,l=a*a;return e(s,a,l)},o}(Math.SQRT2,2,4);var qt=0,gn=0,fn=0,is=1e3,ai,vn,li=0,Dt=0,ci=0,xn=typeof performance=="object"&&performance.now?performance:Date,os=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function wn(){return Dt||(os(jl),Dt=xn.now()+ci)}function jl(){Dt=0}function yn(){this._call=this._time=this._next=null}yn.prototype=di.prototype={constructor:yn,restart:function(e,i,t){if(typeof e!="function")throw new TypeError("callback is not a function");t=(t==null?wn():+t)+(i==null?0:+i),!this._next&&vn!==this&&(vn?vn._next=this:ai=this,vn=this),this._call=e,this._time=t,Zi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zi())}};function di(e,i,t){var n=new yn;return n.restart(e,i,t),n}function rs(){wn(),++qt;for(var e=ai,i;e;)(i=Dt-e._time)>=0&&e._call.call(void 0,i),e=e._next;--qt}function ns(){Dt=(li=xn.now())+ci,qt=gn=0;try{rs()}finally{qt=0,Wl(),Dt=0}}function Xl(){var e=xn.now(),i=e-li;i>is&&(ci-=i,li=e)}function Wl(){for(var e,i=ai,t,n=1/0;i;)i._call?(n>i._time&&(n=i._time),e=i,i=i._next):(t=i._next,i._next=null,i=e?e._next=t:ai=t);vn=e,Zi(n)}function Zi(e){if(!qt){gn&&(gn=clearTimeout(gn));var i=e-Dt;i>24?(e<1/0&&(gn=setTimeout(ns,e-xn.now()-ci)),fn&&(fn=clearInterval(fn))):(fn||(li=xn.now(),fn=setInterval(Xl,is)),qt=1,os(ns))}}function ui(e,i,t){var n=new yn;return i=i==null?0:+i,n.restart(o=>{n.stop(),e(o+i)},i,t),n}var Yl=Et("start","end","cancel","interrupt"),ql=[],ls=0,ss=1,pi=2,hi=3,as=4,mi=5,_n=6;function ut(e,i,t,n,o,r){var s=e.__transition;if(!s)e.__transition={};else if(t in s)return;Ul(e,t,{name:i,index:n,group:o,on:Yl,tween:ql,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:ls})}function Cn(e,i){var t=ge(e,i);if(t.state>ls)throw new Error("too late; already scheduled");return t}function we(e,i){var t=ge(e,i);if(t.state>hi)throw new Error("too late; already running");return t}function ge(e,i){var t=e.__transition;if(!t||!(t=t[i]))throw new Error("transition not found");return t}function Ul(e,i,t){var n=e.__transition,o;n[i]=t,t.timer=di(r,0,t.time);function r(c){t.state=ss,t.timer.restart(s,t.delay,t.time),t.delay<=c&&s(c-t.delay)}function s(c){var d,f,h,g;if(t.state!==ss)return l();for(d in n)if(g=n[d],g.name===t.name){if(g.state===hi)return ui(s);g.state===as?(g.state=_n,g.timer.stop(),g.on.call("interrupt",e,e.__data__,g.index,g.group),delete n[d]):+d<i&&(g.state=_n,g.timer.stop(),g.on.call("cancel",e,e.__data__,g.index,g.group),delete n[d])}if(ui(function(){t.state===hi&&(t.state=as,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=pi,t.on.call("start",e,e.__data__,t.index,t.group),t.state===pi){for(t.state=hi,o=new Array(h=t.tween.length),d=0,f=-1;d<h;++d)(g=t.tween[d].value.call(e,e.__data__,t.index,t.group))&&(o[++f]=g);o.length=f+1}}function a(c){for(var d=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=mi,1),f=-1,h=o.length;++f<h;)o[f].call(e,d);t.state===mi&&(t.on.call("end",e,e.__data__,t.index,t.group),l())}function l(){t.state=_n,t.timer.stop(),delete n[i];for(var c in n)return;delete e.__transition}}function Mt(e,i){var t=e.__transition,n,o,r=!0,s;if(t){i=i==null?null:i+"";for(s in t){if((n=t[s]).name!==i){r=!1;continue}o=n.state>pi&&n.state<mi,n.state=_n,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete t[s]}r&&delete e.__transition}}function cs(e){return this.each(function(){Mt(this,e)})}function Zl(e,i){var t,n;return function(){var o=we(this,e),r=o.tween;if(r!==t){n=t=r;for(var s=0,a=n.length;s<a;++s)if(n[s].name===i){n=n.slice(),n.splice(s,1);break}}o.tween=n}}function Ql(e,i,t){var n,o;if(typeof t!="function")throw new Error;return function(){var r=we(this,e),s=r.tween;if(s!==n){o=(n=s).slice();for(var a={name:i,value:t},l=0,c=o.length;l<c;++l)if(o[l].name===i){o[l]=a;break}l===c&&o.push(a)}r.tween=o}}function ds(e,i){var t=this._id;if(e+="",arguments.length<2){for(var n=ge(this.node(),t).tween,o=0,r=n.length,s;o<r;++o)if((s=n[o]).name===e)return s.value;return null}return this.each((i==null?Zl:Ql)(t,e,i))}function Ut(e,i,t){var n=e._id;return e.each(function(){var o=we(this,n);(o.value||(o.value={}))[i]=t.apply(this,arguments)}),function(o){return ge(o,n).value[i]}}function fi(e,i){var t;return(typeof i=="number"?Me:i instanceof dt?oi:(t=dt(i))?(i=t,oi):Xi)(e,i)}function Kl(e){return function(){this.removeAttribute(e)}}function Jl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ec(e,i,t){var n,o=t+"",r;return function(){var s=this.getAttribute(e);return s===o?null:s===n?r:r=i(n=s,t)}}function tc(e,i,t){var n,o=t+"",r;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===n?r:r=i(n=s,t)}}function nc(e,i,t){var n,o,r;return function(){var s,a=t(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===n&&l===o?r:(o=l,r=i(n=s,a)))}}function ic(e,i,t){var n,o,r;return function(){var s,a=t(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===n&&l===o?r:(o=l,r=i(n=s,a)))}}function us(e,i){var t=et(e),n=t==="transform"?qi:fi;return this.attrTween(e,typeof i=="function"?(t.local?ic:nc)(t,n,Ut(this,"attr."+e,i)):i==null?(t.local?Jl:Kl)(t):(t.local?tc:ec)(t,n,i))}function oc(e,i){return function(t){this.setAttribute(e,i.call(this,t))}}function rc(e,i){return function(t){this.setAttributeNS(e.space,e.local,i.call(this,t))}}function sc(e,i){var t,n;function o(){var r=i.apply(this,arguments);return r!==n&&(t=(n=r)&&rc(e,r)),t}return o._value=i,o}function ac(e,i){var t,n;function o(){var r=i.apply(this,arguments);return r!==n&&(t=(n=r)&&oc(e,r)),t}return o._value=i,o}function hs(e,i){var t="attr."+e;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(i==null)return this.tween(t,null);if(typeof i!="function")throw new Error;var n=et(e);return this.tween(t,(n.local?sc:ac)(n,i))}function lc(e,i){return function(){Cn(this,e).delay=+i.apply(this,arguments)}}function cc(e,i){return i=+i,function(){Cn(this,e).delay=i}}function ps(e){var i=this._id;return arguments.length?this.each((typeof e=="function"?lc:cc)(i,e)):ge(this.node(),i).delay}function dc(e,i){return function(){we(this,e).duration=+i.apply(this,arguments)}}function uc(e,i){return i=+i,function(){we(this,e).duration=i}}function ms(e){var i=this._id;return arguments.length?this.each((typeof e=="function"?dc:uc)(i,e)):ge(this.node(),i).duration}function hc(e,i){if(typeof i!="function")throw new Error;return function(){we(this,e).ease=i}}function fs(e){var i=this._id;return arguments.length?this.each(hc(i,e)):ge(this.node(),i).ease}function pc(e,i){return function(){var t=i.apply(this,arguments);if(typeof t!="function")throw new Error;we(this,e).ease=t}}function gs(e){if(typeof e!="function")throw new Error;return this.each(pc(this._id,e))}function vs(e){typeof e!="function"&&(e=sn(e));for(var i=this._groups,t=i.length,n=new Array(t),o=0;o<t;++o)for(var r=i[o],s=r.length,a=n[o]=[],l,c=0;c<s;++c)(l=r[c])&&e.call(l,l.__data__,c,r)&&a.push(l);return new Te(n,this._parents,this._name,this._id)}function xs(e){if(e._id!==this._id)throw new Error;for(var i=this._groups,t=e._groups,n=i.length,o=t.length,r=Math.min(n,o),s=new Array(n),a=0;a<r;++a)for(var l=i[a],c=t[a],d=l.length,f=s[a]=new Array(d),h,g=0;g<d;++g)(h=l[g]||c[g])&&(f[g]=h);for(;a<n;++a)s[a]=i[a];return new Te(s,this._parents,this._name,this._id)}function mc(e){return(e+"").trim().split(/^|\s+/).every(function(i){var t=i.indexOf(".");return t>=0&&(i=i.slice(0,t)),!i||i==="start"})}function fc(e,i,t){var n,o,r=mc(i)?Cn:we;return function(){var s=r(this,e),a=s.on;a!==n&&(o=(n=a).copy()).on(i,t),s.on=o}}function ys(e,i){var t=this._id;return arguments.length<2?ge(this.node(),t).on.on(e):this.each(fc(t,e,i))}function gc(e){return function(){var i=this.parentNode;for(var t in this.__transition)if(+t!==e)return;i&&i.removeChild(this)}}function ws(){return this.on("end.remove",gc(this._id))}function _s(e){var i=this._name,t=this._id;typeof e!="function"&&(e=Nt(e));for(var n=this._groups,o=n.length,r=new Array(o),s=0;s<o;++s)for(var a=n[s],l=a.length,c=r[s]=new Array(l),d,f,h=0;h<l;++h)(d=a[h])&&(f=e.call(d,d.__data__,h,a))&&("__data__"in d&&(f.__data__=d.__data__),c[h]=f,ut(c[h],i,t,h,c,ge(d,t)));return new Te(r,this._parents,i,t)}function Cs(e){var i=this._name,t=this._id;typeof e!="function"&&(e=rn(e));for(var n=this._groups,o=n.length,r=[],s=[],a=0;a<o;++a)for(var l=n[a],c=l.length,d,f=0;f<c;++f)if(d=l[f]){for(var h=e.call(d,d.__data__,f,l),g,_=ge(d,t),N=0,z=h.length;N<z;++N)(g=h[N])&&ut(g,i,t,N,h,_);r.push(h),s.push(d)}return new Te(r,s,i,t)}var vc=tt.prototype.constructor;function Ss(){return new vc(this._groups,this._parents)}function xc(e,i){var t,n,o;return function(){var r=lt(this,e),s=(this.style.removeProperty(e),lt(this,e));return r===s?null:r===t&&s===n?o:o=i(t=r,n=s)}}function bs(e){return function(){this.style.removeProperty(e)}}function yc(e,i,t){var n,o=t+"",r;return function(){var s=lt(this,e);return s===o?null:s===n?r:r=i(n=s,t)}}function wc(e,i,t){var n,o,r;return function(){var s=lt(this,e),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),lt(this,e))),s===l?null:s===n&&l===o?r:(o=l,r=i(n=s,a))}}function _c(e,i){var t,n,o,r="style."+i,s="end."+r,a;return function(){var l=we(this,e),c=l.on,d=l.value[r]==null?a||(a=bs(i)):void 0;(c!==t||o!==d)&&(n=(t=c).copy()).on(s,o=d),l.on=n}}function Ts(e,i,t){var n=(e+="")=="transform"?Yi:fi;return i==null?this.styleTween(e,xc(e,n)).on("end.style."+e,bs(e)):typeof i=="function"?this.styleTween(e,wc(e,n,Ut(this,"style."+e,i))).each(_c(this._id,e)):this.styleTween(e,yc(e,n,i),t).on("end.style."+e,null)}function Cc(e,i,t){return function(n){this.style.setProperty(e,i.call(this,n),t)}}function Sc(e,i,t){var n,o;function r(){var s=i.apply(this,arguments);return s!==o&&(n=(o=s)&&Cc(e,s,t)),n}return r._value=i,r}function Ns(e,i,t){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(i==null)return this.tween(n,null);if(typeof i!="function")throw new Error;return this.tween(n,Sc(e,i,t??""))}function bc(e){return function(){this.textContent=e}}function Tc(e){return function(){var i=e(this);this.textContent=i??""}}function Es(e){return this.tween("text",typeof e=="function"?Tc(Ut(this,"text",e)):bc(e==null?"":e+""))}function Nc(e){return function(i){this.textContent=e.call(this,i)}}function Ec(e){var i,t;function n(){var o=e.apply(this,arguments);return o!==t&&(i=(t=o)&&Nc(o)),i}return n._value=e,n}function zs(e){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Ec(e))}function Os(){for(var e=this._name,i=this._id,t=gi(),n=this._groups,o=n.length,r=0;r<o;++r)for(var s=n[r],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var d=ge(l,i);ut(l,e,t,c,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Te(n,this._parents,e,t)}function ks(){var e,i,t=this,n=t._id,o=t.size();return new Promise(function(r,s){var a={value:s},l={value:function(){--o===0&&r()}};t.each(function(){var c=we(this,n),d=c.on;d!==e&&(i=(e=d).copy(),i._.cancel.push(a),i._.interrupt.push(a),i._.end.push(l)),c.on=i}),o===0&&r()})}var zc=0;function Te(e,i,t,n){this._groups=e,this._parents=i,this._name=t,this._id=n}function Ds(e){return tt().transition(e)}function gi(){return++zc}var nt=tt.prototype;Te.prototype=Ds.prototype={constructor:Te,select:_s,selectAll:Cs,selectChild:nt.selectChild,selectChildren:nt.selectChildren,filter:vs,merge:xs,selection:Ss,transition:Os,call:nt.call,nodes:nt.nodes,node:nt.node,size:nt.size,empty:nt.empty,each:nt.each,on:ys,attr:us,attrTween:hs,style:Ts,styleTween:Ns,text:Es,textTween:zs,remove:ws,tween:ds,delay:ps,duration:ms,ease:fs,easeVarying:gs,end:ks,[Symbol.iterator]:nt[Symbol.iterator]};function vi(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Oc={time:null,delay:0,duration:250,ease:vi};function kc(e,i){for(var t;!(t=e.__transition)||!(t=t[i]);)if(!(e=e.parentNode))throw new Error(`transition ${i} not found`);return t}function Ms(e){var i,t;e instanceof Te?(i=e._id,e=e._name):(i=gi(),(t=Oc).time=wn(),e=e==null?null:e+"");for(var n=this._groups,o=n.length,r=0;r<o;++r)for(var s=n[r],a=s.length,l,c=0;c<a;++c)(l=s[c])&&ut(l,e,i,c,s,t||kc(l,i));return new Te(n,this._parents,e,i)}tt.prototype.interrupt=cs;tt.prototype.transition=Ms;var Sn=e=>()=>e;function Qi(e,{sourceEvent:i,target:t,transform:n,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:i,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:o}})}function $e(e,i,t){this.k=e,this.x=i,this.y=t}$e.prototype={constructor:$e,scale:function(e){return e===1?this:new $e(this.k*e,this.x,this.y)},translate:function(e,i){return e===0&i===0?this:new $e(this.k,this.x+this.k*e,this.y+this.k*i)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ht=new $e(1,0,0);Ki.prototype=$e.prototype;function Ki(e){for(;!e.__zoom;)if(!(e=e.parentNode))return ht;return e.__zoom}function xi(e){e.stopImmediatePropagation()}function Zt(e){e.preventDefault(),e.stopImmediatePropagation()}function Dc(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Mc(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Rs(){return this.__zoom||ht}function Rc(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Ic(){return navigator.maxTouchPoints||"ontouchstart"in this}function Hc(e,i,t){var n=e.invertX(i[0][0])-t[0][0],o=e.invertX(i[1][0])-t[1][0],r=e.invertY(i[0][1])-t[0][1],s=e.invertY(i[1][1])-t[1][1];return e.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}function Ji(){var e=Dc,i=Mc,t=Hc,n=Rc,o=Ic,r=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Ui,c=Et("start","zoom","end"),d,f,h,g=500,_=150,N=0,z=10;function C(p){p.property("__zoom",Rs).on("wheel.zoom",pe,{passive:!1}).on("mousedown.zoom",Ce).on("dblclick.zoom",le).filter(o).on("touchstart.zoom",ce).on("touchmove.zoom",vt).on("touchend.zoom touchcancel.zoom",xt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}C.transform=function(p,S,v,T){var M=p.selection?p.selection():p;M.property("__zoom",Rs),p!==M?O(p,S,v,T):M.interrupt().each(function(){P(this,arguments).event(T).start().zoom(null,typeof S=="function"?S.apply(this,arguments):S).end()})},C.scaleBy=function(p,S,v,T){C.scaleTo(p,function(){var M=this.__zoom.k,I=typeof S=="function"?S.apply(this,arguments):S;return M*I},v,T)},C.scaleTo=function(p,S,v,T){C.transform(p,function(){var M=i.apply(this,arguments),I=this.__zoom,H=v==null?x(M):typeof v=="function"?v.apply(this,arguments):v,ne=I.invert(H),se=typeof S=="function"?S.apply(this,arguments):S;return t(he(ae(I,se),H,ne),M,s)},v,T)},C.translateBy=function(p,S,v,T){C.transform(p,function(){return t(this.__zoom.translate(typeof S=="function"?S.apply(this,arguments):S,typeof v=="function"?v.apply(this,arguments):v),i.apply(this,arguments),s)},null,T)},C.translateTo=function(p,S,v,T,M){C.transform(p,function(){var I=i.apply(this,arguments),H=this.__zoom,ne=T==null?x(I):typeof T=="function"?T.apply(this,arguments):T;return t(ht.translate(ne[0],ne[1]).scale(H.k).translate(typeof S=="function"?-S.apply(this,arguments):-S,typeof v=="function"?-v.apply(this,arguments):-v),I,s)},T,M)};function ae(p,S){return S=Math.max(r[0],Math.min(r[1],S)),S===p.k?p:new $e(S,p.x,p.y)}function he(p,S,v){var T=S[0]-v[0]*p.k,M=S[1]-v[1]*p.k;return T===p.x&&M===p.y?p:new $e(p.k,T,M)}function x(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function O(p,S,v,T){p.on("start.zoom",function(){P(this,arguments).event(T).start()}).on("interrupt.zoom end.zoom",function(){P(this,arguments).event(T).end()}).tween("zoom",function(){var M=this,I=arguments,H=P(M,I).event(T),ne=i.apply(M,I),se=v==null?x(ne):typeof v=="function"?v.apply(M,I):v,Be=Math.max(ne[1][0]-ne[0][0],ne[1][1]-ne[0][1]),xe=M.__zoom,Re=typeof S=="function"?S.apply(M,I):S,qe=l(xe.invert(se).concat(Be/xe.k),Re.invert(se).concat(Be/Re.k));return function(Ie){if(Ie===1)Ie=Re;else{var Ue=qe(Ie),Si=Be/Ue[2];Ie=new $e(Si,se[0]-Ue[0]*Si,se[1]-Ue[1]*Si)}H.zoom(null,Ie)}})}function P(p,S,v){return!v&&p.__zooming||new G(p,S)}function G(p,S){this.that=p,this.args=S,this.active=0,this.sourceEvent=null,this.extent=i.apply(p,S),this.taps=0}G.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,S){return this.mouse&&p!=="mouse"&&(this.mouse[1]=S.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=S.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=S.invert(this.touch1[0])),this.that.__zoom=S,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var S=fe(this.that).datum();c.call(p,this.that,new Qi(p,{sourceEvent:this.sourceEvent,target:C,type:p,transform:this.that.__zoom,dispatch:c}),S)}};function pe(p,...S){if(!e.apply(this,arguments))return;var v=P(this,S).event(p),T=this.__zoom,M=Math.max(r[0],Math.min(r[1],T.k*Math.pow(2,n.apply(this,arguments)))),I=De(p);if(v.wheel)(v.mouse[0][0]!==I[0]||v.mouse[0][1]!==I[1])&&(v.mouse[1]=T.invert(v.mouse[0]=I)),clearTimeout(v.wheel);else{if(T.k===M)return;v.mouse=[I,T.invert(I)],Mt(this),v.start()}Zt(p),v.wheel=setTimeout(H,_),v.zoom("mouse",t(he(ae(T,M),v.mouse[0],v.mouse[1]),v.extent,s));function H(){v.wheel=null,v.end()}}function Ce(p,...S){if(h||!e.apply(this,arguments))return;var v=p.currentTarget,T=P(this,S,!0).event(p),M=fe(p.view).on("mousemove.zoom",se,!0).on("mouseup.zoom",Be,!0),I=De(p,v),H=p.clientX,ne=p.clientY;ln(p.view),xi(p),T.mouse=[I,this.__zoom.invert(I)],Mt(this),T.start();function se(xe){if(Zt(xe),!T.moved){var Re=xe.clientX-H,qe=xe.clientY-ne;T.moved=Re*Re+qe*qe>N}T.event(xe).zoom("mouse",t(he(T.that.__zoom,T.mouse[0]=De(xe,v),T.mouse[1]),T.extent,s))}function Be(xe){M.on("mousemove.zoom mouseup.zoom",null),cn(xe.view,T.moved),Zt(xe),T.event(xe).end()}}function le(p,...S){if(e.apply(this,arguments)){var v=this.__zoom,T=De(p.changedTouches?p.changedTouches[0]:p,this),M=v.invert(T),I=v.k*(p.shiftKey?.5:2),H=t(he(ae(v,I),T,M),i.apply(this,S),s);Zt(p),a>0?fe(this).transition().duration(a).call(O,H,T,p):fe(this).call(C.transform,H,T,p)}}function ce(p,...S){if(e.apply(this,arguments)){var v=p.touches,T=v.length,M=P(this,S,p.changedTouches.length===T).event(p),I,H,ne,se;for(xi(p),H=0;H<T;++H)ne=v[H],se=De(ne,this),se=[se,this.__zoom.invert(se),ne.identifier],M.touch0?!M.touch1&&M.touch0[2]!==se[2]&&(M.touch1=se,M.taps=0):(M.touch0=se,I=!0,M.taps=1+!!d);d&&(d=clearTimeout(d)),I&&(M.taps<2&&(f=se[0],d=setTimeout(function(){d=null},g)),Mt(this),M.start())}}function vt(p,...S){if(this.__zooming){var v=P(this,S).event(p),T=p.changedTouches,M=T.length,I,H,ne,se;for(Zt(p),I=0;I<M;++I)H=T[I],ne=De(H,this),v.touch0&&v.touch0[2]===H.identifier?v.touch0[0]=ne:v.touch1&&v.touch1[2]===H.identifier&&(v.touch1[0]=ne);if(H=v.that.__zoom,v.touch1){var Be=v.touch0[0],xe=v.touch0[1],Re=v.touch1[0],qe=v.touch1[1],Ie=(Ie=Re[0]-Be[0])*Ie+(Ie=Re[1]-Be[1])*Ie,Ue=(Ue=qe[0]-xe[0])*Ue+(Ue=qe[1]-xe[1])*Ue;H=ae(H,Math.sqrt(Ie/Ue)),ne=[(Be[0]+Re[0])/2,(Be[1]+Re[1])/2],se=[(xe[0]+qe[0])/2,(xe[1]+qe[1])/2]}else if(v.touch0)ne=v.touch0[0],se=v.touch0[1];else return;v.zoom("touch",t(he(H,ne,se),v.extent,s))}}function xt(p,...S){if(this.__zooming){var v=P(this,S).event(p),T=p.changedTouches,M=T.length,I,H;for(xi(p),h&&clearTimeout(h),h=setTimeout(function(){h=null},g),I=0;I<M;++I)H=T[I],v.touch0&&v.touch0[2]===H.identifier?delete v.touch0:v.touch1&&v.touch1[2]===H.identifier&&delete v.touch1;if(v.touch1&&!v.touch0&&(v.touch0=v.touch1,delete v.touch1),v.touch0)v.touch0[1]=this.__zoom.invert(v.touch0[0]);else if(v.end(),v.taps===2&&(H=De(H,this),Math.hypot(f[0]-H[0],f[1]-H[1])<z)){var ne=fe(this).on("dblclick.zoom");ne&&ne.apply(this,arguments)}}}return C.wheelDelta=function(p){return arguments.length?(n=typeof p=="function"?p:Sn(+p),C):n},C.filter=function(p){return arguments.length?(e=typeof p=="function"?p:Sn(!!p),C):e},C.touchable=function(p){return arguments.length?(o=typeof p=="function"?p:Sn(!!p),C):o},C.extent=function(p){return arguments.length?(i=typeof p=="function"?p:Sn([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),C):i},C.scaleExtent=function(p){return arguments.length?(r[0]=+p[0],r[1]=+p[1],C):[r[0],r[1]]},C.translateExtent=function(p){return arguments.length?(s[0][0]=+p[0][0],s[1][0]=+p[1][0],s[0][1]=+p[0][1],s[1][1]=+p[1][1],C):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},C.constrain=function(p){return arguments.length?(t=p,C):t},C.duration=function(p){return arguments.length?(a=+p,C):a},C.interpolate=function(p){return arguments.length?(l=p,C):l},C.on=function(){var p=c.on.apply(c,arguments);return p===c?C:p},C.clickDistance=function(p){return arguments.length?(N=(p=+p)*p,C):Math.sqrt(N)},C.tapDistance=function(p){return arguments.length?(z=+p,C):z},C}function Ye(e){return e!==void 0}function eo(){let e=window.navigator.userAgent.toLowerCase(),i=/(macintosh|macintel|macppc|mac68k|macos)/i,t=/(win32|win64|windows|wince)/i,n=/(iphone|ipad|ipod)/i,o=null;return i.test(e)?o="macos":n.test(e)?o="ios":t.test(e)?o="windows":/android/.test(e)?o="android":!o&&/linux/.test(e)&&(o="linux"),o}var bn=(()=>{class e{constructor(){this.actions=b({multiSelection:[eo()==="macos"?"MetaLeft":"ControlLeft",eo()==="macos"?"MetaRight":"ControlRight"]}),this.actionsActive={multiSelection:!1},B(this.actions).pipe(Se(()=>me(Ge(document,"keydown").pipe(ie(t=>{for(let n in this.actions())(this.actions()[n]??[]).includes(t.code)&&(this.actionsActive[n]=!0)})),Ge(document,"keyup").pipe(ie(t=>{for(let n in this.actions())(this.actions()[n]??[]).includes(t.code)&&(this.actionsActive[n]=!1)})))),ve()).subscribe()}setShortcuts(t){this.actions.update(n=>ze(ze({},n),t))}isActiveAction(t){return this.actionsActive[t]}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var pt=(()=>{class e{constructor(){this.flowEntitiesService=u(te),this.keyboardService=u(bn),this.viewport$=new Ht,this.resetSelection=this.viewport$.pipe(ie(({start:t,end:n,target:o})=>{if(t&&n&&o){let r=e.delta,s=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y),l=s<r&&a<r,c=!o.closest(".selectable");l&&c&&this.select(null)}}),ve()).subscribe()}static{this.delta=6}setViewport(t){this.viewport$.next(t)}select(t){t?.selected()||(this.keyboardService.isActiveAction("multiSelection")||this.flowEntitiesService.entities().forEach(n=>n.selected.set(!1)),t&&t.selected.set(!0))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var yi=(()=>{class e{constructor(){this.rootSvg=u(st).element,this.host=u(oe).nativeElement,this.selectionService=u(pt),this.viewportService=u(Ee),this.flowSettingsService=u(Q),this.zone=u(Oe),this.rootSvgSelection=fe(this.rootSvg),this.transform=b(""),this.viewportForSelection={},this.manualViewportChangeEffect=Pe(()=>{let t=this.viewportService.writableViewport(),n=t.state;if(t.changeType!=="initial"){if(Ye(n.zoom)&&!Ye(n.x)&&!Ye(n.y)){this.rootSvgSelection.transition().duration(t.duration).call(this.zoomBehavior.scaleTo,n.zoom);return}if(Ye(n.x)&&Ye(n.y)&&!Ye(n.zoom)){let o=Bt(this.viewportService.readableViewport).zoom;this.rootSvgSelection.transition().duration(t.duration).call(this.zoomBehavior.transform,ht.translate(n.x,n.y).scale(o));return}if(Ye(n.x)&&Ye(n.y)&&Ye(n.zoom)){this.rootSvgSelection.transition().duration(t.duration).call(this.zoomBehavior.transform,ht.translate(n.x,n.y).scale(n.zoom));return}}},{allowSignalWrites:!0}),this.handleZoom=({transform:t})=>{this.viewportService.readableViewport.set(to(t)),this.transform.set(t.toString())},this.handleZoomStart=({transform:t})=>{this.viewportForSelection={start:to(t)}},this.handleZoomEnd=({transform:t,sourceEvent:n})=>{this.zone.run(()=>{this.viewportForSelection=It(ze({},this.viewportForSelection),{end:to(t),target:Fc(n)}),this.viewportService.triggerViewportChangeEvent("end"),this.selectionService.setViewport(this.viewportForSelection)})},this.filterCondition=t=>t.type==="mousedown"||t.type==="touchstart"?t.target.closest(".vflow-node")===null:!0}ngOnInit(){this.zone.runOutsideAngular(()=>{this.zoomBehavior=Ji().scaleExtent([this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom()]).filter(this.filterCondition).on("start",this.handleZoomStart).on("zoom",this.handleZoom).on("end",this.handleZoomEnd),this.rootSvgSelection.call(this.zoomBehavior).on("dblclick.zoom",null)})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["g","mapContext",""]],hostVars:1,hostBindings:function(n,o){n&2&&k("transform",o.transform())},standalone:!0})}}return e})(),to=e=>({zoom:e.k,x:e.x,y:e.y}),Fc=e=>{if(e instanceof Event&&e.target instanceof Element)return e.target};var wi=(()=>{class e{constructor(){this.entitiesService=u(te),this.settingsService=u(Q)}enable(t,n){fe(t).call(this.getDragBehavior(n))}disable(t){fe(t).call(Qn().on("drag",null))}destroy(t){fe(t).on(".drag",null)}getDragBehavior(t){let n=[],o=[],r=s=>t.dragHandlesCount()?!!s.target.closest(".vflow-drag-handle"):!0;return Qn().filter(r).on("start",s=>{n=this.getDragNodes(t),o=n.map(a=>({x:a.point().x-s.x,y:a.point().y-s.y}))}).on("drag",s=>{n.forEach((a,l)=>{let c={x:jt(s.x+o[l].x),y:jt(s.y+o[l].y)};this.moveNode(a,c)})})}getDragNodes(t){return t.selected()?this.entitiesService.nodes().filter(n=>n.selected()&&n.draggable()):[t]}moveNode(t,n){n=this.alignToGrid(n);let o=t.parent();o&&(n.x=Math.min(o.width()-t.width(),n.x),n.x=Math.max(0,n.x),n.y=Math.min(o.height()-t.height(),n.y),n.y=Math.max(0,n.y)),t.setPoint(n)}alignToGrid(t){let[n,o]=this.settingsService.snapGrid();return n>1&&(t.x=_e(t.x,n)),o>1&&(t.y=_e(t.y,o)),t}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();function no(e,i){let t=e.reduce((n,o)=>(n[o.rawNode.id]=o,n),{});i.forEach(n=>{n.source.set(t[n.edge.source]),n.target.set(t[n.edge.target])})}function Is(e){return Io(e)?e:It(ze({},Pc(e)),{id:e.id,type:e.type})}function Pc(e){let i={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=b(e[t]));return i}function io(e){return e.rawNode.type==="default-group"||e.rawNode.type==="template-group"}function Hs(e,i,t){!i&&vo(e);let n=i??u(ot);return t?en(n,t):n}function mt(e,i){let t=Hs(mt,i?.injector),n;return y(()=>(n||(n=Bt(()=>$n(e,It(ze({},i),{injector:t})))),n()))}var Ae=(()=>{class e{constructor(){this.flowEntitiesService=u(te),this.flowSettingsService=u(Q),this.viewportService=u(Ee),this.nodes=y(()=>this.flowSettingsService.optimization().virtualization?this.viewportNodesAfterInteraction().sort((t,n)=>t.renderOrder()-n.renderOrder()):[...this.flowEntitiesService.nodes()].sort((t,n)=>t.renderOrder()-n.renderOrder())),this.groups=y(()=>this.nodes().filter(t=>io(t))),this.nonGroups=y(()=>this.nodes().filter(t=>!io(t))),this.viewportNodes=y(()=>{let t=this.flowEntitiesService.nodes(),n=this.viewportService.readableViewport(),o=this.flowSettingsService.computedFlowWidth(),r=this.flowSettingsService.computedFlowHeight();return t.filter(s=>{let{x:a,y:l}=s.globalPoint(),c=s.width(),d=s.height();return Bo({x:a,y:l,width:c,height:d},n,o,r)})}),this.viewportNodesAfterInteraction=mt(me(B(this.flowEntitiesService.nodes).pipe(Ze(Ft),K(t=>!!t.length)),this.viewportService.viewportChangeEnd$.pipe(fo(300))).pipe(F(()=>{let t=this.viewportService.readableViewport(),n=this.flowSettingsService.optimization().virtualizationZoomThreshold;return t.zoom<n?[]:this.viewportNodes()})),{initialValue:[]}),this.maxOrder=y(()=>Math.max(...this.flowEntitiesService.nodes().map(t=>t.renderOrder())))}pullNode(t){t.renderOrder.set(this.maxOrder()+1),t.children().forEach(n=>this.pullNode(n))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();function Tn(e,i){i||(i={equal:Object.is});let t;return y(()=>t=e(t),i)}var Fs=(()=>{class e{static{this.defaultWidth=100}static{this.defaultHeight=50}static{this.defaultColor="#1b262c"}constructor(t){this.rawNode=t,this.entitiesService=u(te),this.settingsService=u(Q),this.nodeRenderingService=u(Ae),this.isVisible=b(!1),this.point=b({x:0,y:0}),this.width=b(e.defaultWidth),this.height=b(e.defaultHeight),this.size=y(()=>({width:this.width(),height:this.height()})),this.styleWidth=y(()=>this.controlledByResizer()?`${this.width()}px`:"100%"),this.styleHeight=y(()=>this.controlledByResizer()?`${this.height()}px`:"100%"),this.foWidth=y(()=>this.width()+2),this.foHeight=y(()=>this.height()+2),this.renderOrder=b(0),this.selected=b(!1),this.preview=b({style:{}}),this.globalPoint=y(()=>{let o=this.parent(),r=this.point().x,s=this.point().y;for(;o!==null;)r+=o.point().x,s+=o.point().y,o=o.parent();return{x:r,y:s}}),this.pointTransform=y(()=>`translate(${this.globalPoint().x}, ${this.globalPoint().y})`),this.handles=b([]),this.draggable=b(!0),this.dragHandlesCount=b(0),this.magnetRadius=20,this.isComponentType=Ho(this.rawNode)||Fo(this.rawNode),this.shouldLoad=Tn(o=>{if(o||this.settingsService.optimization().lazyLoadTrigger==="immediate")return!0;if(this.settingsService.optimization().lazyLoadTrigger==="viewport"){if(An(this.rawNode.type)||Ln(this.rawNode.type))return!0;if(Tt(this.rawNode.type)||this.rawNode.type==="html-template"||this.rawNode.type==="svg-template"||this.rawNode.type==="template-group")return this.nodeRenderingService.viewportNodes().includes(this)}return!0}),this.componentInstance$=B(this.shouldLoad).pipe(K(Boolean),Se(()=>this.rawNode.type()),mo(()=>ho(this.rawNode.type)),go(1)),this.text=b(""),this.componentTypeInputs={node:this.rawNode},this.parent=y(()=>this.entitiesService.nodes().find(o=>o.rawNode.id===this.parentId())??null),this.children=y(()=>this.entitiesService.nodes().filter(o=>o.parentId()===this.rawNode.id)),this.color=b(e.defaultColor),this.controlledByResizer=b(!1),this.resizable=b(!1),this.resizing=b(!1),this.resizerTemplate=b(null),this.context={$implicit:{}},this.parentId=b(null);let n=Is(t);n.point&&(this.point=n.point),n.width&&(this.width=n.width),n.height&&(this.height=n.height),n.draggable&&(this.draggable=n.draggable),n.parentId&&(this.parentId=n.parentId),n.preview&&(this.preview=n.preview),n.type==="default-group"&&n.color&&(this.color=n.color),n.type==="default-group"&&n.resizable&&(this.resizable=n.resizable),n.type==="default"&&n.text&&(this.text=n.text),n.type==="html-template"&&(this.context={$implicit:{node:t,selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}}),n.type==="svg-template"&&(this.context={$implicit:{node:t,selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),n.type==="template-group"&&(this.context={$implicit:{node:t,selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),this.point$=B(this.point),this.width$=B(this.width),this.height$=B(this.height),this.size$=B(this.size),this.selected$=B(this.selected),this.handles$=B(this.handles)}setPoint(t){this.point.set(t)}}return e})();var Qt=class{constructor(i){this.edgeLabel=i,this.size=b({width:0,height:0})}};function Le(e,i,t){return{x:(1-t)*e.x+t*i.x,y:(1-t)*e.y+t*i.y}}function Nn({sourcePoint:e,targetPoint:i}){return{path:`M ${e.x},${e.y}L ${i.x},${i.y}`,labelPoints:{start:Le(e,i,.15),center:Le(e,i,.5),end:Le(e,i,.85)}}}function En({sourcePoint:e,targetPoint:i,sourcePosition:t,targetPosition:n}){let o={x:e.x-i.x,y:e.y-i.y},r=Ps(e,t,o),s=Ps(i,n,o),a=`M${e.x},${e.y} C${r.x},${r.y} ${s.x},${s.y} ${i.x},${i.y}`;return Vc(a,e,i,r,s)}function Ps(e,i,t){let n={x:0,y:0};switch(i){case"top":n.y=1;break;case"bottom":n.y=-1;break;case"right":n.x=1;break;case"left":n.x=-1;break}let o={x:t.x*Math.abs(n.x),y:t.y*Math.abs(n.y)},s=.25*25*Math.sqrt(Math.abs(o.x+o.y));return{x:e.x+n.x*s,y:e.y-n.y*s}}function Vc(e,i,t,n,o){return{path:e,labelPoints:{start:ro(i,t,n,o,.1),center:ro(i,t,n,o,.5),end:ro(i,t,n,o,.9)}}}function ro(e,i,t,n,o){let r=Le(e,t,o),s=Le(t,n,o),a=Le(n,i,o);return Le(Le(r,s,o),Le(s,a,o),o)}var Vs={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1}};function $c(e,i){let t=Math.abs(i.x-e.x)/2,n=i.x<e.x?i.x+t:i.x-t,o=Math.abs(i.y-e.y)/2,r=i.y<e.y?i.y+o:i.y-o;return[n,r,t,o]}var Ac=({source:e,sourcePosition:i="bottom",target:t})=>i==="left"||i==="right"?e.x<t.x?{x:1,y:0}:{x:-1,y:0}:e.y<t.y?{x:0,y:1}:{x:0,y:-1},$s=(e,i)=>Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));function Lc({source:e,sourcePosition:i="bottom",target:t,targetPosition:n="top",offset:o}){let r=Vs[i],s=Vs[n],a={x:e.x+r.x*o,y:e.y+r.y*o},l={x:t.x+s.x*o,y:t.y+s.y*o},c=Ac({source:a,sourcePosition:i,target:l}),d=c.x!==0?"x":"y",f=c[d],h=[],g,_,N={x:0,y:0},z={x:0,y:0},[C,ae]=$c(e,t);if(r[d]*s[d]===-1){g=C,_=ae;let x=[{x:g,y:a.y},{x:g,y:l.y}],O=[{x:a.x,y:_},{x:l.x,y:_}];r[d]===f?h=d==="x"?x:O:h=d==="x"?O:x}else{let x=[{x:a.x,y:l.y}],O=[{x:l.x,y:a.y}];if(d==="x"?h=r.x===f?O:x:h=r.y===f?x:O,i===n){let le=Math.abs(e[d]-t[d]);if(le<=o){let ce=Math.min(o-1,o-le);r[d]===f?N[d]=(a[d]>e[d]?-1:1)*ce:z[d]=(l[d]>t[d]?-1:1)*ce}}if(i!==n){let le=d==="x"?"y":"x",ce=r[d]===s[le],vt=a[le]>l[le],xt=a[le]<l[le];(r[d]===1&&(!ce&&vt||ce&&xt)||r[d]!==1&&(!ce&&xt||ce&&vt))&&(h=d==="x"?x:O)}let P={x:a.x+N.x,y:a.y+N.y},G={x:l.x+z.x,y:l.y+z.y},pe=Math.max(Math.abs(P.x-h[0].x),Math.abs(G.x-h[0].x)),Ce=Math.max(Math.abs(P.y-h[0].y),Math.abs(G.y-h[0].y));pe>=Ce?(g=(P.x+G.x)/2,_=h[0].y):(g=h[0].x,_=(P.y+G.y)/2)}return[[e,{x:a.x+N.x,y:a.y+N.y},...h,{x:l.x+z.x,y:l.y+z.y},t],g,_]}function Bc(e,i,t,n){let o=Math.min($s(e,i)/2,$s(i,t)/2,n),{x:r,y:s}=i;if(e.x===r&&r===t.x||e.y===s&&s===t.y)return`L${r} ${s}`;if(e.y===s){let c=e.x<t.x?-1:1,d=e.y<t.y?1:-1;return`L ${r+o*c},${s}Q ${r},${s} ${r},${s+o*d}`}let a=e.x<t.x?1:-1,l=e.y<t.y?-1:1;return`L ${r},${s+o*l}Q ${r},${s} ${r+o*a},${s}`}function ft({sourcePoint:e,targetPoint:i,sourcePosition:t,targetPosition:n},o=5){let[r,s,a]=Lc({source:e,sourcePosition:t,target:i,targetPosition:n,offset:20}),l=r.reduce((_,N,z)=>{let C="";return z>0&&z<r.length-1?C=Bc(r[z-1],N,r[z+1],o):C=`${z===0?"M":"L"}${N.x} ${N.y}`,_+=C,_},""),c=r.length;if(c<2)return{path:l,labelPoints:{start:{x:s,y:a},center:{x:s,y:a},end:{x:s,y:a}}};let d=new Array(c-1),f=new Array(c);f[0]=0;let h=0;for(let _=0;_<c-1;_++){let N=r[_+1].x-r[_].x,z=r[_+1].y-r[_].y,C=Math.sqrt(N*N+z*z);d[_]=C,h+=C,f[_+1]=h}let g=_=>{let N=h*_;if(N<=0)return r[0];if(N>=h)return r[c-1];let z=0,C=c-1;for(;z<C-1;){let G=z+C>>>1;f[G]<N?z=G:C=G}let ae=f[z],x=(N-ae)/d[z],O=r[z],P=r[z+1];return{x:O.x+(P.x-O.x)*x,y:O.y+(P.y-O.y)*x}};return{path:l,labelPoints:{start:g(.15),center:{x:s,y:a},end:g(.85)}}}var _i=class{constructor(i){this.edge=i,this.flowEntitiesService=u(te),this.source=b(void 0),this.target=b(void 0),this.selected=b(!1),this.selected$=B(this.selected),this.shouldLoad=y(()=>(this.source()?.shouldLoad()??!1)&&(this.target()?.shouldLoad()??!1)),this.renderOrder=b(0),this.detached=y(()=>{let t=this.source(),n=this.target();if(!t||!n)return!0;let o=!1,r=!1;return this.edge.sourceHandle?o=!!t.handles().find(s=>s.rawHandle.id===this.edge.sourceHandle):o=!!t.handles().find(s=>s.rawHandle.type==="source"),this.edge.targetHandle?r=!!n.handles().find(s=>s.rawHandle.id===this.edge.targetHandle):r=!!n.handles().find(s=>s.rawHandle.type==="target"),!o||!r}),this.detached$=B(this.detached),this.path=y(()=>{let t=this.sourceHandle(),n=this.targetHandle();if(!t||!n)return{path:""};let o=this.getPathFactoryParams(t,n);switch(this.curve){case"straight":return Nn(o);case"bezier":return En(o);case"smooth-step":return ft(o);case"step":return ft(o,0);default:return this.curve(o)}}),this.sourceHandle=Tn(t=>{let n=null;return this.floating?n=this.closestHandles().sourceHandle:this.edge.sourceHandle?n=this.source()?.handles().find(o=>o.rawHandle.id===this.edge.sourceHandle)??null:n=this.source()?.handles().find(o=>o.rawHandle.type==="source")??null,n===null?t:n}),this.targetHandle=Tn(t=>{let n=null;return this.floating?n=this.closestHandles().targetHandle:this.edge.targetHandle?n=this.target()?.handles().find(o=>o.rawHandle.id===this.edge.targetHandle)??null:n=this.target()?.handles().find(o=>o.rawHandle.type==="target")??null,n===null?t:n}),this.closestHandles=y(()=>{let t=this.source(),n=this.target();if(!t||!n)return{sourceHandle:null,targetHandle:null};let o=this.flowEntitiesService.connection().mode==="strict"?t.handles().filter(c=>c.rawHandle.type==="source"):t.handles(),r=this.flowEntitiesService.connection().mode==="strict"?n.handles().filter(c=>c.rawHandle.type==="target"):n.handles();if(o.length===0||r.length===0)return{sourceHandle:null,targetHandle:null};let s=1/0,a=null,l=null;for(let c of o)for(let d of r){let f=c.pointAbsolute(),h=d.pointAbsolute(),g=Math.sqrt(Math.pow(f.x-h.x,2)+Math.pow(f.y-h.y,2));g<s&&(s=g,a=c,l=d)}return{sourceHandle:a,targetHandle:l}}),this.markerStartUrl=y(()=>{let t=this.edge.markers?.start;return t?`url(#${Je(JSON.stringify(t))})`:""}),this.markerEndUrl=y(()=>{let t=this.edge.markers?.end;return t?`url(#${Je(JSON.stringify(t))})`:""}),this.context={$implicit:{edge:this.edge,path:y(()=>this.path().path),markerStart:this.markerStartUrl,markerEnd:this.markerEndUrl,selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}},this.edgeLabels={},this.type=i.type??"default",this.curve=i.curve??"bezier",this.reconnectable=i.reconnectable??!1,this.floating=i.floating??!1,i.edgeLabels?.start&&(this.edgeLabels.start=new Qt(i.edgeLabels.start)),i.edgeLabels?.center&&(this.edgeLabels.center=new Qt(i.edgeLabels.center)),i.edgeLabels?.end&&(this.edgeLabels.end=new Qt(i.edgeLabels.end))}getPathFactoryParams(i,t){return{mode:"edge",edge:this.edge,sourcePoint:i.pointAbsolute(),targetPoint:t.pointAbsolute(),sourcePosition:i.rawHandle.position,targetPosition:t.rawHandle.position,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}};var zn=class{static nodes(i,t){let n=new Map;return t.forEach(o=>n.set(o.rawNode,o)),i.map(o=>n.get(o)??new Fs(o))}static edges(i,t){let n=new Map;return t.forEach(o=>n.set(o.edge,o)),i.map(o=>n.has(o)?n.get(o):new _i(o))}};var Gc=25,On=(()=>{class e{constructor(){this.entitiesService=u(te),this.nodesPositionChange$=B(this.entitiesService.nodes).pipe(Se(t=>me(...t.map(n=>n.point$.pipe(Qe(1),F(()=>n))))),F(t=>[{type:"position",id:t.rawNode.id,point:t.point()},...this.entitiesService.nodes().filter(n=>n!==t&&n.selected()).map(n=>({type:"position",id:n.rawNode.id,point:n.point()}))])),this.nodeSizeChange$=B(this.entitiesService.nodes).pipe(Se(t=>me(...t.map(n=>n.size$.pipe(Qe(1),F(()=>n))))),F(t=>[{type:"size",id:t.rawNode.id,size:t.size()}])),this.nodeAddChange$=B(this.entitiesService.nodes).pipe(Pt(),F(([t,n])=>n.filter(o=>!t.includes(o))),K(t=>!!t.length),F(t=>t.map(n=>({type:"add",id:n.rawNode.id})))),this.nodeRemoveChange$=B(this.entitiesService.nodes).pipe(Pt(),F(([t,n])=>t.filter(o=>!n.includes(o))),K(t=>!!t.length),F(t=>t.map(n=>({type:"remove",id:n.rawNode.id})))),this.nodeSelectedChange$=B(this.entitiesService.nodes).pipe(Se(t=>me(...t.map(n=>n.selected$.pipe(Jt(),Qe(1),F(()=>n))))),F(t=>[{type:"select",id:t.rawNode.id,selected:t.selected()}])),this.changes$=me(this.nodesPositionChange$,this.nodeSizeChange$,this.nodeAddChange$,this.nodeRemoveChange$,this.nodeSelectedChange$).pipe(Ze(Ft,Gc))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var jc=(e,i)=>e.length===i.length&&[...new Set([...e,...i])].every(t=>e.filter(n=>n===t).length===i.filter(n=>n===t).length),kn=(()=>{class e{constructor(){this.entitiesService=u(te),this.edgeDetachedChange$=me(B(y(()=>{let t=this.entitiesService.nodes();return Bt(this.entitiesService.edges).filter(({source:o,target:r})=>!t.includes(o())||!t.includes(r()))})),B(this.entitiesService.edges).pipe(Se(t=>po(...t.map(n=>n.detached$.pipe(F(()=>n))))),F(t=>t.filter(n=>n.detached())),Qe(2))).pipe(Jt(jc),K(t=>!!t.length),F(t=>t.map(({edge:n})=>({type:"detached",id:n.id})))),this.edgeAddChange$=B(this.entitiesService.edges).pipe(Pt(),F(([t,n])=>n.filter(o=>!t.includes(o))),K(t=>!!t.length),F(t=>t.map(({edge:n})=>({type:"add",id:n.id})))),this.edgeRemoveChange$=B(this.entitiesService.edges).pipe(Pt(),F(([t,n])=>t.filter(o=>!n.includes(o))),K(t=>!!t.length),F(t=>t.map(({edge:n})=>({type:"remove",id:n.id})))),this.edgeSelectChange$=B(this.entitiesService.edges).pipe(Se(t=>me(...t.map(n=>n.selected$.pipe(Jt(),Qe(1),F(()=>n))))),F(t=>[{type:"select",id:t.edge.id,selected:t.selected()}])),this.changes$=me(this.edgeDetachedChange$,this.edgeAddChange$,this.edgeRemoveChange$,this.edgeSelectChange$).pipe(Ze(Ft))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var As=(()=>{class e{constructor(){this.nodesChangeService=u(On),this.edgesChangeService=u(kn),this.onNodesChange=L(this.nodesChangeService.changes$),this.onNodesChangePosition=L(this.nodeChangesOfType("position"),{alias:"onNodesChange.position"}),this.onNodesChangePositionSignle=L(this.singleChange(this.nodeChangesOfType("position")),{alias:"onNodesChange.position.single"}),this.onNodesChangePositionMany=L(this.manyChanges(this.nodeChangesOfType("position")),{alias:"onNodesChange.position.many"}),this.onNodesChangeSize=L(this.nodeChangesOfType("size"),{alias:"onNodesChange.size"}),this.onNodesChangeSizeSingle=L(this.singleChange(this.nodeChangesOfType("size")),{alias:"onNodesChange.size.single"}),this.onNodesChangeSizeMany=L(this.manyChanges(this.nodeChangesOfType("size")),{alias:"onNodesChange.size.many"}),this.onNodesChangeAdd=L(this.nodeChangesOfType("add"),{alias:"onNodesChange.add"}),this.onNodesChangeAddSingle=L(this.singleChange(this.nodeChangesOfType("add")),{alias:"onNodesChange.add.single"}),this.onNodesChangeAddMany=L(this.manyChanges(this.nodeChangesOfType("add")),{alias:"onNodesChange.add.many"}),this.onNodesChangeRemove=L(this.nodeChangesOfType("remove"),{alias:"onNodesChange.remove"}),this.onNodesChangeRemoveSingle=L(this.singleChange(this.nodeChangesOfType("remove")),{alias:"onNodesChange.remove.single"}),this.onNodesChangeRemoveMany=L(this.manyChanges(this.nodeChangesOfType("remove")),{alias:"onNodesChange.remove.many"}),this.onNodesChangeSelect=L(this.nodeChangesOfType("select"),{alias:"onNodesChange.select"}),this.onNodesChangeSelectSingle=L(this.singleChange(this.nodeChangesOfType("select")),{alias:"onNodesChange.select.single"}),this.onNodesChangeSelectMany=L(this.manyChanges(this.nodeChangesOfType("select")),{alias:"onNodesChange.select.many"}),this.onEdgesChange=L(this.edgesChangeService.changes$),this.onNodesChangeDetached=L(this.edgeChangesOfType("detached"),{alias:"onEdgesChange.detached"}),this.onNodesChangeDetachedSingle=L(this.singleChange(this.edgeChangesOfType("detached")),{alias:"onEdgesChange.detached.single"}),this.onNodesChangeDetachedMany=L(this.manyChanges(this.edgeChangesOfType("detached")),{alias:"onEdgesChange.detached.many"}),this.onEdgesChangeAdd=L(this.edgeChangesOfType("add"),{alias:"onEdgesChange.add"}),this.onEdgeChangeAddSingle=L(this.singleChange(this.edgeChangesOfType("add")),{alias:"onEdgesChange.add.single"}),this.onEdgeChangeAddMany=L(this.manyChanges(this.edgeChangesOfType("add")),{alias:"onEdgesChange.add.many"}),this.onEdgeChangeRemove=L(this.edgeChangesOfType("remove"),{alias:"onEdgesChange.remove"}),this.onEdgeChangeRemoveSingle=L(this.singleChange(this.edgeChangesOfType("remove")),{alias:"onEdgesChange.remove.single"}),this.onEdgeChangeRemoveMany=L(this.manyChanges(this.edgeChangesOfType("remove")),{alias:"onEdgesChange.remove.many"}),this.onEdgeChangeSelect=L(this.edgeChangesOfType("select"),{alias:"onEdgesChange.select"}),this.onEdgeChangeSelectSingle=L(this.singleChange(this.edgeChangesOfType("select")),{alias:"onEdgesChange.select.single"}),this.onEdgeChangeSelectMany=L(this.manyChanges(this.edgeChangesOfType("select")),{alias:"onEdgesChange.select.many"})}nodeChangesOfType(t){return this.nodesChangeService.changes$.pipe(F(n=>n.filter(o=>o.type===t)),K(n=>!!n.length))}edgeChangesOfType(t){return this.edgesChangeService.changes$.pipe(F(n=>n.filter(o=>o.type===t)),K(n=>!!n.length))}singleChange(t){return t.pipe(K(n=>n.length===1),F(([n])=>n))}manyChanges(t){return t.pipe(K(n=>n.length>1))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["","changesController",""]],outputs:{onNodesChange:"onNodesChange",onNodesChangePosition:"onNodesChange.position",onNodesChangePositionSignle:"onNodesChange.position.single",onNodesChangePositionMany:"onNodesChange.position.many",onNodesChangeSize:"onNodesChange.size",onNodesChangeSizeSingle:"onNodesChange.size.single",onNodesChangeSizeMany:"onNodesChange.size.many",onNodesChangeAdd:"onNodesChange.add",onNodesChangeAddSingle:"onNodesChange.add.single",onNodesChangeAddMany:"onNodesChange.add.many",onNodesChangeRemove:"onNodesChange.remove",onNodesChangeRemoveSingle:"onNodesChange.remove.single",onNodesChangeRemoveMany:"onNodesChange.remove.many",onNodesChangeSelect:"onNodesChange.select",onNodesChangeSelectSingle:"onNodesChange.select.single",onNodesChangeSelectMany:"onNodesChange.select.many",onEdgesChange:"onEdgesChange",onNodesChangeDetached:"onEdgesChange.detached",onNodesChangeDetachedSingle:"onEdgesChange.detached.single",onNodesChangeDetachedMany:"onEdgesChange.detached.many",onEdgesChangeAdd:"onEdgesChange.add",onEdgeChangeAddSingle:"onEdgesChange.add.single",onEdgeChangeAddMany:"onEdgesChange.add.many",onEdgeChangeRemove:"onEdgesChange.remove",onEdgeChangeRemoveSingle:"onEdgesChange.remove.single",onEdgeChangeRemoveMany:"onEdgesChange.remove.many",onEdgeChangeSelect:"onEdgesChange.select",onEdgeChangeSelectSingle:"onEdgesChange.select.single",onEdgeChangeSelectMany:"onEdgesChange.select.many"},standalone:!0})}}return e})();function Ls(e){return typeof e=="string"?{type:"solid",color:e}:e}uo();var Ci=(()=>{class e{constructor(){this.toolbars=b([]),this.nodeToolbarsMap=y(()=>{let t=new Map;return this.toolbars().forEach(n=>{let o=t.get(n.node)??[];t.set(n.node,[...o,n])}),t})}addToolbar(t){this.toolbars.update(n=>[...n,t])}removeToolbar(t){this.toolbars.update(n=>n.filter(o=>o!==t))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return Kt([on],e.prototype,"addToolbar",null),Kt([on],e.prototype,"removeToolbar",null),e})();function gt(e,i){return new co(t=>{let n=new ResizeObserver(o=>{i.run(()=>t.next(o))});return e.forEach(o=>n.observe(o)),()=>n.disconnect()})}var Wc=["edgeLabelWrapper"],Yc=["edgeLabel",""];function qc(e,i){e&1&&be(0)}function Uc(e,i){if(e&1&&(D(),R(0,"foreignObject"),it(),R(1,"div",1,0),A(3,qc,1,0,"ng-container",2),$()()),e&2){let t=m(2),n=m();k("x",n.edgeLabelPoint().x)("y",n.edgeLabelPoint().y)("width",t.size().width)("height",t.size().height),w(3),Y("ngTemplateOutlet",i)("ngTemplateOutletContext",n.getLabelContext())}}function Zc(e,i){if(e&1&&A(0,Uc,4,6,":svg:foreignObject"),e&2){let t,n=m(2);E(0,(t=n.htmlTemplate())?0:-1,t)}}function Qc(e,i){if(e&1&&(D(),R(0,"foreignObject"),it(),R(1,"div",1,0),bo(3),$()()),e&2){let t=m(),n=m();k("x",n.edgeLabelPoint().x)("y",n.edgeLabelPoint().y)("width",t.size().width)("height",t.size().height),w(),So(n.edgeLabelStyle()),w(2),To(" ",t.edgeLabel.text," ")}}function Kc(e,i){if(e&1&&A(0,Zc,1,1)(1,Qc,4,7,":svg:foreignObject"),e&2){let t=i,n=m();E(0,t.edgeLabel.type==="html-template"&&n.htmlTemplate()?0:-1),w(),E(1,t.edgeLabel.type==="default"?1:-1)}}var Bs=(()=>{class e{constructor(){this.zone=u(Oe),this.destroyRef=u($t),this.settingsService=u(Q),this.model=W.required(),this.edgeModel=W.required(),this.point=W({x:0,y:0}),this.htmlTemplate=W(),this.edgeLabelWrapperRef=wt.required("edgeLabelWrapper"),this.edgeLabelPoint=y(()=>{let t=this.point(),{width:n,height:o}=this.model().size();return{x:t.x-n/2,y:t.y-o/2}}),this.edgeLabelStyle=y(()=>{let t=this.model().edgeLabel;if(t.type==="default"&&t.style){let n=this.settingsService.background(),o="transparent";return n.type==="dots"&&(o=n.backgroundColor??"#fff"),n.type==="solid"&&(o=n.color),t.style.backgroundColor=t.style.backgroundColor??o,t.style}return null})}ngAfterViewInit(){let t=this.edgeLabelWrapperRef().nativeElement;gt([t],this.zone).pipe(Mn(null),ie(()=>{let n=t.clientWidth+2,o=t.clientHeight+2;this.model().size.set({width:n,height:o})}),ve(this.destroyRef)).subscribe()}getLabelContext(){return{$implicit:{edge:this.edgeModel().edge,label:this.model().edgeLabel}}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["g","edgeLabel",""]],viewQuery:function(n,o){n&1&&St(o.edgeLabelWrapperRef,Wc,5),n&2&&bt()},inputs:{model:[j.SignalBased,"model"],edgeModel:[j.SignalBased,"edgeModel"],point:[j.SignalBased,"point"],htmlTemplate:[j.SignalBased,"htmlTemplate"]},standalone:!0,features:[ue],attrs:Yc,decls:1,vars:1,consts:[["edgeLabelWrapper",""],[1,"edge-label-wrapper"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,o){if(n&1&&A(0,Kc,2,2),n&2){let r;E(0,(r=o.model())?0:-1,r)}},dependencies:[Xe],styles:[".edge-label-wrapper[_ngcontent-%COMP%]{width:max-content;margin-top:1px;margin-left:1px}"],changeDetection:0})}}return e})();var Rt=(()=>{class e{constructor(){this.flowEntitiesService=u(te),this.flowSettingsService=u(Q),this.edges=y(()=>this.flowSettingsService.optimization().virtualization?this.viewportEdges().sort((t,n)=>t.renderOrder()-n.renderOrder()):[...this.flowEntitiesService.validEdges()].sort((t,n)=>t.renderOrder()-n.renderOrder())),this.viewportEdges=y(()=>this.flowEntitiesService.validEdges().filter(t=>{let n=t.sourceHandle(),o=t.targetHandle();return n&&o})),this.maxOrder=y(()=>Math.max(...this.flowEntitiesService.validEdges().map(t=>t.renderOrder())))}pull(t){t.renderOrder()!==0&&this.maxOrder()===t.renderOrder()||t.renderOrder.set(this.maxOrder()+1)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var Jc=["edge",""];function ed(e,i){if(e&1){let t=ye();D(),ee(0,"path",0),R(1,"path",1),J("click",function(){U(t);let o=m();return o.select(),Z(o.pull())}),$()}if(e&2){let t=m();At("edge_selected",t.model().selected()),k("d",t.model().path().path)("marker-start",t.model().markerStartUrl())("marker-end",t.model().markerEndUrl()),w(),k("d",t.model().path().path)}}function td(e,i){if(e&1&&be(0,2),e&2){let t=m(2);Y("ngTemplateOutlet",i)("ngTemplateOutletContext",t.model().context)("ngTemplateOutletInjector",t.injector)}}function nd(e,i){if(e&1&&A(0,td,1,3,"ng-container",2),e&2){let t,n=m();E(0,(t=n.edgeTemplate())?0:-1,t)}}function id(e,i){if(e&1&&(D(),ee(0,"g",3)),e&2){let t=m(),n=m();Y("model",t)("point",i)("edgeModel",n.model())("htmlTemplate",n.edgeLabelHtmlTemplate())}}function od(e,i){if(e&1&&A(0,id,1,4,":svg:g",3),e&2){let t,n=m();E(0,(t=(t=n.model().path().labelPoints)==null?null:t.start)?0:-1,t)}}function rd(e,i){if(e&1&&(D(),ee(0,"g",3)),e&2){let t=m(),n=m();Y("model",t)("point",i)("edgeModel",n.model())("htmlTemplate",n.edgeLabelHtmlTemplate())}}function sd(e,i){if(e&1&&A(0,rd,1,4,":svg:g",3),e&2){let t,n=m();E(0,(t=(t=n.model().path().labelPoints)==null?null:t.center)?0:-1,t)}}function ad(e,i){if(e&1&&(D(),ee(0,"g",3)),e&2){let t=m(),n=m();Y("model",t)("point",i)("edgeModel",n.model())("htmlTemplate",n.edgeLabelHtmlTemplate())}}function ld(e,i){if(e&1&&A(0,ad,1,4,":svg:g",3),e&2){let t,n=m();E(0,(t=(t=n.model().path().labelPoints)==null?null:t.end)?0:-1,t)}}function cd(e,i){if(e&1){let t=ye();D(),R(0,"circle",5),J("pointerStart",function(o){U(t);let r=m(2);return Z(r.startReconnection(o,r.model().targetHandle()))}),$()}if(e&2){let t=m(2);k("cx",t.model().sourceHandle().pointAbsolute().x)("cy",t.model().sourceHandle().pointAbsolute().y)}}function dd(e,i){if(e&1){let t=ye();D(),R(0,"circle",5),J("pointerStart",function(o){U(t);let r=m(2);return Z(r.startReconnection(o,r.model().sourceHandle()))}),$()}if(e&2){let t=m(2);k("cx",t.model().targetHandle().pointAbsolute().x)("cy",t.model().targetHandle().pointAbsolute().y)}}function ud(e,i){if(e&1&&A(0,cd,1,2,":svg:circle",4)(1,dd,1,2,":svg:circle",4),e&2){let t=m();E(0,t.model().reconnectable===!0||t.model().reconnectable==="source"?0:-1),w(),E(1,t.model().reconnectable===!0||t.model().reconnectable==="target"?1:-1)}}var Gs=(()=>{class e{constructor(){this.injector=u(ot),this.selectionService=u(pt),this.flowSettingsService=u(Q),this.flowStatusService=u(ke),this.edgeRenderingService=u(Rt),this.connectionController=u(Bn,{optional:!0}),this.model=W.required(),this.edgeTemplate=W(),this.edgeLabelHtmlTemplate=W(),this.isReconnecting=y(()=>{let t=this.flowStatusService.status();return(t.state==="reconnection-start"||t.state==="reconnection-validation")&&t.payload.oldEdge===this.model()})}select(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}pull(){this.flowSettingsService.elevateEdgesOnSelect()&&this.edgeRenderingService.pull(this.model())}startReconnection(t,n){t.stopPropagation(),this.connectionController?.startReconnection(n,this.model())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["g","edge",""]],hostAttrs:[1,"selectable"],hostVars:2,hostBindings:function(n,o){n&2&&je("visibility",o.isReconnecting()?"hidden":"visible")},inputs:{model:[j.SignalBased,"model"],edgeTemplate:[j.SignalBased,"edgeTemplate"],edgeLabelHtmlTemplate:[j.SignalBased,"edgeLabelHtmlTemplate"]},standalone:!0,features:[ue],attrs:Jc,decls:6,vars:6,consts:[[1,"edge"],[1,"interactive-edge",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["edgeLabel","",3,"model","point","edgeModel","htmlTemplate"],["r","10",1,"reconnect-handle"],["r","10",1,"reconnect-handle",3,"pointerStart"]],template:function(n,o){if(n&1&&A(0,ed,2,6)(1,nd,1,1)(2,od,1,1)(3,sd,1,1)(4,ld,1,1)(5,ud,2,2),n&2){let r,s,a;E(0,o.model().type==="default"?0:-1),w(),E(1,o.model().type==="template"&&o.edgeTemplate()?1:-1),w(),E(2,(r=o.model().edgeLabels.start)?2:-1,r),w(),E(3,(s=o.model().edgeLabels.center)?3:-1,s),w(),E(4,(a=o.model().edgeLabels.end)?4:-1,a),w(),E(5,o.model().sourceHandle()&&o.model().targetHandle()?5:-1)}},dependencies:[Xe,Bs,Xt],styles:[".edge[_ngcontent-%COMP%]{fill:none;stroke-width:2;stroke:#b1b1b7}.edge_selected[_ngcontent-%COMP%]{stroke-width:2.5;stroke:#0f4c75}.interactive-edge[_ngcontent-%COMP%]{fill:none;stroke-width:20;stroke:transparent}.reconnect-handle[_ngcontent-%COMP%]{fill:transparent;cursor:move}"],changeDetection:0})}}return e})();var js=(()=>{class e{constructor(){this.handleModel=W.required({alias:"handleSizeController"}),this.handleWrapper=u(oe)}ngAfterViewInit(){let t=this.handleWrapper.nativeElement,n=t.getBBox(),o=hd(t);this.handleModel().size.set({width:n.width+o,height:n.height+o})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["","handleSizeController",""]],inputs:{handleModel:[j.SignalBased,"handleSizeController","handleModel"]},standalone:!0})}}return e})();function hd(e){let i=e.firstElementChild;if(i){let t=getComputedStyle(i).strokeWidth,n=Number(t.replace("px",""));return isNaN(n)?0:n}return 0}var pd=["*"],Xs=(()=>{class e{constructor(){this.selected=W(!1)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["default-node"]],hostVars:2,hostBindings:function(n,o){n&2&&At("selected",o.selected())},inputs:{selected:[j.SignalBased,"selected"]},standalone:!0,features:[ue],ngContentSelectors:pd,decls:1,vars:0,template:function(n,o){n&1&&(In(),Hn(0))},styles:["[_nghost-%COMP%]{border:1.5px solid #1b262c;border-radius:5px;display:flex;align-items:center;justify-content:center;color:#000;background-color:#fff}.selected[_nghost-%COMP%]{border-width:2px}"],changeDetection:0})}}return e})();var Ws=(()=>{class e{constructor(){this.nodeAccessor=u(Ke),this.zone=u(Oe),this.destroyRef=u($t),this.hostElementRef=u(oe)}ngOnInit(){this.nodeAccessor.model().handles$.pipe(Se(n=>gt([...n.map(o=>o.hostReference),this.hostElementRef.nativeElement],this.zone).pipe(F(()=>n))),ie(n=>{n.forEach(o=>o.updateHost())}),ve(this.destroyRef)).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["","nodeHandlesController",""]],standalone:!0})}}return e})();var Ys=(()=>{class e{constructor(){this.nodeAccessor=u(Ke),this.zone=u(Oe),this.destroyRef=u($t),this.hostElementRef=u(oe)}ngOnInit(){let t=this.nodeAccessor.model(),n=this.hostElementRef.nativeElement;me(gt([n],this.zone)).pipe(Mn(null),K(()=>!t.resizing()),ie(()=>{t.width.set(n.clientWidth),t.height.set(n.clientHeight)}),ve(this.destroyRef)).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["","nodeResizeController",""]],standalone:!0})}}return e})();var md=["node",""];function fd(e,i){if(e&1){let t=ye();D(),R(0,"foreignObject",3),J("click",function(){U(t);let o=m();return o.pullNode(),Z(o.selectNode())}),it(),R(1,"default-node",4),ee(2,"div",5)(3,"handle",6)(4,"handle",7),$()()}if(e&2){let t=m();k("width",t.model().foWidth())("height",t.model().foHeight()),w(),je("width",t.model().styleWidth())("height",t.model().styleHeight())("max-width",t.model().styleWidth())("max-height",t.model().styleHeight()),Y("selected",t.model().selected()),w(),Y("outerHTML",t.model().text(),xo)}}function gd(e,i){if(e&1){let t=ye();D(),R(0,"foreignObject",3),J("click",function(){U(t);let o=m();return Z(o.pullNode())}),it(),R(1,"div",8),be(2,9),$()()}if(e&2){let t,n=m();k("width",n.model().foWidth())("height",n.model().foHeight()),w(),je("width",n.model().styleWidth())("height",n.model().styleHeight()),w(),Y("ngTemplateOutlet",(t=n.nodeTemplate())!==null&&t!==void 0?t:null)("ngTemplateOutletContext",n.model().context)("ngTemplateOutletInjector",n.injector)}}function vd(e,i){if(e&1){let t=ye();D(),R(0,"g",10),J("click",function(){U(t);let o=m();return Z(o.pullNode())}),be(1,9),$()}if(e&2){let t,n=m();w(),Y("ngTemplateOutlet",(t=n.nodeSvgTemplate())!==null&&t!==void 0?t:null)("ngTemplateOutletContext",n.model().context)("ngTemplateOutletInjector",n.injector)}}function xd(e,i){if(e&1){let t=ye();D(),R(0,"foreignObject",3),J("click",function(){U(t);let o=m(2);return Z(o.pullNode())}),it(),R(1,"div",8),be(2,11),$()()}if(e&2){let t=m(2);k("width",t.model().foWidth())("height",t.model().foHeight()),w(),je("width",t.model().styleWidth())("height",t.model().styleHeight()),w(),Y("ngComponentOutlet",i)("ngComponentOutletInputs",t.model().componentTypeInputs)("ngComponentOutletInjector",t.injector)}}function yd(e,i){if(e&1&&(A(0,xd,3,9,":svg:foreignObject",0),Pn(1,"async")),e&2){let t,n=m();E(0,(t=Vn(1,1,n.model().componentInstance$))?0:-1,t)}}function wd(e,i){if(e&1){let t=ye();D(),R(0,"rect",12),J("click",function(){U(t);let o=m();return o.pullNode(),Z(o.selectNode())}),$()}if(e&2){let t=m();je("stroke",t.model().color())("fill",t.model().color()),At("default-group-node_selected",t.model().selected()),Y("resizable",t.model().resizable())("gap",3)("resizerColor",t.model().color()),k("width",t.model().size().width)("height",t.model().size().height)}}function _d(e,i){if(e&1){let t=ye();D(),R(0,"g",10),J("click",function(){U(t);let o=m();return Z(o.pullNode())}),be(1,9),$()}if(e&2){let t,n=m();w(),Y("ngTemplateOutlet",(t=n.groupNodeTemplate())!==null&&t!==void 0?t:null)("ngTemplateOutletContext",n.model().context)("ngTemplateOutletInjector",n.injector)}}function Cd(e,i){}function Sd(e,i){if(e&1&&A(0,Cd,0,0,"ng-template",13),e&2){let t=m();Y("ngTemplateOutlet",t)}}function bd(e,i){if(e&1&&A(0,Sd,1,1,null,13),e&2){let t=m();E(0,t.model().resizable()?0:-1)}}function Td(e,i){if(e&1){let t=ye();D(),R(0,"circle",17),J("pointerStart",function(o){U(t);let r=m().$implicit,s=m();return Z(s.startConnection(o,r))})("pointerEnd",function(){U(t);let o=m(2);return Z(o.endConnection())}),$()}if(e&2){let t=m().$implicit;k("cx",t.hostOffset().x)("cy",t.hostOffset().y)("stroke-width",t.strokeWidth)}}function Nd(e,i){if(e&1){let t=ye();D(),R(0,"g",18),J("pointerStart",function(o){U(t);let r=m().$implicit,s=m();return Z(s.startConnection(o,r))})("pointerEnd",function(){U(t);let o=m(2);return Z(o.endConnection())}),$()}if(e&2){let t=m().$implicit;Y("handleSizeController",t)}}function Ed(e,i){e&1&&(D(),be(0))}function zd(e,i){if(e&1){let t=ye();D(),R(0,"g",18),J("pointerStart",function(o){U(t);let r=m().$implicit,s=m();return Z(s.startConnection(o,r))})("pointerEnd",function(){U(t);let o=m(2);return Z(o.endConnection())}),A(1,Ed,1,0,"ng-container",19),$()}if(e&2){let t=m().$implicit;Y("handleSizeController",t),w(),Y("ngTemplateOutlet",t.template)("ngTemplateOutletContext",t.templateContext)}}function Od(e,i){if(e&1){let t=ye();D(),R(0,"circle",20),J("pointerEnd",function(){U(t);let o=m().$implicit,r=m();return r.endConnection(),Z(r.resetValidateConnection(o))})("pointerOver",function(){U(t);let o=m().$implicit,r=m();return Z(r.validateConnection(o))})("pointerOut",function(){U(t);let o=m().$implicit,r=m();return Z(r.resetValidateConnection(o))}),$()}if(e&2){let t=m().$implicit,n=m();k("r",n.model().magnetRadius)("cx",t.hostOffset().x)("cy",t.hostOffset().y)}}function kd(e,i){if(e&1&&A(0,Td,1,3,":svg:circle",14)(1,Nd,1,1,":svg:g",15)(2,zd,2,3,":svg:g",15)(3,Od,1,3,":svg:circle",16),e&2){let t=i.$implicit,n=m();E(0,t.template===void 0?0:-1),w(),E(1,t.template===null?1:-1),w(),E(2,t.template?2:-1),w(),E(3,n.showMagnet()?3:-1)}}function Dd(e,i){if(e&1&&(D(),R(0,"foreignObject"),it(),be(1,13),$()),e&2){let t=i.$implicit;k("width",t.size().width)("height",t.size().height)("transform",t.transform()),w(),Y("ngTemplateOutlet",t.template())}}var qs=(()=>{class e{constructor(){this.injector=u(ot),this.handleService=u(Ei),this.draggableService=u(wi),this.flowStatusService=u(ke),this.nodeRenderingService=u(Ae),this.flowSettingsService=u(Q),this.selectionService=u(pt),this.hostRef=u(oe),this.nodeAccessor=u(Ke),this.overlaysService=u(Ci),this.connectionController=u(Bn,{optional:!0}),this.model=W.required(),this.nodeTemplate=W(),this.nodeSvgTemplate=W(),this.groupNodeTemplate=W(),this.showMagnet=y(()=>this.flowStatusService.status().state==="connection-start"||this.flowStatusService.status().state==="connection-validation"||this.flowStatusService.status().state==="reconnection-start"||this.flowStatusService.status().state==="reconnection-validation"),this.toolbars=y(()=>this.overlaysService.nodeToolbarsMap().get(this.model()))}ngOnInit(){this.model().isVisible.set(!0),this.nodeAccessor.model.set(this.model()),this.handleService.node.set(this.model()),Pe(()=>{this.model().draggable()?this.draggableService.enable(this.hostRef.nativeElement,this.model()):this.draggableService.disable(this.hostRef.nativeElement)},{injector:this.injector})}ngOnDestroy(){this.model().isVisible.set(!1),this.draggableService.destroy(this.hostRef.nativeElement)}startConnection(t,n){t.stopPropagation(),this.connectionController?.startConnection(n)}validateConnection(t){this.connectionController?.validateConnection(t)}resetValidateConnection(t){this.connectionController?.resetValidateConnection(t)}endConnection(){this.connectionController?.endConnection()}pullNode(){this.flowSettingsService.elevateNodesOnSelect()&&this.nodeRenderingService.pullNode(this.model())}selectNode(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["g","node",""]],hostAttrs:[1,"vflow-node"],inputs:{model:[j.SignalBased,"model"],nodeTemplate:[j.SignalBased,"nodeTemplate"],nodeSvgTemplate:[j.SignalBased,"nodeSvgTemplate"],groupNodeTemplate:[j.SignalBased,"groupNodeTemplate"]},standalone:!0,features:[Fn([Ei,Ke]),ue],attrs:md,decls:11,vars:7,consts:[[1,"selectable"],["nodeHandlesController","",1,"selectable"],["rx","5","ry","5",1,"default-group-node",3,"resizable","gap","resizerColor","default-group-node_selected","stroke","fill"],[1,"selectable",3,"click"],["nodeHandlesController","",3,"selected"],[3,"outerHTML"],["type","source","position","right"],["type","target","position","left"],["nodeHandlesController","","nodeResizeController","",1,"wrapper"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["nodeHandlesController","",1,"selectable",3,"click"],[3,"ngComponentOutlet","ngComponentOutletInputs","ngComponentOutletInjector"],["rx","5","ry","5",1,"default-group-node",3,"click","resizable","gap","resizerColor"],[3,"ngTemplateOutlet"],["r","5",1,"default-handle"],[3,"handleSizeController"],[1,"magnet"],["r","5",1,"default-handle",3,"pointerStart","pointerEnd"],[3,"pointerStart","pointerEnd","handleSizeController"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"magnet",3,"pointerEnd","pointerOver","pointerOut"]],template:function(n,o){if(n&1&&(A(0,fd,5,12,":svg:foreignObject",0)(1,gd,3,9,":svg:foreignObject",0)(2,vd,2,3,":svg:g",1)(3,yd,2,3)(4,wd,1,11,":svg:rect",2)(5,_d,2,3,":svg:g",1)(6,bd,1,1),He(7,kd,4,4,null,null,nn),He(9,Dd,2,4,":svg:foreignObject",null,nn)),n&2){let r;E(0,o.model().rawNode.type==="default"?0:-1),w(),E(1,o.model().rawNode.type==="html-template"&&o.nodeTemplate()?1:-1),w(),E(2,o.model().rawNode.type==="svg-template"&&o.nodeSvgTemplate()?2:-1),w(),E(3,o.model().isComponentType?3:-1),w(),E(4,o.model().rawNode.type==="default-group"?4:-1),w(),E(5,o.model().rawNode.type==="template-group"&&o.groupNodeTemplate()?5:-1),w(),E(6,(r=o.model().resizerTemplate())?6:-1,r),w(),Fe(o.model().handles()),w(2),Fe(o.toolbars())}},dependencies:[Xt,Xs,Mo,Xe,Eo,Xo,js,Ws,Ys,zo],styles:[".magnet[_ngcontent-%COMP%]{opacity:0}.wrapper[_ngcontent-%COMP%]{display:table-cell}.default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}.default-handle[_ngcontent-%COMP%]{stroke:#fff;fill:#1b262c}"],changeDetection:0})}}return e})();var Md=["connection",""];function Rd(e,i){if(e&1&&(D(),ee(0,"path",0)),e&2){let t=m(2);k("d",i)("marker-end",t.markerUrl())("stroke",t.defaultColor)}}function Id(e,i){if(e&1&&A(0,Rd,1,3,":svg:path",0),e&2){let t,n=m();E(0,(t=n.path())?0:-1,t)}}function Hd(e,i){e&1&&be(0)}function Fd(e,i){if(e&1&&A(0,Hd,1,0,"ng-container",1),e&2){let t=m(2);Y("ngTemplateOutlet",i)("ngTemplateOutletContext",t.getContext())}}function Pd(e,i){if(e&1&&A(0,Fd,1,2,"ng-container"),e&2){let t,n=m();E(0,(t=n.template())?0:-1,t)}}var Zs=(()=>{class e{constructor(){this.flowStatusService=u(ke),this.spacePointContext=u(at),this.flowEntitiesService=u(te),this.model=W.required(),this.template=W(),this.path=y(()=>{let t=this.flowStatusService.status(),n=this.model().curve;if(t.state==="connection-start"||t.state==="reconnection-start"){let o=t.payload.sourceHandle,r=o.pointAbsolute(),s=o.rawHandle.position,a=this.spacePointContext.svgCurrentSpacePoint(),l=Us(o.rawHandle.position),c=this.getPathFactoryParams(r,a,s,l);switch(n){case"straight":return Nn(c).path;case"bezier":return En(c).path;case"smooth-step":return ft(c).path;case"step":return ft(c,0).path;default:return n(c).path}}if(t.state==="connection-validation"||t.state==="reconnection-validation"){let o=t.payload.sourceHandle,r=o.pointAbsolute(),s=o.rawHandle.position,a=t.payload.targetHandle,l=t.payload.valid?a.pointAbsolute():this.spacePointContext.svgCurrentSpacePoint(),c=t.payload.valid?a.rawHandle.position:Us(o.rawHandle.position),d=this.getPathFactoryParams(r,l,s,c);switch(n){case"straight":return Nn(d).path;case"bezier":return En(d).path;case"smooth-step":return ft(d).path;case"step":return ft(d,0).path;default:return n(d).path}}return null}),this.markerUrl=y(()=>{let t=this.model().settings.marker;return t?`url(#${Je(JSON.stringify(t))})`:""}),this.defaultColor="rgb(177, 177, 183)"}getContext(){return{$implicit:{path:this.path,marker:this.markerUrl}}}getPathFactoryParams(t,n,o,r){return{mode:"connection",sourcePoint:t,targetPoint:n,sourcePosition:o,targetPosition:r,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["g","connection",""]],inputs:{model:[j.SignalBased,"model"],template:[j.SignalBased,"template"]},standalone:!0,features:[ue],attrs:Md,decls:2,vars:2,consts:[["fill","none","stroke-width","2"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,o){n&1&&A(0,Id,1,1)(1,Pd,1,1),n&2&&(E(0,o.model().type==="default"?0:-1),w(),E(1,o.model().type==="template"?1:-1))},dependencies:[Xe],encapsulation:2,changeDetection:0})}}return e})();function Us(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}}function Qs(){return String.fromCharCode(65+Math.floor(Math.random()*26))+Date.now()}var Vd=["background",""];function $d(e,i){if(e&1&&(D(),R(0,"pattern",0),ee(1,"circle"),$(),ee(2,"rect",1)),e&2){let t=m();k("id",t.patternId)("x",t.x())("y",t.y())("width",t.scaledGap())("height",t.scaledGap()),w(),k("cx",t.patternSize())("cy",t.patternSize())("r",t.patternSize())("fill",t.patternColor()),w(),k("fill",t.patternUrl)}}function Ad(e,i){if(e&1&&(D(),R(0,"pattern",0),ee(1,"image"),$(),ee(2,"rect",1)),e&2){let t=m(2);k("id",t.patternId)("x",t.imageX())("y",t.imageY())("width",t.scaledImageWidth())("height",t.scaledImageHeight()),w(),k("href",t.bgImageSrc())("width",t.scaledImageWidth())("height",t.scaledImageHeight()),w(),k("fill",t.patternUrl)}}function Ld(e,i){if(e&1&&(D(),ee(0,"image")),e&2){let t=m(2);k("x",t.imageX())("y",t.imageY())("width",t.scaledImageWidth())("height",t.scaledImageHeight())("href",t.bgImageSrc())}}function Bd(e,i){if(e&1&&A(0,Ad,3,9)(1,Ld,1,5,":svg:image"),e&2){let t=m();E(0,t.repeated()?0:-1),w(),E(1,t.repeated()?-1:1)}}var Gd="#fff",jd=20,Xd=2,Ks="rgb(177, 177, 183)",Js=.1,Wd=!0,ea=(()=>{class e{constructor(){this.viewportService=u(Ee),this.rootSvg=u(st).element,this.settingsService=u(Q),this.backgroundSignal=this.settingsService.background,this.scaledGap=y(()=>{let t=this.backgroundSignal();return t.type==="dots"?this.viewportService.readableViewport().zoom*(t.gap??jd):0}),this.x=y(()=>this.viewportService.readableViewport().x%this.scaledGap()),this.y=y(()=>this.viewportService.readableViewport().y%this.scaledGap()),this.patternColor=y(()=>{let t=this.backgroundSignal();return t.type==="dots"?t.color??Ks:Ks}),this.patternSize=y(()=>{let t=this.backgroundSignal();return t.type==="dots"?this.viewportService.readableViewport().zoom*(t.size??Xd)/2:0}),this.bgImageSrc=y(()=>{let t=this.backgroundSignal();return t.type==="image"?t.src:""}),this.imageSize=mt(B(this.backgroundSignal).pipe(Se(()=>Yd(this.bgImageSrc())),F(t=>({width:t.naturalWidth,height:t.naturalHeight}))),{initialValue:{width:0,height:0}}),this.scaledImageWidth=y(()=>{let t=this.backgroundSignal();if(t.type==="image"){let n=t.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().width*n*(t.scale??Js)}return 0}),this.scaledImageHeight=y(()=>{let t=this.backgroundSignal();if(t.type==="image"){let n=t.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().height*n*(t.scale??Js)}return 0}),this.imageX=y(()=>{let t=this.backgroundSignal();return t.type==="image"?t.repeat?t.fixed?0:this.viewportService.readableViewport().x%this.scaledImageWidth():t.fixed?0:this.viewportService.readableViewport().x:0}),this.imageY=y(()=>{let t=this.backgroundSignal();return t.type==="image"?t.repeat?t.fixed?0:this.viewportService.readableViewport().y%this.scaledImageHeight():t.fixed?0:this.viewportService.readableViewport().y:0}),this.repeated=y(()=>{let t=this.backgroundSignal();return t.type==="image"&&(t.repeat??Wd)}),this.patternId=Qs(),this.patternUrl=`url(#${this.patternId})`,Pe(()=>{let t=this.backgroundSignal();t.type==="dots"&&(this.rootSvg.style.backgroundColor=t.backgroundColor??Gd),t.type==="solid"&&(this.rootSvg.style.backgroundColor=t.color)})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["g","background",""]],standalone:!0,features:[ue],attrs:Vd,decls:2,vars:2,consts:[["patternUnits","userSpaceOnUse"],["x","0","y","0","width","100%","height","100%"]],template:function(n,o){n&1&&A(0,$d,3,10)(1,Bd,2,2),n&2&&(E(0,o.backgroundSignal().type==="dots"?0:-1),w(),E(1,o.backgroundSignal().type==="image"?1:-1))},encapsulation:2,changeDetection:0})}}return e})();function Yd(e){let i=new Image;return i.src=e,new Promise(t=>{i.onload=()=>t(i)})}var qd=["flowDefs",""];function Ud(e,i){if(e&1&&(D(),ee(0,"polyline",3)),e&2){let t,n,o,r=m().$implicit,s=m();je("stroke",(t=r.value.color)!==null&&t!==void 0?t:s.defaultColor)("stroke-width",(n=r.value.strokeWidth)!==null&&n!==void 0?n:2)("fill",(o=r.value.color)!==null&&o!==void 0?o:s.defaultColor)}}function Zd(e,i){if(e&1&&(D(),ee(0,"polyline",4)),e&2){let t,n,o=m().$implicit,r=m();je("stroke",(t=o.value.color)!==null&&t!==void 0?t:r.defaultColor)("stroke-width",(n=o.value.strokeWidth)!==null&&n!==void 0?n:2)}}function Qd(e,i){if(e&1&&(D(),R(0,"marker",0),A(1,Ud,1,6,":svg:polyline",1)(2,Zd,1,4,":svg:polyline",2),$()),e&2){let t,n,o,r,s=i.$implicit;k("id",s.key)("markerWidth",(t=s.value.width)!==null&&t!==void 0?t:16.5)("markerHeight",(n=s.value.height)!==null&&n!==void 0?n:16.5)("orient",(o=s.value.orient)!==null&&o!==void 0?o:"auto-start-reverse")("markerUnits",(r=s.value.markerUnits)!==null&&r!==void 0?r:"userSpaceOnUse"),w(),E(1,s.value.type==="arrow-closed"||!s.value.type?1:-1),w(),E(2,s.value.type==="arrow"?2:-1)}}var ta=(()=>{class e{constructor(){this.markers=W.required(),this.defaultColor="rgb(177, 177, 183)"}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["defs","flowDefs",""]],inputs:{markers:[j.SignalBased,"markers"]},standalone:!0,features:[ue],attrs:qd,decls:3,vars:2,consts:[["viewBox","-10 -10 20 20","refX","0","refY","0"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed",3,"stroke","stroke-width","fill"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default",3,"stroke","stroke-width"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default"]],template:function(n,o){n&1&&(He(0,Qd,3,7,":svg:marker",0,nn),Pn(2,"keyvalue")),n&2&&Fe(Vn(2,0,o.markers()))},dependencies:[Oo],styles:[".marker__arrow_default[_ngcontent-%COMP%]{stroke-width:1px;stroke-linecap:round;stroke-linejoin:round;fill:none}.marker__arrow_closed[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}"],changeDetection:0})}}return e})();var na=(()=>{class e{constructor(){this.host=u(oe),this.flowSettingsService=u(Q),this.flowWidth=y(()=>{let t=this.flowSettingsService.view();return t==="auto"?"100%":t[0]}),this.flowHeight=y(()=>{let t=this.flowSettingsService.view();return t==="auto"?"100%":t[1]}),gt([this.host.nativeElement],u(Oe)).pipe(ie(([t])=>{this.flowSettingsService.computedFlowWidth.set(t.contentRect.width),this.flowSettingsService.computedFlowHeight.set(t.contentRect.height)}),ve()).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["svg","flowSizeController",""]],hostVars:2,hostBindings:function(n,o){n&2&&k("width",o.flowWidth())("height",o.flowHeight())},standalone:!0})}}return e})();var ia=(()=>{class e{constructor(){this.flowStatusService=u(ke)}resetConnection(){let t=this.flowStatusService.status();(t.state==="connection-start"||t.state==="reconnection-start")&&this.flowStatusService.setIdleStatus()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=X({type:e,selectors:[["svg","rootSvgContext",""]],hostBindings:function(n,o){n&1&&J("mouseup",function(){return o.resetConnection()},!1,Ti)("touchend",function(){return o.resetConnection()},!1,Ti)("contextmenu",function(){return o.resetConnection()})},standalone:!0})}}return e})();function so(e,i){let t=[];for(let n of i){let{x:o,y:r}=n.globalPoint();e.x>=o&&e.x<=o+n.width()&&e.y>=r&&e.y<=r+n.height()&&t.push({x:e.x-o,y:e.y-r,spaceNodeId:n.rawNode.id})}return t.reverse(),t.push({spaceNodeId:null,x:e.x,y:e.y}),t}var Dn=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})(),oa=(()=>{class e extends Dn{shouldRenderNode(t){return!t.isVisible()}static{this.\u0275fac=(()=>{let t;return function(o){return(t||(t=Rn(e)))(o||e)}})()}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();function ra(e,i){if(Object.keys(i.preview().style).length){eu(e,i);return}if(i.rawNode.type==="default"){Kd(e,i);return}if(i.rawNode.type==="default-group"){Jd(e,i);return}tu(e,i)}function Kd(e,i){let t=i.globalPoint(),n=i.width(),o=i.height();sa(e,i,5),e.fillStyle="white",e.fill(),e.strokeStyle="#1b262c",e.lineWidth=1.5,e.stroke(),e.fillStyle="black",e.font="14px Arial",e.textAlign="center",e.textBaseline="middle";let r=t.x+n/2,s=t.y+o/2;e.fillText(i.text(),r,s)}function Jd(e,i){let t=i.globalPoint(),n=i.width(),o=i.height();e.globalAlpha=.05,e.fillStyle=i.color(),e.fillRect(t.x,t.y,n,o),e.globalAlpha=1,e.strokeStyle=i.color(),e.lineWidth=1.5,e.strokeRect(t.x,t.y,n,o)}function eu(e,i){let t=i.globalPoint(),n=i.width(),o=i.height(),r=i.preview().style;if(r.borderRadius){let s=parseFloat(r.borderRadius);sa(e,i,s)}else e.beginPath(),e.rect(t.x,t.y,n,o),e.closePath();r.backgroundColor&&(e.fillStyle=r.backgroundColor),r.borderColor&&(e.strokeStyle=r.borderColor),r.borderWidth&&(e.lineWidth=parseFloat(r.borderWidth)),e.fill(),e.stroke()}function tu(e,i){let t=i.globalPoint(),n=i.width(),o=i.height();e.fillStyle="rgb(0 0 0 / 10%)",e.fillRect(t.x,t.y,n,o)}function sa(e,i,t){let n=i.globalPoint(),o=i.width(),r=i.height();e.beginPath(),e.moveTo(n.x+t,n.y),e.lineTo(n.x+o-t,n.y),e.quadraticCurveTo(n.x+o,n.y,n.x+o,n.y+t),e.lineTo(n.x+o,n.y+r-t),e.quadraticCurveTo(n.x+o,n.y+r,n.x+o-t,n.y+r),e.lineTo(n.x+t,n.y+r),e.quadraticCurveTo(n.x,n.y+r,n.x,n.y+r-t),e.lineTo(n.x,n.y+t),e.quadraticCurveTo(n.x,n.y,n.x+t,n.y),e.closePath()}var nu=["previewFlow",""],aa=(()=>{class e{constructor(){this.viewportService=u(Ee),this.renderStrategy=u(Dn),this.nodeRenderingService=u(Ae),this.renderer2=u(yo),this.element=u(oe).nativeElement,this.ctx=this.element.getContext("2d"),this.width=W(0),this.height=W(0),this.dpr=window.devicePixelRatio,Pe(()=>{this.renderer2.setProperty(this.element,"width",this.width()*this.dpr),this.renderer2.setProperty(this.element,"height",this.height()*this.dpr),this.renderer2.setStyle(this.element,"width",`${this.width()}px`),this.renderer2.setStyle(this.element,"height",`${this.height()}px`),this.ctx.scale(this.dpr,this.dpr)}),Pe(()=>{let t=this.viewportService.readableViewport();this.ctx.clearRect(0,0,this.width(),this.height()),this.ctx.save(),this.ctx.setTransform(t.zoom*this.dpr,0,0,t.zoom*this.dpr,t.x*this.dpr,t.y*this.dpr);for(let n=0;n<this.nodeRenderingService.viewportNodes().length;n++){let o=this.nodeRenderingService.viewportNodes()[n];this.renderStrategy.shouldRenderNode(o)&&ra(this.ctx,o)}this.ctx.restore()})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["canvas","previewFlow",""]],inputs:{width:[j.SignalBased,"width"],height:[j.SignalBased,"height"]},standalone:!0,features:[ue],attrs:nu,decls:0,vars:0,template:function(n,o){},encapsulation:2,changeDetection:0})}}return e})();var ao=(()=>{class e{constructor(){this.nodeRenderingService=u(Ae),this.edgeRenderingService=u(Rt),this.flowEntitiesService=u(te),this.settingsService=u(Q),this.flowInitialized=b(!1),u(Oe).runOutsideAngular(()=>lo(this,null,function*(){yield iu(2),this.flowInitialized.set(!0)}))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();function iu(e){return new Promise(i=>{let t=0;function n(){t++,t<e?requestAnimationFrame(n):i()}requestAnimationFrame(n)})}function ou(e,i){if(e&1&&(D(),ee(0,"g",8)),e&2){let t,n=i.$implicit,o=m(2);Y("model",n)("groupNodeTemplate",(t=o.groupNodeTemplateDirective())==null?null:t.templateRef),k("transform",n.pointTransform())}}function ru(e,i){if(e&1&&(D(),ee(0,"g",9)),e&2){let t,n,o=i.$implicit,r=m(2);Y("model",o)("edgeTemplate",(t=r.edgeTemplateDirective())==null?null:t.templateRef)("edgeLabelHtmlTemplate",(n=r.edgeLabelHtmlDirective())==null?null:n.templateRef)}}function su(e,i){if(e&1&&(D(),ee(0,"g",10)),e&2){let t,n,o=i.$implicit,r=m(2);Y("model",o)("nodeTemplate",(t=r.nodeTemplateDirective())==null?null:t.templateRef)("nodeSvgTemplate",(n=r.nodeSvgTemplateDirective())==null?null:n.templateRef),k("transform",o.pointTransform())}}function au(e,i){if(e&1&&(He(0,ou,1,3,":svg:g",8,Lt().trackNodes,!0),He(2,ru,1,3,":svg:g",9,Lt().trackEdges,!0),He(4,su,1,4,":svg:g",10,Lt().trackNodes,!0)),e&2){let t=m();Fe(t.groups()),w(2),Fe(t.edgeModels()),w(2),Fe(t.nonGroups())}}function lu(e,i){if(e&1&&(D(),ee(0,"g",9)),e&2){let t,n,o=i.$implicit,r=m(2);Y("model",o)("edgeTemplate",(t=r.edgeTemplateDirective())==null?null:t.templateRef)("edgeLabelHtmlTemplate",(n=r.edgeLabelHtmlDirective())==null?null:n.templateRef)}}function cu(e,i){if(e&1&&(D(),ee(0,"g",11)),e&2){let t,n,o,r=i.$implicit,s=m(2);Y("model",r)("nodeTemplate",(t=s.nodeTemplateDirective())==null?null:t.templateRef)("nodeSvgTemplate",(n=s.nodeSvgTemplateDirective())==null?null:n.templateRef)("groupNodeTemplate",(o=s.groupNodeTemplateDirective())==null?null:o.templateRef),k("transform",r.pointTransform())}}function du(e,i){if(e&1&&(He(0,lu,1,3,":svg:g",9,Lt().trackEdges,!0),He(2,cu,1,5,":svg:g",11,Lt().trackNodes,!0)),e&2){let t=m();Fe(t.edgeModels()),w(2),Fe(t.nodeModels())}}function uu(e,i){e&1&&(D(),be(0,6)),e&2&&Y("ngTemplateOutlet",i.template())}function hu(e,i){if(e&1&&ee(0,"canvas",7),e&2){let t=m();Y("width",t.flowWidth())("height",t.flowHeight())}}var BC=(()=>{class e{constructor(){this.viewportService=u(Ee),this.flowEntitiesService=u(te),this.nodesChangeService=u(On),this.edgesChangeService=u(kn),this.nodeRenderingService=u(Ae),this.edgeRenderingService=u(Rt),this.flowSettingsService=u(Q),this.componentEventBusService=u(Ni),this.keyboardService=u(bn),this.injector=u(ot),this.flowRenderingService=u(ao),this.nodeModels=this.nodeRenderingService.nodes,this.groups=this.nodeRenderingService.groups,this.nonGroups=this.nodeRenderingService.nonGroups,this.edgeModels=this.edgeRenderingService.edges,this.onComponentNodeEvent=L(this.componentEventBusService.event$),this.nodeTemplateDirective=_t(Di),this.nodeSvgTemplateDirective=_t(Mi),this.groupNodeTemplateDirective=_t(Ri),this.edgeTemplateDirective=_t(zi),this.edgeLabelHtmlDirective=_t(ki),this.connectionTemplateDirective=_t(Oi),this.mapContext=wt(yi),this.spacePointContext=wt.required(at),this.viewport=this.viewportService.readableViewport.asReadonly(),this.nodesChange=mt(this.nodesChangeService.changes$,{initialValue:[]}),this.edgesChange=mt(this.edgesChangeService.changes$,{initialValue:[]}),this.initialized=this.flowRenderingService.flowInitialized.asReadonly(),this.viewportChange$=B(this.viewportService.readableViewport).pipe(Qe(1)),this.nodesChange$=this.nodesChangeService.changes$,this.edgesChange$=this.edgesChangeService.changes$,this.initialized$=B(this.flowRenderingService.flowInitialized),this.markers=this.flowEntitiesService.markers,this.minimap=this.flowEntitiesService.minimap,this.flowOptimization=this.flowSettingsService.optimization,this.flowWidth=this.flowSettingsService.computedFlowWidth,this.flowHeight=this.flowSettingsService.computedFlowHeight}set view(t){this.flowSettingsService.view.set(t)}set minZoom(t){this.flowSettingsService.minZoom.set(t)}set maxZoom(t){this.flowSettingsService.maxZoom.set(t)}set background(t){this.flowSettingsService.background.set(Ls(t))}set optimization(t){this.flowSettingsService.optimization.update(n=>ze(ze({},n),t))}set entitiesSelectable(t){this.flowSettingsService.entitiesSelectable.set(t)}set keyboardShortcuts(t){this.keyboardService.setShortcuts(t)}set connection(t){this.flowEntitiesService.connection.set(t)}get connection(){return this.flowEntitiesService.connection()}set snapGrid(t){this.flowSettingsService.snapGrid.set(t)}set elevateNodesOnSelect(t){this.flowSettingsService.elevateNodesOnSelect.set(t)}set elevateEdgesOnSelect(t){this.flowSettingsService.elevateEdgesOnSelect.set(t)}set nodes(t){let n=en(this.injector,()=>zn.nodes(t,this.flowEntitiesService.nodes()));no(n,this.flowEntitiesService.edges()),this.flowEntitiesService.nodes.set(n),n.forEach(o=>this.nodeRenderingService.pullNode(o))}set edges(t){let n=en(this.injector,()=>zn.edges(t,this.flowEntitiesService.edges()));no(this.flowEntitiesService.nodes(),n),this.flowEntitiesService.edges.set(n)}viewportTo(t){this.viewportService.writableViewport.set({changeType:"absolute",state:t,duration:0})}zoomTo(t){this.viewportService.writableViewport.set({changeType:"absolute",state:{zoom:t},duration:0})}panTo(t){this.viewportService.writableViewport.set({changeType:"absolute",state:t,duration:0})}fitView(t){this.viewportService.fitView(t)}getNode(t){return this.flowEntitiesService.getNode(t)?.rawNode}getDetachedEdges(){return this.flowEntitiesService.getDetachedEdges().map(t=>t.edge)}documentPointToFlowPoint(t,n){let o=this.spacePointContext().documentPointToFlowPoint(t);return n?.spaces?so(o,this.nodeRenderingService.groups()):o}getIntesectingNodes(t,n={partially:!0}){return Ao(t,this.nodeModels(),n).map(o=>o.rawNode)}toNodeSpace(t,n){let o=this.nodeModels().find(s=>s.rawNode.id===t);if(!o)return{x:1/0,y:1/0};if(n===null)return o.globalPoint();let r=this.nodeModels().find(s=>s.rawNode.id===n);return r?so(o.globalPoint(),[r])[0]:{x:1/0,y:1/0}}trackNodes(t,{rawNode:n}){return n}trackEdges(t,{edge:n}){return n}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=de({type:e,selectors:[["vflow"]],contentQueries:function(n,o,r){n&1&&(Ct(r,o.nodeTemplateDirective,Di,5),Ct(r,o.nodeSvgTemplateDirective,Mi,5),Ct(r,o.groupNodeTemplateDirective,Ri,5),Ct(r,o.edgeTemplateDirective,zi,5),Ct(r,o.edgeLabelHtmlDirective,ki,5),Ct(r,o.connectionTemplateDirective,Oi,5)),n&2&&bt(6)},viewQuery:function(n,o){n&1&&(St(o.mapContext,yi,5),St(o.spacePointContext,at,5)),n&2&&bt(2)},inputs:{view:"view",minZoom:"minZoom",maxZoom:"maxZoom",background:"background",optimization:"optimization",entitiesSelectable:"entitiesSelectable",keyboardShortcuts:"keyboardShortcuts",connection:[j.HasDecoratorInputTransform,"connection","connection",t=>new Gt(t)],snapGrid:"snapGrid",elevateNodesOnSelect:"elevateNodesOnSelect",elevateEdgesOnSelect:"elevateEdgesOnSelect",nodes:"nodes",edges:"edges"},outputs:{onComponentNodeEvent:"onComponentNodeEvent"},standalone:!0,features:[Fn([wi,Ee,ke,te,On,kn,Ae,Rt,pt,Q,Ni,bn,Ci,{provide:Dn,useClass:oa},ao]),Co,_o([{directive:As,outputs:["onNodesChange","onNodesChange","onNodesChange.position","onNodesChange.position","onNodesChange.position.single","onNodesChange.position.single","onNodesChange.position.many","onNodesChange.position.many","onNodesChange.size","onNodesChange.size","onNodesChange.size.single","onNodesChange.size.single","onNodesChange.size.many","onNodesChange.size.many","onNodesChange.add","onNodesChange.add","onNodesChange.add.single","onNodesChange.add.single","onNodesChange.add.many","onNodesChange.add.many","onNodesChange.remove","onNodesChange.remove","onNodesChange.remove.single","onNodesChange.remove.single","onNodesChange.remove.many","onNodesChange.remove.many","onNodesChange.select","onNodesChange.select","onNodesChange.select.single","onNodesChange.select.single","onNodesChange.select.many","onNodesChange.select.many","onEdgesChange","onEdgesChange","onEdgesChange.detached","onEdgesChange.detached","onEdgesChange.detached.single","onEdgesChange.detached.single","onEdgesChange.detached.many","onEdgesChange.detached.many","onEdgesChange.add","onEdgesChange.add","onEdgesChange.add.single","onEdgesChange.add.single","onEdgesChange.add.many","onEdgesChange.add.many","onEdgesChange.remove","onEdgesChange.remove","onEdgesChange.remove.single","onEdgesChange.remove.single","onEdgesChange.remove.many","onEdgesChange.remove.many","onEdgesChange.select","onEdgesChange.select","onEdgesChange.select.single","onEdgesChange.select.single","onEdgesChange.select.many","onEdgesChange.select.many"]}]),ue],decls:10,vars:7,consts:[["flow",""],["rootSvgRef","","rootSvgContext","","rootPointer","","flowSizeController","",1,"root-svg"],["flowDefs","",3,"markers"],["background",""],["mapContext","","spacePointContext",""],["connection","",3,"model","template"],[3,"ngTemplateOutlet"],["previewFlow","",1,"preview-flow",3,"width","height"],["node","",3,"model","groupNodeTemplate"],["edge","",3,"model","edgeTemplate","edgeLabelHtmlTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate","groupNodeTemplate"]],template:function(n,o){if(n&1&&(D(),R(0,"svg",1,0),ee(2,"defs",2)(3,"g",3),R(4,"g",4),ee(5,"g",5),A(6,au,6,0)(7,du,4,0),$(),A(8,uu,1,1,":svg:ng-container",6),$(),A(9,hu,1,2,"canvas",7)),n&2){let r,s;w(2),Y("markers",o.markers()),w(3),Y("model",o.connection)("template",(r=o.connectionTemplateDirective())==null?null:r.templateRef),w(),E(6,o.flowOptimization().detachedGroupsLayer?6:-1),w(),E(7,o.flowOptimization().detachedGroupsLayer?-1:7),w(),E(8,(s=o.minimap())?8:-1,s),w(),E(9,o.flowOptimization().virtualization?9:-1)}},dependencies:[st,ia,rt,na,ta,ea,yi,at,Zs,qs,Gs,Xe,aa],styles:["[_nghost-%COMP%]{display:grid;grid-template-columns:1fr;width:100%;height:100%;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]     *{box-sizing:border-box}.root-svg[_ngcontent-%COMP%]{grid-row-start:1;grid-column-start:1}.preview-flow[_ngcontent-%COMP%]{pointer-events:none;grid-row-start:1;grid-column-start:1}"],changeDetection:0})}}return e})();export{Et as a,di as b,Gn as c,te as d,Lo as e,Q as f,Ee as g,pt as h,zi as i,ki as j,Di as k,Mi as l,Ri as m,Ro as n,Io as o,Nu as p,Eu as q,Ci as r,gt as s,Bn as t,Rt as u,Gs as v,Xs as w,Xo as x,qs as y,BC as z};
