import{c as N,d as L,e as Q,f as q,g as A,u as R}from"./chunk-UKKUZNX5.js";import{$ as b,Cb as s,Ea as _,Fa as r,Ga as x,Ha as C,Ia as k,La as V,Ma as y,O as p,Pa as z,Q as l,Qa as W,R as F,Ra as d,Sa as M,Ta as a,Ua as P,Va as $,Xa as I,Y as w,Z as S,Za as B,_ as c,_a as m,ba as H,fa as h,gb as j,hb as D,ka as O,na as o,qb as E,ya as g,yb as G,za as T}from"./chunk-VFFNGGE6.js";var v=class{constructor(){this.template=g(null)}};var J=["minimap"];function K(t,f){if(t&1&&(c(),d(0,"foreignObject"),b(),d(1,"default-node",4),a(2,"div",5),M()()),t&2){let e=m().$implicit;r("transform",e.pointTransform())("width",e.size().width)("height",e.size().height),o(),C("width",e.size().width,"px")("height",e.size().height,"px")("max-width",e.size().width,"px")("max-height",e.size().height,"px"),x("selected",e.selected()),o(),x("outerHTML",e.text(),O)}}function U(t,f){if(t&1&&(c(),a(0,"rect",6)),t&2){let e=m().$implicit;C("stroke",e.color())("fill",e.color()),k("default-group-node_selected",e.selected()),r("transform",e.pointTransform())("width",e.size().width)("height",e.size().height)}}function X(t,f){if(t&1&&(c(),P(0),_(1,K,3,13,":svg:foreignObject")(2,U,1,9,":svg:rect",3),$()),t&2){let e=f.$implicit;o(),y(1,e.node.type==="default"||e.node.type==="html-template"||e.isComponentType?1:-1),o(),y(2,e.node.type==="default-group"||e.node.type==="template-group"?2:-1)}}function Y(t,f){if(t&1){let e=I();c(),a(0,"rect",1),d(1,"svg",2),B("mouseover",function(){w(e);let n=m();return S(n.hovered.set(!0))})("mouseleave",function(){w(e);let n=m();return S(n.hovered.set(!1))}),a(2,"rect"),d(3,"g"),a(4,"rect"),z(5,X,3,2,":svg:ng-container",null,V().trackNodes,!0),M()()}if(t&2){let e=m();r("x",e.minimapPoint().x)("y",e.minimapPoint().y)("width",e.minimapWidth())("height",e.minimapHeight())("stroke",e.strokeColor()),o(),r("x",e.minimapPoint().x)("y",e.minimapPoint().y)("width",e.minimapWidth())("height",e.minimapHeight()),o(),r("width",e.minimapWidth())("height",e.minimapHeight())("fill",e.maskColor()),o(),r("transform",e.minimapTransform()),o(),r("fill",e.viewportColor())("transform",e.viewportTransform())("width",e.minimapWidth())("height",e.minimapHeight()),o(),W(e.entitiesService.nodes())}}var he=(()=>{class t{constructor(){this.entitiesService=p(L),this.flowSettingsService=p(q),this.viewportService=p(A),this.injector=p(H),this.maskColor=h("rgba(215, 215, 215, 0.6)"),this.strokeColor=h("rgb(200, 200, 200)"),this.position=h("bottom-right"),this.scaleOnHover=h(!1),this.minimap=T.required("minimap"),this.minimapOffset=10,this.minimapScale=s(()=>this.scaleOnHover()&&this.hovered()?.4:.2),this.viewportColor=s(()=>{let e=this.flowSettingsService.background();return e.type==="dots"||e.type==="solid"?e.color??"#fff":"#fff"}),this.hovered=g(!1),this.minimapPoint=s(()=>{switch(this.position()){case"top-left":return{x:this.minimapOffset,y:this.minimapOffset};case"top-right":return{x:this.flowSettingsService.computedFlowWidth()-this.minimapWidth()-this.minimapOffset,y:this.minimapOffset};case"bottom-left":return{x:this.minimapOffset,y:this.flowSettingsService.computedFlowHeight()-this.minimapHeight()-this.minimapOffset};case"bottom-right":return{x:this.flowSettingsService.computedFlowWidth()-this.minimapWidth()-this.minimapOffset,y:this.flowSettingsService.computedFlowHeight()-this.minimapHeight()-this.minimapOffset}}}),this.minimapWidth=s(()=>this.flowSettingsService.computedFlowWidth()*this.minimapScale()),this.minimapHeight=s(()=>this.flowSettingsService.computedFlowHeight()*this.minimapScale()),this.viewportTransform=s(()=>{let e=this.viewportService.readableViewport(),i=1/e.zoom,n=-(e.x*this.minimapScale())*i;n/=this.minimapScale();let u=-(e.y*this.minimapScale())*i;return u/=this.minimapScale(),i/=this.minimapScale(),`translate(${n}, ${u}) scale(${i})`}),this.boundsViewport=s(()=>{let e=this.entitiesService.nodes();return Q(N(e),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),-1/0,1.5,0)}),this.minimapTransform=s(()=>{let e=this.boundsViewport(),i=e.x*this.minimapScale(),n=e.y*this.minimapScale(),u=e.zoom*this.minimapScale();return`translate(${i} ${n}) scale(${u})`})}ngOnInit(){let e=new v;e.template.set(this.minimap()),this.entitiesService.minimap.set(e)}trackNodes(e,{node:i}){return i}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=F({type:t,selectors:[["mini-map"]],viewQuery:function(i,n){i&1&&j(n.minimap,J,5),i&2&&D()},inputs:{maskColor:[l.SignalBased,"maskColor"],strokeColor:[l.SignalBased,"strokeColor"],position:[l.SignalBased,"position"],scaleOnHover:[l.SignalBased,"scaleOnHover"]},standalone:!0,features:[E],decls:2,vars:0,consts:[["minimap",""],["fill","none"],[3,"mouseover","mouseleave"],["rx","5","ry","5",1,"default-group-node",3,"default-group-node_selected","stroke","fill"],[3,"selected"],[3,"outerHTML"],["rx","5","ry","5",1,"default-group-node"]],template:function(i,n){i&1&&_(0,Y,7,17,"ng-template",null,0,G)},dependencies:[R],styles:[".default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}"],changeDetection:0})}}return t})();export{he as a};
