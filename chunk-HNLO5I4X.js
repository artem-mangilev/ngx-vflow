import{a as G,b as I,c as L,d as Q,e as q,v as B}from"./chunk-N5NWT4P3.js";import{Ba as b,Bb as T,Hb as _,Ja as c,Lc as E,Ma as u,Sb as s,Tb as S,Ub as x,Vb as k,Yb as F,Yc as r,Zb as C,ac as V,bc as z,cc as h,dc as y,ec as a,fc as W,gc as P,hb as H,ic as $,lc as N,mb as o,mc as m,oa as p,uc as j,va as v,vb as O,vc as D,wa as w,xa as l,ya as M}from"./chunk-7JBMCLDE.js";var g=class{constructor(){this.template=u(null)}};var A=["minimap"];function R(t,d){if(t&1&&(l(),h(0,"foreignObject"),M(),h(1,"default-node",4),a(2,"div",5),y()()),t&2){let e=m().$implicit;s("transform",e.pointTransform())("width",e.size().width)("height",e.size().height),o(),x("width",e.size().width,"px")("height",e.size().height,"px")("max-width",e.size().width,"px")("max-height",e.size().height,"px"),S("selected",e.selected()),o(),S("outerHTML",e.text(),H)}}function J(t,d){if(t&1&&(l(),a(0,"rect",6)),t&2){let e=m().$implicit;x("stroke",e.color())("fill",e.color()),k("default-group-node_selected",e.selected()),s("transform",e.pointTransform())("width",e.size().width)("height",e.size().height)}}function K(t,d){if(t&1&&(l(),W(0),_(1,R,3,13,":svg:foreignObject")(2,J,1,9,":svg:rect",3),P()),t&2){let e=d.$implicit;o(),C(e.rawNode.type==="default"||e.rawNode.type==="html-template"||e.isComponentType?1:-1),o(),C(e.rawNode.type==="default-group"||e.rawNode.type==="template-group"?2:-1)}}function U(t,d){if(t&1){let e=$();l(),a(0,"rect",1),h(1,"svg",2),N("mouseover",function(){v(e);let n=m();return w(n.hovered.set(!0))})("mouseleave",function(){v(e);let n=m();return w(n.hovered.set(!1))}),a(2,"rect"),h(3,"g"),a(4,"rect"),V(5,K,3,2,":svg:ng-container",null,F().trackNodes,!0),y()()}if(t&2){let e=m();s("x",e.minimapPoint().x)("y",e.minimapPoint().y)("width",e.minimapWidth())("height",e.minimapHeight())("stroke",e.strokeColor()),o(),s("x",e.minimapPoint().x)("y",e.minimapPoint().y)("width",e.minimapWidth())("height",e.minimapHeight()),o(),s("width",e.minimapWidth())("height",e.minimapHeight())("fill",e.maskColor()),o(),s("transform",e.minimapTransform()),o(),s("fill",e.viewportColor())("transform",e.viewportTransform())("width",e.minimapWidth())("height",e.minimapHeight()),o(),z(e.entitiesService.nodes())}}var le=(()=>{class t{constructor(){this.entitiesService=p(I),this.flowSettingsService=p(Q),this.viewportService=p(q),this.injector=p(b),this.maskColor=c("rgba(215, 215, 215, 0.6)"),this.strokeColor=c("rgb(200, 200, 200)"),this.position=c("bottom-right"),this.scaleOnHover=c(!1),this.minimap=O.required("minimap"),this.minimapOffset=10,this.minimapScale=r(()=>this.scaleOnHover()&&this.hovered()?.4:.2),this.viewportColor=r(()=>{let e=this.flowSettingsService.background();return e.type==="dots"||e.type==="solid"?e.color??"#fff":"#fff"}),this.hovered=u(!1),this.minimapPoint=r(()=>{switch(this.position()){case"top-left":return{x:this.minimapOffset,y:this.minimapOffset};case"top-right":return{x:this.flowSettingsService.computedFlowWidth()-this.minimapWidth()-this.minimapOffset,y:this.minimapOffset};case"bottom-left":return{x:this.minimapOffset,y:this.flowSettingsService.computedFlowHeight()-this.minimapHeight()-this.minimapOffset};case"bottom-right":return{x:this.flowSettingsService.computedFlowWidth()-this.minimapWidth()-this.minimapOffset,y:this.flowSettingsService.computedFlowHeight()-this.minimapHeight()-this.minimapOffset}}}),this.minimapWidth=r(()=>this.flowSettingsService.computedFlowWidth()*this.minimapScale()),this.minimapHeight=r(()=>this.flowSettingsService.computedFlowHeight()*this.minimapScale()),this.viewportTransform=r(()=>{let e=this.viewportService.readableViewport(),i=1/e.zoom,n=-(e.x*this.minimapScale())*i;n/=this.minimapScale();let f=-(e.y*this.minimapScale())*i;return f/=this.minimapScale(),i/=this.minimapScale(),`translate(${n}, ${f}) scale(${i})`}),this.boundsViewport=r(()=>{let e=this.entitiesService.nodes();return L(G(e),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),-1/0,1.5,0)}),this.minimapTransform=r(()=>{let e=this.boundsViewport(),i=e.x*this.minimapScale(),n=e.y*this.minimapScale(),f=e.zoom*this.minimapScale();return`translate(${i} ${n}) scale(${f})`})}ngOnInit(){let e=new g;e.template.set(this.minimap()),this.entitiesService.minimap.set(e)}trackNodes(e,{rawNode:i}){return i}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=T({type:t,selectors:[["mini-map"]],viewQuery:function(i,n){i&1&&j(n.minimap,A,5),i&2&&D()},inputs:{maskColor:[1,"maskColor"],strokeColor:[1,"strokeColor"],position:[1,"position"],scaleOnHover:[1,"scaleOnHover"]},decls:2,vars:0,consts:[["minimap",""],["fill","none"],[3,"mouseover","mouseleave"],["rx","5","ry","5",1,"default-group-node",3,"default-group-node_selected","stroke","fill"],[3,"selected"],[3,"outerHTML"],["rx","5","ry","5",1,"default-group-node"]],template:function(i,n){i&1&&_(0,U,7,17,"ng-template",null,0,E)},dependencies:[B],styles:[".default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}"],changeDetection:0})}}return t})();export{le as a};
