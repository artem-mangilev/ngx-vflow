import{Ac as $,Da as E,Db as a,E as k,Ea as b,Gb as q,Ka as N,Ma as v,Oa as h,Pa as B,Ra as d,Sa as M,Ta as P,ad as l,bd as R,c as m,cd as X,da as C,ea as z,f as y,ga as H,h as j,ka as f,l as D,o as V,ra as r,v as O,va as u,wa as F,ya as g}from"./chunk-Z42XPK5A.js";function w(t){t||(b(w),t=r(h));let n=new m(e=>t.onDestroy(e.next.bind(e)));return e=>e.pipe(C(n))}var I=class{constructor(n){this.source=n,this.destroyed=!1,this.destroyRef=r(h),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}subscribe(n){if(this.destroyed)throw new H(953,!1);let e=this.source.pipe(w(this.destroyRef)).subscribe({next:i=>n(i)});return{unsubscribe:()=>e.unsubscribe()}}};function tt(t,n){return new I(t)}function W(t,n){!n?.injector&&b(W);let e=n?.injector??r(v),i=new j(1),s=X(()=>{let o;try{o=t()}catch(c){R(()=>i.error(c));return}R(()=>i.next(o))},{injector:e,manualCleanup:!0});return e.get(h).onDestroy(()=>{s.destroy(),i.complete()}),i.asObservable()}function S(t,n){let e=!n?.manualCleanup;e&&!n?.injector&&b(S);let i=e?n?.injector?.get(h)??r(h):null,s;n?.requireSync?s=a({kind:0}):s=a({kind:1,value:n?.initialValue});let o=t.subscribe({next:c=>s.set({kind:1,value:c}),error:c=>{if(n?.rejectErrors)throw c;s.set({kind:2,error:c})}});return i?.onDestroy(o.unsubscribe.bind(o)),l(()=>{let c=s();switch(c.kind){case 1:return c.value;case 2:throw c.error;case 0:throw new H(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var Y=(()=>{class t{constructor(){this._event$=new y,this.event$=this._event$.asObservable()}pushEvent(e){this._event$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=f({token:t,factory:t.\u0275fac})}}return t})();var A=(()=>{class t{constructor(){this.model=a(null)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=f({token:t,factory:t.\u0275fac})}}return t})();var T=(()=>{class t{constructor(){this.eventBus=r(Y),this.nodeService=r(A),this.destroyRef=r(h),this.selected=this.nodeService.model().selected,this.data=a(void 0)}ngOnInit(){this.trackEvents().pipe(w(this.destroyRef)).subscribe()}trackEvents(){let e=Object.getOwnPropertyNames(this),i=new Map;for(let s of e){let o=this[s];o instanceof P&&i.set(o,s),o instanceof B&&i.set(G(o),s)}return k(...Array.from(i.keys()).map(s=>s.pipe(z(o=>{this.eventBus.pushEvent({nodeId:this.nodeService.model()?.rawNode.id??"",eventName:i.get(s),eventPayload:o})}))))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=g({type:t})}}return t})();function G(t){return new m(n=>{let e=t.subscribe(i=>{n.next(i)});return()=>{e.unsubscribe()}})}var gt=(()=>{class t extends T{constructor(){super(...arguments),this.node=d.required()}ngOnInit(){this.node().data&&this.data.set(this.node().data),super.ngOnInit()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=N(t)))(s||t)}})()}static{this.\u0275dir=g({type:t,inputs:{node:[u.SignalBased,"node"]},features:[q]})}}return t})();V();function L(t,n,e){let i=e.value;return e.value=function(...s){queueMicrotask(()=>{i?.apply(this,s)})},e}var U=(()=>{class t{constructor(){this.node=a(null)}createHandle(e){let i=this.node();i&&i.handles.update(s=>[...s,e])}destroyHandle(e){let i=this.node();i&&i.handles.update(s=>s.filter(o=>o!==e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=f({token:t,factory:t.\u0275fac})}}return D([L],t.prototype,"createHandle",null),t})();var x=class{constructor(n,e){this.rawHandle=n,this.parentNode=e,this.strokeWidth=2,this.size=a({width:10+2*this.strokeWidth,height:10+2*this.strokeWidth}),this.pointAbsolute=l(()=>({x:this.parentNode.globalPoint().x+this.hostOffset().x+this.sizeOffset().x,y:this.parentNode.globalPoint().y+this.hostOffset().y+this.sizeOffset().y})),this.state=a("idle"),this.updateHostSizeAndPosition$=new y,this.hostSize=S(this.updateHostSizeAndPosition$.pipe(O(()=>this.getHostSize())),{initialValue:{width:0,height:0}}),this.hostPosition=S(this.updateHostSizeAndPosition$.pipe(O(()=>({x:this.hostReference instanceof HTMLElement?this.hostReference.offsetLeft:0,y:this.hostReference instanceof HTMLElement?this.hostReference.offsetTop:0}))),{initialValue:{x:0,y:0}}),this.hostOffset=l(()=>{switch(this.rawHandle.position){case"left":return{x:-this.rawHandle.userOffsetX,y:-this.rawHandle.userOffsetY+this.hostPosition().y+this.hostSize().height/2};case"right":return{x:-this.rawHandle.userOffsetX+this.parentNode.size().width,y:-this.rawHandle.userOffsetY+this.hostPosition().y+this.hostSize().height/2};case"top":return{x:-this.rawHandle.userOffsetX+this.hostPosition().x+this.hostSize().width/2,y:-this.rawHandle.userOffsetY};case"bottom":return{x:-this.rawHandle.userOffsetX+this.hostPosition().x+this.hostSize().width/2,y:-this.rawHandle.userOffsetY+this.parentNode.size().height}}}),this.sizeOffset=l(()=>{switch(this.rawHandle.position){case"left":return{x:-(this.size().width/2),y:0};case"right":return{x:this.size().width/2,y:0};case"top":return{x:0,y:-(this.size().height/2)};case"bottom":return{x:0,y:this.size().height/2}}}),this.hostReference=this.rawHandle.hostReference,this.template=this.rawHandle.template,this.templateContext={$implicit:{point:this.hostOffset,state:this.state,node:this.parentNode.rawNode}}}updateHost(){this.updateHostSizeAndPosition$.next()}getHostSize(){return this.hostReference instanceof HTMLElement?{width:this.hostReference.offsetWidth,height:this.hostReference.offsetHeight}:this.hostReference instanceof SVGGraphicsElement?this.hostReference.getBBox():{width:0,height:0}}};var Nt=(()=>{class t{constructor(){this.injector=r(v),this.handleService=r(U),this.element=r(M).nativeElement,this.destroyRef=r(h),this.position=d.required(),this.type=d.required(),this.id=d(),this.template=d(),this.offsetX=d(0),this.offsetY=d(0)}ngOnInit(){E(this.injector,()=>{let e=this.handleService.node();if(e){let i=new x({position:this.position(),type:this.type(),id:this.id(),hostReference:this.element.parentElement,template:this.template(),userOffsetX:this.offsetX(),userOffsetY:this.offsetY()},e);this.handleService.createHandle(i),requestAnimationFrame(()=>i.updateHost()),this.destroyRef.onDestroy(()=>this.handleService.destroyHandle(i))}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=F({type:t,selectors:[["handle"]],inputs:{position:[u.SignalBased,"position"],type:[u.SignalBased,"type"],id:[u.SignalBased,"id"],template:[u.SignalBased,"template"],offsetX:[u.SignalBased,"offsetX"],offsetY:[u.SignalBased,"offsetY"]},standalone:!0,features:[$],decls:0,vars:0,template:function(i,s){},encapsulation:2,changeDetection:0})}}return t})();export{w as a,tt as b,W as c,S as d,Y as e,A as f,T as g,gt as h,L as i,U as j,Nt as k};
