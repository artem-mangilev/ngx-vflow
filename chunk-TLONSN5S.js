import{a as pe,b as X,c as G,d as Ln,e as zi,f as Ke,g as Ro,h as Ho,i as rn,j as Oi,k as Io}from"./chunk-NA7FJBPQ.js";import{b as ko,g as Xe,h as Do,i as Mo}from"./chunk-QMHLIXQX.js";import{$ as xo,$b as I,Ac as le,C as Ge,Da as tn,Db as b,E as me,Ea as yo,Eb as _t,Ec as $n,Fb as Ct,Fc as An,G as U,Ga as Q,Gb as Co,H as mo,Ha as K,Hb as So,Ia as k,Ib as bo,Ic as Oo,J as go,Ja as ot,Ka as In,L as vo,Ma as rt,Oa as At,Ob as F,Pb as D,Qa as nn,Qb as W,R as en,Ra as B,Rb as je,Sa as re,Sb as Lt,Tb as To,Vb as Bt,W as Vt,Wb as E,Xb as No,Yb as on,Zb as Oe,_ as $t,_b as ke,aa as Qe,ac as j,ad as y,ba as Hn,bc as q,bd as Gt,c as ho,ca as be,cd as Ve,ea as te,ec as Te,f as Ft,fc as ye,hc as ne,i as Pt,ic as f,j as Ni,jc as Fn,ka as Z,kb as wo,kc as Pn,l as Jt,nb as Ei,o as po,p as Ze,pb as _,pc as St,qc as bt,r as fo,ra as h,rc as Tt,sb as wt,tc as Eo,v as R,va as A,vc as zo,wa as ae,wb as _o,ya as Y,yb as Re,zc as Vn}from"./chunk-Z42XPK5A.js";import{a as Ee,b as it,i as uo}from"./chunk-ODLL2QMY.js";var ki=(()=>{class e{constructor(){this.templateRef=h(wt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["ng-template","edge",""]],standalone:!0})}}return e})(),Di=(()=>{class e{constructor(){this.templateRef=h(wt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["ng-template","connection",""]],standalone:!0})}}return e})(),Mi=(()=>{class e{constructor(){this.templateRef=h(wt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["ng-template","edgeLabelHtml",""]],standalone:!0})}}return e})(),Ri=(()=>{class e{constructor(){this.templateRef=h(wt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["ng-template","nodeHtml",""]],standalone:!0})}}return e})(),Hi=(()=>{class e{constructor(){this.templateRef=h(wt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["ng-template","nodeSvg",""]],standalone:!0})}}return e})(),Ii=(()=>{class e{constructor(){this.templateRef=h(wt)}static ngTemplateContextGuard(t,n){return!0}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["ng-template","groupNode",""]],standalone:!0})}}return e})();function Nt(e){try{return new Proxy(e,{apply:()=>{}})(),!0}catch{return!1}}var Fo=(()=>{class e extends Ro{constructor(){super(...arguments),this.node=B.required()}ngOnInit(){let t=this.node().data;t&&(this.data=t),super.ngOnInit()}static{this.\u0275fac=(()=>{let t;return function(o){return(t||(t=In(e)))(o||e)}})()}static{this.\u0275dir=Y({type:e,inputs:{node:[A.SignalBased,"node"]},features:[Co]})}}return e})();function Bn(e){return Object.prototype.isPrototypeOf.call(Ho,e)}function Gn(e){return Object.prototype.isPrototypeOf.call(Fo,e)}function Po(e){return typeof e.point=="function"}function Vo(e){return Bn(e.type)?!0:Nt(e.type)&&!Nt(e.point)}function $o(e){return Gn(e.type)?!0:Nt(e.type)&&Nt(e.point)}function Pu(e){return e.type==="html-template"}function Vu(e){return e.type==="default-group"}var _e=(()=>{class e{constructor(){this.status=b({state:"idle",payload:null})}setIdleStatus(){this.status.set({state:"idle",payload:null})}setConnectionStartStatus(t,n){this.status.set({state:"connection-start",payload:{source:t,sourceHandle:n}})}setReconnectionStartStatus(t,n,o){this.status.set({state:"reconnection-start",payload:{source:t,sourceHandle:n,oldEdge:o}})}setConnectionValidationStatus(t,n,o,r,s){this.status.set({state:"connection-validation",payload:{source:n,target:o,sourceHandle:r,targetHandle:s,valid:t}})}setReconnectionValidationStatus(t,n,o,r,s,a){this.status.set({state:"reconnection-validation",payload:{source:n,target:o,sourceHandle:r,targetHandle:s,valid:t,oldEdge:a}})}setConnectionEndStatus(t,n,o,r){this.status.set({state:"connection-end",payload:{source:t,target:n,sourceHandle:o,targetHandle:r}})}setReconnectionEndStatus(t,n,o,r,s){this.status.set({state:"reconnection-end",payload:{source:t,target:n,sourceHandle:o,targetHandle:r,oldEdge:s}})}setNodeDragStartStatus(t){this.status.set({state:"node-drag-start",payload:{node:t}})}setNodeDragEndStatus(t){this.status.set({state:"node-drag-end",payload:{node:t}})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();function Fi(e){return e.state==="node-drag-start"}function Ao(e){return e.state==="node-drag-end"}var jt=class{constructor(i){this.settings=i,this.curve=i.curve??"bezier",this.type=i.type??"default",this.mode=i.mode??"strict";let t=this.getValidators(i);this.validator=n=>t.every(o=>o(n))}getValidators(i){let t=[];return t.push(ha),this.mode==="loose"&&t.push(pa),i.validator&&t.push(i.validator),t}},ha=e=>e.source!==e.target,pa=e=>e.sourceHandle!==void 0&&e.targetHandle!==void 0;function Je(e){return e.split("").reduce((i,t)=>(i=(i<<5)-i+t.charCodeAt(0),i&i),0)}var ie=(()=>{class e{constructor(){this.nodes=b([],{equal:(t,n)=>!t.length&&!n.length?!0:t===n}),this.rawNodes=y(()=>this.nodes().map(t=>t.rawNode)),this.edges=b([],{equal:(t,n)=>!t.length&&!n.length?!0:t===n}),this.rawEdges=y(()=>this.edges().map(t=>t.edge)),this.validEdges=y(()=>{let t=this.nodes();return this.edges().filter(n=>t.includes(n.source())&&t.includes(n.target()))}),this.connection=b(new jt({})),this.markers=y(()=>{let t=new Map;this.validEdges().forEach(o=>{if(o.edge.markers?.start){let r=Je(JSON.stringify(o.edge.markers.start));t.set(r,o.edge.markers.start)}if(o.edge.markers?.end){let r=Je(JSON.stringify(o.edge.markers.end));t.set(r,o.edge.markers.end)}});let n=this.connection().settings.marker;if(n){let o=Je(JSON.stringify(n));t.set(o,n)}return t}),this.entities=y(()=>[...this.nodes(),...this.edges()]),this.minimap=b(null)}getNode(t){return this.nodes().find(({rawNode:n})=>n.id===t)}getDetachedEdges(){return this.edges().filter(t=>t.detached())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();function Pi(e){let i={};return e.sourceHandle.rawHandle.type==="source"?(i.source=e.source,i.sourceHandle=e.sourceHandle):(i.source=e.target,i.sourceHandle=e.targetHandle),e.targetHandle.rawHandle.type==="target"?(i.target=e.target,i.targetHandle=e.targetHandle):(i.target=e.source,i.targetHandle=e.sourceHandle),i}var jn=(()=>{class e{constructor(){this.statusService=h(_e),this.flowEntitiesService=h(ie),this.onConnect=X(G(this.statusService.status).pipe(U(t=>t.state==="connection-end"),R(t=>Lo(t,this.isStrictMode())),te(()=>this.statusService.setIdleStatus()),U(t=>this.flowEntitiesService.connection().validator(t)))),this.onReconnect=X(G(this.statusService.status).pipe(U(t=>t.state==="reconnection-end"),R(t=>{let n=Lo(t,this.isStrictMode()),o=t.payload.oldEdge.edge;return{connection:n,oldEdge:o}}),te(()=>this.statusService.setIdleStatus()),U(({connection:t})=>this.flowEntitiesService.connection().validator(t)))),this.isStrictMode=y(()=>this.flowEntitiesService.connection().mode==="strict")}startConnection(t){this.statusService.setConnectionStartStatus(t.parentNode,t)}startReconnection(t,n){this.statusService.setReconnectionStartStatus(t.parentNode,t,n)}validateConnection(t){let n=this.statusService.status();if(n.state==="connection-start"||n.state==="reconnection-start"){let o=n.state==="reconnection-start",r=n.payload.source,s=t.parentNode,a=n.payload.sourceHandle,l=t;if(this.isStrictMode()){let d=Pi({source:n.payload.source,sourceHandle:n.payload.sourceHandle,target:t.parentNode,targetHandle:t});r=d.source,s=d.target,a=d.sourceHandle,l=d.targetHandle}let c=this.flowEntitiesService.connection().validator({source:r.rawNode.id,target:s.rawNode.id,sourceHandle:a.rawHandle.id,targetHandle:l.rawHandle.id});t.state.set(c?"valid":"invalid"),o?this.statusService.setReconnectionValidationStatus(c,n.payload.source,t.parentNode,n.payload.sourceHandle,t,n.payload.oldEdge):this.statusService.setConnectionValidationStatus(c,n.payload.source,t.parentNode,n.payload.sourceHandle,t)}}resetValidateConnection(t){t.state.set("idle");let n=this.statusService.status();(n.state==="connection-validation"||n.state==="reconnection-validation")&&(n.state==="reconnection-validation"?this.statusService.setReconnectionStartStatus(n.payload.source,n.payload.sourceHandle,n.payload.oldEdge):this.statusService.setConnectionStartStatus(n.payload.source,n.payload.sourceHandle))}endConnection(){let t=this.statusService.status();if(t.state==="connection-validation"||t.state==="reconnection-validation"){let n=t.state==="reconnection-validation",o=t.payload.source,r=t.payload.sourceHandle,s=t.payload.target,a=t.payload.targetHandle;n?this.statusService.setReconnectionEndStatus(o,s,r,a,t.payload.oldEdge):this.statusService.setConnectionEndStatus(o,s,r,a)}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["","onConnect",""],["","onReconnect",""]],outputs:{onConnect:"onConnect",onReconnect:"onReconnect"},standalone:!0})}}return e})();function Lo(e,i){let t=e.payload.source,n=e.payload.target,o=e.payload.sourceHandle,r=e.payload.targetHandle;if(i){let d=Pi({source:e.payload.source,sourceHandle:e.payload.sourceHandle,target:e.payload.target,targetHandle:e.payload.targetHandle});t=d.source,n=d.target,o=d.sourceHandle,r=d.targetHandle}let s=t.rawNode.id,a=n.rawNode.id,l=o.rawHandle.id,c=r.rawHandle.id;return{source:s,target:a,sourceHandle:l,targetHandle:c}}po();var st=(()=>{class e{constructor(){this.host=h(re).nativeElement,this.initialTouch$=new Ft,this.prevTouchEvent=null,this.mouseMovement$=Ge(this.host,"mousemove").pipe(R(t=>({x:t.clientX,y:t.clientY,movementX:t.movementX,movementY:t.movementY,target:t.target,originalEvent:t})),Ze(Ni),$t()),this.touchMovement$=me(this.initialTouch$,Ge(this.host,"touchmove")).pipe(te(t=>t.preventDefault()),R(t=>{let n=t.touches[0]?.clientX??0,o=t.touches[0]?.clientY??0,r=this.prevTouchEvent?t.touches[0].pageX-this.prevTouchEvent.touches[0].pageX:0,s=this.prevTouchEvent?t.touches[0].pageY-this.prevTouchEvent.touches[0].pageY:0,a=document.elementFromPoint(n,o);return{x:n,y:o,movementX:r,movementY:s,target:a,originalEvent:t}}),te(t=>this.prevTouchEvent=t.originalEvent),Ze(Ni),$t()),this.pointerMovement$=me(this.mouseMovement$,this.touchMovement$),this.touchEnd$=Ge(this.host,"touchend").pipe(R(t=>{let n=t.changedTouches[0]?.clientX??0,o=t.changedTouches[0]?.clientY??0,r=document.elementFromPoint(n,o);return{x:n,y:o,target:r,originalEvent:t}}),te(()=>this.prevTouchEvent=null),$t()),this.mouseUp$=Ge(this.host,"mouseup").pipe(R(t=>{let n=t.clientX,o=t.clientY,r=t.target;return{x:n,y:o,target:r,originalEvent:t}}),$t()),this.documentPointerEnd$=me(Ge(document,"mouseup"),Ge(document,"touchend")).pipe($t())}setInitialTouch(t){this.initialTouch$.next(t)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["svg","rootPointer",""]],standalone:!0})}}return e})();var Bo=(e,i)=>{let t=Math.max(0,Math.min(e.x+e.width,i.x+i.width)-Math.max(e.x,i.x)),n=Math.max(0,Math.min(e.y+e.height,i.y+i.height)-Math.max(e.y,i.y));return Math.ceil(t*n)};function Xn(e){if(e.length===0)return{x:0,y:0,width:0,height:0};let i={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(t=>{let n=fa(t);i=ga(i,n)}),ma(i)}function Go(e,i,t){let n=i.find(r=>r.rawNode.id===e);if(!n)return[];let o=sn(n);return i.filter(r=>{if(r.rawNode.id===e)return!1;let s=Bo(sn(r),o);return t?.partially?s>0:s>=o.width*o.height})}function fa(e){return{x:e.point().x,y:e.point().y,x2:e.point().x+e.size().width,y2:e.point().y+e.size().height}}function sn(e){return{x:e.globalPoint().x,y:e.globalPoint().y,width:e.width(),height:e.height()}}function ma({x:e,y:i,x2:t,y2:n}){return{x:e,y:i,width:t-e,height:n-i}}function ga(e,i){return{x:Math.min(e.x,i.x),y:Math.min(e.y,i.y),x2:Math.max(e.x2,i.x2),y2:Math.max(e.y2,i.y2)}}function jo(e,i,t,n,o,r){let s=i/(e.width*(1+r)),a=t/(e.height*(1+r)),l=Math.min(s,a),c=va(l,n,o),d=e.x+e.width/2,m=e.y+e.height/2,u=i/2-d*c,g=t/2-m*c;return{x:u,y:g,zoom:c}}function va(e,i=0,t=1){return Math.min(Math.max(e,i),t)}function xa(e,i,t){let n=e.zoom;return{x:-e.x/n,y:-e.y/n,width:i/n,height:t/n}}function Xo(e,i,t,n){let o=xa(i,t,n);return!(e.x+e.width<o.x||e.x>o.x+o.width||e.y+e.height<o.y||e.y>o.y+o.height)}var Yo={detachedGroupsLayer:!1,virtualization:!1,virtualizationZoomThreshold:.5,lazyLoadTrigger:"immediate"};var J=(()=>{class e{constructor(){this.entitiesSelectable=b(!0),this.elevateNodesOnSelect=b(!0),this.elevateEdgesOnSelect=b(!0),this.view=b([400,400]),this.computedFlowWidth=b(0),this.computedFlowHeight=b(0),this.minZoom=b(.5),this.maxZoom=b(3),this.background=b({type:"solid",color:"#fff"}),this.snapGrid=b([1,1]),this.optimization=b(Yo)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var De=(()=>{class e{constructor(){this.entitiesService=h(ie),this.flowSettingsService=h(J),this.writableViewport=b({changeType:"initial",state:e.getDefaultViewport(),duration:0}),this.readableViewport=b(e.getDefaultViewport()),this.viewportChangeEnd$=new Ft}static getDefaultViewport(){return{zoom:1,x:0,y:0}}fitView(t={padding:.1,duration:0,nodes:[]}){let n=this.getBoundsNodes(t.nodes??[]),o=jo(Xn(n),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom(),t.padding??.1),r=t.duration??0;this.writableViewport.set({changeType:"absolute",state:o,duration:r})}triggerViewportChangeEvent(t){t==="end"&&this.viewportChangeEnd$.next()}getBoundsNodes(t){return t?.length?t.map(n=>this.entitiesService.nodes().find(({rawNode:o})=>o.id===n)).filter(n=>!!n):this.entitiesService.nodes()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var Xt=e=>Math.round(e*100)/100;var at=(()=>{class e{constructor(){this.element=h(re).nativeElement}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["svg","rootSvgRef",""]],standalone:!0})}}return e})();var lt=(()=>{class e{constructor(){this.pointerMovementDirective=h(st),this.rootSvg=h(at).element,this.host=h(re).nativeElement,this.svgCurrentSpacePoint=y(()=>{let t=this.pointerMovement();return t?this.documentPointToFlowPoint({x:t.x,y:t.y}):{x:0,y:0}}),this.pointerMovement=Ln(this.pointerMovementDirective.pointerMovement$)}documentPointToFlowPoint(t){let n=this.rootSvg.createSVGPoint();return n.x=t.x,n.y=t.y,n.matrixTransform(this.host.getScreenCTM().inverse())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["g","spacePointContext",""]],standalone:!0})}}return e})();function Wo(e){return window.TouchEvent&&e instanceof TouchEvent}var Yt=(()=>{class e{constructor(){this.hostElement=h(re).nativeElement,this.pointerMovementDirective=h(st),this.pointerOver=nn(),this.pointerOut=nn(),this.pointerStart=nn(),this.pointerEnd=nn(),this.wasPointerOver=!1,this.touchEnd=this.pointerMovementDirective.touchEnd$.pipe(U(({target:t})=>t===this.hostElement),te(({originalEvent:t})=>this.pointerEnd.emit(t)),pe()).subscribe(),this.touchOverOut=this.pointerMovementDirective.touchMovement$.pipe(te(({target:t,originalEvent:n})=>{this.handleTouchOverAndOut(t,n)}),pe()).subscribe()}onPointerStart(t){this.pointerStart.emit(t),Wo(t)&&this.pointerMovementDirective.setInitialTouch(t)}onPointerEnd(t){this.pointerEnd.emit(t)}onMouseOver(t){this.pointerOver.emit(t)}onMouseOut(t){this.pointerOut.emit(t)}handleTouchOverAndOut(t,n){t===this.hostElement?(this.pointerOver.emit(n),this.wasPointerOver=!0):(this.wasPointerOver&&this.pointerOut.emit(n),this.wasPointerOver=!1)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["","pointerStart",""],["","pointerEnd",""],["","pointerOver",""],["","pointerOut",""]],hostBindings:function(n,o){n&1&&ne("mousedown",function(s){return o.onPointerStart(s)})("touchstart",function(s){return o.onPointerStart(s)})("mouseup",function(s){return o.onPointerEnd(s)})("mouseover",function(s){return o.onMouseOver(s)})("mouseout",function(s){return o.onMouseOut(s)})},outputs:{pointerOver:"pointerOver",pointerOut:"pointerOut",pointerStart:"pointerStart",pointerEnd:"pointerEnd"},standalone:!0})}}return e})();function Ce(e,i){return Math.ceil(e/i)*i}var ya=["resizer"],wa=["resizable",""],_a=["*"];function Ca(e,i){if(e&1){let t=ye();k(),I(0,"g")(1,"line",1),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("top",o))}),j(),I(2,"line",2),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("left",o))}),j(),I(3,"line",3),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("bottom",o))}),j(),I(4,"line",4),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("right",o))}),j(),I(5,"rect",5),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("top-left",o))}),j(),I(6,"rect",6),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("top-right",o))}),j(),I(7,"rect",7),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("bottom-left",o))}),j(),I(8,"rect",8),ne("pointerStart",function(o){Q(t);let r=f();return K(r.startResize("bottom-right",o))}),j()()}if(e&2){let t=f();_(),D("x1",t.lineGap)("y1",-t.gap())("x2",t.model.size().width-t.lineGap)("y2",-t.gap())("stroke",t.resizerColor()),_(),D("x1",-t.gap())("y1",t.lineGap)("x2",-t.gap())("y2",t.model.size().height-t.lineGap)("stroke",t.resizerColor()),_(),D("x1",t.lineGap)("y1",t.model.size().height+t.gap())("x2",t.model.size().width-t.lineGap)("y2",t.model.size().height+t.gap())("stroke",t.resizerColor()),_(),D("x1",t.model.size().width+t.gap())("y1",t.lineGap)("x2",t.model.size().width+t.gap())("y2",t.model.size().height-t.lineGap)("stroke",t.resizerColor()),_(),D("x",-(t.handleSize/2)-t.gap())("y",-(t.handleSize/2)-t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor()),_(),D("x",t.model.size().width-t.handleSize/2+t.gap())("y",-(t.handleSize/2)-t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor()),_(),D("x",-(t.handleSize/2)-t.gap())("y",t.model.size().height-t.handleSize/2+t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor()),_(),D("x",t.model.size().width-t.handleSize/2+t.gap())("y",t.model.size().height-t.handleSize/2+t.gap())("width",t.handleSize)("height",t.handleSize)("fill",t.resizerColor())}}var qo=(()=>{class e{get model(){return this.nodeAccessor.model()}constructor(){this.nodeAccessor=h(Ke),this.rootPointer=h(st),this.viewportService=h(De),this.spacePointContext=h(lt),this.settingsService=h(J),this.hostRef=h(re),this.resizable=B(),this.resizerColor=B("#2e414c"),this.gap=B(1.5),this.resizer=_t.required("resizer"),this.lineGap=3,this.handleSize=6,this.resizeSide=null,this.zoom=y(()=>this.viewportService.readableViewport().zoom??0),this.minWidth=0,this.minHeight=0,this.maxWidth=1/0,this.maxHeight=1/0,this.resizeOnGlobalMouseMove=this.rootPointer.pointerMovement$.pipe(U(()=>this.resizeSide!==null),U(t=>t.movementX!==0||t.movementY!==0),te(t=>this.resize(t)),pe()).subscribe(),this.endResizeOnGlobalMouseUp=this.rootPointer.documentPointerEnd$.pipe(te(()=>this.endResize()),pe()).subscribe(),Ve(()=>{let t=this.resizable();typeof t=="boolean"?this.model.resizable.set(t):this.model.resizable.set(!0)},{allowSignalWrites:!0})}ngOnInit(){this.model.controlledByResizer.set(!0),this.model.resizerTemplate.set(this.resizer())}ngOnDestroy(){this.model.controlledByResizer.set(!1)}ngAfterViewInit(){this.minWidth=+getComputedStyle(this.hostRef.nativeElement).minWidth.replace("px","")||0,this.minHeight=+getComputedStyle(this.hostRef.nativeElement).minHeight.replace("px","")||0,this.maxWidth=+getComputedStyle(this.hostRef.nativeElement).maxWidth.replace("px","")||1/0,this.maxHeight=+getComputedStyle(this.hostRef.nativeElement).maxHeight.replace("px","")||1/0}startResize(t,n){n.stopPropagation(),this.resizeSide=t,this.model.resizing.set(!0)}resize(t){if(!this.resizeSide)return;let n=Sa(t.movementX,t.movementY,this.zoom()),o=this.applyResize(this.resizeSide,this.model,n,this.getDistanceToEdge(t)),{x:r,y:s,width:a,height:l}=ba(o,this.model,this.resizeSide,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);this.model.setPoint({x:r,y:s}),this.model.width.set(a),this.model.height.set(l)}endResize(){this.resizeSide=null,this.model.resizing.set(!1)}getDistanceToEdge(t){let n=this.spacePointContext.documentPointToFlowPoint({x:t.x,y:t.y}),{x:o,y:r}=this.model.globalPoint();return{left:n.x-o,right:n.x-(o+this.model.width()),top:n.y-r,bottom:n.y-(r+this.model.height())}}applyResize(t,n,o,r){let{x:s,y:a}=n.point(),l=n.width(),c=n.height(),[d,m]=this.settingsService.snapGrid();switch(t){case"left":{let u=o.x+r.left,g=Ce(s+u,d),w=g-s;return{x:g,y:a,width:l-w,height:c}}case"right":{let u=o.x+r.right,g=Ce(l+u,d);return{x:s,y:a,width:g,height:c}}case"top":{let u=o.y+r.top,g=Ce(a+u,m),w=g-a;return{x:s,y:g,width:l,height:c-w}}case"bottom":{let u=o.y+r.bottom,g=Ce(c+u,m);return{x:s,y:a,width:l,height:g}}case"top-left":{let u=o.x+r.left,g=o.y+r.top,w=Ce(s+u,d),N=Ce(a+g,m),O=w-s,C=N-a;return{x:w,y:N,width:l-O,height:c-C}}case"top-right":{let u=o.x+r.right,g=o.y+r.top,w=Ce(a+g,m),N=w-a;return{x:s,y:w,width:Ce(l+u,d),height:c-N}}case"bottom-left":{let u=o.x+r.left,g=o.y+r.bottom,w=Ce(s+u,d),N=w-s;return{x:w,y:a,width:l-N,height:Ce(c+g,m)}}case"bottom-right":{let u=o.x+r.right,g=o.y+r.bottom;return{x:s,y:a,width:Ce(l+u,d),height:Ce(c+g,m)}}}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["","resizable",""]],viewQuery:function(n,o){n&1&&bt(o.resizer,ya,5),n&2&&Tt()},inputs:{resizable:[A.SignalBased,"resizable"],resizerColor:[A.SignalBased,"resizerColor"],gap:[A.SignalBased,"gap"]},standalone:!0,features:[le],attrs:wa,ngContentSelectors:_a,decls:3,vars:0,consts:[["resizer",""],["stroke-width","2",1,"top",3,"pointerStart"],["stroke-width","2",1,"left",3,"pointerStart"],["stroke-width","2",1,"bottom",3,"pointerStart"],["stroke-width","2",1,"right",3,"pointerStart"],[1,"top-left",3,"pointerStart"],[1,"top-right",3,"pointerStart"],[1,"bottom-left",3,"pointerStart"],[1,"bottom-right",3,"pointerStart"]],template:function(n,o){n&1&&(Fn(),F(0,Ca,9,40,"ng-template",null,0,Oo),Pn(2))},dependencies:[Yt],styles:[".top[_ngcontent-%COMP%]{cursor:n-resize}.left[_ngcontent-%COMP%]{cursor:w-resize}.right[_ngcontent-%COMP%]{cursor:e-resize}.bottom[_ngcontent-%COMP%]{cursor:s-resize}.top-left[_ngcontent-%COMP%]{cursor:nw-resize}.top-right[_ngcontent-%COMP%]{cursor:ne-resize}.bottom-left[_ngcontent-%COMP%]{cursor:sw-resize}.bottom-right[_ngcontent-%COMP%]{cursor:se-resize}"],changeDetection:0})}}return Jt([rn],e.prototype,"ngAfterViewInit",null),e})();function Sa(e,i,t){return{x:Xt(e/t),y:Xt(i/t)}}function ba(e,i,t,n,o,r,s){let{x:a,y:l,width:c,height:d}=e;c=Math.max(c,0),d=Math.max(d,0),c=Math.max(n,c),d=Math.max(o,d),c=Math.min(r,c),d=Math.min(s,d),a=Math.min(a,i.point().x+i.width()-n),l=Math.min(l,i.point().y+i.height()-o),a=Math.max(a,i.point().x+i.width()-r),l=Math.max(l,i.point().y+i.height()-s);let m=i.parent();if(m){let g=m.width(),w=m.height(),N=i.point().x,O=i.point().y;a=Math.max(a,0),l=Math.max(l,0),t.includes("left")&&a===0&&(c=Math.min(c,N+i.width())),t.includes("top")&&l===0&&(d=Math.min(d,O+i.height())),c=Math.min(c,g-a),d=Math.min(d,w-l)}let u=Xn(i.children());return u&&(t.includes("left")&&(a=Math.min(a,i.point().x+i.width()-(u.x+u.width)),c=Math.max(c,u.x+u.width)),t.includes("right")&&(c=Math.max(c,u.x+u.width)),t.includes("bottom")&&(d=Math.max(d,u.y+u.height)),t.includes("top")&&(l=Math.min(l,i.point().y+i.height()-(u.y+u.height)),d=Math.max(d,u.y+u.height))),{x:a,y:l,width:c,height:d}}var Yn="http://www.w3.org/1999/xhtml",Vi={svg:"http://www.w3.org/2000/svg",xhtml:Yn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function et(e){var i=e+="",t=i.indexOf(":");return t>=0&&(i=e.slice(0,t))!=="xmlns"&&(e=e.slice(t+1)),Vi.hasOwnProperty(i)?{space:Vi[i],local:e}:e}function Ta(e){return function(){var i=this.ownerDocument,t=this.namespaceURI;return t===Yn&&i.documentElement.namespaceURI===Yn?i.createElement(e):i.createElementNS(t,e)}}function Na(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Wn(e){var i=et(e);return(i.local?Na:Ta)(i)}function Ea(){}function Et(e){return e==null?Ea:function(){return this.querySelector(e)}}function Uo(e){typeof e!="function"&&(e=Et(e));for(var i=this._groups,t=i.length,n=new Array(t),o=0;o<t;++o)for(var r=i[o],s=r.length,a=n[o]=new Array(s),l,c,d=0;d<s;++d)(l=r[d])&&(c=e.call(l,l.__data__,d,r))&&("__data__"in l&&(c.__data__=l.__data__),a[d]=c);return new ce(n,this._parents)}function $i(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function za(){return[]}function an(e){return e==null?za:function(){return this.querySelectorAll(e)}}function Oa(e){return function(){return $i(e.apply(this,arguments))}}function Zo(e){typeof e=="function"?e=Oa(e):e=an(e);for(var i=this._groups,t=i.length,n=[],o=[],r=0;r<t;++r)for(var s=i[r],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(e.call(l,l.__data__,c,s)),o.push(l));return new ce(n,o)}function ln(e){return function(){return this.matches(e)}}function qn(e){return function(i){return i.matches(e)}}var ka=Array.prototype.find;function Da(e){return function(){return ka.call(this.children,e)}}function Ma(){return this.firstElementChild}function Qo(e){return this.select(e==null?Ma:Da(typeof e=="function"?e:qn(e)))}var Ra=Array.prototype.filter;function Ha(){return Array.from(this.children)}function Ia(e){return function(){return Ra.call(this.children,e)}}function Ko(e){return this.selectAll(e==null?Ha:Ia(typeof e=="function"?e:qn(e)))}function Jo(e){typeof e!="function"&&(e=ln(e));for(var i=this._groups,t=i.length,n=new Array(t),o=0;o<t;++o)for(var r=i[o],s=r.length,a=n[o]=[],l,c=0;c<s;++c)(l=r[c])&&e.call(l,l.__data__,c,r)&&a.push(l);return new ce(n,this._parents)}function Un(e){return new Array(e.length)}function er(){return new ce(this._enter||this._groups.map(Un),this._parents)}function cn(e,i){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=i}cn.prototype={constructor:cn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,i){return this._parent.insertBefore(e,i)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function tr(e){return function(){return e}}function Fa(e,i,t,n,o,r){for(var s=0,a,l=i.length,c=r.length;s<c;++s)(a=i[s])?(a.__data__=r[s],n[s]=a):t[s]=new cn(e,r[s]);for(;s<l;++s)(a=i[s])&&(o[s]=a)}function Pa(e,i,t,n,o,r,s){var a,l,c=new Map,d=i.length,m=r.length,u=new Array(d),g;for(a=0;a<d;++a)(l=i[a])&&(u[a]=g=s.call(l,l.__data__,a,i)+"",c.has(g)?o[a]=l:c.set(g,l));for(a=0;a<m;++a)g=s.call(e,r[a],a,r)+"",(l=c.get(g))?(n[a]=l,l.__data__=r[a],c.delete(g)):t[a]=new cn(e,r[a]);for(a=0;a<d;++a)(l=i[a])&&c.get(u[a])===l&&(o[a]=l)}function Va(e){return e.__data__}function nr(e,i){if(!arguments.length)return Array.from(this,Va);var t=i?Pa:Fa,n=this._parents,o=this._groups;typeof e!="function"&&(e=tr(e));for(var r=o.length,s=new Array(r),a=new Array(r),l=new Array(r),c=0;c<r;++c){var d=n[c],m=o[c],u=m.length,g=$a(e.call(d,d&&d.__data__,c,n)),w=g.length,N=a[c]=new Array(w),O=s[c]=new Array(w),C=l[c]=new Array(u);t(d,m,N,O,C,g,i);for(var ee=0,se=0,x,z;ee<w;++ee)if(x=N[ee]){for(ee>=se&&(se=ee+1);!(z=O[se])&&++se<w;);x._next=z||null}}return s=new ce(s,n),s._enter=a,s._exit=l,s}function $a(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ir(){return new ce(this._exit||this._groups.map(Un),this._parents)}function or(e,i,t){var n=this.enter(),o=this,r=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),i!=null&&(o=i(o),o&&(o=o.selection())),t==null?r.remove():t(r),n&&o?n.merge(o).order():o}function rr(e){for(var i=e.selection?e.selection():e,t=this._groups,n=i._groups,o=t.length,r=n.length,s=Math.min(o,r),a=new Array(o),l=0;l<s;++l)for(var c=t[l],d=n[l],m=c.length,u=a[l]=new Array(m),g,w=0;w<m;++w)(g=c[w]||d[w])&&(u[w]=g);for(;l<o;++l)a[l]=t[l];return new ce(a,this._parents)}function sr(){for(var e=this._groups,i=-1,t=e.length;++i<t;)for(var n=e[i],o=n.length-1,r=n[o],s;--o>=0;)(s=n[o])&&(r&&s.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(s,r),r=s);return this}function ar(e){e||(e=Aa);function i(m,u){return m&&u?e(m.__data__,u.__data__):!m-!u}for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r){for(var s=t[r],a=s.length,l=o[r]=new Array(a),c,d=0;d<a;++d)(c=s[d])&&(l[d]=c);l.sort(i)}return new ce(o,this._parents).order()}function Aa(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function lr(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function cr(){return Array.from(this)}function dr(){for(var e=this._groups,i=0,t=e.length;i<t;++i)for(var n=e[i],o=0,r=n.length;o<r;++o){var s=n[o];if(s)return s}return null}function ur(){let e=0;for(let i of this)++e;return e}function hr(){return!this.node()}function pr(e){for(var i=this._groups,t=0,n=i.length;t<n;++t)for(var o=i[t],r=0,s=o.length,a;r<s;++r)(a=o[r])&&e.call(a,a.__data__,r,o);return this}function La(e){return function(){this.removeAttribute(e)}}function Ba(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ga(e,i){return function(){this.setAttribute(e,i)}}function ja(e,i){return function(){this.setAttributeNS(e.space,e.local,i)}}function Xa(e,i){return function(){var t=i.apply(this,arguments);t==null?this.removeAttribute(e):this.setAttribute(e,t)}}function Ya(e,i){return function(){var t=i.apply(this,arguments);t==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,t)}}function fr(e,i){var t=et(e);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((i==null?t.local?Ba:La:typeof i=="function"?t.local?Ya:Xa:t.local?ja:Ga)(t,i))}function Zn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Wa(e){return function(){this.style.removeProperty(e)}}function qa(e,i,t){return function(){this.style.setProperty(e,i,t)}}function Ua(e,i,t){return function(){var n=i.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,t)}}function mr(e,i,t){return arguments.length>1?this.each((i==null?Wa:typeof i=="function"?Ua:qa)(e,i,t??"")):ct(this.node(),e)}function ct(e,i){return e.style.getPropertyValue(i)||Zn(e).getComputedStyle(e,null).getPropertyValue(i)}function Za(e){return function(){delete this[e]}}function Qa(e,i){return function(){this[e]=i}}function Ka(e,i){return function(){var t=i.apply(this,arguments);t==null?delete this[e]:this[e]=t}}function gr(e,i){return arguments.length>1?this.each((i==null?Za:typeof i=="function"?Ka:Qa)(e,i)):this.node()[e]}function vr(e){return e.trim().split(/^|\s+/)}function Ai(e){return e.classList||new xr(e)}function xr(e){this._node=e,this._names=vr(e.getAttribute("class")||"")}xr.prototype={add:function(e){var i=this._names.indexOf(e);i<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var i=this._names.indexOf(e);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function yr(e,i){for(var t=Ai(e),n=-1,o=i.length;++n<o;)t.add(i[n])}function wr(e,i){for(var t=Ai(e),n=-1,o=i.length;++n<o;)t.remove(i[n])}function Ja(e){return function(){yr(this,e)}}function el(e){return function(){wr(this,e)}}function tl(e,i){return function(){(i.apply(this,arguments)?yr:wr)(this,e)}}function _r(e,i){var t=vr(e+"");if(arguments.length<2){for(var n=Ai(this.node()),o=-1,r=t.length;++o<r;)if(!n.contains(t[o]))return!1;return!0}return this.each((typeof i=="function"?tl:i?Ja:el)(t,i))}function nl(){this.textContent=""}function il(e){return function(){this.textContent=e}}function ol(e){return function(){var i=e.apply(this,arguments);this.textContent=i??""}}function Cr(e){return arguments.length?this.each(e==null?nl:(typeof e=="function"?ol:il)(e)):this.node().textContent}function rl(){this.innerHTML=""}function sl(e){return function(){this.innerHTML=e}}function al(e){return function(){var i=e.apply(this,arguments);this.innerHTML=i??""}}function Sr(e){return arguments.length?this.each(e==null?rl:(typeof e=="function"?al:sl)(e)):this.node().innerHTML}function ll(){this.nextSibling&&this.parentNode.appendChild(this)}function br(){return this.each(ll)}function cl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Tr(){return this.each(cl)}function Nr(e){var i=typeof e=="function"?e:Wn(e);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function dl(){return null}function Er(e,i){var t=typeof e=="function"?e:Wn(e),n=i==null?dl:typeof i=="function"?i:Et(i);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function ul(){var e=this.parentNode;e&&e.removeChild(this)}function zr(){return this.each(ul)}function hl(){var e=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(e,this.nextSibling):e}function pl(){var e=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(e,this.nextSibling):e}function Or(e){return this.select(e?pl:hl)}function kr(e){return arguments.length?this.property("__data__",e):this.node().__data__}function fl(e){return function(i){e.call(this,i,this.__data__)}}function ml(e){return e.trim().split(/^|\s+/).map(function(i){var t="",n=i.indexOf(".");return n>=0&&(t=i.slice(n+1),i=i.slice(0,n)),{type:i,name:t}})}function gl(e){return function(){var i=this.__on;if(i){for(var t=0,n=-1,o=i.length,r;t<o;++t)r=i[t],(!e.type||r.type===e.type)&&r.name===e.name?this.removeEventListener(r.type,r.listener,r.options):i[++n]=r;++n?i.length=n:delete this.__on}}}function vl(e,i,t){return function(){var n=this.__on,o,r=fl(i);if(n){for(var s=0,a=n.length;s<a;++s)if((o=n[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=r,o.options=t),o.value=i;return}}this.addEventListener(e.type,r,t),o={type:e.type,name:e.name,value:i,listener:r,options:t},n?n.push(o):this.__on=[o]}}function Dr(e,i,t){var n=ml(e+""),o,r=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,d;l<c;++l)for(o=0,d=a[l];o<r;++o)if((s=n[o]).type===d.type&&s.name===d.name)return d.value}return}for(a=i?vl:gl,o=0;o<r;++o)this.each(a(n[o],i,t));return this}function Mr(e,i,t){var n=Zn(e),o=n.CustomEvent;typeof o=="function"?o=new o(i,t):(o=n.document.createEvent("Event"),t?(o.initEvent(i,t.bubbles,t.cancelable),o.detail=t.detail):o.initEvent(i,!1,!1)),e.dispatchEvent(o)}function xl(e,i){return function(){return Mr(this,e,i)}}function yl(e,i){return function(){return Mr(this,e,i.apply(this,arguments))}}function Rr(e,i){return this.each((typeof i=="function"?yl:xl)(e,i))}function*Hr(){for(var e=this._groups,i=0,t=e.length;i<t;++i)for(var n=e[i],o=0,r=n.length,s;o<r;++o)(s=n[o])&&(yield s)}var Li=[null];function ce(e,i){this._groups=e,this._parents=i}function Ir(){return new ce([[document.documentElement]],Li)}function wl(){return this}ce.prototype=Ir.prototype={constructor:ce,select:Uo,selectAll:Zo,selectChild:Qo,selectChildren:Ko,filter:Jo,data:nr,enter:er,exit:ir,join:or,merge:rr,selection:wl,order:sr,sort:ar,call:lr,nodes:cr,node:dr,size:ur,empty:hr,each:pr,attr:fr,style:mr,property:gr,classed:_r,text:Cr,html:Sr,raise:br,lower:Tr,append:Nr,insert:Er,remove:zr,clone:Or,datum:kr,on:Dr,dispatch:Rr,[Symbol.iterator]:Hr};var tt=Ir;function ge(e){return typeof e=="string"?new ce([[document.querySelector(e)]],[document.documentElement]):new ce([[e]],Li)}function Fr(e){let i;for(;i=e.sourceEvent;)e=i;return e}function He(e,i){if(e=Fr(e),i===void 0&&(i=e.currentTarget),i){var t=i.ownerSVGElement||i;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(i.getScreenCTM().inverse()),[n.x,n.y]}if(i.getBoundingClientRect){var o=i.getBoundingClientRect();return[e.clientX-o.left-i.clientLeft,e.clientY-o.top-i.clientTop]}}return[e.pageX,e.pageY]}var _l={value:()=>{}};function Vr(){for(var e=0,i=arguments.length,t={},n;e<i;++e){if(!(n=arguments[e]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new Qn(t)}function Qn(e){this._=e}function Cl(e,i){return e.trim().split(/^|\s+/).map(function(t){var n="",o=t.indexOf(".");if(o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}Qn.prototype=Vr.prototype={constructor:Qn,on:function(e,i){var t=this._,n=Cl(e+"",t),o,r=-1,s=n.length;if(arguments.length<2){for(;++r<s;)if((o=(e=n[r]).type)&&(o=Sl(t[o],e.name)))return o;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++r<s;)if(o=(e=n[r]).type)t[o]=Pr(t[o],e.name,i);else if(i==null)for(o in t)t[o]=Pr(t[o],e.name,null);return this},copy:function(){var e={},i=this._;for(var t in i)e[t]=i[t].slice();return new Qn(e)},call:function(e,i){if((o=arguments.length-2)>0)for(var t=new Array(o),n=0,o,r;n<o;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],n=0,o=r.length;n<o;++n)r[n].value.apply(i,t)},apply:function(e,i,t){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],o=0,r=n.length;o<r;++o)n[o].value.apply(i,t)}};function Sl(e,i){for(var t=0,n=e.length,o;t<n;++t)if((o=e[t]).name===i)return o.value}function Pr(e,i,t){for(var n=0,o=e.length;n<o;++n)if(e[n].name===i){e[n]=_l,e=e.slice(0,n).concat(e.slice(n+1));break}return t!=null&&e.push({name:i,value:t}),e}var zt=Vr;var $r={passive:!1},Ot={capture:!0,passive:!1};function Kn(e){e.stopImmediatePropagation()}function dt(e){e.preventDefault(),e.stopImmediatePropagation()}function dn(e){var i=e.document.documentElement,t=ge(e).on("dragstart.drag",dt,Ot);"onselectstart"in i?t.on("selectstart.drag",dt,Ot):(i.__noselect=i.style.MozUserSelect,i.style.MozUserSelect="none")}function un(e,i){var t=e.document.documentElement,n=ge(e).on("dragstart.drag",null);i&&(n.on("click.drag",dt,Ot),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}var hn=e=>()=>e;function pn(e,{sourceEvent:i,subject:t,target:n,identifier:o,active:r,x:s,y:a,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:i,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}pn.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function bl(e){return!e.ctrlKey&&!e.button}function Tl(){return this.parentNode}function Nl(e,i){return i??{x:e.x,y:e.y}}function El(){return navigator.maxTouchPoints||"ontouchstart"in this}function Jn(){var e=bl,i=Tl,t=Nl,n=El,o={},r=zt("start","drag","end"),s=0,a,l,c,d,m=0;function u(x){x.on("mousedown.drag",g).filter(n).on("touchstart.drag",O).on("touchmove.drag",C,$r).on("touchend.drag touchcancel.drag",ee).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(x,z){if(!(d||!e.call(this,x,z))){var H=se(this,i.call(this,x,z),x,z,"mouse");H&&(ge(x.view).on("mousemove.drag",w,Ot).on("mouseup.drag",N,Ot),dn(x.view),Kn(x),c=!1,a=x.clientX,l=x.clientY,H("start",x))}}function w(x){if(dt(x),!c){var z=x.clientX-a,H=x.clientY-l;c=z*z+H*H>m}o.mouse("drag",x)}function N(x){ge(x.view).on("mousemove.drag mouseup.drag",null),un(x.view,c),dt(x),o.mouse("end",x)}function O(x,z){if(e.call(this,x,z)){var H=x.changedTouches,$=i.call(this,x,z),fe=H.length,Se,ue;for(Se=0;Se<fe;++Se)(ue=se(this,$,x,z,H[Se].identifier,H[Se]))&&(Kn(x),ue("start",x,H[Se]))}}function C(x){var z=x.changedTouches,H=z.length,$,fe;for($=0;$<H;++$)(fe=o[z[$].identifier])&&(dt(x),fe("drag",x,z[$]))}function ee(x){var z=x.changedTouches,H=z.length,$,fe;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),$=0;$<H;++$)(fe=o[z[$].identifier])&&(Kn(x),fe("end",x,z[$]))}function se(x,z,H,$,fe,Se){var ue=r.copy(),he=He(Se||H,z),xt,yt,p;if((p=t.call(x,new pn("beforestart",{sourceEvent:H,target:u,identifier:fe,active:s,x:he[0],y:he[1],dx:0,dy:0,dispatch:ue}),$))!=null)return xt=p.x-he[0]||0,yt=p.y-he[1]||0,function S(v,T,M){var P=he,V;switch(v){case"start":o[fe]=S,V=s++;break;case"end":delete o[fe],--s;case"drag":he=He(M||T,z),V=s;break}ue.call(v,x,new pn(v,{sourceEvent:T,subject:p,target:u,identifier:fe,active:V,x:he[0]+xt,y:he[1]+yt,dx:he[0]-P[0],dy:he[1]-P[1],dispatch:ue}),$)}}return u.filter=function(x){return arguments.length?(e=typeof x=="function"?x:hn(!!x),u):e},u.container=function(x){return arguments.length?(i=typeof x=="function"?x:hn(x),u):i},u.subject=function(x){return arguments.length?(t=typeof x=="function"?x:hn(x),u):t},u.touchable=function(x){return arguments.length?(n=typeof x=="function"?x:hn(!!x),u):n},u.on=function(){var x=r.on.apply(r,arguments);return x===r?u:x},u.clickDistance=function(x){return arguments.length?(m=(x=+x)*x,u):Math.sqrt(m)},u}function ei(e,i,t){e.prototype=i.prototype=t,t.constructor=e}function Bi(e,i){var t=Object.create(e.prototype);for(var n in i)t[n]=i[n];return t}function gn(){}var fn=.7,ii=1/fn,Wt="\\s*([+-]?\\d+)\\s*",mn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zl=/^#([0-9a-f]{3,8})$/,Ol=new RegExp(`^rgb\\(${Wt},${Wt},${Wt}\\)$`),kl=new RegExp(`^rgb\\(${Ye},${Ye},${Ye}\\)$`),Dl=new RegExp(`^rgba\\(${Wt},${Wt},${Wt},${mn}\\)$`),Ml=new RegExp(`^rgba\\(${Ye},${Ye},${Ye},${mn}\\)$`),Rl=new RegExp(`^hsl\\(${mn},${Ye},${Ye}\\)$`),Hl=new RegExp(`^hsla\\(${mn},${Ye},${Ye},${mn}\\)$`),Ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ei(gn,ut,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Lr,formatHex:Lr,formatHex8:Il,formatHsl:Fl,formatRgb:Br,toString:Br});function Lr(){return this.rgb().formatHex()}function Il(){return this.rgb().formatHex8()}function Fl(){return qr(this).formatHsl()}function Br(){return this.rgb().formatRgb()}function ut(e){var i,t;return e=(e+"").trim().toLowerCase(),(i=zl.exec(e))?(t=i[1].length,i=parseInt(i[1],16),t===6?Gr(i):t===3?new ze(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):t===8?ti(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):t===4?ti(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=Ol.exec(e))?new ze(i[1],i[2],i[3],1):(i=kl.exec(e))?new ze(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=Dl.exec(e))?ti(i[1],i[2],i[3],i[4]):(i=Ml.exec(e))?ti(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=Rl.exec(e))?Yr(i[1],i[2]/100,i[3]/100,1):(i=Hl.exec(e))?Yr(i[1],i[2]/100,i[3]/100,i[4]):Ar.hasOwnProperty(e)?Gr(Ar[e]):e==="transparent"?new ze(NaN,NaN,NaN,0):null}function Gr(e){return new ze(e>>16&255,e>>8&255,e&255,1)}function ti(e,i,t,n){return n<=0&&(e=i=t=NaN),new ze(e,i,t,n)}function Pl(e){return e instanceof gn||(e=ut(e)),e?(e=e.rgb(),new ze(e.r,e.g,e.b,e.opacity)):new ze}function qt(e,i,t,n){return arguments.length===1?Pl(e):new ze(e,i,t,n??1)}function ze(e,i,t,n){this.r=+e,this.g=+i,this.b=+t,this.opacity=+n}ei(ze,qt,Bi(gn,{brighter(e){return e=e==null?ii:Math.pow(ii,e),new ze(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?fn:Math.pow(fn,e),new ze(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ze(Dt(this.r),Dt(this.g),Dt(this.b),oi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jr,formatHex:jr,formatHex8:Vl,formatRgb:Xr,toString:Xr}));function jr(){return`#${kt(this.r)}${kt(this.g)}${kt(this.b)}`}function Vl(){return`#${kt(this.r)}${kt(this.g)}${kt(this.b)}${kt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xr(){let e=oi(this.opacity);return`${e===1?"rgb(":"rgba("}${Dt(this.r)}, ${Dt(this.g)}, ${Dt(this.b)}${e===1?")":`, ${e})`}`}function oi(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Dt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function kt(e){return e=Dt(e),(e<16?"0":"")+e.toString(16)}function Yr(e,i,t,n){return n<=0?e=i=t=NaN:t<=0||t>=1?e=i=NaN:i<=0&&(e=NaN),new $e(e,i,t,n)}function qr(e){if(e instanceof $e)return new $e(e.h,e.s,e.l,e.opacity);if(e instanceof gn||(e=ut(e)),!e)return new $e;if(e instanceof $e)return e;e=e.rgb();var i=e.r/255,t=e.g/255,n=e.b/255,o=Math.min(i,t,n),r=Math.max(i,t,n),s=NaN,a=r-o,l=(r+o)/2;return a?(i===r?s=(t-n)/a+(t<n)*6:t===r?s=(n-i)/a+2:s=(i-t)/a+4,a/=l<.5?r+o:2-r-o,s*=60):a=l>0&&l<1?0:s,new $e(s,a,l,e.opacity)}function Ur(e,i,t,n){return arguments.length===1?qr(e):new $e(e,i,t,n??1)}function $e(e,i,t,n){this.h=+e,this.s=+i,this.l=+t,this.opacity=+n}ei($e,Ur,Bi(gn,{brighter(e){return e=e==null?ii:Math.pow(ii,e),new $e(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?fn:Math.pow(fn,e),new $e(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,i=isNaN(e)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*i,o=2*t-n;return new ze(Gi(e>=240?e-240:e+120,o,n),Gi(e,o,n),Gi(e<120?e+240:e-120,o,n),this.opacity)},clamp(){return new $e(Wr(this.h),ni(this.s),ni(this.l),oi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=oi(this.opacity);return`${e===1?"hsl(":"hsla("}${Wr(this.h)}, ${ni(this.s)*100}%, ${ni(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Wr(e){return e=(e||0)%360,e<0?e+360:e}function ni(e){return Math.max(0,Math.min(1,e||0))}function Gi(e,i,t){return(e<60?i+(t-i)*e/60:e<180?t:e<240?i+(t-i)*(240-e)/60:i)*255}function ji(e,i,t,n,o){var r=e*e,s=r*e;return((1-3*e+3*r-s)*i+(4-6*r+3*s)*t+(1+3*e+3*r-3*s)*n+s*o)/6}function Zr(e){var i=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,i-1):Math.floor(t*i),o=e[n],r=e[n+1],s=n>0?e[n-1]:2*o-r,a=n<i-1?e[n+2]:2*r-o;return ji((t-n/i)*i,s,o,r,a)}}function Qr(e){var i=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*i),o=e[(n+i-1)%i],r=e[n%i],s=e[(n+1)%i],a=e[(n+2)%i];return ji((t-n/i)*i,o,r,s,a)}}var Xi=e=>()=>e;function $l(e,i){return function(t){return e+t*i}}function Al(e,i,t){return e=Math.pow(e,t),i=Math.pow(i,t)-e,t=1/t,function(n){return Math.pow(e+n*i,t)}}function Kr(e){return(e=+e)==1?ri:function(i,t){return t-i?Al(i,t,e):Xi(isNaN(i)?t:i)}}function ri(e,i){var t=i-e;return t?$l(e,t):Xi(isNaN(e)?i:e)}var si=function e(i){var t=Kr(i);function n(o,r){var s=t((o=qt(o)).r,(r=qt(r)).r),a=t(o.g,r.g),l=t(o.b,r.b),c=ri(o.opacity,r.opacity);return function(d){return o.r=s(d),o.g=a(d),o.b=l(d),o.opacity=c(d),o+""}}return n.gamma=e,n}(1);function Jr(e){return function(i){var t=i.length,n=new Array(t),o=new Array(t),r=new Array(t),s,a;for(s=0;s<t;++s)a=qt(i[s]),n[s]=a.r||0,o[s]=a.g||0,r[s]=a.b||0;return n=e(n),o=e(o),r=e(r),a.opacity=1,function(l){return a.r=n(l),a.g=o(l),a.b=r(l),a+""}}}var Ll=Jr(Zr),Bl=Jr(Qr);function Ie(e,i){return e=+e,i=+i,function(t){return e*(1-t)+i*t}}var Wi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yi=new RegExp(Wi.source,"g");function Gl(e){return function(){return e}}function jl(e){return function(i){return e(i)+""}}function qi(e,i){var t=Wi.lastIndex=Yi.lastIndex=0,n,o,r,s=-1,a=[],l=[];for(e=e+"",i=i+"";(n=Wi.exec(e))&&(o=Yi.exec(i));)(r=o.index)>t&&(r=i.slice(t,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,l.push({i:s,x:Ie(n,o)})),t=Yi.lastIndex;return t<i.length&&(r=i.slice(t),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?jl(l[0].x):Gl(i):(i=l.length,function(c){for(var d=0,m;d<i;++d)a[(m=l[d]).i]=m.x(c);return a.join("")})}var es=180/Math.PI,ai={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ui(e,i,t,n,o,r){var s,a,l;return(s=Math.sqrt(e*e+i*i))&&(e/=s,i/=s),(l=e*t+i*n)&&(t-=e*l,n-=i*l),(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a,l/=a),e*n<i*t&&(e=-e,i=-i,l=-l,s=-s),{translateX:o,translateY:r,rotate:Math.atan2(i,e)*es,skewX:Math.atan(l)*es,scaleX:s,scaleY:a}}var li;function ts(e){let i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return i.isIdentity?ai:Ui(i.a,i.b,i.c,i.d,i.e,i.f)}function ns(e){return e==null?ai:(li||(li=document.createElementNS("http://www.w3.org/2000/svg","g")),li.setAttribute("transform",e),(e=li.transform.baseVal.consolidate())?(e=e.matrix,Ui(e.a,e.b,e.c,e.d,e.e,e.f)):ai)}function is(e,i,t,n){function o(c){return c.length?c.pop()+" ":""}function r(c,d,m,u,g,w){if(c!==m||d!==u){var N=g.push("translate(",null,i,null,t);w.push({i:N-4,x:Ie(c,m)},{i:N-2,x:Ie(d,u)})}else(m||u)&&g.push("translate("+m+i+u+t)}function s(c,d,m,u){c!==d?(c-d>180?d+=360:d-c>180&&(c+=360),u.push({i:m.push(o(m)+"rotate(",null,n)-2,x:Ie(c,d)})):d&&m.push(o(m)+"rotate("+d+n)}function a(c,d,m,u){c!==d?u.push({i:m.push(o(m)+"skewX(",null,n)-2,x:Ie(c,d)}):d&&m.push(o(m)+"skewX("+d+n)}function l(c,d,m,u,g,w){if(c!==m||d!==u){var N=g.push(o(g)+"scale(",null,",",null,")");w.push({i:N-4,x:Ie(c,m)},{i:N-2,x:Ie(d,u)})}else(m!==1||u!==1)&&g.push(o(g)+"scale("+m+","+u+")")}return function(c,d){var m=[],u=[];return c=e(c),d=e(d),r(c.translateX,c.translateY,d.translateX,d.translateY,m,u),s(c.rotate,d.rotate,m,u),a(c.skewX,d.skewX,m,u),l(c.scaleX,c.scaleY,d.scaleX,d.scaleY,m,u),c=d=null,function(g){for(var w=-1,N=u.length,O;++w<N;)m[(O=u[w]).i]=O.x(g);return m.join("")}}}var Zi=is(ts,"px, ","px)","deg)"),Qi=is(ns,", ",")",")");var Xl=1e-12;function os(e){return((e=Math.exp(e))+1/e)/2}function Yl(e){return((e=Math.exp(e))-1/e)/2}function Wl(e){return((e=Math.exp(2*e))-1)/(e+1)}var Ki=function e(i,t,n){function o(r,s){var a=r[0],l=r[1],c=r[2],d=s[0],m=s[1],u=s[2],g=d-a,w=m-l,N=g*g+w*w,O,C;if(N<Xl)C=Math.log(u/c)/i,O=function($){return[a+$*g,l+$*w,c*Math.exp(i*$*C)]};else{var ee=Math.sqrt(N),se=(u*u-c*c+n*N)/(2*c*t*ee),x=(u*u-c*c-n*N)/(2*u*t*ee),z=Math.log(Math.sqrt(se*se+1)-se),H=Math.log(Math.sqrt(x*x+1)-x);C=(H-z)/i,O=function($){var fe=$*C,Se=os(z),ue=c/(t*ee)*(Se*Wl(i*fe+z)-Yl(z));return[a+ue*g,l+ue*w,c*Se/os(i*fe+z)]}}return O.duration=C*1e3*i/Math.SQRT2,O}return o.rho=function(r){var s=Math.max(.001,+r),a=s*s,l=a*a;return e(s,a,l)},o}(Math.SQRT2,2,4);var Ut=0,xn=0,vn=0,ss=1e3,ci,yn,di=0,Mt=0,ui=0,wn=typeof performance=="object"&&performance.now?performance:Date,as=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Cn(){return Mt||(as(ql),Mt=wn.now()+ui)}function ql(){Mt=0}function _n(){this._call=this._time=this._next=null}_n.prototype=hi.prototype={constructor:_n,restart:function(e,i,t){if(typeof e!="function")throw new TypeError("callback is not a function");t=(t==null?Cn():+t)+(i==null?0:+i),!this._next&&yn!==this&&(yn?yn._next=this:ci=this,yn=this),this._call=e,this._time=t,Ji()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ji())}};function hi(e,i,t){var n=new _n;return n.restart(e,i,t),n}function ls(){Cn(),++Ut;for(var e=ci,i;e;)(i=Mt-e._time)>=0&&e._call.call(void 0,i),e=e._next;--Ut}function rs(){Mt=(di=wn.now())+ui,Ut=xn=0;try{ls()}finally{Ut=0,Zl(),Mt=0}}function Ul(){var e=wn.now(),i=e-di;i>ss&&(ui-=i,di=e)}function Zl(){for(var e,i=ci,t,n=1/0;i;)i._call?(n>i._time&&(n=i._time),e=i,i=i._next):(t=i._next,i._next=null,i=e?e._next=t:ci=t);yn=e,Ji(n)}function Ji(e){if(!Ut){xn&&(xn=clearTimeout(xn));var i=e-Mt;i>24?(e<1/0&&(xn=setTimeout(rs,e-wn.now()-ui)),vn&&(vn=clearInterval(vn))):(vn||(di=wn.now(),vn=setInterval(Ul,ss)),Ut=1,as(rs))}}function pi(e,i,t){var n=new _n;return i=i==null?0:+i,n.restart(o=>{n.stop(),e(o+i)},i,t),n}var Ql=zt("start","end","cancel","interrupt"),Kl=[],us=0,cs=1,mi=2,fi=3,ds=4,gi=5,Sn=6;function ht(e,i,t,n,o,r){var s=e.__transition;if(!s)e.__transition={};else if(t in s)return;Jl(e,t,{name:i,index:n,group:o,on:Ql,tween:Kl,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:us})}function bn(e,i){var t=ve(e,i);if(t.state>us)throw new Error("too late; already scheduled");return t}function we(e,i){var t=ve(e,i);if(t.state>fi)throw new Error("too late; already running");return t}function ve(e,i){var t=e.__transition;if(!t||!(t=t[i]))throw new Error("transition not found");return t}function Jl(e,i,t){var n=e.__transition,o;n[i]=t,t.timer=hi(r,0,t.time);function r(c){t.state=cs,t.timer.restart(s,t.delay,t.time),t.delay<=c&&s(c-t.delay)}function s(c){var d,m,u,g;if(t.state!==cs)return l();for(d in n)if(g=n[d],g.name===t.name){if(g.state===fi)return pi(s);g.state===ds?(g.state=Sn,g.timer.stop(),g.on.call("interrupt",e,e.__data__,g.index,g.group),delete n[d]):+d<i&&(g.state=Sn,g.timer.stop(),g.on.call("cancel",e,e.__data__,g.index,g.group),delete n[d])}if(pi(function(){t.state===fi&&(t.state=ds,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=mi,t.on.call("start",e,e.__data__,t.index,t.group),t.state===mi){for(t.state=fi,o=new Array(u=t.tween.length),d=0,m=-1;d<u;++d)(g=t.tween[d].value.call(e,e.__data__,t.index,t.group))&&(o[++m]=g);o.length=m+1}}function a(c){for(var d=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=gi,1),m=-1,u=o.length;++m<u;)o[m].call(e,d);t.state===gi&&(t.on.call("end",e,e.__data__,t.index,t.group),l())}function l(){t.state=Sn,t.timer.stop(),delete n[i];for(var c in n)return;delete e.__transition}}function Rt(e,i){var t=e.__transition,n,o,r=!0,s;if(t){i=i==null?null:i+"";for(s in t){if((n=t[s]).name!==i){r=!1;continue}o=n.state>mi&&n.state<gi,n.state=Sn,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete t[s]}r&&delete e.__transition}}function hs(e){return this.each(function(){Rt(this,e)})}function ec(e,i){var t,n;return function(){var o=we(this,e),r=o.tween;if(r!==t){n=t=r;for(var s=0,a=n.length;s<a;++s)if(n[s].name===i){n=n.slice(),n.splice(s,1);break}}o.tween=n}}function tc(e,i,t){var n,o;if(typeof t!="function")throw new Error;return function(){var r=we(this,e),s=r.tween;if(s!==n){o=(n=s).slice();for(var a={name:i,value:t},l=0,c=o.length;l<c;++l)if(o[l].name===i){o[l]=a;break}l===c&&o.push(a)}r.tween=o}}function ps(e,i){var t=this._id;if(e+="",arguments.length<2){for(var n=ve(this.node(),t).tween,o=0,r=n.length,s;o<r;++o)if((s=n[o]).name===e)return s.value;return null}return this.each((i==null?ec:tc)(t,e,i))}function Zt(e,i,t){var n=e._id;return e.each(function(){var o=we(this,n);(o.value||(o.value={}))[i]=t.apply(this,arguments)}),function(o){return ve(o,n).value[i]}}function vi(e,i){var t;return(typeof i=="number"?Ie:i instanceof ut?si:(t=ut(i))?(i=t,si):qi)(e,i)}function nc(e){return function(){this.removeAttribute(e)}}function ic(e){return function(){this.removeAttributeNS(e.space,e.local)}}function oc(e,i,t){var n,o=t+"",r;return function(){var s=this.getAttribute(e);return s===o?null:s===n?r:r=i(n=s,t)}}function rc(e,i,t){var n,o=t+"",r;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===n?r:r=i(n=s,t)}}function sc(e,i,t){var n,o,r;return function(){var s,a=t(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===n&&l===o?r:(o=l,r=i(n=s,a)))}}function ac(e,i,t){var n,o,r;return function(){var s,a=t(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===n&&l===o?r:(o=l,r=i(n=s,a)))}}function fs(e,i){var t=et(e),n=t==="transform"?Qi:vi;return this.attrTween(e,typeof i=="function"?(t.local?ac:sc)(t,n,Zt(this,"attr."+e,i)):i==null?(t.local?ic:nc)(t):(t.local?rc:oc)(t,n,i))}function lc(e,i){return function(t){this.setAttribute(e,i.call(this,t))}}function cc(e,i){return function(t){this.setAttributeNS(e.space,e.local,i.call(this,t))}}function dc(e,i){var t,n;function o(){var r=i.apply(this,arguments);return r!==n&&(t=(n=r)&&cc(e,r)),t}return o._value=i,o}function uc(e,i){var t,n;function o(){var r=i.apply(this,arguments);return r!==n&&(t=(n=r)&&lc(e,r)),t}return o._value=i,o}function ms(e,i){var t="attr."+e;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(i==null)return this.tween(t,null);if(typeof i!="function")throw new Error;var n=et(e);return this.tween(t,(n.local?dc:uc)(n,i))}function hc(e,i){return function(){bn(this,e).delay=+i.apply(this,arguments)}}function pc(e,i){return i=+i,function(){bn(this,e).delay=i}}function gs(e){var i=this._id;return arguments.length?this.each((typeof e=="function"?hc:pc)(i,e)):ve(this.node(),i).delay}function fc(e,i){return function(){we(this,e).duration=+i.apply(this,arguments)}}function mc(e,i){return i=+i,function(){we(this,e).duration=i}}function vs(e){var i=this._id;return arguments.length?this.each((typeof e=="function"?fc:mc)(i,e)):ve(this.node(),i).duration}function gc(e,i){if(typeof i!="function")throw new Error;return function(){we(this,e).ease=i}}function xs(e){var i=this._id;return arguments.length?this.each(gc(i,e)):ve(this.node(),i).ease}function vc(e,i){return function(){var t=i.apply(this,arguments);if(typeof t!="function")throw new Error;we(this,e).ease=t}}function ys(e){if(typeof e!="function")throw new Error;return this.each(vc(this._id,e))}function ws(e){typeof e!="function"&&(e=ln(e));for(var i=this._groups,t=i.length,n=new Array(t),o=0;o<t;++o)for(var r=i[o],s=r.length,a=n[o]=[],l,c=0;c<s;++c)(l=r[c])&&e.call(l,l.__data__,c,r)&&a.push(l);return new Ne(n,this._parents,this._name,this._id)}function _s(e){if(e._id!==this._id)throw new Error;for(var i=this._groups,t=e._groups,n=i.length,o=t.length,r=Math.min(n,o),s=new Array(n),a=0;a<r;++a)for(var l=i[a],c=t[a],d=l.length,m=s[a]=new Array(d),u,g=0;g<d;++g)(u=l[g]||c[g])&&(m[g]=u);for(;a<n;++a)s[a]=i[a];return new Ne(s,this._parents,this._name,this._id)}function xc(e){return(e+"").trim().split(/^|\s+/).every(function(i){var t=i.indexOf(".");return t>=0&&(i=i.slice(0,t)),!i||i==="start"})}function yc(e,i,t){var n,o,r=xc(i)?bn:we;return function(){var s=r(this,e),a=s.on;a!==n&&(o=(n=a).copy()).on(i,t),s.on=o}}function Cs(e,i){var t=this._id;return arguments.length<2?ve(this.node(),t).on.on(e):this.each(yc(t,e,i))}function wc(e){return function(){var i=this.parentNode;for(var t in this.__transition)if(+t!==e)return;i&&i.removeChild(this)}}function Ss(){return this.on("end.remove",wc(this._id))}function bs(e){var i=this._name,t=this._id;typeof e!="function"&&(e=Et(e));for(var n=this._groups,o=n.length,r=new Array(o),s=0;s<o;++s)for(var a=n[s],l=a.length,c=r[s]=new Array(l),d,m,u=0;u<l;++u)(d=a[u])&&(m=e.call(d,d.__data__,u,a))&&("__data__"in d&&(m.__data__=d.__data__),c[u]=m,ht(c[u],i,t,u,c,ve(d,t)));return new Ne(r,this._parents,i,t)}function Ts(e){var i=this._name,t=this._id;typeof e!="function"&&(e=an(e));for(var n=this._groups,o=n.length,r=[],s=[],a=0;a<o;++a)for(var l=n[a],c=l.length,d,m=0;m<c;++m)if(d=l[m]){for(var u=e.call(d,d.__data__,m,l),g,w=ve(d,t),N=0,O=u.length;N<O;++N)(g=u[N])&&ht(g,i,t,N,u,w);r.push(u),s.push(d)}return new Ne(r,s,i,t)}var _c=tt.prototype.constructor;function Ns(){return new _c(this._groups,this._parents)}function Cc(e,i){var t,n,o;return function(){var r=ct(this,e),s=(this.style.removeProperty(e),ct(this,e));return r===s?null:r===t&&s===n?o:o=i(t=r,n=s)}}function Es(e){return function(){this.style.removeProperty(e)}}function Sc(e,i,t){var n,o=t+"",r;return function(){var s=ct(this,e);return s===o?null:s===n?r:r=i(n=s,t)}}function bc(e,i,t){var n,o,r;return function(){var s=ct(this,e),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),ct(this,e))),s===l?null:s===n&&l===o?r:(o=l,r=i(n=s,a))}}function Tc(e,i){var t,n,o,r="style."+i,s="end."+r,a;return function(){var l=we(this,e),c=l.on,d=l.value[r]==null?a||(a=Es(i)):void 0;(c!==t||o!==d)&&(n=(t=c).copy()).on(s,o=d),l.on=n}}function zs(e,i,t){var n=(e+="")=="transform"?Zi:vi;return i==null?this.styleTween(e,Cc(e,n)).on("end.style."+e,Es(e)):typeof i=="function"?this.styleTween(e,bc(e,n,Zt(this,"style."+e,i))).each(Tc(this._id,e)):this.styleTween(e,Sc(e,n,i),t).on("end.style."+e,null)}function Nc(e,i,t){return function(n){this.style.setProperty(e,i.call(this,n),t)}}function Ec(e,i,t){var n,o;function r(){var s=i.apply(this,arguments);return s!==o&&(n=(o=s)&&Nc(e,s,t)),n}return r._value=i,r}function Os(e,i,t){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(i==null)return this.tween(n,null);if(typeof i!="function")throw new Error;return this.tween(n,Ec(e,i,t??""))}function zc(e){return function(){this.textContent=e}}function Oc(e){return function(){var i=e(this);this.textContent=i??""}}function ks(e){return this.tween("text",typeof e=="function"?Oc(Zt(this,"text",e)):zc(e==null?"":e+""))}function kc(e){return function(i){this.textContent=e.call(this,i)}}function Dc(e){var i,t;function n(){var o=e.apply(this,arguments);return o!==t&&(i=(t=o)&&kc(o)),i}return n._value=e,n}function Ds(e){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Dc(e))}function Ms(){for(var e=this._name,i=this._id,t=xi(),n=this._groups,o=n.length,r=0;r<o;++r)for(var s=n[r],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var d=ve(l,i);ht(l,e,t,c,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Ne(n,this._parents,e,t)}function Rs(){var e,i,t=this,n=t._id,o=t.size();return new Promise(function(r,s){var a={value:s},l={value:function(){--o===0&&r()}};t.each(function(){var c=we(this,n),d=c.on;d!==e&&(i=(e=d).copy(),i._.cancel.push(a),i._.interrupt.push(a),i._.end.push(l)),c.on=i}),o===0&&r()})}var Mc=0;function Ne(e,i,t,n){this._groups=e,this._parents=i,this._name=t,this._id=n}function Hs(e){return tt().transition(e)}function xi(){return++Mc}var nt=tt.prototype;Ne.prototype=Hs.prototype={constructor:Ne,select:bs,selectAll:Ts,selectChild:nt.selectChild,selectChildren:nt.selectChildren,filter:ws,merge:_s,selection:Ns,transition:Ms,call:nt.call,nodes:nt.nodes,node:nt.node,size:nt.size,empty:nt.empty,each:nt.each,on:Cs,attr:fs,attrTween:ms,style:zs,styleTween:Os,text:ks,textTween:Ds,remove:Ss,tween:ps,delay:gs,duration:vs,ease:xs,easeVarying:ys,end:Rs,[Symbol.iterator]:nt[Symbol.iterator]};function yi(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Rc={time:null,delay:0,duration:250,ease:yi};function Hc(e,i){for(var t;!(t=e.__transition)||!(t=t[i]);)if(!(e=e.parentNode))throw new Error(`transition ${i} not found`);return t}function Is(e){var i,t;e instanceof Ne?(i=e._id,e=e._name):(i=xi(),(t=Rc).time=Cn(),e=e==null?null:e+"");for(var n=this._groups,o=n.length,r=0;r<o;++r)for(var s=n[r],a=s.length,l,c=0;c<a;++c)(l=s[c])&&ht(l,e,i,c,s,t||Hc(l,i));return new Ne(n,this._parents,e,i)}tt.prototype.interrupt=hs;tt.prototype.transition=Is;var Tn=e=>()=>e;function eo(e,{sourceEvent:i,target:t,transform:n,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:i,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:o}})}function Ae(e,i,t){this.k=e,this.x=i,this.y=t}Ae.prototype={constructor:Ae,scale:function(e){return e===1?this:new Ae(this.k*e,this.x,this.y)},translate:function(e,i){return e===0&i===0?this:new Ae(this.k,this.x+this.k*e,this.y+this.k*i)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var pt=new Ae(1,0,0);to.prototype=Ae.prototype;function to(e){for(;!e.__zoom;)if(!(e=e.parentNode))return pt;return e.__zoom}function wi(e){e.stopImmediatePropagation()}function Qt(e){e.preventDefault(),e.stopImmediatePropagation()}function Ic(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Fc(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Fs(){return this.__zoom||pt}function Pc(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Vc(){return navigator.maxTouchPoints||"ontouchstart"in this}function $c(e,i,t){var n=e.invertX(i[0][0])-t[0][0],o=e.invertX(i[1][0])-t[1][0],r=e.invertY(i[0][1])-t[0][1],s=e.invertY(i[1][1])-t[1][1];return e.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}function no(){var e=Ic,i=Fc,t=$c,n=Pc,o=Vc,r=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Ki,c=zt("start","zoom","end"),d,m,u,g=500,w=150,N=0,O=10;function C(p){p.property("__zoom",Fs).on("wheel.zoom",fe,{passive:!1}).on("mousedown.zoom",Se).on("dblclick.zoom",ue).filter(o).on("touchstart.zoom",he).on("touchmove.zoom",xt).on("touchend.zoom touchcancel.zoom",yt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}C.transform=function(p,S,v,T){var M=p.selection?p.selection():p;M.property("__zoom",Fs),p!==M?z(p,S,v,T):M.interrupt().each(function(){H(this,arguments).event(T).start().zoom(null,typeof S=="function"?S.apply(this,arguments):S).end()})},C.scaleBy=function(p,S,v,T){C.scaleTo(p,function(){var M=this.__zoom.k,P=typeof S=="function"?S.apply(this,arguments):S;return M*P},v,T)},C.scaleTo=function(p,S,v,T){C.transform(p,function(){var M=i.apply(this,arguments),P=this.__zoom,V=v==null?x(M):typeof v=="function"?v.apply(this,arguments):v,oe=P.invert(V),de=typeof S=="function"?S.apply(this,arguments):S;return t(se(ee(P,de),V,oe),M,s)},v,T)},C.translateBy=function(p,S,v,T){C.transform(p,function(){return t(this.__zoom.translate(typeof S=="function"?S.apply(this,arguments):S,typeof v=="function"?v.apply(this,arguments):v),i.apply(this,arguments),s)},null,T)},C.translateTo=function(p,S,v,T,M){C.transform(p,function(){var P=i.apply(this,arguments),V=this.__zoom,oe=T==null?x(P):typeof T=="function"?T.apply(this,arguments):T;return t(pt.translate(oe[0],oe[1]).scale(V.k).translate(typeof S=="function"?-S.apply(this,arguments):-S,typeof v=="function"?-v.apply(this,arguments):-v),P,s)},T,M)};function ee(p,S){return S=Math.max(r[0],Math.min(r[1],S)),S===p.k?p:new Ae(S,p.x,p.y)}function se(p,S,v){var T=S[0]-v[0]*p.k,M=S[1]-v[1]*p.k;return T===p.x&&M===p.y?p:new Ae(p.k,T,M)}function x(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function z(p,S,v,T){p.on("start.zoom",function(){H(this,arguments).event(T).start()}).on("interrupt.zoom end.zoom",function(){H(this,arguments).event(T).end()}).tween("zoom",function(){var M=this,P=arguments,V=H(M,P).event(T),oe=i.apply(M,P),de=v==null?x(oe):typeof v=="function"?v.apply(M,P):v,Be=Math.max(oe[1][0]-oe[0][0],oe[1][1]-oe[0][1]),xe=M.__zoom,Fe=typeof S=="function"?S.apply(M,P):S,qe=l(xe.invert(de).concat(Be/xe.k),Fe.invert(de).concat(Be/Fe.k));return function(Pe){if(Pe===1)Pe=Fe;else{var Ue=qe(Pe),Ti=Be/Ue[2];Pe=new Ae(Ti,de[0]-Ue[0]*Ti,de[1]-Ue[1]*Ti)}V.zoom(null,Pe)}})}function H(p,S,v){return!v&&p.__zooming||new $(p,S)}function $(p,S){this.that=p,this.args=S,this.active=0,this.sourceEvent=null,this.extent=i.apply(p,S),this.taps=0}$.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,S){return this.mouse&&p!=="mouse"&&(this.mouse[1]=S.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=S.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=S.invert(this.touch1[0])),this.that.__zoom=S,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var S=ge(this.that).datum();c.call(p,this.that,new eo(p,{sourceEvent:this.sourceEvent,target:C,type:p,transform:this.that.__zoom,dispatch:c}),S)}};function fe(p,...S){if(!e.apply(this,arguments))return;var v=H(this,S).event(p),T=this.__zoom,M=Math.max(r[0],Math.min(r[1],T.k*Math.pow(2,n.apply(this,arguments)))),P=He(p);if(v.wheel)(v.mouse[0][0]!==P[0]||v.mouse[0][1]!==P[1])&&(v.mouse[1]=T.invert(v.mouse[0]=P)),clearTimeout(v.wheel);else{if(T.k===M)return;v.mouse=[P,T.invert(P)],Rt(this),v.start()}Qt(p),v.wheel=setTimeout(V,w),v.zoom("mouse",t(se(ee(T,M),v.mouse[0],v.mouse[1]),v.extent,s));function V(){v.wheel=null,v.end()}}function Se(p,...S){if(u||!e.apply(this,arguments))return;var v=p.currentTarget,T=H(this,S,!0).event(p),M=ge(p.view).on("mousemove.zoom",de,!0).on("mouseup.zoom",Be,!0),P=He(p,v),V=p.clientX,oe=p.clientY;dn(p.view),wi(p),T.mouse=[P,this.__zoom.invert(P)],Rt(this),T.start();function de(xe){if(Qt(xe),!T.moved){var Fe=xe.clientX-V,qe=xe.clientY-oe;T.moved=Fe*Fe+qe*qe>N}T.event(xe).zoom("mouse",t(se(T.that.__zoom,T.mouse[0]=He(xe,v),T.mouse[1]),T.extent,s))}function Be(xe){M.on("mousemove.zoom mouseup.zoom",null),un(xe.view,T.moved),Qt(xe),T.event(xe).end()}}function ue(p,...S){if(e.apply(this,arguments)){var v=this.__zoom,T=He(p.changedTouches?p.changedTouches[0]:p,this),M=v.invert(T),P=v.k*(p.shiftKey?.5:2),V=t(se(ee(v,P),T,M),i.apply(this,S),s);Qt(p),a>0?ge(this).transition().duration(a).call(z,V,T,p):ge(this).call(C.transform,V,T,p)}}function he(p,...S){if(e.apply(this,arguments)){var v=p.touches,T=v.length,M=H(this,S,p.changedTouches.length===T).event(p),P,V,oe,de;for(wi(p),V=0;V<T;++V)oe=v[V],de=He(oe,this),de=[de,this.__zoom.invert(de),oe.identifier],M.touch0?!M.touch1&&M.touch0[2]!==de[2]&&(M.touch1=de,M.taps=0):(M.touch0=de,P=!0,M.taps=1+!!d);d&&(d=clearTimeout(d)),P&&(M.taps<2&&(m=de[0],d=setTimeout(function(){d=null},g)),Rt(this),M.start())}}function xt(p,...S){if(this.__zooming){var v=H(this,S).event(p),T=p.changedTouches,M=T.length,P,V,oe,de;for(Qt(p),P=0;P<M;++P)V=T[P],oe=He(V,this),v.touch0&&v.touch0[2]===V.identifier?v.touch0[0]=oe:v.touch1&&v.touch1[2]===V.identifier&&(v.touch1[0]=oe);if(V=v.that.__zoom,v.touch1){var Be=v.touch0[0],xe=v.touch0[1],Fe=v.touch1[0],qe=v.touch1[1],Pe=(Pe=Fe[0]-Be[0])*Pe+(Pe=Fe[1]-Be[1])*Pe,Ue=(Ue=qe[0]-xe[0])*Ue+(Ue=qe[1]-xe[1])*Ue;V=ee(V,Math.sqrt(Pe/Ue)),oe=[(Be[0]+Fe[0])/2,(Be[1]+Fe[1])/2],de=[(xe[0]+qe[0])/2,(xe[1]+qe[1])/2]}else if(v.touch0)oe=v.touch0[0],de=v.touch0[1];else return;v.zoom("touch",t(se(V,oe,de),v.extent,s))}}function yt(p,...S){if(this.__zooming){var v=H(this,S).event(p),T=p.changedTouches,M=T.length,P,V;for(wi(p),u&&clearTimeout(u),u=setTimeout(function(){u=null},g),P=0;P<M;++P)V=T[P],v.touch0&&v.touch0[2]===V.identifier?delete v.touch0:v.touch1&&v.touch1[2]===V.identifier&&delete v.touch1;if(v.touch1&&!v.touch0&&(v.touch0=v.touch1,delete v.touch1),v.touch0)v.touch0[1]=this.__zoom.invert(v.touch0[0]);else if(v.end(),v.taps===2&&(V=He(V,this),Math.hypot(m[0]-V[0],m[1]-V[1])<O)){var oe=ge(this).on("dblclick.zoom");oe&&oe.apply(this,arguments)}}}return C.wheelDelta=function(p){return arguments.length?(n=typeof p=="function"?p:Tn(+p),C):n},C.filter=function(p){return arguments.length?(e=typeof p=="function"?p:Tn(!!p),C):e},C.touchable=function(p){return arguments.length?(o=typeof p=="function"?p:Tn(!!p),C):o},C.extent=function(p){return arguments.length?(i=typeof p=="function"?p:Tn([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),C):i},C.scaleExtent=function(p){return arguments.length?(r[0]=+p[0],r[1]=+p[1],C):[r[0],r[1]]},C.translateExtent=function(p){return arguments.length?(s[0][0]=+p[0][0],s[1][0]=+p[1][0],s[0][1]=+p[0][1],s[1][1]=+p[1][1],C):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},C.constrain=function(p){return arguments.length?(t=p,C):t},C.duration=function(p){return arguments.length?(a=+p,C):a},C.interpolate=function(p){return arguments.length?(l=p,C):l},C.on=function(){var p=c.on.apply(c,arguments);return p===c?C:p},C.clickDistance=function(p){return arguments.length?(N=(p=+p)*p,C):Math.sqrt(N)},C.tapDistance=function(p){return arguments.length?(O=+p,C):O},C}function We(e){return e!==void 0}function io(){let e=window.navigator.userAgent.toLowerCase(),i=/(macintosh|macintel|macppc|mac68k|macos)/i,t=/(win32|win64|windows|wince)/i,n=/(iphone|ipad|ipod)/i,o=null;return i.test(e)?o="macos":n.test(e)?o="ios":t.test(e)?o="windows":/android/.test(e)?o="android":!o&&/linux/.test(e)&&(o="linux"),o}var Nn=(()=>{class e{constructor(){this.actions=b({multiSelection:[io()==="macos"?"MetaLeft":"ControlLeft",io()==="macos"?"MetaRight":"ControlRight"]}),this.actionsActive={multiSelection:!1},G(this.actions).pipe(be(()=>me(Ge(document,"keydown").pipe(te(t=>{for(let n in this.actions())(this.actions()[n]??[]).includes(t.code)&&(this.actionsActive[n]=!0)})),Ge(document,"keyup").pipe(te(t=>{for(let n in this.actions())(this.actions()[n]??[]).includes(t.code)&&(this.actionsActive[n]=!1)})))),pe()).subscribe()}setShortcuts(t){this.actions.update(n=>Ee(Ee({},n),t))}isActiveAction(t){return this.actionsActive[t]}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var ft=(()=>{class e{constructor(){this.flowEntitiesService=h(ie),this.keyboardService=h(Nn),this.viewport$=new Ft,this.resetSelection=this.viewport$.pipe(te(({start:t,end:n,target:o})=>{if(t&&n&&o){let r=e.delta,s=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y),l=s<r&&a<r,c=!o.closest(".selectable");l&&c&&this.select(null)}}),pe()).subscribe()}static{this.delta=6}setViewport(t){this.viewport$.next(t)}select(t){t?.selected()||(this.keyboardService.isActiveAction("multiSelection")||this.flowEntitiesService.entities().forEach(n=>n.selected.set(!1)),t&&t.selected.set(!0))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var _i=(()=>{class e{constructor(){this.rootSvg=h(at).element,this.host=h(re).nativeElement,this.selectionService=h(ft),this.viewportService=h(De),this.flowSettingsService=h(J),this.zone=h(Re),this.rootSvgSelection=ge(this.rootSvg),this.transform=b(""),this.viewportForSelection={},this.manualViewportChangeEffect=Ve(()=>{let t=this.viewportService.writableViewport(),n=t.state;if(t.changeType!=="initial"){if(We(n.zoom)&&!We(n.x)&&!We(n.y)){this.rootSvgSelection.transition().duration(t.duration).call(this.zoomBehavior.scaleTo,n.zoom);return}if(We(n.x)&&We(n.y)&&!We(n.zoom)){let o=Gt(this.viewportService.readableViewport).zoom;this.rootSvgSelection.transition().duration(t.duration).call(this.zoomBehavior.transform,pt.translate(n.x,n.y).scale(o));return}if(We(n.x)&&We(n.y)&&We(n.zoom)){this.rootSvgSelection.transition().duration(t.duration).call(this.zoomBehavior.transform,pt.translate(n.x,n.y).scale(n.zoom));return}}},{allowSignalWrites:!0}),this.handleZoom=({transform:t})=>{this.viewportService.readableViewport.set(oo(t)),this.transform.set(t.toString())},this.handleZoomStart=({transform:t})=>{this.viewportForSelection={start:oo(t)}},this.handleZoomEnd=({transform:t,sourceEvent:n})=>{this.zone.run(()=>{this.viewportForSelection=it(Ee({},this.viewportForSelection),{end:oo(t),target:Ac(n)}),this.viewportService.triggerViewportChangeEvent("end"),this.selectionService.setViewport(this.viewportForSelection)})},this.filterCondition=t=>t.type==="mousedown"||t.type==="touchstart"?t.target.closest(".vflow-node")===null:!0}ngOnInit(){this.zone.runOutsideAngular(()=>{this.zoomBehavior=no().scaleExtent([this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom()]).filter(this.filterCondition).on("start",this.handleZoomStart).on("zoom",this.handleZoom).on("end",this.handleZoomEnd),this.rootSvgSelection.call(this.zoomBehavior).on("dblclick.zoom",null)})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["g","mapContext",""]],hostVars:1,hostBindings:function(n,o){n&2&&D("transform",o.transform())},standalone:!0})}}return e})(),oo=e=>({zoom:e.k,x:e.x,y:e.y}),Ac=e=>{if(e instanceof Event&&e.target instanceof Element)return e.target};var Ci=(()=>{class e{constructor(){this.entitiesService=h(ie),this.settingsService=h(J),this.flowStatusService=h(_e)}enable(t,n){ge(t).call(this.getDragBehavior(n))}disable(t){ge(t).call(Jn().on("drag",null))}destroy(t){ge(t).on(".drag",null)}getDragBehavior(t){let n=[],o=[],r=s=>t.dragHandlesCount()?!!s.target.closest(".vflow-drag-handle"):!0;return Jn().filter(r).on("start",s=>{n=this.getDragNodes(t),this.flowStatusService.setNodeDragStartStatus(t),o=n.map(a=>({x:a.point().x-s.x,y:a.point().y-s.y}))}).on("drag",s=>{n.forEach((a,l)=>{let c={x:Xt(s.x+o[l].x),y:Xt(s.y+o[l].y)};this.moveNode(a,c)})}).on("end",()=>{this.flowStatusService.setNodeDragEndStatus(t)})}getDragNodes(t){return t.selected()?this.entitiesService.nodes().filter(n=>n.selected()&&n.draggable()):[t]}moveNode(t,n){n=this.alignToGrid(n);let o=t.parent();o&&(n.x=Math.min(o.width()-t.width(),n.x),n.x=Math.max(0,n.x),n.y=Math.min(o.height()-t.height(),n.y),n.y=Math.max(0,n.y)),t.setPoint(n)}alignToGrid(t){let[n,o]=this.settingsService.snapGrid();return n>1&&(t.x=Ce(t.x,n)),o>1&&(t.y=Ce(t.y,o)),t}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();function ro(e,i){let t=e.reduce((n,o)=>(n[o.rawNode.id]=o,n),{});i.forEach(n=>{n.source.set(t[n.edge.source]),n.target.set(t[n.edge.target])})}function Ps(e){return Po(e)?e:it(Ee({},Lc(e)),{id:e.id,type:e.type})}function Lc(e){let i={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=b(e[t]));return i}function Vs(e,i,t){!i&&yo(e);let n=i??h(rt);return t?tn(n,t):n}function mt(e,i){let t=Vs(mt,i?.injector),n;return y(()=>(n||(n=Gt(()=>Ln(e,it(Ee({},i),{injector:t})))),n()))}var Me=(()=>{class e{constructor(){this.flowEntitiesService=h(ie),this.flowSettingsService=h(J),this.viewportService=h(De),this.nodes=y(()=>this.flowSettingsService.optimization().virtualization?this.viewportNodesAfterInteraction().sort((t,n)=>t.renderOrder()-n.renderOrder()):[...this.flowEntitiesService.nodes()].sort((t,n)=>t.renderOrder()-n.renderOrder())),this.groups=y(()=>this.nodes().filter(t=>!!t.children().length)),this.nonGroups=y(()=>this.nodes().filter(t=>!t.children().length)),this.viewportNodes=y(()=>{let t=this.flowEntitiesService.nodes(),n=this.viewportService.readableViewport(),o=this.flowSettingsService.computedFlowWidth(),r=this.flowSettingsService.computedFlowHeight();return t.filter(s=>{let{x:a,y:l}=s.globalPoint(),c=s.width(),d=s.height();return Xo({x:a,y:l,width:c,height:d},n,o,r)})}),this.viewportNodesAfterInteraction=mt(me(G(this.flowEntitiesService.nodes).pipe(Ze(Pt),U(t=>!!t.length)),this.viewportService.viewportChangeEnd$.pipe(vo(300))).pipe(R(()=>{let t=this.viewportService.readableViewport(),n=this.flowSettingsService.optimization().virtualizationZoomThreshold;return t.zoom<n?[]:this.viewportNodes()})),{initialValue:[]}),this.maxOrder=y(()=>Math.max(...this.flowEntitiesService.nodes().map(t=>t.renderOrder())))}pullNode(t){t.renderOrder.set(this.maxOrder()+1),t.children().forEach(n=>this.pullNode(n))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();function Ht(e,i){i||(i={equal:Object.is});let t;return y(()=>t=e(t),i)}var $s=(()=>{class e{static{this.defaultWidth=100}static{this.defaultHeight=50}static{this.defaultColor="#1b262c"}constructor(t){this.rawNode=t,this.entitiesService=h(ie),this.settingsService=h(J),this.nodeRenderingService=h(Me),this.isVisible=b(!1),this.point=b({x:0,y:0}),this.width=b(e.defaultWidth),this.height=b(e.defaultHeight),this.size=y(()=>({width:this.width(),height:this.height()})),this.styleWidth=y(()=>this.controlledByResizer()?`${this.width()}px`:"100%"),this.styleHeight=y(()=>this.controlledByResizer()?`${this.height()}px`:"100%"),this.foWidth=y(()=>this.width()+2),this.foHeight=y(()=>this.height()+2),this.renderOrder=b(0),this.selected=b(!1),this.preview=b({style:{}}),this.globalPoint=y(()=>{let o=this.parent(),r=this.point().x,s=this.point().y;for(;o!==null;)r+=o.point().x,s+=o.point().y,o=o.parent();return{x:r,y:s}}),this.pointTransform=y(()=>`translate(${this.globalPoint().x}, ${this.globalPoint().y})`),this.handles=b([]),this.draggable=b(!0),this.dragHandlesCount=b(0),this.magnetRadius=20,this.isComponentType=Vo(this.rawNode)||$o(this.rawNode),this.shouldLoad=Ht(o=>{if(o||this.settingsService.optimization().lazyLoadTrigger==="immediate")return!0;if(this.settingsService.optimization().lazyLoadTrigger==="viewport"){if(Bn(this.rawNode.type)||Gn(this.rawNode.type))return!0;if(Nt(this.rawNode.type)||this.rawNode.type==="html-template"||this.rawNode.type==="svg-template"||this.rawNode.type==="template-group")return this.nodeRenderingService.viewportNodes().includes(this)}return!0}),this.componentInstance$=G(this.shouldLoad).pipe(U(Boolean),be(()=>this.rawNode.type()),go(()=>fo(this.rawNode.type)),xo(1)),this.text=b(""),this.componentTypeInputs={node:this.rawNode},this.parent=y(()=>this.entitiesService.nodes().find(o=>o.rawNode.id===this.parentId())??null),this.children=y(()=>this.entitiesService.nodes().filter(o=>o.parentId()===this.rawNode.id)),this.color=b(e.defaultColor),this.controlledByResizer=b(!1),this.resizable=b(!1),this.resizing=b(!1),this.resizerTemplate=b(null),this.context={$implicit:{}},this.parentId=b(null);let n=Ps(t);n.point&&(this.point=n.point),n.width&&(this.width=n.width),n.height&&(this.height=n.height),n.draggable&&(this.draggable=n.draggable),n.parentId&&(this.parentId=n.parentId),n.preview&&(this.preview=n.preview),n.type==="default-group"&&n.color&&(this.color=n.color),n.type==="default-group"&&n.resizable&&(this.resizable=n.resizable),n.type==="default"&&n.text&&(this.text=n.text),n.type==="html-template"&&(this.context={$implicit:{node:t,selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}}),n.type==="svg-template"&&(this.context={$implicit:{node:t,selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),n.type==="template-group"&&(this.context={$implicit:{node:t,selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),this.point$=G(this.point),this.width$=G(this.width),this.height$=G(this.height),this.size$=G(this.size),this.selected$=G(this.selected),this.handles$=G(this.handles)}setPoint(t){this.point.set(t)}}return e})();var Kt=class{constructor(i){this.edgeLabel=i,this.size=b({width:0,height:0})}};function Le(e,i,t){return{x:(1-t)*e.x+t*i.x,y:(1-t)*e.y+t*i.y}}function En({sourcePoint:e,targetPoint:i}){return{path:`M ${e.x},${e.y}L ${i.x},${i.y}`,labelPoints:{start:Le(e,i,.15),center:Le(e,i,.5),end:Le(e,i,.85)}}}function zn({sourcePoint:e,targetPoint:i,sourcePosition:t,targetPosition:n}){let o={x:e.x-i.x,y:e.y-i.y},r=As(e,t,o),s=As(i,n,o),a=`M${e.x},${e.y} C${r.x},${r.y} ${s.x},${s.y} ${i.x},${i.y}`;return Bc(a,e,i,r,s)}function As(e,i,t){let n={x:0,y:0};switch(i){case"top":n.y=1;break;case"bottom":n.y=-1;break;case"right":n.x=1;break;case"left":n.x=-1;break}let o={x:t.x*Math.abs(n.x),y:t.y*Math.abs(n.y)},s=.25*25*Math.sqrt(Math.abs(o.x+o.y));return{x:e.x+n.x*s,y:e.y-n.y*s}}function Bc(e,i,t,n,o){return{path:e,labelPoints:{start:ao(i,t,n,o,.1),center:ao(i,t,n,o,.5),end:ao(i,t,n,o,.9)}}}function ao(e,i,t,n,o){let r=Le(e,t,o),s=Le(t,n,o),a=Le(n,i,o);return Le(Le(r,s,o),Le(s,a,o),o)}var Ls={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1}};function Gc(e,i){let t=Math.abs(i.x-e.x)/2,n=i.x<e.x?i.x+t:i.x-t,o=Math.abs(i.y-e.y)/2,r=i.y<e.y?i.y+o:i.y-o;return[n,r,t,o]}var jc=({source:e,sourcePosition:i="bottom",target:t})=>i==="left"||i==="right"?e.x<t.x?{x:1,y:0}:{x:-1,y:0}:e.y<t.y?{x:0,y:1}:{x:0,y:-1},Bs=(e,i)=>Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));function Xc({source:e,sourcePosition:i="bottom",target:t,targetPosition:n="top",offset:o}){let r=Ls[i],s=Ls[n],a={x:e.x+r.x*o,y:e.y+r.y*o},l={x:t.x+s.x*o,y:t.y+s.y*o},c=jc({source:a,sourcePosition:i,target:l}),d=c.x!==0?"x":"y",m=c[d],u=[],g,w,N={x:0,y:0},O={x:0,y:0},[C,ee]=Gc(e,t);if(r[d]*s[d]===-1){g=C,w=ee;let x=[{x:g,y:a.y},{x:g,y:l.y}],z=[{x:a.x,y:w},{x:l.x,y:w}];r[d]===m?u=d==="x"?x:z:u=d==="x"?z:x}else{let x=[{x:a.x,y:l.y}],z=[{x:l.x,y:a.y}];if(d==="x"?u=r.x===m?z:x:u=r.y===m?x:z,i===n){let ue=Math.abs(e[d]-t[d]);if(ue<=o){let he=Math.min(o-1,o-ue);r[d]===m?N[d]=(a[d]>e[d]?-1:1)*he:O[d]=(l[d]>t[d]?-1:1)*he}}if(i!==n){let ue=d==="x"?"y":"x",he=r[d]===s[ue],xt=a[ue]>l[ue],yt=a[ue]<l[ue];(r[d]===1&&(!he&&xt||he&&yt)||r[d]!==1&&(!he&&yt||he&&xt))&&(u=d==="x"?x:z)}let H={x:a.x+N.x,y:a.y+N.y},$={x:l.x+O.x,y:l.y+O.y},fe=Math.max(Math.abs(H.x-u[0].x),Math.abs($.x-u[0].x)),Se=Math.max(Math.abs(H.y-u[0].y),Math.abs($.y-u[0].y));fe>=Se?(g=(H.x+$.x)/2,w=u[0].y):(g=u[0].x,w=(H.y+$.y)/2)}return[[e,{x:a.x+N.x,y:a.y+N.y},...u,{x:l.x+O.x,y:l.y+O.y},t],g,w]}function Yc(e,i,t,n){let o=Math.min(Bs(e,i)/2,Bs(i,t)/2,n),{x:r,y:s}=i;if(e.x===r&&r===t.x||e.y===s&&s===t.y)return`L${r} ${s}`;if(e.y===s){let c=e.x<t.x?-1:1,d=e.y<t.y?1:-1;return`L ${r+o*c},${s}Q ${r},${s} ${r},${s+o*d}`}let a=e.x<t.x?1:-1,l=e.y<t.y?-1:1;return`L ${r},${s+o*l}Q ${r},${s} ${r+o*a},${s}`}function gt({sourcePoint:e,targetPoint:i,sourcePosition:t,targetPosition:n},o=5){let[r,s,a]=Xc({source:e,sourcePosition:t,target:i,targetPosition:n,offset:20}),l=r.reduce((w,N,O)=>{let C="";return O>0&&O<r.length-1?C=Yc(r[O-1],N,r[O+1],o):C=`${O===0?"M":"L"}${N.x} ${N.y}`,w+=C,w},""),c=r.length;if(c<2)return{path:l,labelPoints:{start:{x:s,y:a},center:{x:s,y:a},end:{x:s,y:a}}};let d=new Array(c-1),m=new Array(c);m[0]=0;let u=0;for(let w=0;w<c-1;w++){let N=r[w+1].x-r[w].x,O=r[w+1].y-r[w].y,C=Math.sqrt(N*N+O*O);d[w]=C,u+=C,m[w+1]=u}let g=w=>{let N=u*w;if(N<=0)return r[0];if(N>=u)return r[c-1];let O=0,C=c-1;for(;O<C-1;){let $=O+C>>>1;m[$]<N?O=$:C=$}let ee=m[O],x=(N-ee)/d[O],z=r[O],H=r[O+1];return{x:z.x+(H.x-z.x)*x,y:z.y+(H.y-z.y)*x}};return{path:l,labelPoints:{start:g(.15),center:{x:s,y:a},end:g(.85)}}}var Si=class{constructor(i){this.edge=i,this.flowEntitiesService=h(ie),this.source=b(void 0),this.target=b(void 0),this.selected=b(!1),this.selected$=G(this.selected),this.shouldLoad=y(()=>(this.source()?.shouldLoad()??!1)&&(this.target()?.shouldLoad()??!1)),this.renderOrder=b(0),this.detached=y(()=>{let t=this.source(),n=this.target();if(!t||!n)return!0;let o=!1,r=!1;return this.edge.sourceHandle?o=!!t.handles().find(s=>s.rawHandle.id===this.edge.sourceHandle):o=!!t.handles().find(s=>s.rawHandle.type==="source"),this.edge.targetHandle?r=!!n.handles().find(s=>s.rawHandle.id===this.edge.targetHandle):r=!!n.handles().find(s=>s.rawHandle.type==="target"),!o||!r}),this.detached$=G(this.detached),this.path=y(()=>{let t=this.sourceHandle(),n=this.targetHandle();if(!t||!n)return{path:""};let o=this.getPathFactoryParams(t,n);switch(this.curve){case"straight":return En(o);case"bezier":return zn(o);case"smooth-step":return gt(o);case"step":return gt(o,0);default:return this.curve(o)}}),this.sourceHandle=Ht(t=>{let n=null;return this.floating?n=this.closestHandles().sourceHandle:this.edge.sourceHandle?n=this.source()?.handles().find(o=>o.rawHandle.id===this.edge.sourceHandle)??null:n=this.source()?.handles().find(o=>o.rawHandle.type==="source")??null,n===null?t:n}),this.targetHandle=Ht(t=>{let n=null;return this.floating?n=this.closestHandles().targetHandle:this.edge.targetHandle?n=this.target()?.handles().find(o=>o.rawHandle.id===this.edge.targetHandle)??null:n=this.target()?.handles().find(o=>o.rawHandle.type==="target")??null,n===null?t:n}),this.closestHandles=y(()=>{let t=this.source(),n=this.target();if(!t||!n)return{sourceHandle:null,targetHandle:null};let o=this.flowEntitiesService.connection().mode==="strict"?t.handles().filter(c=>c.rawHandle.type==="source"):t.handles(),r=this.flowEntitiesService.connection().mode==="strict"?n.handles().filter(c=>c.rawHandle.type==="target"):n.handles();if(o.length===0||r.length===0)return{sourceHandle:null,targetHandle:null};let s=1/0,a=null,l=null;for(let c of o)for(let d of r){let m=c.pointAbsolute(),u=d.pointAbsolute(),g=Math.sqrt(Math.pow(m.x-u.x,2)+Math.pow(m.y-u.y,2));g<s&&(s=g,a=c,l=d)}return{sourceHandle:a,targetHandle:l}}),this.markerStartUrl=y(()=>{let t=this.edge.markers?.start;return t?`url(#${Je(JSON.stringify(t))})`:""}),this.markerEndUrl=y(()=>{let t=this.edge.markers?.end;return t?`url(#${Je(JSON.stringify(t))})`:""}),this.context={$implicit:{edge:this.edge,path:y(()=>this.path().path),markerStart:this.markerStartUrl,markerEnd:this.markerEndUrl,selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}},this.edgeLabels={},this.type=i.type??"default",this.curve=i.curve??"bezier",this.reconnectable=i.reconnectable??!1,this.floating=i.floating??!1,i.edgeLabels?.start&&(this.edgeLabels.start=new Kt(i.edgeLabels.start)),i.edgeLabels?.center&&(this.edgeLabels.center=new Kt(i.edgeLabels.center)),i.edgeLabels?.end&&(this.edgeLabels.end=new Kt(i.edgeLabels.end))}getPathFactoryParams(i,t){return{mode:"edge",edge:this.edge,sourcePoint:i.pointAbsolute(),targetPoint:t.pointAbsolute(),sourcePosition:i.rawHandle.position,targetPosition:t.rawHandle.position,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}};var On=class{static nodes(i,t){let n=new Map;return t.forEach(o=>n.set(o.rawNode,o)),i.map(o=>n.get(o)??new $s(o))}static edges(i,t){let n=new Map;return t.forEach(o=>n.set(o.edge,o)),i.map(o=>n.has(o)?n.get(o):new Si(o))}};var Wc=25,kn=(()=>{class e{constructor(){this.entitiesService=h(ie),this.nodesPositionChange$=G(this.entitiesService.nodes).pipe(be(t=>me(...t.map(n=>n.point$.pipe(Qe(1),R(()=>n))))),R(t=>[{type:"position",id:t.rawNode.id,point:t.point()},...this.entitiesService.nodes().filter(n=>n!==t&&n.selected()).map(n=>({type:"position",id:n.rawNode.id,point:n.point()}))])),this.nodeSizeChange$=G(this.entitiesService.nodes).pipe(be(t=>me(...t.map(n=>n.size$.pipe(Qe(1),R(()=>n))))),R(t=>[{type:"size",id:t.rawNode.id,size:t.size()}])),this.nodeAddChange$=G(this.entitiesService.nodes).pipe(Vt(),R(([t,n])=>n.filter(o=>!t.includes(o))),U(t=>!!t.length),R(t=>t.map(n=>({type:"add",id:n.rawNode.id})))),this.nodeRemoveChange$=G(this.entitiesService.nodes).pipe(Vt(),R(([t,n])=>t.filter(o=>!n.includes(o))),U(t=>!!t.length),R(t=>t.map(n=>({type:"remove",id:n.rawNode.id})))),this.nodeSelectedChange$=G(this.entitiesService.nodes).pipe(be(t=>me(...t.map(n=>n.selected$.pipe(en(),Qe(1),R(()=>n))))),R(t=>[{type:"select",id:t.rawNode.id,selected:t.selected()}])),this.changes$=me(this.nodesPositionChange$,this.nodeSizeChange$,this.nodeAddChange$,this.nodeRemoveChange$,this.nodeSelectedChange$).pipe(Ze(Pt,Wc))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var qc=(e,i)=>e.length===i.length&&[...new Set([...e,...i])].every(t=>e.filter(n=>n===t).length===i.filter(n=>n===t).length),Dn=(()=>{class e{constructor(){this.entitiesService=h(ie),this.edgeDetachedChange$=me(G(y(()=>{let t=this.entitiesService.nodes();return Gt(this.entitiesService.edges).filter(({source:o,target:r})=>!t.includes(o())||!t.includes(r()))})),G(this.entitiesService.edges).pipe(be(t=>mo(...t.map(n=>n.detached$.pipe(R(()=>n))))),R(t=>t.filter(n=>n.detached())),Qe(2))).pipe(en(qc),U(t=>!!t.length),R(t=>t.map(({edge:n})=>({type:"detached",id:n.id})))),this.edgeAddChange$=G(this.entitiesService.edges).pipe(Vt(),R(([t,n])=>n.filter(o=>!t.includes(o))),U(t=>!!t.length),R(t=>t.map(({edge:n})=>({type:"add",id:n.id})))),this.edgeRemoveChange$=G(this.entitiesService.edges).pipe(Vt(),R(([t,n])=>t.filter(o=>!n.includes(o))),U(t=>!!t.length),R(t=>t.map(({edge:n})=>({type:"remove",id:n.id})))),this.edgeSelectChange$=G(this.entitiesService.edges).pipe(be(t=>me(...t.map(n=>n.selected$.pipe(en(),Qe(1),R(()=>n))))),R(t=>[{type:"select",id:t.edge.id,selected:t.selected()}])),this.changes$=me(this.edgeDetachedChange$,this.edgeAddChange$,this.edgeRemoveChange$,this.edgeSelectChange$).pipe(Ze(Pt))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var Gs=(()=>{class e{constructor(){this.nodesChangeService=h(kn),this.edgesChangeService=h(Dn),this.onNodesChange=X(this.nodesChangeService.changes$),this.onNodesChangePosition=X(this.nodeChangesOfType("position"),{alias:"onNodesChange.position"}),this.onNodesChangePositionSignle=X(this.singleChange(this.nodeChangesOfType("position")),{alias:"onNodesChange.position.single"}),this.onNodesChangePositionMany=X(this.manyChanges(this.nodeChangesOfType("position")),{alias:"onNodesChange.position.many"}),this.onNodesChangeSize=X(this.nodeChangesOfType("size"),{alias:"onNodesChange.size"}),this.onNodesChangeSizeSingle=X(this.singleChange(this.nodeChangesOfType("size")),{alias:"onNodesChange.size.single"}),this.onNodesChangeSizeMany=X(this.manyChanges(this.nodeChangesOfType("size")),{alias:"onNodesChange.size.many"}),this.onNodesChangeAdd=X(this.nodeChangesOfType("add"),{alias:"onNodesChange.add"}),this.onNodesChangeAddSingle=X(this.singleChange(this.nodeChangesOfType("add")),{alias:"onNodesChange.add.single"}),this.onNodesChangeAddMany=X(this.manyChanges(this.nodeChangesOfType("add")),{alias:"onNodesChange.add.many"}),this.onNodesChangeRemove=X(this.nodeChangesOfType("remove"),{alias:"onNodesChange.remove"}),this.onNodesChangeRemoveSingle=X(this.singleChange(this.nodeChangesOfType("remove")),{alias:"onNodesChange.remove.single"}),this.onNodesChangeRemoveMany=X(this.manyChanges(this.nodeChangesOfType("remove")),{alias:"onNodesChange.remove.many"}),this.onNodesChangeSelect=X(this.nodeChangesOfType("select"),{alias:"onNodesChange.select"}),this.onNodesChangeSelectSingle=X(this.singleChange(this.nodeChangesOfType("select")),{alias:"onNodesChange.select.single"}),this.onNodesChangeSelectMany=X(this.manyChanges(this.nodeChangesOfType("select")),{alias:"onNodesChange.select.many"}),this.onEdgesChange=X(this.edgesChangeService.changes$),this.onNodesChangeDetached=X(this.edgeChangesOfType("detached"),{alias:"onEdgesChange.detached"}),this.onNodesChangeDetachedSingle=X(this.singleChange(this.edgeChangesOfType("detached")),{alias:"onEdgesChange.detached.single"}),this.onNodesChangeDetachedMany=X(this.manyChanges(this.edgeChangesOfType("detached")),{alias:"onEdgesChange.detached.many"}),this.onEdgesChangeAdd=X(this.edgeChangesOfType("add"),{alias:"onEdgesChange.add"}),this.onEdgeChangeAddSingle=X(this.singleChange(this.edgeChangesOfType("add")),{alias:"onEdgesChange.add.single"}),this.onEdgeChangeAddMany=X(this.manyChanges(this.edgeChangesOfType("add")),{alias:"onEdgesChange.add.many"}),this.onEdgeChangeRemove=X(this.edgeChangesOfType("remove"),{alias:"onEdgesChange.remove"}),this.onEdgeChangeRemoveSingle=X(this.singleChange(this.edgeChangesOfType("remove")),{alias:"onEdgesChange.remove.single"}),this.onEdgeChangeRemoveMany=X(this.manyChanges(this.edgeChangesOfType("remove")),{alias:"onEdgesChange.remove.many"}),this.onEdgeChangeSelect=X(this.edgeChangesOfType("select"),{alias:"onEdgesChange.select"}),this.onEdgeChangeSelectSingle=X(this.singleChange(this.edgeChangesOfType("select")),{alias:"onEdgesChange.select.single"}),this.onEdgeChangeSelectMany=X(this.manyChanges(this.edgeChangesOfType("select")),{alias:"onEdgesChange.select.many"})}nodeChangesOfType(t){return this.nodesChangeService.changes$.pipe(R(n=>n.filter(o=>o.type===t)),U(n=>!!n.length))}edgeChangesOfType(t){return this.edgesChangeService.changes$.pipe(R(n=>n.filter(o=>o.type===t)),U(n=>!!n.length))}singleChange(t){return t.pipe(U(n=>n.length===1),R(([n])=>n))}manyChanges(t){return t.pipe(U(n=>n.length>1))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["","changesController",""]],outputs:{onNodesChange:"onNodesChange",onNodesChangePosition:"onNodesChange.position",onNodesChangePositionSignle:"onNodesChange.position.single",onNodesChangePositionMany:"onNodesChange.position.many",onNodesChangeSize:"onNodesChange.size",onNodesChangeSizeSingle:"onNodesChange.size.single",onNodesChangeSizeMany:"onNodesChange.size.many",onNodesChangeAdd:"onNodesChange.add",onNodesChangeAddSingle:"onNodesChange.add.single",onNodesChangeAddMany:"onNodesChange.add.many",onNodesChangeRemove:"onNodesChange.remove",onNodesChangeRemoveSingle:"onNodesChange.remove.single",onNodesChangeRemoveMany:"onNodesChange.remove.many",onNodesChangeSelect:"onNodesChange.select",onNodesChangeSelectSingle:"onNodesChange.select.single",onNodesChangeSelectMany:"onNodesChange.select.many",onEdgesChange:"onEdgesChange",onNodesChangeDetached:"onEdgesChange.detached",onNodesChangeDetachedSingle:"onEdgesChange.detached.single",onNodesChangeDetachedMany:"onEdgesChange.detached.many",onEdgesChangeAdd:"onEdgesChange.add",onEdgeChangeAddSingle:"onEdgesChange.add.single",onEdgeChangeAddMany:"onEdgesChange.add.many",onEdgeChangeRemove:"onEdgesChange.remove",onEdgeChangeRemoveSingle:"onEdgesChange.remove.single",onEdgeChangeRemoveMany:"onEdgesChange.remove.many",onEdgeChangeSelect:"onEdgesChange.select",onEdgeChangeSelectSingle:"onEdgesChange.select.single",onEdgeChangeSelectMany:"onEdgesChange.select.many"},standalone:!0})}}return e})();function js(e){return typeof e=="string"?{type:"solid",color:e}:e}po();var bi=(()=>{class e{constructor(){this.toolbars=b([]),this.nodeToolbarsMap=y(()=>{let t=new Map;return this.toolbars().forEach(n=>{let o=t.get(n.node)??[];t.set(n.node,[...o,n])}),t})}addToolbar(t){this.toolbars.update(n=>[...n,t])}removeToolbar(t){this.toolbars.update(n=>n.filter(o=>o!==t))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return Jt([rn],e.prototype,"addToolbar",null),Jt([rn],e.prototype,"removeToolbar",null),e})();function vt(e,i){return new ho(t=>{let n=new ResizeObserver(o=>{i.run(()=>t.next(o))});return e.forEach(o=>n.observe(o)),()=>n.disconnect()})}var Zc=["edgeLabelWrapper"],Qc=["edgeLabel",""];function Kc(e,i){e&1&&Te(0)}function Jc(e,i){if(e&1&&(k(),I(0,"foreignObject"),ot(),I(1,"div",1,0),F(3,Kc,1,0,"ng-container",2),j()()),e&2){let t=f(2),n=f();D("x",n.edgeLabelPoint().x)("y",n.edgeLabelPoint().y)("width",t.size().width)("height",t.size().height),_(3),W("ngTemplateOutlet",i)("ngTemplateOutletContext",n.getLabelContext())}}function ed(e,i){if(e&1&&F(0,Jc,4,6,":svg:foreignObject"),e&2){let t,n=f(2);E(0,(t=n.htmlTemplate())?0:-1,t)}}function td(e,i){if(e&1&&(k(),I(0,"foreignObject"),ot(),I(1,"div",1,0),Eo(3),j()()),e&2){let t=f(),n=f();D("x",n.edgeLabelPoint().x)("y",n.edgeLabelPoint().y)("width",t.size().width)("height",t.size().height),_(),To(n.edgeLabelStyle()),_(2),zo(" ",t.edgeLabel.text," ")}}function nd(e,i){if(e&1&&F(0,ed,1,1)(1,td,4,7,":svg:foreignObject"),e&2){let t=i,n=f();E(0,t.edgeLabel.type==="html-template"&&n.htmlTemplate()?0:-1),_(),E(1,t.edgeLabel.type==="default"?1:-1)}}var Xs=(()=>{class e{constructor(){this.zone=h(Re),this.destroyRef=h(At),this.settingsService=h(J),this.model=B.required(),this.edgeModel=B.required(),this.point=B({x:0,y:0}),this.htmlTemplate=B(),this.edgeLabelWrapperRef=_t.required("edgeLabelWrapper"),this.edgeLabelPoint=y(()=>{let t=this.point(),{width:n,height:o}=this.model().size();return{x:t.x-n/2,y:t.y-o/2}}),this.edgeLabelStyle=y(()=>{let t=this.model().edgeLabel;if(t.type==="default"&&t.style){let n=this.settingsService.background(),o="transparent";return n.type==="dots"&&(o=n.backgroundColor??"#fff"),n.type==="solid"&&(o=n.color),t.style.backgroundColor=t.style.backgroundColor??o,t.style}return null})}ngAfterViewInit(){let t=this.edgeLabelWrapperRef().nativeElement;vt([t],this.zone).pipe(Hn(null),te(()=>{let n=t.clientWidth+2,o=t.clientHeight+2;this.model().size.set({width:n,height:o})}),pe(this.destroyRef)).subscribe()}getLabelContext(){return{$implicit:{edge:this.edgeModel().edge,label:this.model().edgeLabel}}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["g","edgeLabel",""]],viewQuery:function(n,o){n&1&&bt(o.edgeLabelWrapperRef,Zc,5),n&2&&Tt()},inputs:{model:[A.SignalBased,"model"],edgeModel:[A.SignalBased,"edgeModel"],point:[A.SignalBased,"point"],htmlTemplate:[A.SignalBased,"htmlTemplate"]},standalone:!0,features:[le],attrs:Qc,decls:1,vars:1,consts:[["edgeLabelWrapper",""],[1,"edge-label-wrapper"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,o){if(n&1&&F(0,nd,2,2),n&2){let r;E(0,(r=o.model())?0:-1,r)}},dependencies:[Xe],styles:[".edge-label-wrapper[_ngcontent-%COMP%]{width:max-content;margin-top:1px;margin-left:1px}"],changeDetection:0})}}return e})();var It=(()=>{class e{constructor(){this.flowEntitiesService=h(ie),this.flowSettingsService=h(J),this.edges=y(()=>this.flowSettingsService.optimization().virtualization?this.viewportEdges().sort((t,n)=>t.renderOrder()-n.renderOrder()):[...this.flowEntitiesService.validEdges()].sort((t,n)=>t.renderOrder()-n.renderOrder())),this.viewportEdges=y(()=>this.flowEntitiesService.validEdges().filter(t=>{let n=t.sourceHandle(),o=t.targetHandle();return n&&o})),this.maxOrder=y(()=>Math.max(...this.flowEntitiesService.validEdges().map(t=>t.renderOrder())))}pull(t){t.renderOrder()!==0&&this.maxOrder()===t.renderOrder()||t.renderOrder.set(this.maxOrder()+1)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();var id=["edge",""];function od(e,i){if(e&1){let t=ye();k(),q(0,"path",0),I(1,"path",1),ne("click",function(){Q(t);let o=f();return o.select(),K(o.pull())}),j()}if(e&2){let t=f();Lt("edge_selected",t.model().selected()),D("d",t.model().path().path)("marker-start",t.model().markerStartUrl())("marker-end",t.model().markerEndUrl()),_(),D("d",t.model().path().path)}}function rd(e,i){if(e&1&&Te(0,2),e&2){let t=f(2);W("ngTemplateOutlet",i)("ngTemplateOutletContext",t.model().context)("ngTemplateOutletInjector",t.injector)}}function sd(e,i){if(e&1&&F(0,rd,1,3,"ng-container",2),e&2){let t,n=f();E(0,(t=n.edgeTemplate())?0:-1,t)}}function ad(e,i){if(e&1&&(k(),q(0,"g",3)),e&2){let t=f(),n=f();W("model",t)("point",i)("edgeModel",n.model())("htmlTemplate",n.edgeLabelHtmlTemplate())}}function ld(e,i){if(e&1&&F(0,ad,1,4,":svg:g",3),e&2){let t,n=f();E(0,(t=(t=n.model().path().labelPoints)==null?null:t.start)?0:-1,t)}}function cd(e,i){if(e&1&&(k(),q(0,"g",3)),e&2){let t=f(),n=f();W("model",t)("point",i)("edgeModel",n.model())("htmlTemplate",n.edgeLabelHtmlTemplate())}}function dd(e,i){if(e&1&&F(0,cd,1,4,":svg:g",3),e&2){let t,n=f();E(0,(t=(t=n.model().path().labelPoints)==null?null:t.center)?0:-1,t)}}function ud(e,i){if(e&1&&(k(),q(0,"g",3)),e&2){let t=f(),n=f();W("model",t)("point",i)("edgeModel",n.model())("htmlTemplate",n.edgeLabelHtmlTemplate())}}function hd(e,i){if(e&1&&F(0,ud,1,4,":svg:g",3),e&2){let t,n=f();E(0,(t=(t=n.model().path().labelPoints)==null?null:t.end)?0:-1,t)}}function pd(e,i){if(e&1){let t=ye();k(),I(0,"circle",5),ne("pointerStart",function(o){Q(t);let r=f(2);return K(r.startReconnection(o,r.model().targetHandle()))}),j()}if(e&2){let t=f(2);D("cx",t.model().sourceHandle().pointAbsolute().x)("cy",t.model().sourceHandle().pointAbsolute().y)}}function fd(e,i){if(e&1){let t=ye();k(),I(0,"circle",5),ne("pointerStart",function(o){Q(t);let r=f(2);return K(r.startReconnection(o,r.model().sourceHandle()))}),j()}if(e&2){let t=f(2);D("cx",t.model().targetHandle().pointAbsolute().x)("cy",t.model().targetHandle().pointAbsolute().y)}}function md(e,i){if(e&1&&F(0,pd,1,2,":svg:circle",4)(1,fd,1,2,":svg:circle",4),e&2){let t=f();E(0,t.model().reconnectable===!0||t.model().reconnectable==="source"?0:-1),_(),E(1,t.model().reconnectable===!0||t.model().reconnectable==="target"?1:-1)}}var Ys=(()=>{class e{constructor(){this.injector=h(rt),this.selectionService=h(ft),this.flowSettingsService=h(J),this.flowStatusService=h(_e),this.edgeRenderingService=h(It),this.connectionController=h(jn,{optional:!0}),this.model=B.required(),this.edgeTemplate=B(),this.edgeLabelHtmlTemplate=B(),this.isReconnecting=y(()=>{let t=this.flowStatusService.status();return(t.state==="reconnection-start"||t.state==="reconnection-validation")&&t.payload.oldEdge===this.model()})}select(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}pull(){this.flowSettingsService.elevateEdgesOnSelect()&&this.edgeRenderingService.pull(this.model())}startReconnection(t,n){t.stopPropagation(),this.connectionController?.startReconnection(n,this.model())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["g","edge",""]],hostAttrs:[1,"selectable"],hostVars:2,hostBindings:function(n,o){n&2&&je("visibility",o.isReconnecting()?"hidden":"visible")},inputs:{model:[A.SignalBased,"model"],edgeTemplate:[A.SignalBased,"edgeTemplate"],edgeLabelHtmlTemplate:[A.SignalBased,"edgeLabelHtmlTemplate"]},standalone:!0,features:[le],attrs:id,decls:6,vars:6,consts:[[1,"edge"],[1,"interactive-edge",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["edgeLabel","",3,"model","point","edgeModel","htmlTemplate"],["r","10",1,"reconnect-handle"],["r","10",1,"reconnect-handle",3,"pointerStart"]],template:function(n,o){if(n&1&&F(0,od,2,6)(1,sd,1,1)(2,ld,1,1)(3,dd,1,1)(4,hd,1,1)(5,md,2,2),n&2){let r,s,a;E(0,o.model().type==="default"?0:-1),_(),E(1,o.model().type==="template"&&o.edgeTemplate()?1:-1),_(),E(2,(r=o.model().edgeLabels.start)?2:-1,r),_(),E(3,(s=o.model().edgeLabels.center)?3:-1,s),_(),E(4,(a=o.model().edgeLabels.end)?4:-1,a),_(),E(5,o.model().sourceHandle()&&o.model().targetHandle()?5:-1)}},dependencies:[Xe,Xs,Yt],styles:[".edge[_ngcontent-%COMP%]{fill:none;stroke-width:2;stroke:#b1b1b7}.edge_selected[_ngcontent-%COMP%]{stroke-width:2.5;stroke:#0f4c75}.interactive-edge[_ngcontent-%COMP%]{fill:none;stroke-width:20;stroke:transparent}.reconnect-handle[_ngcontent-%COMP%]{fill:transparent;cursor:move}"],changeDetection:0})}}return e})();var Ws=(()=>{class e{constructor(){this.handleModel=B.required({alias:"handleSizeController"}),this.handleWrapper=h(re)}ngAfterViewInit(){let t=this.handleWrapper.nativeElement,n=t.getBBox(),o=gd(t);this.handleModel().size.set({width:n.width+o,height:n.height+o})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["","handleSizeController",""]],inputs:{handleModel:[A.SignalBased,"handleSizeController","handleModel"]},standalone:!0})}}return e})();function gd(e){let i=e.firstElementChild;if(i){let t=getComputedStyle(i).strokeWidth,n=Number(t.replace("px",""));return isNaN(n)?0:n}return 0}var vd=["*"],qs=(()=>{class e{constructor(){this.selected=B(!1)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["default-node"]],hostVars:2,hostBindings:function(n,o){n&2&&Lt("selected",o.selected())},inputs:{selected:[A.SignalBased,"selected"]},standalone:!0,features:[le],ngContentSelectors:vd,decls:1,vars:0,template:function(n,o){n&1&&(Fn(),Pn(0))},styles:["[_nghost-%COMP%]{border:1.5px solid #1b262c;border-radius:5px;display:flex;align-items:center;justify-content:center;color:#000;background-color:#fff}.selected[_nghost-%COMP%]{border-width:2px}"],changeDetection:0})}}return e})();var Us=(()=>{class e{constructor(){this.nodeAccessor=h(Ke),this.zone=h(Re),this.destroyRef=h(At),this.hostElementRef=h(re)}ngOnInit(){this.nodeAccessor.model().handles$.pipe(be(n=>vt([...n.map(o=>o.hostReference),this.hostElementRef.nativeElement],this.zone).pipe(R(()=>n))),te(n=>{n.forEach(o=>o.updateHost())}),pe(this.destroyRef)).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["","nodeHandlesController",""]],standalone:!0})}}return e})();var Zs=(()=>{class e{constructor(){this.nodeAccessor=h(Ke),this.zone=h(Re),this.destroyRef=h(At),this.hostElementRef=h(re)}ngOnInit(){let t=this.nodeAccessor.model(),n=this.hostElementRef.nativeElement;me(vt([n],this.zone)).pipe(Hn(null),U(()=>!t.resizing()),te(()=>{t.width.set(n.clientWidth),t.height.set(n.clientHeight)}),pe(this.destroyRef)).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["","nodeResizeController",""]],standalone:!0})}}return e})();var xd=["node",""];function yd(e,i){if(e&1){let t=ye();k(),I(0,"foreignObject",3),ne("click",function(){Q(t);let o=f();return o.pullNode(),K(o.selectNode())}),ot(),I(1,"default-node",4),q(2,"div",5)(3,"handle",6)(4,"handle",7),j()()}if(e&2){let t=f();D("width",t.model().foWidth())("height",t.model().foHeight()),_(),je("width",t.model().styleWidth())("height",t.model().styleHeight())("max-width",t.model().styleWidth())("max-height",t.model().styleHeight()),W("selected",t.model().selected()),_(),W("outerHTML",t.model().text(),wo)}}function wd(e,i){if(e&1){let t=ye();k(),I(0,"foreignObject",3),ne("click",function(){Q(t);let o=f();return K(o.pullNode())}),ot(),I(1,"div",8),Te(2,9),j()()}if(e&2){let t,n=f();D("width",n.model().foWidth())("height",n.model().foHeight()),_(),je("width",n.model().styleWidth())("height",n.model().styleHeight()),_(),W("ngTemplateOutlet",(t=n.nodeTemplate())!==null&&t!==void 0?t:null)("ngTemplateOutletContext",n.model().context)("ngTemplateOutletInjector",n.injector)}}function _d(e,i){if(e&1){let t=ye();k(),I(0,"g",10),ne("click",function(){Q(t);let o=f();return K(o.pullNode())}),Te(1,9),j()}if(e&2){let t,n=f();_(),W("ngTemplateOutlet",(t=n.nodeSvgTemplate())!==null&&t!==void 0?t:null)("ngTemplateOutletContext",n.model().context)("ngTemplateOutletInjector",n.injector)}}function Cd(e,i){if(e&1){let t=ye();k(),I(0,"foreignObject",3),ne("click",function(){Q(t);let o=f(2);return K(o.pullNode())}),ot(),I(1,"div",8),Te(2,11),j()()}if(e&2){let t=f(2);D("width",t.model().foWidth())("height",t.model().foHeight()),_(),je("width",t.model().styleWidth())("height",t.model().styleHeight()),_(),W("ngComponentOutlet",i)("ngComponentOutletInputs",t.model().componentTypeInputs)("ngComponentOutletInjector",t.injector)}}function Sd(e,i){if(e&1&&(F(0,Cd,3,9,":svg:foreignObject",0),$n(1,"async")),e&2){let t,n=f();E(0,(t=An(1,1,n.model().componentInstance$))?0:-1,t)}}function bd(e,i){if(e&1){let t=ye();k(),I(0,"rect",12),ne("click",function(){Q(t);let o=f();return o.pullNode(),K(o.selectNode())}),j()}if(e&2){let t=f();je("stroke",t.model().color())("fill",t.model().color()),Lt("default-group-node_selected",t.model().selected()),W("resizable",t.model().resizable())("gap",3)("resizerColor",t.model().color()),D("width",t.model().size().width)("height",t.model().size().height)}}function Td(e,i){if(e&1){let t=ye();k(),I(0,"g",10),ne("click",function(){Q(t);let o=f();return K(o.pullNode())}),Te(1,9),j()}if(e&2){let t,n=f();_(),W("ngTemplateOutlet",(t=n.groupNodeTemplate())!==null&&t!==void 0?t:null)("ngTemplateOutletContext",n.model().context)("ngTemplateOutletInjector",n.injector)}}function Nd(e,i){}function Ed(e,i){if(e&1&&F(0,Nd,0,0,"ng-template",13),e&2){let t=f();W("ngTemplateOutlet",t)}}function zd(e,i){if(e&1&&F(0,Ed,1,1,null,13),e&2){let t=f();E(0,t.model().resizable()?0:-1)}}function Od(e,i){if(e&1){let t=ye();k(),I(0,"circle",17),ne("pointerStart",function(o){Q(t);let r=f().$implicit,s=f();return K(s.startConnection(o,r))})("pointerEnd",function(){Q(t);let o=f(2);return K(o.endConnection())}),j()}if(e&2){let t=f().$implicit;D("cx",t.hostOffset().x)("cy",t.hostOffset().y)("stroke-width",t.strokeWidth)}}function kd(e,i){if(e&1){let t=ye();k(),I(0,"g",18),ne("pointerStart",function(o){Q(t);let r=f().$implicit,s=f();return K(s.startConnection(o,r))})("pointerEnd",function(){Q(t);let o=f(2);return K(o.endConnection())}),j()}if(e&2){let t=f().$implicit;W("handleSizeController",t)}}function Dd(e,i){e&1&&(k(),Te(0))}function Md(e,i){if(e&1){let t=ye();k(),I(0,"g",18),ne("pointerStart",function(o){Q(t);let r=f().$implicit,s=f();return K(s.startConnection(o,r))})("pointerEnd",function(){Q(t);let o=f(2);return K(o.endConnection())}),F(1,Dd,1,0,"ng-container",19),j()}if(e&2){let t=f().$implicit;W("handleSizeController",t),_(),W("ngTemplateOutlet",t.template)("ngTemplateOutletContext",t.templateContext)}}function Rd(e,i){if(e&1){let t=ye();k(),I(0,"circle",20),ne("pointerEnd",function(){Q(t);let o=f().$implicit,r=f();return r.endConnection(),K(r.resetValidateConnection(o))})("pointerOver",function(){Q(t);let o=f().$implicit,r=f();return K(r.validateConnection(o))})("pointerOut",function(){Q(t);let o=f().$implicit,r=f();return K(r.resetValidateConnection(o))}),j()}if(e&2){let t=f().$implicit,n=f();D("r",n.model().magnetRadius)("cx",t.hostOffset().x)("cy",t.hostOffset().y)}}function Hd(e,i){if(e&1&&F(0,Od,1,3,":svg:circle",14)(1,kd,1,1,":svg:g",15)(2,Md,2,3,":svg:g",15)(3,Rd,1,3,":svg:circle",16),e&2){let t=i.$implicit,n=f();E(0,t.template===void 0?0:-1),_(),E(1,t.template===null?1:-1),_(),E(2,t.template?2:-1),_(),E(3,n.showMagnet()?3:-1)}}function Id(e,i){if(e&1&&(k(),I(0,"foreignObject"),ot(),Te(1,13),j()),e&2){let t=i.$implicit;D("width",t.size().width)("height",t.size().height)("transform",t.transform()),_(),W("ngTemplateOutlet",t.template())}}var Qs=(()=>{class e{constructor(){this.injector=h(rt),this.handleService=h(Oi),this.draggableService=h(Ci),this.flowStatusService=h(_e),this.nodeRenderingService=h(Me),this.flowSettingsService=h(J),this.selectionService=h(ft),this.hostRef=h(re),this.nodeAccessor=h(Ke),this.overlaysService=h(bi),this.connectionController=h(jn,{optional:!0}),this.model=B.required(),this.nodeTemplate=B(),this.nodeSvgTemplate=B(),this.groupNodeTemplate=B(),this.showMagnet=y(()=>this.flowStatusService.status().state==="connection-start"||this.flowStatusService.status().state==="connection-validation"||this.flowStatusService.status().state==="reconnection-start"||this.flowStatusService.status().state==="reconnection-validation"),this.toolbars=y(()=>this.overlaysService.nodeToolbarsMap().get(this.model()))}ngOnInit(){this.model().isVisible.set(!0),this.nodeAccessor.model.set(this.model()),this.handleService.node.set(this.model()),Ve(()=>{this.model().draggable()?this.draggableService.enable(this.hostRef.nativeElement,this.model()):this.draggableService.disable(this.hostRef.nativeElement)},{injector:this.injector})}ngOnDestroy(){this.model().isVisible.set(!1),this.draggableService.destroy(this.hostRef.nativeElement)}startConnection(t,n){t.stopPropagation(),this.connectionController?.startConnection(n)}validateConnection(t){this.connectionController?.validateConnection(t)}resetValidateConnection(t){this.connectionController?.resetValidateConnection(t)}endConnection(){this.connectionController?.endConnection()}pullNode(){this.flowSettingsService.elevateNodesOnSelect()&&this.nodeRenderingService.pullNode(this.model())}selectNode(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["g","node",""]],hostAttrs:[1,"vflow-node"],inputs:{model:[A.SignalBased,"model"],nodeTemplate:[A.SignalBased,"nodeTemplate"],nodeSvgTemplate:[A.SignalBased,"nodeSvgTemplate"],groupNodeTemplate:[A.SignalBased,"groupNodeTemplate"]},standalone:!0,features:[Vn([Oi,Ke]),le],attrs:xd,decls:11,vars:7,consts:[[1,"selectable"],["nodeHandlesController","",1,"selectable"],["rx","5","ry","5",1,"default-group-node",3,"resizable","gap","resizerColor","default-group-node_selected","stroke","fill"],[1,"selectable",3,"click"],["nodeHandlesController","",3,"selected"],[3,"outerHTML"],["type","source","position","right"],["type","target","position","left"],["nodeHandlesController","","nodeResizeController","",1,"wrapper"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["nodeHandlesController","",1,"selectable",3,"click"],[3,"ngComponentOutlet","ngComponentOutletInputs","ngComponentOutletInjector"],["rx","5","ry","5",1,"default-group-node",3,"click","resizable","gap","resizerColor"],[3,"ngTemplateOutlet"],["r","5",1,"default-handle"],[3,"handleSizeController"],[1,"magnet"],["r","5",1,"default-handle",3,"pointerStart","pointerEnd"],[3,"pointerStart","pointerEnd","handleSizeController"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"magnet",3,"pointerEnd","pointerOver","pointerOut"]],template:function(n,o){if(n&1&&(F(0,yd,5,12,":svg:foreignObject",0)(1,wd,3,9,":svg:foreignObject",0)(2,_d,2,3,":svg:g",1)(3,Sd,2,3)(4,bd,1,11,":svg:rect",2)(5,Td,2,3,":svg:g",1)(6,zd,1,1),Oe(7,Hd,4,4,null,null,on),Oe(9,Id,2,4,":svg:foreignObject",null,on)),n&2){let r;E(0,o.model().rawNode.type==="default"?0:-1),_(),E(1,o.model().rawNode.type==="html-template"&&o.nodeTemplate()?1:-1),_(),E(2,o.model().rawNode.type==="svg-template"&&o.nodeSvgTemplate()?2:-1),_(),E(3,o.model().isComponentType?3:-1),_(),E(4,o.model().rawNode.type==="default-group"?4:-1),_(),E(5,o.model().rawNode.type==="template-group"&&o.groupNodeTemplate()?5:-1),_(),E(6,(r=o.model().resizerTemplate())?6:-1,r),_(),ke(o.model().handles()),_(2),ke(o.toolbars())}},dependencies:[Yt,qs,Io,Xe,ko,qo,Ws,Us,Zs,Do],styles:[".magnet[_ngcontent-%COMP%]{opacity:0}.wrapper[_ngcontent-%COMP%]{display:table-cell}.default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}.default-handle[_ngcontent-%COMP%]{stroke:#fff;fill:#1b262c}"],changeDetection:0})}}return e})();var Fd=["connection",""];function Pd(e,i){if(e&1&&(k(),q(0,"path",0)),e&2){let t=f(2);D("d",i)("marker-end",t.markerUrl())("stroke",t.defaultColor)}}function Vd(e,i){if(e&1&&F(0,Pd,1,3,":svg:path",0),e&2){let t,n=f();E(0,(t=n.path())?0:-1,t)}}function $d(e,i){e&1&&Te(0)}function Ad(e,i){if(e&1&&F(0,$d,1,0,"ng-container",1),e&2){let t=f(2);W("ngTemplateOutlet",i)("ngTemplateOutletContext",t.getContext())}}function Ld(e,i){if(e&1&&F(0,Ad,1,2,"ng-container"),e&2){let t,n=f();E(0,(t=n.template())?0:-1,t)}}var Js=(()=>{class e{constructor(){this.flowStatusService=h(_e),this.spacePointContext=h(lt),this.flowEntitiesService=h(ie),this.model=B.required(),this.template=B(),this.path=y(()=>{let t=this.flowStatusService.status(),n=this.model().curve;if(t.state==="connection-start"||t.state==="reconnection-start"){let o=t.payload.sourceHandle,r=o.pointAbsolute(),s=o.rawHandle.position,a=this.spacePointContext.svgCurrentSpacePoint(),l=Ks(o.rawHandle.position),c=this.getPathFactoryParams(r,a,s,l);switch(n){case"straight":return En(c).path;case"bezier":return zn(c).path;case"smooth-step":return gt(c).path;case"step":return gt(c,0).path;default:return n(c).path}}if(t.state==="connection-validation"||t.state==="reconnection-validation"){let o=t.payload.sourceHandle,r=o.pointAbsolute(),s=o.rawHandle.position,a=t.payload.targetHandle,l=t.payload.valid?a.pointAbsolute():this.spacePointContext.svgCurrentSpacePoint(),c=t.payload.valid?a.rawHandle.position:Ks(o.rawHandle.position),d=this.getPathFactoryParams(r,l,s,c);switch(n){case"straight":return En(d).path;case"bezier":return zn(d).path;case"smooth-step":return gt(d).path;case"step":return gt(d,0).path;default:return n(d).path}}return null}),this.markerUrl=y(()=>{let t=this.model().settings.marker;return t?`url(#${Je(JSON.stringify(t))})`:""}),this.defaultColor="rgb(177, 177, 183)"}getContext(){return{$implicit:{path:this.path,marker:this.markerUrl}}}getPathFactoryParams(t,n,o,r){return{mode:"connection",sourcePoint:t,targetPoint:n,sourcePosition:o,targetPosition:r,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["g","connection",""]],inputs:{model:[A.SignalBased,"model"],template:[A.SignalBased,"template"]},standalone:!0,features:[le],attrs:Fd,decls:2,vars:2,consts:[["fill","none","stroke-width","2"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,o){n&1&&F(0,Vd,1,1)(1,Ld,1,1),n&2&&(E(0,o.model().type==="default"?0:-1),_(),E(1,o.model().type==="template"?1:-1))},dependencies:[Xe],encapsulation:2,changeDetection:0})}}return e})();function Ks(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}}function ea(){return String.fromCharCode(65+Math.floor(Math.random()*26))+Date.now()}var Bd=["background",""];function Gd(e,i){if(e&1&&(k(),I(0,"pattern",0),q(1,"circle"),j(),q(2,"rect",1)),e&2){let t=f();D("id",t.patternId)("x",t.x())("y",t.y())("width",t.scaledGap())("height",t.scaledGap()),_(),D("cx",t.patternSize())("cy",t.patternSize())("r",t.patternSize())("fill",t.patternColor()),_(),D("fill",t.patternUrl)}}function jd(e,i){if(e&1&&(k(),I(0,"pattern",0),q(1,"image"),j(),q(2,"rect",1)),e&2){let t=f(2);D("id",t.patternId)("x",t.imageX())("y",t.imageY())("width",t.scaledImageWidth())("height",t.scaledImageHeight()),_(),D("href",t.bgImageSrc())("width",t.scaledImageWidth())("height",t.scaledImageHeight()),_(),D("fill",t.patternUrl)}}function Xd(e,i){if(e&1&&(k(),q(0,"image")),e&2){let t=f(2);D("x",t.imageX())("y",t.imageY())("width",t.scaledImageWidth())("height",t.scaledImageHeight())("href",t.bgImageSrc())}}function Yd(e,i){if(e&1&&F(0,jd,3,9)(1,Xd,1,5,":svg:image"),e&2){let t=f();E(0,t.repeated()?0:-1),_(),E(1,t.repeated()?-1:1)}}var Wd="#fff",qd=20,Ud=2,ta="rgb(177, 177, 183)",na=.1,Zd=!0,ia=(()=>{class e{constructor(){this.viewportService=h(De),this.rootSvg=h(at).element,this.settingsService=h(J),this.backgroundSignal=this.settingsService.background,this.scaledGap=y(()=>{let t=this.backgroundSignal();return t.type==="dots"?this.viewportService.readableViewport().zoom*(t.gap??qd):0}),this.x=y(()=>this.viewportService.readableViewport().x%this.scaledGap()),this.y=y(()=>this.viewportService.readableViewport().y%this.scaledGap()),this.patternColor=y(()=>{let t=this.backgroundSignal();return t.type==="dots"?t.color??ta:ta}),this.patternSize=y(()=>{let t=this.backgroundSignal();return t.type==="dots"?this.viewportService.readableViewport().zoom*(t.size??Ud)/2:0}),this.bgImageSrc=y(()=>{let t=this.backgroundSignal();return t.type==="image"?t.src:""}),this.imageSize=mt(G(this.backgroundSignal).pipe(be(()=>Qd(this.bgImageSrc())),R(t=>({width:t.naturalWidth,height:t.naturalHeight}))),{initialValue:{width:0,height:0}}),this.scaledImageWidth=y(()=>{let t=this.backgroundSignal();if(t.type==="image"){let n=t.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().width*n*(t.scale??na)}return 0}),this.scaledImageHeight=y(()=>{let t=this.backgroundSignal();if(t.type==="image"){let n=t.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().height*n*(t.scale??na)}return 0}),this.imageX=y(()=>{let t=this.backgroundSignal();return t.type==="image"?t.repeat?t.fixed?0:this.viewportService.readableViewport().x%this.scaledImageWidth():t.fixed?0:this.viewportService.readableViewport().x:0}),this.imageY=y(()=>{let t=this.backgroundSignal();return t.type==="image"?t.repeat?t.fixed?0:this.viewportService.readableViewport().y%this.scaledImageHeight():t.fixed?0:this.viewportService.readableViewport().y:0}),this.repeated=y(()=>{let t=this.backgroundSignal();return t.type==="image"&&(t.repeat??Zd)}),this.patternId=ea(),this.patternUrl=`url(#${this.patternId})`,Ve(()=>{let t=this.backgroundSignal();t.type==="dots"&&(this.rootSvg.style.backgroundColor=t.backgroundColor??Wd),t.type==="solid"&&(this.rootSvg.style.backgroundColor=t.color)})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["g","background",""]],standalone:!0,features:[le],attrs:Bd,decls:2,vars:2,consts:[["patternUnits","userSpaceOnUse"],["x","0","y","0","width","100%","height","100%"]],template:function(n,o){n&1&&F(0,Gd,3,10)(1,Yd,2,2),n&2&&(E(0,o.backgroundSignal().type==="dots"?0:-1),_(),E(1,o.backgroundSignal().type==="image"?1:-1))},encapsulation:2,changeDetection:0})}}return e})();function Qd(e){let i=new Image;return i.src=e,new Promise(t=>{i.onload=()=>t(i)})}var Kd=["flowDefs",""];function Jd(e,i){if(e&1&&(k(),q(0,"polyline",3)),e&2){let t,n,o,r=f().$implicit,s=f();je("stroke",(t=r.value.color)!==null&&t!==void 0?t:s.defaultColor)("stroke-width",(n=r.value.strokeWidth)!==null&&n!==void 0?n:2)("fill",(o=r.value.color)!==null&&o!==void 0?o:s.defaultColor)}}function eu(e,i){if(e&1&&(k(),q(0,"polyline",4)),e&2){let t,n,o=f().$implicit,r=f();je("stroke",(t=o.value.color)!==null&&t!==void 0?t:r.defaultColor)("stroke-width",(n=o.value.strokeWidth)!==null&&n!==void 0?n:2)}}function tu(e,i){if(e&1&&(k(),I(0,"marker",0),F(1,Jd,1,6,":svg:polyline",1)(2,eu,1,4,":svg:polyline",2),j()),e&2){let t,n,o,r,s=i.$implicit;D("id",s.key)("markerWidth",(t=s.value.width)!==null&&t!==void 0?t:16.5)("markerHeight",(n=s.value.height)!==null&&n!==void 0?n:16.5)("orient",(o=s.value.orient)!==null&&o!==void 0?o:"auto-start-reverse")("markerUnits",(r=s.value.markerUnits)!==null&&r!==void 0?r:"userSpaceOnUse"),_(),E(1,s.value.type==="arrow-closed"||!s.value.type?1:-1),_(),E(2,s.value.type==="arrow"?2:-1)}}var oa=(()=>{class e{constructor(){this.markers=B.required(),this.defaultColor="rgb(177, 177, 183)"}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["defs","flowDefs",""]],inputs:{markers:[A.SignalBased,"markers"]},standalone:!0,features:[le],attrs:Kd,decls:3,vars:2,consts:[["viewBox","-10 -10 20 20","refX","0","refY","0"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed",3,"stroke","stroke-width","fill"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default",3,"stroke","stroke-width"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default"]],template:function(n,o){n&1&&(Oe(0,tu,3,7,":svg:marker",0,on),$n(2,"keyvalue")),n&2&&ke(An(2,0,o.markers()))},dependencies:[Mo],styles:[".marker__arrow_default[_ngcontent-%COMP%]{stroke-width:1px;stroke-linecap:round;stroke-linejoin:round;fill:none}.marker__arrow_closed[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}"],changeDetection:0})}}return e})();var ra=(()=>{class e{constructor(){this.host=h(re),this.flowSettingsService=h(J),this.flowWidth=y(()=>{let t=this.flowSettingsService.view();return t==="auto"?"100%":t[0]}),this.flowHeight=y(()=>{let t=this.flowSettingsService.view();return t==="auto"?"100%":t[1]}),vt([this.host.nativeElement],h(Re)).pipe(te(([t])=>{this.flowSettingsService.computedFlowWidth.set(t.contentRect.width),this.flowSettingsService.computedFlowHeight.set(t.contentRect.height)}),pe()).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["svg","flowSizeController",""]],hostVars:2,hostBindings:function(n,o){n&2&&D("width",o.flowWidth())("height",o.flowHeight())},standalone:!0})}}return e})();var sa=(()=>{class e{constructor(){this.flowStatusService=h(_e)}resetConnection(){let t=this.flowStatusService.status();(t.state==="connection-start"||t.state==="reconnection-start")&&this.flowStatusService.setIdleStatus()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=Y({type:e,selectors:[["svg","rootSvgContext",""]],hostBindings:function(n,o){n&1&&ne("mouseup",function(){return o.resetConnection()},!1,Ei)("touchend",function(){return o.resetConnection()},!1,Ei)("contextmenu",function(){return o.resetConnection()})},standalone:!0})}}return e})();function Mn(e,i){let t=[];for(let n of i){let{x:o,y:r}=n.globalPoint();e.x>=o&&e.x<=o+n.width()&&e.y>=r&&e.y<=r+n.height()&&t.push({x:e.x-o,y:e.y-r,spaceNodeId:n.rawNode.id})}return t.reverse(),t.push({spaceNodeId:null,x:e.x,y:e.y}),t}var Rn=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})(),aa=(()=>{class e extends Rn{shouldRenderNode(t){return!t.isVisible()}static{this.\u0275fac=(()=>{let t;return function(o){return(t||(t=In(e)))(o||e)}})()}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();function la(e,i){if(Object.keys(i.preview().style).length){ou(e,i);return}if(i.rawNode.type==="default"){nu(e,i);return}if(i.rawNode.type==="default-group"){iu(e,i);return}ru(e,i)}function nu(e,i){let t=i.globalPoint(),n=i.width(),o=i.height();ca(e,i,5),e.fillStyle="white",e.fill(),e.strokeStyle="#1b262c",e.lineWidth=1.5,e.stroke(),e.fillStyle="black",e.font="14px Arial",e.textAlign="center",e.textBaseline="middle";let r=t.x+n/2,s=t.y+o/2;e.fillText(i.text(),r,s)}function iu(e,i){let t=i.globalPoint(),n=i.width(),o=i.height();e.globalAlpha=.05,e.fillStyle=i.color(),e.fillRect(t.x,t.y,n,o),e.globalAlpha=1,e.strokeStyle=i.color(),e.lineWidth=1.5,e.strokeRect(t.x,t.y,n,o)}function ou(e,i){let t=i.globalPoint(),n=i.width(),o=i.height(),r=i.preview().style;if(r.borderRadius){let s=parseFloat(r.borderRadius);ca(e,i,s)}else e.beginPath(),e.rect(t.x,t.y,n,o),e.closePath();r.backgroundColor&&(e.fillStyle=r.backgroundColor),r.borderColor&&(e.strokeStyle=r.borderColor),r.borderWidth&&(e.lineWidth=parseFloat(r.borderWidth)),e.fill(),e.stroke()}function ru(e,i){let t=i.globalPoint(),n=i.width(),o=i.height();e.fillStyle="rgb(0 0 0 / 10%)",e.fillRect(t.x,t.y,n,o)}function ca(e,i,t){let n=i.globalPoint(),o=i.width(),r=i.height();e.beginPath(),e.moveTo(n.x+t,n.y),e.lineTo(n.x+o-t,n.y),e.quadraticCurveTo(n.x+o,n.y,n.x+o,n.y+t),e.lineTo(n.x+o,n.y+r-t),e.quadraticCurveTo(n.x+o,n.y+r,n.x+o-t,n.y+r),e.lineTo(n.x+t,n.y+r),e.quadraticCurveTo(n.x,n.y+r,n.x,n.y+r-t),e.lineTo(n.x,n.y+t),e.quadraticCurveTo(n.x,n.y,n.x+t,n.y),e.closePath()}var su=["previewFlow",""],da=(()=>{class e{constructor(){this.viewportService=h(De),this.renderStrategy=h(Rn),this.nodeRenderingService=h(Me),this.renderer2=h(_o),this.element=h(re).nativeElement,this.ctx=this.element.getContext("2d"),this.width=B(0),this.height=B(0),this.dpr=window.devicePixelRatio,Ve(()=>{this.renderer2.setProperty(this.element,"width",this.width()*this.dpr),this.renderer2.setProperty(this.element,"height",this.height()*this.dpr),this.renderer2.setStyle(this.element,"width",`${this.width()}px`),this.renderer2.setStyle(this.element,"height",`${this.height()}px`),this.ctx.scale(this.dpr,this.dpr)}),Ve(()=>{let t=this.viewportService.readableViewport();this.ctx.clearRect(0,0,this.width(),this.height()),this.ctx.save(),this.ctx.setTransform(t.zoom*this.dpr,0,0,t.zoom*this.dpr,t.x*this.dpr,t.y*this.dpr);for(let n=0;n<this.nodeRenderingService.viewportNodes().length;n++){let o=this.nodeRenderingService.viewportNodes()[n];this.renderStrategy.shouldRenderNode(o)&&la(this.ctx,o)}this.ctx.restore()})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["canvas","previewFlow",""]],inputs:{width:[A.SignalBased,"width"],height:[A.SignalBased,"height"]},standalone:!0,features:[le],attrs:su,decls:0,vars:0,template:function(n,o){},encapsulation:2,changeDetection:0})}}return e})();var lo=(()=>{class e{constructor(){this.nodeRenderingService=h(Me),this.edgeRenderingService=h(It),this.flowEntitiesService=h(ie),this.settingsService=h(J),this.flowInitialized=b(!1),h(Re).runOutsideAngular(()=>uo(this,null,function*(){yield au(2),this.flowInitialized.set(!0)}))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=Z({token:e,factory:e.\u0275fac})}}return e})();function au(e){return new Promise(i=>{let t=0;function n(){t++,t<e?requestAnimationFrame(n):i()}requestAnimationFrame(n)})}function co(e){return it(Ee({},e),{left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height})}var lu=["alignmentHelper",""];function cu(e,i){if(e&1&&(k(),q(0,"line")),e&2){let t=i.$implicit,n=f(3);D("stroke",n.lineColor())("stroke-dasharray",t.isCenter?4:null)("x1",t.x)("y1",t.y)("x2",t.x2)("y2",t.y2)}}function du(e,i){e&1&&Oe(0,cu,1,6,":svg:line",null,No),e&2&&ke(i.lines)}function uu(e,i){if(e&1&&F(0,du,2,0),e&2){let t,n=f();E(0,(t=n.intersections())?0:-1,t)}}var ua=(()=>{class e{constructor(){this.nodeRenderingService=h(Me),this.flowStatus=h(_e),this.tolerance=B(10),this.lineColor=B("#1b262c"),this.isNodeDragging=y(()=>Fi(this.flowStatus.status())),this.intersections=Ht(t=>{let n=this.flowStatus.status();if(Fi(n)){let o=n.payload.node,r=co(sn(o)),s=this.nodeRenderingService.viewportNodes().filter(u=>u!==o).filter(u=>!o.children().includes(u)).map(u=>co(sn(u))),a=[],l=r.x,c=r.y,d=1/0,m=1/0;return s.forEach(u=>{let g=r.left+r.width/2,w=u.left+u.width/2;for(let[C,ee,se,x]of[[g,w,w-r.width/2,!0],[r.left,u.left,u.left,!1],[r.left,u.right,u.right,!1],[r.right,u.left,u.left-r.width,!1],[r.right,u.right,u.right-r.width,!1]]){let z=Math.abs(C-ee);if(z<=this.tolerance()){let H=Math.min(r.top,u.top),$=Math.max(r.bottom,u.bottom);if(a.push({x:ee,y:H,x2:ee,y2:$,isCenter:x}),z<d&&(d=z,l=se),x)break}}let N=r.top+r.height/2,O=u.top+u.height/2;for(let[C,ee,se,x]of[[N,O,O-r.height/2,!0],[r.top,u.top,u.top,!1],[r.top,u.bottom,u.bottom,!1],[r.bottom,u.top,u.top-r.height,!1],[r.bottom,u.bottom,u.bottom-r.height,!1]]){let z=Math.abs(C-ee);if(z<=this.tolerance()){let H=Math.min(r.left,u.left),$=Math.max(r.right,u.right);if(a.push({x:H,y:ee,x2:$,y2:ee,isCenter:x}),z<m&&(m=z,c=se),x)break}}}),{lines:a,snappedX:l,snappedY:c}}return t}),G(this.flowStatus.status).pipe(U(Ao),R(t=>t.payload.node),R(t=>[t,this.intersections()]),te(([t,n])=>{if(n){let o={x:n.snappedX,y:n.snappedY},r=t.parent()?[t.parent()]:[];t.setPoint(Mn(o,r)[0])}}),pe()).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["g","alignmentHelper",""]],inputs:{tolerance:[A.SignalBased,"tolerance"],lineColor:[A.SignalBased,"lineColor"]},standalone:!0,features:[le],attrs:lu,decls:1,vars:1,template:function(n,o){n&1&&F(0,uu,1,1),n&2&&E(0,o.isNodeDragging()?0:-1)},encapsulation:2,changeDetection:0})}}return e})();function hu(e,i){e&1&&(k(),q(0,"g",8))}function pu(e,i){if(e&1&&(k(),q(0,"g",9)),e&2){let t=f();W("tolerance",t.tolerance)("lineColor",t.lineColor)}}function fu(e,i){e&1&&F(0,hu,1,0,":svg:g",8)(1,pu,1,2),e&2&&E(0,i===!0?0:1)}function mu(e,i){if(e&1&&(k(),q(0,"g",10)),e&2){let t,n=i.$implicit,o=f(2);W("model",n)("groupNodeTemplate",(t=o.groupNodeTemplateDirective())==null?null:t.templateRef),D("transform",n.pointTransform())}}function gu(e,i){if(e&1&&(k(),q(0,"g",11)),e&2){let t,n,o=i.$implicit,r=f(2);W("model",o)("edgeTemplate",(t=r.edgeTemplateDirective())==null?null:t.templateRef)("edgeLabelHtmlTemplate",(n=r.edgeLabelHtmlDirective())==null?null:n.templateRef)}}function vu(e,i){if(e&1&&(k(),q(0,"g",12)),e&2){let t,n,o=i.$implicit,r=f(2);W("model",o)("nodeTemplate",(t=r.nodeTemplateDirective())==null?null:t.templateRef)("nodeSvgTemplate",(n=r.nodeSvgTemplateDirective())==null?null:n.templateRef),D("transform",o.pointTransform())}}function xu(e,i){if(e&1&&(Oe(0,mu,1,3,":svg:g",10,Bt().trackNodes,!0),Oe(2,gu,1,3,":svg:g",11,Bt().trackEdges,!0),Oe(4,vu,1,4,":svg:g",12,Bt().trackNodes,!0)),e&2){let t=f();ke(t.groups()),_(2),ke(t.edgeModels()),_(2),ke(t.nonGroups())}}function yu(e,i){if(e&1&&(k(),q(0,"g",11)),e&2){let t,n,o=i.$implicit,r=f(2);W("model",o)("edgeTemplate",(t=r.edgeTemplateDirective())==null?null:t.templateRef)("edgeLabelHtmlTemplate",(n=r.edgeLabelHtmlDirective())==null?null:n.templateRef)}}function wu(e,i){if(e&1&&(k(),q(0,"g",13)),e&2){let t,n,o,r=i.$implicit,s=f(2);W("model",r)("nodeTemplate",(t=s.nodeTemplateDirective())==null?null:t.templateRef)("nodeSvgTemplate",(n=s.nodeSvgTemplateDirective())==null?null:n.templateRef)("groupNodeTemplate",(o=s.groupNodeTemplateDirective())==null?null:o.templateRef),D("transform",r.pointTransform())}}function _u(e,i){if(e&1&&(Oe(0,yu,1,3,":svg:g",11,Bt().trackEdges,!0),Oe(2,wu,1,5,":svg:g",13,Bt().trackNodes,!0)),e&2){let t=f();ke(t.edgeModels()),_(2),ke(t.nodeModels())}}function Cu(e,i){e&1&&(k(),Te(0,6)),e&2&&W("ngTemplateOutlet",i.template())}function Su(e,i){if(e&1&&q(0,"canvas",7),e&2){let t=f();W("width",t.flowWidth())("height",t.flowHeight())}}var pS=(()=>{class e{constructor(){this.viewportService=h(De),this.flowEntitiesService=h(ie),this.nodesChangeService=h(kn),this.edgesChangeService=h(Dn),this.nodeRenderingService=h(Me),this.edgeRenderingService=h(It),this.flowSettingsService=h(J),this.componentEventBusService=h(zi),this.keyboardService=h(Nn),this.injector=h(rt),this.flowRenderingService=h(lo),this.alignmentHelper=B(!1),this.nodeModels=this.nodeRenderingService.nodes,this.groups=this.nodeRenderingService.groups,this.nonGroups=this.nodeRenderingService.nonGroups,this.edgeModels=this.edgeRenderingService.edges,this.onComponentNodeEvent=X(this.componentEventBusService.event$),this.nodeTemplateDirective=Ct(Ri),this.nodeSvgTemplateDirective=Ct(Hi),this.groupNodeTemplateDirective=Ct(Ii),this.edgeTemplateDirective=Ct(ki),this.edgeLabelHtmlDirective=Ct(Mi),this.connectionTemplateDirective=Ct(Di),this.mapContext=_t(_i),this.spacePointContext=_t.required(lt),this.viewport=this.viewportService.readableViewport.asReadonly(),this.nodesChange=mt(this.nodesChangeService.changes$,{initialValue:[]}),this.edgesChange=mt(this.edgesChangeService.changes$,{initialValue:[]}),this.initialized=this.flowRenderingService.flowInitialized.asReadonly(),this.viewportChange$=G(this.viewportService.readableViewport).pipe(Qe(1)),this.nodesChange$=this.nodesChangeService.changes$,this.edgesChange$=this.edgesChangeService.changes$,this.initialized$=G(this.flowRenderingService.flowInitialized),this.markers=this.flowEntitiesService.markers,this.minimap=this.flowEntitiesService.minimap,this.flowOptimization=this.flowSettingsService.optimization,this.flowWidth=this.flowSettingsService.computedFlowWidth,this.flowHeight=this.flowSettingsService.computedFlowHeight}set view(t){this.flowSettingsService.view.set(t)}set minZoom(t){this.flowSettingsService.minZoom.set(t)}set maxZoom(t){this.flowSettingsService.maxZoom.set(t)}set background(t){this.flowSettingsService.background.set(js(t))}set optimization(t){this.flowSettingsService.optimization.update(n=>Ee(Ee({},n),t))}set entitiesSelectable(t){this.flowSettingsService.entitiesSelectable.set(t)}set keyboardShortcuts(t){this.keyboardService.setShortcuts(t)}set connection(t){this.flowEntitiesService.connection.set(t)}get connection(){return this.flowEntitiesService.connection()}set snapGrid(t){this.flowSettingsService.snapGrid.set(t)}set elevateNodesOnSelect(t){this.flowSettingsService.elevateNodesOnSelect.set(t)}set elevateEdgesOnSelect(t){this.flowSettingsService.elevateEdgesOnSelect.set(t)}set nodes(t){let n=tn(this.injector,()=>On.nodes(t,this.flowEntitiesService.nodes()));ro(n,this.flowEntitiesService.edges()),this.flowEntitiesService.nodes.set(n),n.forEach(o=>this.nodeRenderingService.pullNode(o))}set edges(t){let n=tn(this.injector,()=>On.edges(t,this.flowEntitiesService.edges()));ro(this.flowEntitiesService.nodes(),n),this.flowEntitiesService.edges.set(n)}viewportTo(t){this.viewportService.writableViewport.set({changeType:"absolute",state:t,duration:0})}zoomTo(t){this.viewportService.writableViewport.set({changeType:"absolute",state:{zoom:t},duration:0})}panTo(t){this.viewportService.writableViewport.set({changeType:"absolute",state:t,duration:0})}fitView(t){this.viewportService.fitView(t)}getNode(t){return this.flowEntitiesService.getNode(t)?.rawNode}getDetachedEdges(){return this.flowEntitiesService.getDetachedEdges().map(t=>t.edge)}documentPointToFlowPoint(t,n){let o=this.spacePointContext().documentPointToFlowPoint(t);return n?.spaces?Mn(o,this.nodeRenderingService.groups()):o}getIntesectingNodes(t,n={partially:!0}){return Go(t,this.nodeModels(),n).map(o=>o.rawNode)}toNodeSpace(t,n){let o=this.nodeModels().find(s=>s.rawNode.id===t);if(!o)return{x:1/0,y:1/0};if(n===null)return o.globalPoint();let r=this.nodeModels().find(s=>s.rawNode.id===n);return r?Mn(o.globalPoint(),[r])[0]:{x:1/0,y:1/0}}trackNodes(t,{rawNode:n}){return n}trackEdges(t,{edge:n}){return n}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=ae({type:e,selectors:[["vflow"]],contentQueries:function(n,o,r){n&1&&(St(r,o.nodeTemplateDirective,Ri,5),St(r,o.nodeSvgTemplateDirective,Hi,5),St(r,o.groupNodeTemplateDirective,Ii,5),St(r,o.edgeTemplateDirective,ki,5),St(r,o.edgeLabelHtmlDirective,Mi,5),St(r,o.connectionTemplateDirective,Di,5)),n&2&&Tt(6)},viewQuery:function(n,o){n&1&&(bt(o.mapContext,_i,5),bt(o.spacePointContext,lt,5)),n&2&&Tt(2)},inputs:{view:"view",minZoom:"minZoom",maxZoom:"maxZoom",background:"background",optimization:"optimization",entitiesSelectable:"entitiesSelectable",keyboardShortcuts:"keyboardShortcuts",connection:[A.HasDecoratorInputTransform,"connection","connection",t=>new jt(t)],snapGrid:"snapGrid",elevateNodesOnSelect:"elevateNodesOnSelect",elevateEdgesOnSelect:"elevateEdgesOnSelect",nodes:"nodes",alignmentHelper:[A.SignalBased,"alignmentHelper"],edges:"edges"},outputs:{onComponentNodeEvent:"onComponentNodeEvent"},standalone:!0,features:[Vn([Ci,De,_e,ie,kn,Dn,Me,It,ft,J,zi,Nn,bi,{provide:Rn,useClass:aa},lo]),bo,So([{directive:Gs,outputs:["onNodesChange","onNodesChange","onNodesChange.position","onNodesChange.position","onNodesChange.position.single","onNodesChange.position.single","onNodesChange.position.many","onNodesChange.position.many","onNodesChange.size","onNodesChange.size","onNodesChange.size.single","onNodesChange.size.single","onNodesChange.size.many","onNodesChange.size.many","onNodesChange.add","onNodesChange.add","onNodesChange.add.single","onNodesChange.add.single","onNodesChange.add.many","onNodesChange.add.many","onNodesChange.remove","onNodesChange.remove","onNodesChange.remove.single","onNodesChange.remove.single","onNodesChange.remove.many","onNodesChange.remove.many","onNodesChange.select","onNodesChange.select","onNodesChange.select.single","onNodesChange.select.single","onNodesChange.select.many","onNodesChange.select.many","onEdgesChange","onEdgesChange","onEdgesChange.detached","onEdgesChange.detached","onEdgesChange.detached.single","onEdgesChange.detached.single","onEdgesChange.detached.many","onEdgesChange.detached.many","onEdgesChange.add","onEdgesChange.add","onEdgesChange.add.single","onEdgesChange.add.single","onEdgesChange.add.many","onEdgesChange.add.many","onEdgesChange.remove","onEdgesChange.remove","onEdgesChange.remove.single","onEdgesChange.remove.single","onEdgesChange.remove.many","onEdgesChange.remove.many","onEdgesChange.select","onEdgesChange.select","onEdgesChange.select.single","onEdgesChange.select.single","onEdgesChange.select.many","onEdgesChange.select.many"]}]),le],decls:11,vars:8,consts:[["flow",""],["rootSvgRef","","rootSvgContext","","rootPointer","","flowSizeController","",1,"root-svg"],["flowDefs","",3,"markers"],["background",""],["mapContext","","spacePointContext",""],["connection","",3,"model","template"],[3,"ngTemplateOutlet"],["previewFlow","",1,"preview-flow",3,"width","height"],["alignmentHelper",""],["alignmentHelper","",3,"tolerance","lineColor"],["node","",3,"model","groupNodeTemplate"],["edge","",3,"model","edgeTemplate","edgeLabelHtmlTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate","groupNodeTemplate"]],template:function(n,o){if(n&1&&(k(),I(0,"svg",1,0),q(2,"defs",2)(3,"g",3),I(4,"g",4),F(5,fu,2,1),q(6,"g",5),F(7,xu,6,0)(8,_u,4,0),j(),F(9,Cu,1,1,":svg:ng-container",6),j(),F(10,Su,1,2,"canvas",7)),n&2){let r,s,a;_(2),W("markers",o.markers()),_(3),E(5,(r=o.alignmentHelper())?5:-1,r),_(),W("model",o.connection)("template",(s=o.connectionTemplateDirective())==null?null:s.templateRef),_(),E(7,o.flowOptimization().detachedGroupsLayer?7:-1),_(),E(8,o.flowOptimization().detachedGroupsLayer?-1:8),_(),E(9,(a=o.minimap())?9:-1,a),_(),E(10,o.flowOptimization().virtualization?10:-1)}},dependencies:[at,sa,st,ra,oa,ia,_i,lt,Js,Qs,Ys,Xe,da,ua],styles:["[_nghost-%COMP%]{display:grid;grid-template-columns:1fr;width:100%;height:100%;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]     *{box-sizing:border-box}.root-svg[_ngcontent-%COMP%]{grid-row-start:1;grid-column-start:1}.preview-flow[_ngcontent-%COMP%]{pointer-events:none;grid-row-start:1;grid-column-start:1}"],changeDetection:0})}}return e})();export{zt as a,hi as b,Xn as c,ie as d,jo as e,J as f,De as g,ft as h,ki as i,Mi as j,Ri as k,Hi as l,Ii as m,Fo as n,Po as o,Pu as p,Vu as q,bi as r,vt as s,jn as t,It as u,Ys as v,qs as w,qo as x,Qs as y,pS as z};
