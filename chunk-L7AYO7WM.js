import{Ba as x,Bb as k,Ca as m,Db as l,Ea as C,F as b,Fb as E,Ha as I,Ja as a,Ka as R,Ma as h,Yc as p,ad as z,c as w,ca as O,dd as g,g as d,ia as r,m as S,oa as o,p as Y,sa as H,w as y,za as D}from"./chunk-7JBMCLDE.js";var F=(()=>{class t{constructor(){this._event$=new d,this.event$=this._event$.asObservable()}pushEvent(e){this._event$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=r({token:t,factory:t.\u0275fac})}}return t})();var A=(()=>{class t{constructor(){this.model=h(null)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=r({token:t,factory:t.\u0275fac})}}return t})();var j=(()=>{class t{constructor(){this.eventBus=o(F),this.nodeService=o(A),this.destroyRef=o(m),this.selected=this.nodeService.model().selected,this.data=h(void 0)}ngOnInit(){this.trackEvents().pipe(z(this.destroyRef)).subscribe()}trackEvents(){let e=Object.getOwnPropertyNames(this),i=new Map;for(let s of e){let n=this[s];n instanceof C&&i.set(n,s),n instanceof I&&i.set($(n),s)}return b(...Array.from(i.keys()).map(s=>s.pipe(O(n=>{this.eventBus.pushEvent({nodeId:this.nodeService.model()?.rawNode.id??"",eventName:i.get(s),eventPayload:n})}))))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=l({type:t})}}return t})();function $(t){return new w(c=>{let e=t.subscribe(i=>{c.next(i)});return()=>{e.unsubscribe()}})}var rt=(()=>{class t extends j{constructor(){super(...arguments),this.node=a.required()}ngOnInit(){let e=this.node().data;e&&(this.data=e),super.ngOnInit()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=D(t)))(s||t)}})()}static{this.\u0275dir=l({type:t,inputs:{node:[1,"node"]},features:[E]})}}return t})();Y();function B(t,c,e){let i=e.value;return e.value=function(...s){queueMicrotask(()=>{i?.apply(this,s)})},e}var M=(()=>{class t{constructor(){this.node=h(null)}createHandle(e){let i=this.node();i&&i.handles.update(s=>[...s,e])}destroyHandle(e){let i=this.node();i&&i.handles.update(s=>s.filter(n=>n!==e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=r({token:t,factory:t.\u0275fac})}}return S([B],t.prototype,"createHandle",null),t})();var u=class{constructor(c,e,i){this.rawHandle=c,this.parentNode=e,this.batchingService=i,this.strokeWidth=2,this.size=h({width:10+2*this.strokeWidth,height:10+2*this.strokeWidth}),this.pointAbsolute=p(()=>({x:this.parentNode.globalPoint().x+this.hostOffset().x+this.sizeOffset().x,y:this.parentNode.globalPoint().y+this.hostOffset().y+this.sizeOffset().y})),this.state=h("idle"),this.updateHostSizeAndPosition$=new d,this.hostSize=g(this.updateHostSizeAndPosition$.pipe(y(()=>this.getHostSize())),{initialValue:{width:0,height:0}}),this.hostPosition=g(this.updateHostSizeAndPosition$.pipe(y(()=>{let s=this.hostReference instanceof HTMLElement?this.batchingService.getElementOffsets(this.hostReference):void 0;return{x:s?s.offsetLeft:0,y:s?s.offsetTop:0}})),{initialValue:{x:0,y:0}}),this.hostOffset=p(()=>{switch(this.rawHandle.position){case"left":return{x:-this.rawHandle.userOffsetX,y:-this.rawHandle.userOffsetY+this.hostPosition().y+this.hostSize().height/2};case"right":return{x:-this.rawHandle.userOffsetX+this.parentNode.size().width,y:-this.rawHandle.userOffsetY+this.hostPosition().y+this.hostSize().height/2};case"top":return{x:-this.rawHandle.userOffsetX+this.hostPosition().x+this.hostSize().width/2,y:-this.rawHandle.userOffsetY};case"bottom":return{x:-this.rawHandle.userOffsetX+this.hostPosition().x+this.hostSize().width/2,y:-this.rawHandle.userOffsetY+this.parentNode.size().height}}}),this.sizeOffset=p(()=>{switch(this.rawHandle.position){case"left":return{x:-(this.size().width/2),y:0};case"right":return{x:this.size().width/2,y:0};case"top":return{x:0,y:-(this.size().height/2)};case"bottom":return{x:0,y:this.size().height/2}}}),this.hostReference=this.rawHandle.hostReference,this.template=this.rawHandle.template,this.templateContext={$implicit:{point:this.hostOffset,state:this.state,node:this.parentNode.rawNode}},this.hostReference instanceof HTMLElement&&this.batchingService.addElementCache(this.hostReference)}onDestroy(){this.hostReference instanceof HTMLElement&&this.batchingService.removeElementCache(this.hostReference)}updateHost(){this.batchingService.markCacheAsDirty(),this.updateHostSizeAndPosition$.next()}getHostSize(){if(this.hostReference instanceof HTMLElement){let c=this.batchingService.getElementOffsets(this.hostReference);if(c)return{width:c.offsetWidth,height:c.offsetHeight}}else if(this.hostReference instanceof SVGGraphicsElement)return this.hostReference.getBBox();return{width:0,height:0}}};var N=(()=>{class t{constructor(){this.elementOffsetCache=new Map,this.cacheIsDirty=!0,this.minMsBetweenDirty=16,this.lastDirty=void 0}addElementCache(e){this.elementOffsetCache.set(e,void 0),this.markCacheAsDirty()}removeElementCache(e){this.elementOffsetCache.delete(e)}getElementOffsets(e){let i,s=this.elementOffsetCache.get(e);if(s===void 0?this.addElementCache(e):i=s,this.cacheIsDirty){for(let{[0]:n}of this.elementOffsetCache){let q=n.offsetWidth,T=n.offsetHeight,L=n.offsetLeft,X=n.offsetTop,v={offsetWidth:q,offsetHeight:T,offsetLeft:L,offsetTop:X};this.elementOffsetCache.set(n,v),n===e&&(i=v)}this.cacheIsDirty=!1}return i}markCacheAsDirty(){let e=new Date;if(this.lastDirty===void 0){this.cacheIsDirty=!0,this.lastDirty=e;return}e.getTime()-this.lastDirty?.getTime()>this.minMsBetweenDirty&&(this.cacheIsDirty=!0,this.lastDirty=e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=r({token:t,factory:t.\u0275fac})}}return t})();var P=(()=>{class t{constructor(){this.callbacks=[],this.requestAnimationFrameStarted=!1}batchAnimationFrame(e){this.callbacks.push(e),this.requestAnimationFrameStarted||(this.requestAnimationFrameStarted=!0,requestAnimationFrame(()=>{this.callbacks.map(i=>{i&&i()}),this.callbacks=[],this.requestAnimationFrameStarted=!1}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=r({token:t,factory:t.\u0275fac})}}return t})();var It=(()=>{class t{constructor(){this.injector=o(x),this.handleService=o(M),this.element=o(R).nativeElement,this.destroyRef=o(m),this.requestAnimationFrameBatchingService=o(P),this.offsetBatchingCacheService=o(N),this.position=a.required(),this.type=a.required(),this.id=a(),this.template=a(),this.offsetX=a(0),this.offsetY=a(0)}ngOnInit(){H(this.injector,()=>{let e=this.handleService.node();if(e){let i=new u({position:this.position(),type:this.type(),id:this.id(),hostReference:this.element.parentElement,template:this.template(),userOffsetX:this.offsetX(),userOffsetY:this.offsetY()},e,this.offsetBatchingCacheService);this.handleService.createHandle(i),this.requestAnimationFrameBatchingService.batchAnimationFrame(()=>{i.updateHost()}),this.destroyRef.onDestroy(()=>{this.handleService.destroyHandle(i),i.onDestroy()})}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["handle"]],inputs:{position:[1,"position"],type:[1,"type"],id:[1,"id"],template:[1,"template"],offsetX:[1,"offsetX"],offsetY:[1,"offsetY"]},decls:0,vars:0,template:function(i,s){},encapsulation:2,changeDetection:0})}}return t})();export{F as a,A as b,rt as c,B as d,M as e,N as f,P as g,It as h};
