import{a as S,b as x}from"./chunk-YV53NWFE.js";import{d as p}from"./chunk-IO7LDB7E.js";import{Ac as y,Db as h,Ma as m,Oa as u,Ra as s,Sa as g,bd as r,f as l,l as f,o as w,ra as i,v as a,va as n,wa as c}from"./chunk-WSOERDLG.js";w();var o=class{constructor(z,t){this.rawHandle=z,this.parentNode=t,this.strokeWidth=2,this.size=h({width:10+2*this.strokeWidth,height:10+2*this.strokeWidth}),this.offset=r(()=>{switch(this.rawHandle.position){case"left":return{x:0,y:this.parentPosition().y+this.parentSize().height/2};case"right":return{x:this.parentNode.size().width,y:this.parentPosition().y+this.parentSize().height/2};case"top":return{x:this.parentPosition().x+this.parentSize().width/2,y:0};case"bottom":return{x:this.parentPosition().x+this.parentSize().width/2,y:this.parentNode.size().height}}}),this.sizeOffset=r(()=>{switch(this.rawHandle.position){case"left":return{x:-(this.size().width/2),y:0};case"right":return{x:this.size().width/2,y:0};case"top":return{x:0,y:-(this.size().height/2)};case"bottom":return{x:0,y:this.size().height/2}}}),this.pointAbsolute=r(()=>({x:this.parentNode.globalPoint().x+this.offset().x+this.sizeOffset().x,y:this.parentNode.globalPoint().y+this.offset().y+this.sizeOffset().y})),this.state=h("idle"),this.updateParentSizeAndPosition$=new l,this.parentSize=p(this.updateParentSizeAndPosition$.pipe(a(()=>this.getParentSize())),{initialValue:{width:0,height:0}}),this.parentPosition=p(this.updateParentSizeAndPosition$.pipe(a(()=>({x:this.parentReference instanceof HTMLElement?this.parentReference.offsetLeft:0,y:this.parentReference instanceof HTMLElement?this.parentReference.offsetTop:0}))),{initialValue:{x:0,y:0}}),this.parentReference=this.rawHandle.parentReference,this.template=this.rawHandle.template,this.templateContext={$implicit:{point:this.offset,state:this.state,node:this.parentNode.node}}}updateParent(){this.updateParentSizeAndPosition$.next()}getParentSize(){return this.parentReference instanceof HTMLElement?{width:this.parentReference.offsetWidth,height:this.parentReference.offsetHeight}:this.parentReference instanceof SVGGraphicsElement?this.parentReference.getBBox():{width:0,height:0}}};var j=(()=>{class e{constructor(){this.injector=i(m),this.handleService=i(S),this.element=i(g).nativeElement,this.destroyRef=i(u),this.position=s.required(),this.type=s.required(),this.id=s(),this.template=s()}ngOnInit(){let t=this.handleService.node();t&&(this.model=new o({position:this.position(),type:this.type(),id:this.id(),parentReference:this.element.parentElement,template:this.template()},t),this.handleService.createHandle(this.model),requestAnimationFrame(()=>this.model.updateParent()),this.destroyRef.onDestroy(()=>this.handleService.destroyHandle(this.model)))}static{this.\u0275fac=function(d){return new(d||e)}}static{this.\u0275cmp=c({type:e,selectors:[["handle"]],inputs:{position:[n.SignalBased,"position"],type:[n.SignalBased,"type"],id:[n.SignalBased,"id"],template:[n.SignalBased,"template"]},standalone:!0,features:[y],decls:0,vars:0,template:function(d,P){},encapsulation:2,changeDetection:0})}}return f([x],e.prototype,"ngOnInit",null),e})();export{j as a};
