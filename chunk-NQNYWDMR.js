import{Ba as S,Bb as j,Ca as p,Db as l,Ea as R,F as H,Fb as E,Ha as z,Ja as n,Ka as I,Ma as r,Yc as u,ad as k,c as g,ca as x,dd as v,g as d,ia as h,m as w,oa as o,p as M,sa as O,w as y,za as b}from"./chunk-7JBMCLDE.js";var C=(()=>{class t{constructor(){this._event$=new d,this.event$=this._event$.asObservable()}pushEvent(e){this._event$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=h({token:t,factory:t.\u0275fac})}}return t})();var D=(()=>{class t{constructor(){this.model=r(null)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=h({token:t,factory:t.\u0275fac})}}return t})();var N=(()=>{class t{constructor(){this.eventBus=o(C),this.nodeService=o(D),this.destroyRef=o(p),this.selected=this.nodeService.model().selected,this.data=r(void 0)}ngOnInit(){this.trackEvents().pipe(k(this.destroyRef)).subscribe()}trackEvents(){let e=Object.getOwnPropertyNames(this),i=new Map;for(let s of e){let a=this[s];a instanceof R&&i.set(a,s),a instanceof z&&i.set(X(a),s)}return H(...Array.from(i.keys()).map(s=>s.pipe(x(a=>{this.eventBus.pushEvent({nodeId:this.nodeService.model()?.rawNode.id??"",eventName:i.get(s),eventPayload:a})}))))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=l({type:t})}}return t})();function X(t){return new g(c=>{let e=t.subscribe(i=>{c.next(i)});return()=>{e.unsubscribe()}})}var _=(()=>{class t extends N{constructor(){super(...arguments),this.node=n.required()}ngOnInit(){let e=this.node().data;e&&(this.data=e),super.ngOnInit()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=b(t)))(s||t)}})()}static{this.\u0275dir=l({type:t,inputs:{node:[1,"node"]},features:[E]})}}return t})();M();function P(t,c,e){let i=e.value;return e.value=function(...s){queueMicrotask(()=>{i?.apply(this,s)})},e}var F=(()=>{class t{constructor(){this.node=r(null)}createHandle(e){let i=this.node();i&&i.handles.update(s=>[...s,e])}destroyHandle(e){let i=this.node();i&&i.handles.update(s=>s.filter(a=>a!==e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=h({token:t,factory:t.\u0275fac})}}return w([P],t.prototype,"createHandle",null),t})();var m=class{constructor(c,e){this.rawHandle=c,this.parentNode=e,this.strokeWidth=2,this.size=r({width:10+2*this.strokeWidth,height:10+2*this.strokeWidth}),this.pointAbsolute=u(()=>({x:this.parentNode.globalPoint().x+this.hostOffset().x+this.sizeOffset().x,y:this.parentNode.globalPoint().y+this.hostOffset().y+this.sizeOffset().y})),this.state=r("idle"),this.updateHostSizeAndPosition$=new d,this.hostSize=v(this.updateHostSizeAndPosition$.pipe(y(()=>this.getHostSize())),{initialValue:{width:0,height:0}}),this.hostPosition=v(this.updateHostSizeAndPosition$.pipe(y(()=>({x:this.hostReference instanceof HTMLElement?this.hostReference.offsetLeft:0,y:this.hostReference instanceof HTMLElement?this.hostReference.offsetTop:0}))),{initialValue:{x:0,y:0}}),this.hostOffset=u(()=>{switch(this.rawHandle.position){case"left":return{x:-this.rawHandle.userOffsetX,y:-this.rawHandle.userOffsetY+this.hostPosition().y+this.hostSize().height/2};case"right":return{x:-this.rawHandle.userOffsetX+this.parentNode.size().width,y:-this.rawHandle.userOffsetY+this.hostPosition().y+this.hostSize().height/2};case"top":return{x:-this.rawHandle.userOffsetX+this.hostPosition().x+this.hostSize().width/2,y:-this.rawHandle.userOffsetY};case"bottom":return{x:-this.rawHandle.userOffsetX+this.hostPosition().x+this.hostSize().width/2,y:-this.rawHandle.userOffsetY+this.parentNode.size().height}}}),this.sizeOffset=u(()=>{switch(this.rawHandle.position){case"left":return{x:-(this.size().width/2),y:0};case"right":return{x:this.size().width/2,y:0};case"top":return{x:0,y:-(this.size().height/2)};case"bottom":return{x:0,y:this.size().height/2}}}),this.hostReference=this.rawHandle.hostReference,this.template=this.rawHandle.template,this.templateContext={$implicit:{point:this.hostOffset,state:this.state,node:this.parentNode.rawNode}}}updateHost(){this.updateHostSizeAndPosition$.next()}getHostSize(){return this.hostReference instanceof HTMLElement?{width:this.hostReference.offsetWidth,height:this.hostReference.offsetHeight}:this.hostReference instanceof SVGGraphicsElement?this.hostReference.getBBox():{width:0,height:0}}};var yt=(()=>{class t{constructor(){this.injector=o(S),this.handleService=o(F),this.element=o(I).nativeElement,this.destroyRef=o(p),this.position=n.required(),this.type=n.required(),this.id=n(),this.template=n(),this.offsetX=n(0),this.offsetY=n(0)}ngOnInit(){O(this.injector,()=>{let e=this.handleService.node();if(e){let i=new m({position:this.position(),type:this.type(),id:this.id(),hostReference:this.element.parentElement,template:this.template(),userOffsetX:this.offsetX(),userOffsetY:this.offsetY()},e);this.handleService.createHandle(i),requestAnimationFrame(()=>i.updateHost()),this.destroyRef.onDestroy(()=>this.handleService.destroyHandle(i))}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=j({type:t,selectors:[["handle"]],inputs:{position:[1,"position"],type:[1,"type"],id:[1,"id"],template:[1,"template"],offsetX:[1,"offsetX"],offsetY:[1,"offsetY"]},decls:0,vars:0,template:function(i,s){},encapsulation:2,changeDetection:0})}}return t})();export{C as a,D as b,_ as c,P as d,F as e,yt as f};
