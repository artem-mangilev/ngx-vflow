import{a as T,d as k}from"./chunk-IO7LDB7E.js";import{C as p,Db as s,E as w,G as B,Qa as y,Sa as m,_ as f,bd as v,ea as d,f as F,hc as H,j as O,ka as a,p as P,ra as c,v as g,ya as u}from"./chunk-WSOERDLG.js";function j(e){if(e.length===0)return{x:0,y:0,width:0,height:0};let o={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(t=>{let i=Z(t);o=A(o,i)}),z(o)}function Z(e){return{x:e.point().x,y:e.point().y,x2:e.point().x+e.size().width,y2:e.point().y+e.size().height}}function z({x:e,y:o,x2:t,y2:i}){return{x:e,y:o,width:t-e,height:i-o}}function A(e,o){return{x:Math.min(e.x,o.x),y:Math.min(e.y,o.y),x2:Math.max(e.x2,o.x2),y2:Math.max(e.y2,o.y2)}}var x=class{constructor(o){this.settings=o,this.curve=o.curve??"bezier",this.type=o.type??"default",this.mode=o.mode??"strict";let t=this.getValidators(o);this.validator=i=>t.every(r=>r(i))}getValidators(o){let t=[];return t.push(J),this.mode==="loose"&&t.push(q),o.validator&&t.push(o.validator),t}},J=e=>e.source!==e.target,q=e=>e.sourceHandle!==void 0&&e.targetHandle!==void 0;function S(e){return e.split("").reduce((o,t)=>(o=(o<<5)-o+t.charCodeAt(0),o&o),0)}var R=(()=>{class e{constructor(){this.nodes=s([],{equal:(t,i)=>!t.length&&!i.length?!0:t===i}),this.edges=s([],{equal:(t,i)=>!t.length&&!i.length?!0:t===i}),this.validEdges=v(()=>{let t=this.nodes();return this.edges().filter(i=>t.includes(i.source())&&t.includes(i.target()))}),this.connection=s(new x({})),this.markers=v(()=>{let t=new Map;this.validEdges().forEach(r=>{if(r.edge.markers?.start){let n=S(JSON.stringify(r.edge.markers.start));t.set(n,r.edge.markers.start)}if(r.edge.markers?.end){let n=S(JSON.stringify(r.edge.markers.end));t.set(n,r.edge.markers.end)}});let i=this.connection().settings.marker;if(i){let r=S(JSON.stringify(i));t.set(r,i)}return t}),this.entities=v(()=>[...this.nodes(),...this.edges()]),this.minimap=s(null)}getNode(t){return this.nodes().find(({node:i})=>i.id===t)}getDetachedEdges(){return this.edges().filter(t=>t.detached())}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac})}}return e})();function $(e,o,t,i,r,n){let h=o/(e.width*(1+n)),E=t/(e.height*(1+n)),V=Math.min(h,E),M=U(V,i,r),X=e.x+e.width/2,Y=e.y+e.height/2,C=o/2-X*M,N=t/2-Y*M;return{x:C,y:N,zoom:M}}function U(e,o=0,t=1){return Math.min(Math.max(e,o),t)}var I=(()=>{class e{constructor(){this.entitiesSelectable=s(!0),this.view=s([400,400]),this.computedFlowWidth=s(0),this.computedFlowHeight=s(0),this.minZoom=s(.5),this.maxZoom=s(3),this.background=s({type:"solid",color:"#fff"})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac})}}return e})();var pt=(()=>{class e{constructor(){this.entitiesService=c(R),this.flowSettingsService=c(I),this.writableViewport=s({changeType:"initial",state:e.getDefaultViewport(),duration:0}),this.readableViewport=s(e.getDefaultViewport())}static getDefaultViewport(){return{zoom:1,x:0,y:0}}fitView(t={padding:.1,duration:0,nodes:[]}){let i=this.getBoundsNodes(t.nodes??[]),r=$(j(i),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom(),t.padding??.1),n=t.duration??0;this.writableViewport.set({changeType:"absolute",state:r,duration:n})}getBoundsNodes(t){return t?.length?t.map(i=>this.entitiesService.nodes().find(({node:r})=>r.id===i)).filter(i=>!!i):this.entitiesService.nodes()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac})}}return e})();var lt=e=>Math.round(e*100)/100;var yt=(()=>{class e{constructor(){this.model=s(null)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac})}}return e})();var D=(()=>{class e{constructor(){this.host=c(m).nativeElement,this.initialTouch$=new F,this.prevTouchEvent=null,this.mouseMovement$=p(this.host,"mousemove").pipe(g(t=>({x:t.clientX,y:t.clientY,movementX:t.movementX,movementY:t.movementY,target:t.target,originalEvent:t})),P(O),f()),this.touchMovement$=w(this.initialTouch$,p(this.host,"touchmove")).pipe(d(t=>t.preventDefault()),g(t=>{let i=t.touches[0]?.clientX??0,r=t.touches[0]?.clientY??0,n=this.prevTouchEvent?t.touches[0].pageX-this.prevTouchEvent.touches[0].pageX:0,h=this.prevTouchEvent?t.touches[0].pageY-this.prevTouchEvent.touches[0].pageY:0,E=document.elementFromPoint(i,r);return{x:i,y:r,movementX:n,movementY:h,target:E,originalEvent:t}}),d(t=>this.prevTouchEvent=t.originalEvent),P(O),f()),this.pointerMovement$=w(this.mouseMovement$,this.touchMovement$),this.touchEnd$=p(this.host,"touchend").pipe(g(t=>{let i=t.changedTouches[0]?.clientX??0,r=t.changedTouches[0]?.clientY??0,n=document.elementFromPoint(i,r);return{x:i,y:r,target:n,originalEvent:t}}),d(()=>this.prevTouchEvent=null),f()),this.mouseUp$=p(this.host,"mouseup").pipe(g(t=>{let i=t.clientX,r=t.clientY,n=t.target;return{x:i,y:r,target:n,originalEvent:t}}),f()),this.documentPointerEnd$=w(p(document,"mouseup"),p(document,"touchend")).pipe(f())}setInitialTouch(t){this.initialTouch$.next(t)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=u({type:e,selectors:[["svg","rootPointer",""]],standalone:!0})}}return e})();var b=(()=>{class e{constructor(){this.element=c(m).nativeElement}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=u({type:e,selectors:[["svg","rootSvgRef",""]],standalone:!0})}}return e})();var jt=(()=>{class e{constructor(){this.pointerMovementDirective=c(D),this.rootSvg=c(b).element,this.host=c(m).nativeElement,this.svgCurrentSpacePoint=v(()=>{let t=this.pointerMovement();return t?this.documentPointToFlowPoint({x:t.x,y:t.y}):{x:0,y:0}}),this.pointerMovement=k(this.pointerMovementDirective.pointerMovement$)}documentPointToFlowPoint(t){let i=this.rootSvg.createSVGPoint();return i.x=t.x,i.y=t.y,i.matrixTransform(this.host.getScreenCTM().inverse())}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=u({type:e,selectors:[["g","spacePointContext",""]],standalone:!0})}}return e})();var Ct=(()=>{class e{constructor(){this.hostElement=c(m).nativeElement,this.pointerMovementDirective=c(D),this.pointerOver=y(),this.pointerOut=y(),this.pointerStart=y(),this.pointerEnd=y(),this.wasPointerOver=!1,this.touchEnd=this.pointerMovementDirective.touchEnd$.pipe(B(({target:t})=>t===this.hostElement),d(({originalEvent:t})=>this.pointerEnd.emit(t)),T()).subscribe(),this.touchOverOut=this.pointerMovementDirective.touchMovement$.pipe(d(({target:t,originalEvent:i})=>{this.handleTouchOverAndOut(t,i)}),T()).subscribe()}onPointerStart(t){this.pointerStart.emit(t),t instanceof TouchEvent&&this.pointerMovementDirective.setInitialTouch(t)}onPointerEnd(t){this.pointerEnd.emit(t)}onMouseOver(t){this.pointerOver.emit(t)}onMouseOut(t){this.pointerOut.emit(t)}handleTouchOverAndOut(t,i){t===this.hostElement?(this.pointerOver.emit(i),this.wasPointerOver=!0):(this.wasPointerOver&&this.pointerOut.emit(i),this.wasPointerOver=!1)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=u({type:e,selectors:[["","pointerStart",""],["","pointerEnd",""],["","pointerOver",""],["","pointerOut",""]],hostBindings:function(i,r){i&1&&H("mousedown",function(h){return r.onPointerStart(h)})("touchstart",function(h){return r.onPointerStart(h)})("mouseup",function(h){return r.onPointerEnd(h)})("mouseover",function(h){return r.onMouseOver(h)})("mouseout",function(h){return r.onMouseOut(h)})},outputs:{pointerOver:"pointerOver",pointerOut:"pointerOut",pointerStart:"pointerStart",pointerEnd:"pointerEnd"},standalone:!0})}}return e})();export{j as a,x as b,S as c,R as d,$ as e,I as f,pt as g,b as h,lt as i,yt as j,D as k,jt as l,Ct as m};
