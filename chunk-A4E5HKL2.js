import{a as Gt,b as Te,c as Mi,d as ze,e as Bt,f as Ni,g as Vi}from"./chunk-JLTDU4H3.js";import{d as zi,g as xe,h as Oi,i as Ri}from"./chunk-2TNB4PV3.js";import{$ as ne,$b as ce,A as hi,Aa as ue,Ab as q,Ba as qe,C as le,Cb as k,Cc as bt,E as U,Ea as fe,Fb as _i,G as H,Gb as D,Gc as Tt,H as mi,Ha as ct,Hc as Dt,Ia as R,J as ui,Ja as Y,Kc as Hi,L as fi,La as l,N as gi,P as at,Rb as w,Sb as N,Tb as Ce,U as we,Ub as Ze,Vb as bi,X as Ye,Xb as Qe,Xc as Je,Y as Ue,Yb as v,Yc as f,Z as me,Zb as Ti,Zc as Se,_ as vi,_b as dt,ac as de,ba as I,bc as _,bd as Z,c as Ct,cc as z,cd as X,da as Si,dc as V,dd as b,ed as Et,f as We,gb as Ci,gc as ae,ha as F,hc as ie,i as Xe,j as Pe,k as di,kb as jt,kc as A,lb as g,lc as d,mc as xt,na as s,nb as Fe,nc as _t,p as be,qb as xi,r as pi,ra as lt,sa as yi,sc as je,tc as Le,ua as j,ub as Ie,uc as Ae,v as S,va as L,vb as $e,wa as C,wc as Di,xa as He,ya as wi,yc as Ei}from"./chunk-KX6DNB73.js";import{b as Ke,d as Lt,j as At,k as ki}from"./chunk-IGMHS2AO.js";import{a as W,b as K}from"./chunk-JGDRNPQP.js";var Wt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["ng-template","edge",""]]})}}return t})(),Xt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["ng-template","connection",""]]})}}return t})(),Yt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["ng-template","edgeLabelHtml",""]]})}}return t})(),Ut=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["ng-template","nodeHtml",""]]})}}return t})(),qt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["ng-template","nodeSvg",""]]})}}return t})(),Zt=(()=>{class t{constructor(){this.templateRef=s(Fe)}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["ng-template","groupNode",""]]})}}return t})();function pt(t){return typeof t!="function"?!1:t.apply!==void 0}function ht(t){return Object.prototype.isPrototypeOf.call(Mi,t)}function y(t){return t!==void 0}var G={point:{x:0,y:0},width:100,height:50,draggable:!0,parentId:null,extent:"parent",preview:{style:{}},selected:!1,color:"#1b262c",resizable:!1,text:"",data:{}};function Fi(t){return ht(t.type)?!0:pt(t.type)}function Qr(t){return t.type==="html-template"}function Jr(t){return t.type==="default-group"}function Pn(t,o){return o?{id:t.id,point:l(t.point),draggable:l(y(t.draggable)?t.draggable:G.draggable),parentId:l(y(t.parentId)?t.parentId:G.parentId),extent:l(y(t.extent)?t.extent:G.extent),preview:l(y(t.preview)?t.preview:G.preview),selected:l(y(t.selected)?t.selected:G.selected)}:{id:t.id,point:l(t.point),draggable:y(t.draggable)?l(t.draggable):void 0,parentId:y(t.parentId)?l(t.parentId):void 0,extent:y(t.extent)?l(t.extent):void 0,preview:y(t.preview)?l(t.preview):void 0,selected:y(t.selected)?l(t.selected):void 0}}function Pi(t,o={useDefaults:!0}){let e=Pn(t,o.useDefaults);if(t.type==="default")return o.useDefaults?K(W({},e),{type:"default",text:l(t.text??""),width:l(t.width??G.width),height:l(t.height??G.height)}):K(W({},e),{type:"default",text:y(t.text)?l(t.text):void 0,width:y(t.width)?l(t.width):void 0,height:y(t.height)?l(t.height):void 0});if(t.type==="html-template")return o.useDefaults?K(W({},e),{type:"html-template",data:l(t.data??G.data),width:l(t.width??G.width),height:l(t.height??G.height)}):K(W({},e),{type:"html-template",data:y(t.data)?l(t.data):void 0,width:y(t.width)?l(t.width):void 0,height:y(t.height)?l(t.height):void 0});if(t.type==="svg-template"){let i=l(t.width),n=l(t.height);return o.useDefaults?K(W({},e),{type:"svg-template",width:i,height:n,data:l(t.data??G.data)}):K(W({},e),{type:"svg-template",width:i,height:n,data:y(t.data)?l(t.data):void 0})}if(t.type==="default-group"){let i=l(t.width),n=l(t.height);return o.useDefaults?K(W({},e),{type:"default-group",width:i,height:n,color:l(t.color??G.color),resizable:l(t.resizable??G.resizable)}):K(W({},e),{type:"default-group",width:i,height:n,color:y(t.color)?l(t.color):void 0,resizable:y(t.resizable)?l(t.resizable):void 0})}if(t.type==="template-group"){let i=l(t.width),n=l(t.height);return o.useDefaults?K(W({},e),{type:"template-group",width:i,height:n,data:l(t.data??G.data)}):K(W({},e),{type:"template-group",width:i,height:n,data:y(t.data)?l(t.data):void 0})}if(ht(t.type)||pt(t.type))return o.useDefaults?K(W({},e),{type:t.type,data:l(t.data??G.data),width:l(t.width??G.width),height:l(t.height??G.height)}):K(W({},e),{type:t.type,data:y(t.data)?l(t.data):void 0,width:y(t.width)?l(t.width):void 0,height:y(t.height)?l(t.height):void 0});throw new Error(`Unknown node type for node with id ${t.id}`)}function Kr(t,o={useDefaults:!0}){return o.useDefaults?t.map(e=>Pi(e,{useDefaults:!0})):t.map(e=>Pi(e,{useDefaults:!1}))}var oe={type:"default",curve:"bezier",data:{},edgeLabels:{},markers:{},reconnectable:!1,floating:!1,selected:!1};function Ii(t,o={useDefaults:!0}){return o.useDefaults?{id:t.id,source:t.source,target:t.target,type:y(t.type)?t.type:oe.type,sourceHandle:y(t.sourceHandle)?t.sourceHandle:"",targetHandle:y(t.targetHandle)?t.targetHandle:"",curve:l(y(t.curve)?t.curve:oe.curve),data:l(y(t.data)?t.data:oe.data),edgeLabels:l(y(t.edgeLabels)?t.edgeLabels:oe.edgeLabels),markers:l(y(t.markers)?t.markers:oe.markers),reconnectable:l(y(t.reconnectable)?t.reconnectable:oe.reconnectable),floating:l(y(t.floating)?t.floating:oe.floating),selected:l(y(t.selected)?t.selected:oe.selected)}:{id:t.id,type:t.type,source:t.source,target:t.target,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle,curve:y(t.curve)?l(t.curve):void 0,data:y(t.data)?l(t.data):void 0,edgeLabels:y(t.edgeLabels)?l(t.edgeLabels):void 0,markers:y(t.markers)?l(t.markers):void 0,reconnectable:y(t.reconnectable)?l(t.reconnectable):void 0,floating:y(t.floating)?l(t.floating):void 0,selected:y(t.selected)?l(t.selected):void 0}}function os(t,o={useDefaults:!0}){return o.useDefaults?t.map(e=>Ii(e,{useDefaults:!0})):t.map(e=>Ii(e,{useDefaults:!1}))}var Q=(()=>{class t{constructor(){this.status=l({state:"idle",payload:null}),this.status$=b(this.status).pipe(Ue({bufferSize:1,refCount:!0}))}setIdleStatus(){this.status.set({state:"idle",payload:null})}setConnectionStartStatus(e,i){this.status.set({state:"connection-start",payload:{source:e,sourceHandle:i}})}setReconnectionStartStatus(e,i,n){this.status.set({state:"reconnection-start",payload:{source:e,sourceHandle:i,oldEdge:n}})}setConnectionValidationStatus(e,i,n,r,a){this.status.set({state:"connection-validation",payload:{source:i,target:n,sourceHandle:r,targetHandle:a,valid:e}})}setReconnectionValidationStatus(e,i,n,r,a,c){this.status.set({state:"reconnection-validation",payload:{source:i,target:n,sourceHandle:r,targetHandle:a,valid:e,oldEdge:c}})}setConnectionReleaseStatus(e,i,n,r){this.status.set({state:"connection-release",payload:{source:e,target:i,sourceHandle:n,targetHandle:r}})}setConnectionReleaseValidatedStatus(e,i,n,r,a){this.status.set({state:"connection-release-validated",payload:{source:e,target:i,sourceHandle:n,targetHandle:r,valid:a}})}setConnectionDroppedStatus(e,i){this.status.set({state:"connection-dropped",payload:{source:e,sourceHandle:i}})}setReconnectionReleaseStatus(e,i,n,r,a){this.status.set({state:"reconnection-release",payload:{source:e,target:i,sourceHandle:n,targetHandle:r,oldEdge:a}})}setReconnectionReleaseValidatedStatus(e,i,n,r,a,c){this.status.set({state:"reconnection-release-validated",payload:{source:e,target:i,sourceHandle:n,targetHandle:r,oldEdge:a,valid:c}})}setReconnectionDroppedStatus(e,i,n){this.status.set({state:"reconnection-dropped",payload:{source:e,sourceHandle:i,oldEdge:n}})}setNodeDragStartStatus(e){this.status.set({state:"node-drag-start",payload:{node:e}})}setNodeDragStatus(e){this.status.set({state:"node-drag",payload:{node:e}})}setNodeDragEndStatus(e){this.status.set({state:"node-drag-end",payload:{node:e}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function Qt(t){return t.state==="node-drag-start"}function Jt(t){return t.state==="node-drag"}function $i(t){return t.state==="node-drag-end"}var et=class{constructor(o){this.settings=o,this.curve=o.curve??"bezier",this.type=o.type??"default",this.mode=o.mode??"strict",this.allowSelfConnections=o.allowSelfConnections??!1;let e=[];this.allowSelfConnections||e.push(Fn),this.mode==="strict"&&e.push(In),this.mode==="loose"&&e.push($n),o.validator&&e.push(o.validator),this.validator=i=>e.every(n=>n(i))}},Fn=t=>t.source!==t.target,In=t=>t.sourceHandleType!==t.targetHandleType,$n=t=>t.sourceHandle!==void 0&&t.targetHandle!==void 0;function De(t){return t.split("").reduce((o,e)=>(o=(o<<5)-o+e.charCodeAt(0),o&o),0)}var B=(()=>{class t{constructor(){this.nodes=l([],{equal:(e,i)=>!e.length&&!i.length?!0:e===i}),this.nodeByIdMap=f(()=>{let e=new Map;return this.nodes().forEach(i=>{e.set(i.rawNode.id,i)}),e}),this.nodesByParentIdMap=f(()=>{let e=new Map;return this.nodes().forEach(i=>{if(!i.rawNode.parentId)return;let n=i.rawNode.parentId();if(!n)return;let r=e.get(n);r?(r.push(i),e.set(n,r)):e.set(n,[i])}),e}),this.rawNodes=f(()=>this.nodes().map(e=>e.rawNode)),this.edges=l([],{equal:(e,i)=>!e.length&&!i.length?!0:e===i}),this.rawEdges=f(()=>this.edges().map(e=>e.edge)),this.validEdges=f(()=>{let e=this.nodes();return this.edges().filter(i=>e.includes(i.source())&&e.includes(i.target()))}),this.connection=l(new et({})),this.markers=f(()=>{let e=new Map;this.validEdges().forEach(n=>{let r=n.markers();if(r?.start){let a=De(JSON.stringify(r.start));e.set(a,r.start)}if(r?.end){let a=De(JSON.stringify(r.end));e.set(a,r.end)}});let i=this.connection().settings.marker;if(i){let n=De(JSON.stringify(i));e.set(n,i)}return e}),this.entities=f(()=>[...this.nodes(),...this.edges()]),this.minimap=l(null)}getNode(e){return this.nodes().find(({rawNode:i})=>i.id===e)}getDetachedEdges(){return this.edges().filter(e=>e.detached())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function Kt(t){let o=t.sourceHandle.rawHandle.type,e=t.targetHandle.rawHandle.type;if(o===e)return{source:t.source,sourceHandle:t.sourceHandle,target:t.target,targetHandle:t.targetHandle};let i={};return o==="source"?(i.source=t.source,i.sourceHandle=t.sourceHandle):(i.source=t.target,i.sourceHandle=t.targetHandle),e==="target"?(i.target=t.target,i.targetHandle=t.targetHandle):(i.target=t.source,i.targetHandle=t.sourceHandle),i}function ji(t){return{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}}}function Li(t){return{valid:t.payload.valid,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:t.payload.target.rawNode,handle:{id:t.payload.targetHandle.rawHandle.id,type:t.payload.targetHandle.rawHandle.type,position:t.payload.targetHandle.rawHandle.position}}}}function Ai(t){return{valid:null,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:null,handle:null}}}function Gi(t){return{edge:t.payload.oldEdge.edge,node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}}}function Bi(t){return{valid:t.payload.valid,edge:t.payload.oldEdge.edge,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:t.payload.target.rawNode,handle:{id:t.payload.targetHandle.rawHandle.id,type:t.payload.targetHandle.rawHandle.type,position:t.payload.targetHandle.rawHandle.position}}}}function Wi(t){return{valid:null,edge:t.payload.oldEdge.edge,from:{node:t.payload.source.rawNode,handle:{id:t.payload.sourceHandle.rawHandle.id,type:t.payload.sourceHandle.rawHandle.type,position:t.payload.sourceHandle.rawHandle.position}},to:{node:null,handle:null}}}var Ht=(()=>{class t{constructor(){this.statusService=s(Q),this.flowEntitiesService=s(B),this.connectStart=X(this.statusService.status$.pipe(H(e=>e.state==="connection-start"),S(ji))),this.connect=X(this.statusService.status$.pipe(H(e=>e.state==="connection-release"),S(e=>Xi(e,this.isStrictMode())),I(e=>{let i=this.statusService.status();this.statusService.setConnectionReleaseValidatedStatus(i.payload.source,i.payload.target,i.payload.sourceHandle,i.payload.targetHandle,this.flowEntitiesService.connection().validator(e))}),H(e=>this.flowEntitiesService.connection().validator(e)))),this.connectEnd=X(U(this.statusService.status$.pipe(H(e=>e.state==="connection-release-validated"),S(Li)),this.statusService.status$.pipe(H(e=>e.state==="connection-dropped"),S(Ai))).pipe(I(()=>this.statusService.setIdleStatus()))),this.reconnectStart=X(this.statusService.status$.pipe(H(e=>e.state==="reconnection-start"),S(Gi))),this.reconnect=X(b(this.statusService.status).pipe(H(e=>e.state==="reconnection-release"),S(e=>{let i=Xi(e,this.isStrictMode()),n=e.payload.oldEdge.edge;return{connection:i,oldEdge:n}}),I(({connection:e})=>{let i=this.statusService.status();this.statusService.setReconnectionReleaseValidatedStatus(i.payload.source,i.payload.target,i.payload.sourceHandle,i.payload.targetHandle,i.payload.oldEdge,this.flowEntitiesService.connection().validator(e))}),H(({connection:e})=>this.flowEntitiesService.connection().validator(e)))),this.reconnectEnd=X(U(this.statusService.status$.pipe(H(e=>e.state==="reconnection-release-validated"),S(Bi)),this.statusService.status$.pipe(H(e=>e.state==="reconnection-dropped"),S(Wi))).pipe(I(()=>this.statusService.setIdleStatus()))),this.isStrictMode=f(()=>this.flowEntitiesService.connection().mode==="strict")}startConnection(e){this.statusService.setConnectionStartStatus(e.parentNode,e)}startReconnection(e,i){this.statusService.setReconnectionStartStatus(e.parentNode,e,i)}validateConnection(e){let i=this.statusService.status();if(i.state==="connection-start"||i.state==="reconnection-start"){let n=i.state==="reconnection-start",r=i.payload.source,a=e.parentNode,c=i.payload.sourceHandle,m=e;if(this.isStrictMode()){let p=Kt({source:i.payload.source,sourceHandle:i.payload.sourceHandle,target:e.parentNode,targetHandle:e});r=p.source,a=p.target,c=p.sourceHandle,m=p.targetHandle}let u=this.flowEntitiesService.connection().validator({source:r.rawNode.id,target:a.rawNode.id,sourceHandle:c.rawHandle.id,targetHandle:m.rawHandle.id,sourceHandleType:c.rawHandle.type,targetHandleType:m.rawHandle.type});e.state.set(u?"valid":"invalid"),n?this.statusService.setReconnectionValidationStatus(u,i.payload.source,e.parentNode,i.payload.sourceHandle,e,i.payload.oldEdge):this.statusService.setConnectionValidationStatus(u,i.payload.source,e.parentNode,i.payload.sourceHandle,e)}}resetValidateConnection(e){e.state.set("idle");let i=this.statusService.status();(i.state==="connection-validation"||i.state==="reconnection-validation")&&(i.state==="reconnection-validation"?this.statusService.setReconnectionStartStatus(i.payload.source,i.payload.sourceHandle,i.payload.oldEdge):this.statusService.setConnectionStartStatus(i.payload.source,i.payload.sourceHandle))}endConnection(){let e=this.statusService.status();if(e.state==="connection-validation"||e.state==="reconnection-validation"){let i=e.state==="reconnection-validation",n=e.payload.source,r=e.payload.sourceHandle,a=e.payload.target,c=e.payload.targetHandle;i?this.statusService.setReconnectionReleaseStatus(n,a,r,c,e.payload.oldEdge):this.statusService.setConnectionReleaseStatus(n,a,r,c)}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","connectStart",""],["","connect",""],["","connectEnd",""],["","reconnectStart",""],["","reconnect",""],["","reconnectEnd",""]],outputs:{connectStart:"connectStart",connect:"connect",connectEnd:"connectEnd",reconnectStart:"reconnectStart",reconnect:"reconnect",reconnectEnd:"reconnectEnd"}})}}return t})();function Xi(t,o){let e=t.payload.source,i=t.payload.target,n=t.payload.sourceHandle,r=t.payload.targetHandle;if(o){let p=Kt({source:t.payload.source,sourceHandle:t.payload.sourceHandle,target:t.payload.target,targetHandle:t.payload.targetHandle});e=p.source,i=p.target,n=p.sourceHandle,r=p.targetHandle}let a=e.rawNode.id,c=i.rawNode.id,m=n.rawHandle.id,u=r.rawHandle.id;return{source:a,target:c,sourceHandle:m,targetHandle:u,sourceHandleType:n.rawHandle.type,targetHandleType:r.rawHandle.type}}var Oe=(()=>{class t{constructor(){this.host=s(Y).nativeElement,this.initialTouch$=new We,this.prevTouchEvent=null,this.mouseMovement$=le(this.host,"mousemove").pipe(S(e=>({x:e.clientX,y:e.clientY,movementX:e.movementX,movementY:e.movementY,target:e.target,originalEvent:e})),be(Pe),Ye()),this.touchMovement$=U(this.initialTouch$,le(this.host,"touchmove")).pipe(I(e=>e.preventDefault()),S(e=>{let i=e.touches[0]?.clientX??0,n=e.touches[0]?.clientY??0,r=this.prevTouchEvent?e.touches[0].pageX-this.prevTouchEvent.touches[0].pageX:0,a=this.prevTouchEvent?e.touches[0].pageY-this.prevTouchEvent.touches[0].pageY:0,c=document.elementFromPoint(i,n);return{x:i,y:n,movementX:r,movementY:a,target:c,originalEvent:e}}),I(e=>this.prevTouchEvent=e.originalEvent),be(Pe),Ye()),this.pointerMovement$=U(this.mouseMovement$,this.touchMovement$),this.touchEnd$=le(this.host,"touchend").pipe(S(e=>{let i=e.changedTouches[0]?.clientX??0,n=e.changedTouches[0]?.clientY??0,r=document.elementFromPoint(i,n);return{x:i,y:n,target:r,originalEvent:e}}),I(()=>this.prevTouchEvent=null),Ye()),this.mouseUp$=le(this.host,"mouseup").pipe(S(e=>{let i=e.clientX,n=e.clientY,r=e.target;return{x:i,y:n,target:r,originalEvent:e}}),Ye()),this.documentPointerEnd$=U(le(document,"mouseup"),le(document,"touchend")).pipe(Ye())}setInitialTouch(e){this.initialTouch$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["svg","rootPointer",""]]})}}return t})();var Yi=(t,o)=>{let e=Math.max(0,Math.min(t.x+t.width,o.x+o.width)-Math.max(t.x,o.x)),i=Math.max(0,Math.min(t.y+t.height,o.y+o.height)-Math.max(t.y,o.y));return Math.ceil(e*i)};function zt(t){if(t.length===0)return{x:0,y:0,width:0,height:0};let o={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return t.forEach(e=>{let i=jn(e);o=An(o,i)}),Ln(o)}function Ui(t,o,e){let i=o.find(r=>r.rawNode.id===t);if(!i)return[];let n=mt(i);return o.filter(r=>{if(r.rawNode.id===t)return!1;let a=Yi(mt(r),n);return e?.partially?a>0:a>=n.width*n.height})}function jn(t){return{x:t.point().x,y:t.point().y,x2:t.point().x+t.width(),y2:t.point().y+t.height()}}function mt(t){return{x:t.globalPoint().x,y:t.globalPoint().y,width:t.width(),height:t.height()}}function Ln({x:t,y:o,x2:e,y2:i}){return{x:t,y:o,width:e-t,height:i-o}}function An(t,o){return{x:Math.min(t.x,o.x),y:Math.min(t.y,o.y),x2:Math.max(t.x2,o.x2),y2:Math.max(t.y2,o.y2)}}function qi(t,o,e,i,n,r){let a=o/(t.width*(1+r)),c=e/(t.height*(1+r)),m=Math.min(a,c),u=Gn(m,i,n),p=t.x+t.width/2,M=t.y+t.height/2,h=o/2-p*u,T=e/2-M*u;return{x:h,y:T,zoom:u}}function Gn(t,o=0,e=1){return Math.min(Math.max(t,o),e)}function Bn(t,o,e){let i=t.zoom;return{x:-t.x/i,y:-t.y/i,width:o/i,height:e/i}}function Zi(t,o,e,i){let n=Bn(o,e,i);return!(t.x+t.width<n.x||t.x>n.x+n.width||t.y+t.height<n.y||t.y>n.y+n.height)}var Qi={detachedGroupsLayer:!1,virtualization:!1,virtualizationZoomThreshold:.5,lazyLoadTrigger:"immediate"};var P=(()=>{class t{constructor(){this.entitiesSelectable=l(!0),this.elevateNodesOnSelect=l(!0),this.elevateEdgesOnSelect=l(!0),this.autoPan=l(!0),this.view=l([400,400]),this.computedFlowWidth=l(0),this.computedFlowHeight=l(0),this.minZoom=l(.5),this.maxZoom=l(3),this.background=l({type:"solid",color:"#fff"}),this.snapGrid=l([1,1]),this.optimization=l(Qi),this.selectionMode=l("default")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var ee=(()=>{class t{constructor(){this.entitiesService=s(B),this.flowSettingsService=s(P),this.writableViewport=l({changeType:"initial",state:t.getDefaultViewport(),duration:0}),this.readableViewport=l(t.getDefaultViewport()),this.viewportChangeEnd$=new We}static getDefaultViewport(){return{zoom:1,x:0,y:0}}fitView(e={padding:.1,duration:0,nodes:[]}){let i=this.getBoundsNodes(e.nodes??[]),n=qi(zt(i),this.flowSettingsService.computedFlowWidth(),this.flowSettingsService.computedFlowHeight(),this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom(),e.padding??.1),r=e.duration??0;this.writableViewport.set({changeType:"absolute",state:n,duration:r})}triggerViewportChangeEvent(e){e==="end"&&this.viewportChangeEnd$.next()}getBoundsNodes(e){return e?.length?e.map(i=>this.entitiesService.nodes().find(({rawNode:n})=>n.id===i)).filter(i=>!!i):this.entitiesService.nodes()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var tt=t=>Math.round(t*100)/100;var _e=(()=>{class t{constructor(){this.element=s(Y).nativeElement}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["svg","rootSvgRef",""]]})}}return t})();var Re=(()=>{class t{constructor(){this.pointerMovementDirective=s(Oe),this.rootSvg=s(_e).element,this.host=s(Y).nativeElement,this.viewportService=s(ee),this.svgCurrentSpacePoint=f(()=>{this.viewportService.readableViewport();let e=this.currentPoint();return e?this.documentPointToFlowPoint({x:e.x,y:e.y}):{x:0,y:0}}),this.currentPoint=Et(this.pointerMovementDirective.pointerMovement$)}documentPointToFlowPoint(e){let i=this.rootSvg.createSVGPoint();return i.x=e.x,i.y=e.y,i.matrixTransform(this.host.getScreenCTM().inverse())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["g","spacePointContext",""]]})}}return t})();function Ji(t){return window.TouchEvent&&t instanceof TouchEvent}var it=(()=>{class t{constructor(){this.hostElement=s(Y).nativeElement,this.pointerMovementDirective=s(Oe),this.pointerOver=ct(),this.pointerOut=ct(),this.pointerStart=ct(),this.pointerEnd=ct(),this.wasPointerOver=!1,this.touchEnd=this.pointerMovementDirective.touchEnd$.pipe(H(({target:e})=>e===this.hostElement),I(({originalEvent:e})=>this.pointerEnd.emit(e)),Z()).subscribe(),this.touchOverOut=this.pointerMovementDirective.touchMovement$.pipe(I(({target:e,originalEvent:i})=>{this.handleTouchOverAndOut(e,i)}),Z()).subscribe()}onPointerStart(e){this.pointerStart.emit(e),Ji(e)&&this.pointerMovementDirective.setInitialTouch(e)}onPointerEnd(e){this.pointerEnd.emit(e)}onMouseOver(e){this.pointerOver.emit(e)}onMouseOut(e){this.pointerOut.emit(e)}handleTouchOverAndOut(e,i){e===this.hostElement?(this.pointerOver.emit(i),this.wasPointerOver=!0):(this.wasPointerOver&&this.pointerOut.emit(i),this.wasPointerOver=!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","pointerStart",""],["","pointerEnd",""],["","pointerOver",""],["","pointerOut",""]],hostBindings:function(i,n){i&1&&A("mousedown",function(a){return n.onPointerStart(a)})("touchstart",function(a){return n.onPointerStart(a)})("mouseup",function(a){return n.onPointerEnd(a)})("mouseover",function(a){return n.onMouseOver(a)})("mouseout",function(a){return n.onMouseOut(a)})},outputs:{pointerOver:"pointerOver",pointerOut:"pointerOut",pointerStart:"pointerStart",pointerEnd:"pointerEnd"}})}}return t})();function re(t,o){return Math.ceil(t/o)*o}var Wn=["resizer"],Xn=["resizable",""],Yn=["*"];function Un(t,o){if(t&1){let e=ie();C(),_(0,"g")(1,"line",1),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("top",n))}),z(),_(2,"line",2),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("left",n))}),z(),_(3,"line",3),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("bottom",n))}),z(),_(4,"line",4),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("right",n))}),z(),_(5,"rect",5),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("top-left",n))}),z(),_(6,"rect",6),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("top-right",n))}),z(),_(7,"rect",7),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("bottom-left",n))}),z(),_(8,"rect",8),A("pointerStart",function(n){j(e);let r=d();return L(r.startResize("bottom-right",n))}),z()()}if(t&2){let e=d();g(),w("x1",e.lineGap)("y1",-e.gap())("x2",e.model.width()-e.lineGap)("y2",-e.gap())("stroke",e.resizerColor()),g(),w("x1",-e.gap())("y1",e.lineGap)("x2",-e.gap())("y2",e.model.height()-e.lineGap)("stroke",e.resizerColor()),g(),w("x1",e.lineGap)("y1",e.model.height()+e.gap())("x2",e.model.width()-e.lineGap)("y2",e.model.height()+e.gap())("stroke",e.resizerColor()),g(),w("x1",e.model.width()+e.gap())("y1",e.lineGap)("x2",e.model.width()+e.gap())("y2",e.model.height()-e.lineGap)("stroke",e.resizerColor()),g(),w("x",-(e.handleSize/2)-e.gap())("y",-(e.handleSize/2)-e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),g(),w("x",e.model.width()-e.handleSize/2+e.gap())("y",-(e.handleSize/2)-e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),g(),w("x",-(e.handleSize/2)-e.gap())("y",e.model.height()-e.handleSize/2+e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor()),g(),w("x",e.model.width()-e.handleSize/2+e.gap())("y",e.model.height()-e.handleSize/2+e.gap())("width",e.handleSize)("height",e.handleSize)("fill",e.resizerColor())}}var Ki=(()=>{class t{get model(){return this.nodeAccessor.model()}constructor(){this.nodeAccessor=s(Te),this.rootPointer=s(Oe),this.viewportService=s(ee),this.spacePointContext=s(Re),this.settingsService=s(P),this.hostRef=s(Y),this.afService=s(ze),this.zone=s(fe),this.resizable=R(),this.resizerColor=R("#2e414c"),this.gap=R(1.5),this.resizer=Ie.required("resizer"),this.lineGap=3,this.handleSize=6,this.resizeSide=null,this.zoom=f(()=>this.viewportService.readableViewport().zoom??0),this.minWidth=0,this.minHeight=0,this.maxWidth=1/0,this.maxHeight=1/0,this.resizeOnGlobalMouseMove=this.rootPointer.pointerMovement$.pipe(H(()=>this.resizeSide!==null),H(e=>e.movementX!==0||e.movementY!==0),I(e=>this.resize(e)),Z()).subscribe(),this.endResizeOnGlobalMouseUp=this.rootPointer.documentPointerEnd$.pipe(I(()=>this.endResize()),Z()).subscribe(),Se(()=>{let e=this.resizable();typeof e=="boolean"?this.model.resizable.set(e):this.model.resizable.set(!0)})}ngOnInit(){this.model.controlledByResizer.set(!0),this.model.resizerTemplate.set(this.resizer())}ngOnDestroy(){this.model.controlledByResizer.set(!1)}ngAfterViewInit(){this.afService.batchAnimationFrame(()=>{this.minWidth=+getComputedStyle(this.hostRef.nativeElement).minWidth.replace("px","")||0,this.minHeight=+getComputedStyle(this.hostRef.nativeElement).minHeight.replace("px","")||0,this.maxWidth=+getComputedStyle(this.hostRef.nativeElement).maxWidth.replace("px","")||1/0,this.maxHeight=+getComputedStyle(this.hostRef.nativeElement).maxHeight.replace("px","")||1/0})}startResize(e,i){i.stopPropagation(),this.resizeSide=e,this.model.resizing.set(!0)}resize(e){if(!this.resizeSide)return;let i=qn(e.movementX,e.movementY,this.zoom()),n=this.applyResize(this.resizeSide,this.model,i,this.getDistanceToEdge(e)),{x:r,y:a,width:c,height:m}=Zn(n,this.model,this.resizeSide,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.model.setPoint({x:r,y:a}),this.model.width.set(c),this.model.height.set(m)})})}endResize(){this.resizeSide=null,this.model.resizing.set(!1)}getDistanceToEdge(e){let i=this.spacePointContext.documentPointToFlowPoint({x:e.x,y:e.y}),{x:n,y:r}=this.model.globalPoint();return{left:i.x-n,right:i.x-(n+this.model.width()),top:i.y-r,bottom:i.y-(r+this.model.height())}}applyResize(e,i,n,r){let{x:a,y:c}=i.point(),m=i.width(),u=i.height(),[p,M]=this.settingsService.snapGrid();switch(e){case"left":{let h=n.x+r.left,T=re(a+h,p),x=T-a;return{x:T,y:c,width:m-x,height:u}}case"right":{let h=n.x+r.right,T=re(m+h,p);return{x:a,y:c,width:T,height:u}}case"top":{let h=n.y+r.top,T=re(c+h,M),x=T-c;return{x:a,y:T,width:m,height:u-x}}case"bottom":{let h=n.y+r.bottom,T=re(u+h,M);return{x:a,y:c,width:m,height:T}}case"top-left":{let h=n.x+r.left,T=n.y+r.top,x=re(a+h,p),O=re(c+T,M),$=x-a,te=O-c;return{x,y:O,width:m-$,height:u-te}}case"top-right":{let h=n.x+r.right,T=n.y+r.top,x=re(c+T,M),O=x-c;return{x:a,y:x,width:re(m+h,p),height:u-O}}case"bottom-left":{let h=n.x+r.left,T=n.y+r.bottom,x=re(a+h,p),O=x-a;return{x,y:c,width:m-O,height:re(u+T,M)}}case"bottom-right":{let h=n.x+r.right,T=n.y+r.bottom;return{x:a,y:c,width:re(m+h,p),height:re(u+T,M)}}}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["","resizable",""]],viewQuery:function(i,n){i&1&&Le(n.resizer,Wn,5),i&2&&Ae()},inputs:{resizable:[1,"resizable"],resizerColor:[1,"resizerColor"],gap:[1,"gap"]},attrs:Xn,ngContentSelectors:Yn,decls:3,vars:0,consts:[["resizer",""],["stroke-width","2",1,"top",3,"pointerStart"],["stroke-width","2",1,"left",3,"pointerStart"],["stroke-width","2",1,"bottom",3,"pointerStart"],["stroke-width","2",1,"right",3,"pointerStart"],[1,"top-left",3,"pointerStart"],[1,"top-right",3,"pointerStart"],[1,"bottom-left",3,"pointerStart"],[1,"bottom-right",3,"pointerStart"]],template:function(i,n){i&1&&(xt(),D(0,Un,9,40,"ng-template",null,0,Hi),_t(2))},dependencies:[it],styles:[".top[_ngcontent-%COMP%]{cursor:n-resize}.left[_ngcontent-%COMP%]{cursor:w-resize}.right[_ngcontent-%COMP%]{cursor:e-resize}.bottom[_ngcontent-%COMP%]{cursor:s-resize}.top-left[_ngcontent-%COMP%]{cursor:nw-resize}.top-right[_ngcontent-%COMP%]{cursor:ne-resize}.bottom-left[_ngcontent-%COMP%]{cursor:sw-resize}.bottom-right[_ngcontent-%COMP%]{cursor:se-resize}"],changeDetection:0})}}return t})();function qn(t,o,e){return{x:tt(t/e),y:tt(o/e)}}function Zn(t,o,e,i,n,r,a){let{x:c,y:m,width:u,height:p}=t;u=Math.max(u,0),p=Math.max(p,0),u=Math.max(i,u),p=Math.max(n,p),u=Math.min(r,u),p=Math.min(a,p),c=Math.min(c,o.point().x+o.width()-i),m=Math.min(m,o.point().y+o.height()-n),c=Math.max(c,o.point().x+o.width()-r),m=Math.max(m,o.point().y+o.height()-a);let M=o.parent();if(M){let T=M.width(),x=M.height(),O=o.point().x,$=o.point().y;c=Math.max(c,0),m=Math.max(m,0),e.includes("left")&&c===0&&(u=Math.min(u,O+o.width())),e.includes("top")&&m===0&&(p=Math.min(p,$+o.height())),u=Math.min(u,T-c),p=Math.min(p,x-m)}let h=zt(o.children());return h&&(e.includes("left")&&(c=Math.min(c,o.point().x+o.width()-(h.x+h.width)),u=Math.max(u,h.x+h.width)),e.includes("right")&&(u=Math.max(u,h.x+h.width)),e.includes("bottom")&&(p=Math.max(p,h.y+h.height)),e.includes("top")&&(m=Math.min(m,o.point().y+o.height()-(h.y+h.height)),p=Math.max(p,h.y+h.height))),{x:c,y:m,width:u,height:p}}function ei(){let t=window.navigator.userAgent.toLowerCase(),o=/(macintosh|macintel|macppc|mac68k|macos)/i,e=/(win32|win64|windows|wince)/i,i=/(iphone|ipad|ipod)/i,n=null;return o.test(t)?n="macos":i.test(t)?n="ios":e.test(t)?n="windows":/android/.test(t)?n="android":!n&&/linux/.test(t)&&(n="linux"),n}var ut=(()=>{class t{constructor(){this.actions=l({multiSelection:[ei()==="macos"?"MetaLeft":"ControlLeft",ei()==="macos"?"MetaRight":"ControlRight"]}),this.actionsActive={multiSelection:!1},b(this.actions).pipe(ne(()=>U(le(document,"keydown").pipe(I(e=>{for(let i in this.actions())(this.actions()[i]??[]).includes(e.code)&&(this.actionsActive[i]=!0)})),le(document,"keyup").pipe(I(e=>{for(let i in this.actions())(this.actions()[i]??[]).includes(e.code)&&(this.actionsActive[i]=!1)})))),Z()).subscribe()}setShortcuts(e){this.actions.update(i=>W(W({},i),e))}isActiveAction(e){return this.actionsActive[e]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var Ot=class{select(o,e){o?.selected()||(e.isMultiSelectionActive||e.entities.forEach(i=>i.selected.set(!1)),o&&o.selected.set(!0))}handleViewportChange(o,e){let{start:i,end:n,target:r,delta:a}=o,c=Math.abs(n.x-i.x),m=Math.abs(n.y-i.y),u=c<a&&m<a,p=!r.closest(".selectable");u&&p&&this.select(null,e)}};var Rt=class{select(){}handleViewportChange(){}};var ke=(()=>{class t{constructor(){this.flowEntitiesService=s(B),this.keyboardService=s(ut),this.flowSettingsService=s(P),this.strategies={default:new Ot,manual:new Rt},this.currentStrategy=f(()=>this.strategies[this.flowSettingsService.selectionMode()]),this.viewport$=new We,this.viewportChangeSub=this.viewport$.pipe(I(({start:e,end:i,target:n})=>{e&&i&&n&&this.currentStrategy().handleViewportChange({start:e,end:i,target:n,delta:t.delta},{entities:this.flowEntitiesService.entities(),isMultiSelectionActive:this.keyboardService.isActiveAction("multiSelection")})}),Z()).subscribe()}static{this.delta=6}setViewport(e){this.viewport$.next(e)}select(e){this.currentStrategy().select(e,{entities:this.flowEntitiesService.entities(),isMultiSelectionActive:this.keyboardService.isActiveAction("multiSelection")})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var kt=(()=>{class t{constructor(){this.rootSvg=s(_e).element,this.host=s(Y).nativeElement,this.selectionService=s(ke),this.viewportService=s(ee),this.flowSettingsService=s(P),this.zone=s(fe),this.rootSvgSelection=Ke(this.rootSvg),this.transform=l(""),this.viewportForSelection={},this.manualViewportChangeEffect=Se(()=>{let e=this.viewportService.writableViewport(),i=e.state;if(e.changeType!=="initial"){if(y(i.zoom)&&!y(i.x)&&!y(i.y)){this.rootSvgSelection.transition().duration(e.duration).call(this.zoomBehavior.scaleTo,i.zoom);return}if(y(i.x)&&y(i.y)&&!y(i.zoom)){let n=Je(this.viewportService.readableViewport).zoom;this.rootSvgSelection.transition().duration(e.duration).call(this.zoomBehavior.transform,At.translate(i.x,i.y).scale(n));return}if(y(i.x)&&y(i.y)&&y(i.zoom)){this.rootSvgSelection.transition().duration(e.duration).call(this.zoomBehavior.transform,At.translate(i.x,i.y).scale(i.zoom));return}}}),this.handleZoom=({transform:e})=>{this.viewportService.readableViewport.set(ti(e)),this.transform.set(e.toString())},this.handleZoomStart=({transform:e})=>{this.viewportForSelection={start:ti(e)}},this.handleZoomEnd=({transform:e,sourceEvent:i})=>{this.zone.run(()=>{this.viewportForSelection=K(W({},this.viewportForSelection),{end:ti(e),target:Qn(i)}),this.viewportService.triggerViewportChangeEvent("end"),this.selectionService.setViewport(this.viewportForSelection)})},this.filterCondition=e=>e.type==="mousedown"||e.type==="touchstart"?e.target.closest(".vflow-node")===null:!0}ngOnInit(){this.zone.runOutsideAngular(()=>{this.zoomBehavior=ki().scaleExtent([this.flowSettingsService.minZoom(),this.flowSettingsService.maxZoom()]).filter(this.filterCondition).on("start",this.handleZoomStart).on("zoom",this.handleZoom).on("end",this.handleZoomEnd),this.rootSvgSelection.call(this.zoomBehavior).on("dblclick.zoom",null)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["g","mapContext",""]],hostVars:1,hostBindings:function(i,n){i&2&&w("transform",n.transform())}})}}return t})(),ti=t=>({zoom:t.k,x:t.x,y:t.y}),Qn=t=>{if(t instanceof Event&&t.target instanceof Element)return t.target};var Mt=(()=>{class t{constructor(){this.entitiesService=s(B),this.settingsService=s(P),this.flowStatusService=s(Q),this.viewportService=s(ee),this.injector=s(ue)}enable(e,i){Ke(e).call(this.getDragBehavior(i))}disable(e){Ke(e).call(Lt().on("drag",null))}destroy(e){Ke(e).on(".drag",null)}getDragBehavior(e){let i=[],n=[],r=null,a=c=>e.dragHandlesCount()?!!c.target.closest(".vflow-drag-handle"):!0;return Lt().filter(a).on("start",c=>{i=this.getDragNodes(e),this.flowStatusService.setNodeDragStartStatus(e),n=i.map(m=>({x:m.point().x-c.x,y:m.point().y-c.y})),r=this.moveNodesOnAutoPan$(i)}).on("drag",c=>{i.forEach((m,u)=>{let p={x:tt(c.x+n[u].x),y:tt(c.y+n[u].y)};this.alignToGrid(p),this.moveNode(m,p)}),this.flowStatusService.setNodeDragStatus(e)}).on("end",()=>{r?.unsubscribe(),r=null,this.flowStatusService.setNodeDragEndStatus(e)})}getDragNodes(e){return e.selected()?this.entitiesService.nodes().filter(i=>i.selected()&&i.draggable()):[e]}moveNode(e,i){let n=e.parent();e.extent()==="parent"&&n&&(i.x=Math.min(n.width()-e.width(),i.x),i.x=Math.max(0,i.x),i.y=Math.min(n.height()-e.height(),i.y),i.y=Math.max(0,i.y)),e.setPoint(i)}alignToGrid(e){let[i,n]=this.settingsService.snapGrid();return i>1&&(e.x=re(e.x,i)),n>1&&(e.y=re(e.y,n)),e}moveNodesOnAutoPan$(e){return b(this.viewportService.readableViewport,{injector:this.injector}).pipe(me(1),we(),H(([i,n])=>i.x!==n.x||i.y!==n.y)).subscribe(([i,n])=>{let r=n.x-i.x,a=n.y-i.y,c=n.zoom,m=-r/c,u=-a/c;e.forEach(p=>{let M={x:p.point().x+m,y:p.point().y+u};this.moveNode(p,M)})})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function ii(t,o){let e=t.reduce((i,n)=>(i[n.rawNode.id]=n,i),{});o.forEach(i=>{i.source.set(e[i.edge.source]),i.target.set(e[i.edge.target])})}function en(t,o,e){!o&&yi(t);let i=o??s(ue);return e?lt(i,e):i}function Me(t,o){let e=en(Me,o?.injector),i;return f(()=>(i||(i=Je(()=>Et(t,K(W({},o),{injector:e})))),i()))}function tn(t){return t.rawNode.type==="default-group"||t.rawNode.type==="template-group"}var pe=(()=>{class t{constructor(){this.flowEntitiesService=s(B),this.flowSettingsService=s(P),this.viewportService=s(ee),this.maxOrder=0,this.nodes=f(()=>this.flowSettingsService.optimization().virtualization?this.viewportNodesAfterInteraction().sort((e,i)=>e.renderOrder()-i.renderOrder()):[...this.flowEntitiesService.nodes()].sort((e,i)=>e.renderOrder()-i.renderOrder())),this.groups=f(()=>this.nodes().filter(e=>!!e.children().length||tn(e))),this.nonGroups=f(()=>this.nodes().filter(e=>!this.groups().includes(e))),this.viewportNodes=f(()=>{let e=this.flowEntitiesService.nodes(),i=this.viewportService.readableViewport(),n=this.flowSettingsService.computedFlowWidth(),r=this.flowSettingsService.computedFlowHeight();return e.filter(a=>{let{x:c,y:m}=a.globalPoint(),u=a.width(),p=a.height();return Zi({x:c,y:m,width:u,height:p},i,n,r)})}),this.viewportNodesAfterInteraction=Me(U(b(this.flowEntitiesService.nodes).pipe(be(Xe),H(e=>!!e.length)),this.viewportService.viewportChangeEnd$.pipe(fi(300))).pipe(S(()=>{let e=this.viewportService.readableViewport(),i=this.flowSettingsService.optimization().virtualizationZoomThreshold;return e.zoom<i?[]:this.viewportNodes()})),{initialValue:[]})}pullNode(e){this.maxOrder++,e.renderOrder.set(this.maxOrder),e.children().forEach(i=>this.pullNode(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function Ge(t,o){o||(o={equal:Object.is});let e;return f(()=>e=t(e),o)}var Nt=class{constructor(o){this.rawNode=o,this.entitiesService=s(B),this.settingsService=s(P),this.nodeRenderingService=s(pe),this.isVisible=l(!1),this.point=l({x:0,y:0}),this.width=l(G.width),this.height=l(G.height),this.styleWidth=f(()=>this.controlledByResizer()?`${this.width()}px`:"100%"),this.styleHeight=f(()=>this.controlledByResizer()?`${this.height()}px`:"100%"),this.foWidth=f(()=>this.width()+2),this.foHeight=f(()=>this.height()+2),this.renderOrder=l(0),this.selected=l(!1),this.preview=l({style:{}}),this.extent=l(G.extent),this.globalPoint=f(()=>{let e=this.parent(),i=this.point().x,n=this.point().y;for(;e!==null;)i+=e.point().x,n+=e.point().y,e=e.parent();return{x:i,y:n}}),this.pointTransform=f(()=>`translate(${this.globalPoint().x}, ${this.globalPoint().y})`),this.handles=l([]),this.draggable=l(!0),this.dragHandlesCount=l(0),this.magnetRadius=20,this.isComponentType=Fi(this.rawNode),this.shouldLoad=Ge(e=>{if(e||this.settingsService.optimization().lazyLoadTrigger==="immediate")return!0;if(this.settingsService.optimization().lazyLoadTrigger==="viewport"){if(ht(this.rawNode.type))return!0;if(pt(this.rawNode.type)||this.rawNode.type==="html-template"||this.rawNode.type==="svg-template"||this.rawNode.type==="template-group")return this.nodeRenderingService.viewportNodes().includes(this)}return!0}),this.componentInstance$=b(this.shouldLoad).pipe(H(Boolean),ne(()=>this.rawNode.type()),ui(()=>pi(this.rawNode.type)),Ue(1)),this.text=l(G.text),this.componentTypeInputs={node:this.rawNode},this.parent=f(()=>{let e=this.parentId();return e?this.entitiesService.nodeByIdMap().get(e)??null:null}),this.children=f(()=>this.entitiesService.nodesByParentIdMap().get(this.rawNode.id)??[]),this.color=l(G.color),this.controlledByResizer=l(!1),this.resizable=l(G.resizable),this.resizing=l(!1),this.resizerTemplate=l(null),this.context={$implicit:{}},this.parentId=l(G.parentId),o.point&&(this.point=o.point),o.width&&(this.width=o.width),o.height&&(this.height=o.height),o.draggable&&(this.draggable=o.draggable),o.parentId&&(this.parentId=o.parentId),o.preview&&(this.preview=o.preview),o.selected&&(this.selected=o.selected),o.extent&&(this.extent=o.extent),o.type==="default-group"&&o.color&&(this.color=o.color),o.type==="default-group"&&o.resizable&&(this.resizable=o.resizable),o.type==="default"&&o.text&&(this.text=o.text),o.type==="html-template"&&(this.context={$implicit:{node:o,data:o.data??l(G.data),selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}}),o.type==="svg-template"&&(this.context={$implicit:{node:o,data:o.data??l(G.data),selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),o.type==="template-group"&&(this.context={$implicit:{node:o,data:o.data??l(G.data),selected:this.selected.asReadonly(),width:this.width.asReadonly(),height:this.height.asReadonly(),shouldLoad:this.shouldLoad}}),this.point$=b(this.point),this.width$=b(this.width),this.height$=b(this.height),this.selected$=b(this.selected),this.handles$=b(this.handles)}setPoint(o){this.point.set(o)}};var nt=class{constructor(o){this.edgeLabel=o,this.size=l({width:0,height:0})}};function ye(t,o,e){return{x:(1-e)*t.x+e*o.x,y:(1-e)*t.y+e*o.y}}function ft({sourcePoint:t,targetPoint:o}){return{path:`M ${t.x},${t.y}L ${o.x},${o.y}`,labelPoints:{start:ye(t,o,.15),center:ye(t,o,.5),end:ye(t,o,.85)}}}function gt({sourcePoint:t,targetPoint:o,sourcePosition:e,targetPosition:i}){let n={x:t.x-o.x,y:t.y-o.y},r=nn(t,e,n),a=nn(o,i,n),c=`M${t.x},${t.y} C${r.x},${r.y} ${a.x},${a.y} ${o.x},${o.y}`;return Jn(c,t,o,r,a)}function nn(t,o,e){let i={x:0,y:0};switch(o){case"top":i.y=1;break;case"bottom":i.y=-1;break;case"right":i.x=1;break;case"left":i.x=-1;break}let n={x:e.x*Math.abs(i.x),y:e.y*Math.abs(i.y)},a=.25*25*Math.sqrt(Math.abs(n.x+n.y));return{x:t.x+i.x*a,y:t.y-i.y*a}}function Jn(t,o,e,i,n){return{path:t,labelPoints:{start:oi(o,e,i,n,.1),center:oi(o,e,i,n,.5),end:oi(o,e,i,n,.9)}}}function oi(t,o,e,i,n){let r=ye(t,e,n),a=ye(e,i,n),c=ye(i,o,n);return ye(ye(r,a,n),ye(a,c,n),n)}var on={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1}};function Kn(t,o){let e=Math.abs(o.x-t.x)/2,i=o.x<t.x?o.x+e:o.x-e,n=Math.abs(o.y-t.y)/2,r=o.y<t.y?o.y+n:o.y-n;return[i,r,e,n]}var eo=({source:t,sourcePosition:o="bottom",target:e})=>o==="left"||o==="right"?t.x<e.x?{x:1,y:0}:{x:-1,y:0}:t.y<e.y?{x:0,y:1}:{x:0,y:-1},rn=(t,o)=>Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2));function to({source:t,sourcePosition:o="bottom",target:e,targetPosition:i="top",offset:n}){let r=on[o],a=on[i],c={x:t.x+r.x*n,y:t.y+r.y*n},m={x:e.x+a.x*n,y:e.y+a.y*n},u=eo({source:c,sourcePosition:o,target:m}),p=u.x!==0?"x":"y",M=u[p],h=[],T,x,O={x:0,y:0},$={x:0,y:0},[te,ge]=Kn(t,e);if(r[p]*a[p]===-1){T=te,x=ge;let se=[{x:T,y:c.y},{x:T,y:m.y}],J=[{x:c.x,y:x},{x:m.x,y:x}];r[p]===M?h=p==="x"?se:J:h=p==="x"?J:se}else{let se=[{x:c.x,y:m.y}],J=[{x:m.x,y:c.y}];if(p==="x"?h=r.x===M?J:se:h=r.y===M?se:J,o===i){let Ee=Math.abs(t[p]-e[p]);if(Ee<=n){let Ve=Math.min(n-1,n-Ee);r[p]===M?O[p]=(c[p]>t[p]?-1:1)*Ve:$[p]=(m[p]>e[p]?-1:1)*Ve}}if(o!==i){let Ee=p==="x"?"y":"x",Ve=r[p]===a[Ee],li=c[Ee]>m[Ee],ci=c[Ee]<m[Ee];(r[p]===1&&(!Ve&&li||Ve&&ci)||r[p]!==1&&(!Ve&&ci||Ve&&li))&&(h=p==="x"?se:J)}let ve={x:c.x+O.x,y:c.y+O.y},he={x:m.x+$.x,y:m.y+$.y},Nn=Math.max(Math.abs(ve.x-h[0].x),Math.abs(he.x-h[0].x)),Vn=Math.max(Math.abs(ve.y-h[0].y),Math.abs(he.y-h[0].y));Nn>=Vn?(T=(ve.x+he.x)/2,x=h[0].y):(T=h[0].x,x=(ve.y+he.y)/2)}return[[t,{x:c.x+O.x,y:c.y+O.y},...h,{x:m.x+$.x,y:m.y+$.y},e],T,x]}function io(t,o,e,i){let n=Math.min(rn(t,o)/2,rn(o,e)/2,i),{x:r,y:a}=o;if(t.x===r&&r===e.x||t.y===a&&a===e.y)return`L${r} ${a}`;if(t.y===a){let u=t.x<e.x?-1:1,p=t.y<e.y?1:-1;return`L ${r+n*u},${a}Q ${r},${a} ${r},${a+n*p}`}let c=t.x<e.x?1:-1,m=t.y<e.y?-1:1;return`L ${r},${a+n*m}Q ${r},${a} ${r+n*c},${a}`}function Ne({sourcePoint:t,targetPoint:o,sourcePosition:e,targetPosition:i},n=5){let[r,a,c]=to({source:t,sourcePosition:e,target:o,targetPosition:i,offset:20}),m=r.reduce((x,O,$)=>{let te="";return $>0&&$<r.length-1?te=io(r[$-1],O,r[$+1],n):te=`${$===0?"M":"L"}${O.x} ${O.y}`,x+=te,x},""),u=r.length;if(u<2)return{path:m,labelPoints:{start:{x:a,y:c},center:{x:a,y:c},end:{x:a,y:c}}};let p=new Array(u-1),M=new Array(u);M[0]=0;let h=0;for(let x=0;x<u-1;x++){let O=r[x+1].x-r[x].x,$=r[x+1].y-r[x].y,te=Math.sqrt(O*O+$*$);p[x]=te,h+=te,M[x+1]=h}let T=x=>{let O=h*x;if(O<=0)return r[0];if(O>=h)return r[u-1];let $=0,te=u-1;for(;$<te-1;){let he=$+te>>>1;M[he]<O?$=he:te=he}let ge=M[$],se=(O-ge)/p[$],J=r[$],ve=r[$+1];return{x:J.x+(ve.x-J.x)*se,y:J.y+(ve.y-J.y)*se}};return{path:m,labelPoints:{start:T(.15),center:{x:a,y:c},end:T(.85)}}}var Vt=class{constructor(o){this.edge=o,this.flowEntitiesService=s(B),this.source=l(void 0),this.target=l(void 0),this.curve=l(oe.curve),this.reconnectable=l(oe.reconnectable),this.floating=l(oe.floating),this.markers=l(oe.markers),this.edgeLabels=l(oe.edgeLabels),this.selected=l(oe.selected),this.selected$=b(this.selected),this.shouldLoad=f(()=>(this.source()?.shouldLoad()??!1)&&(this.target()?.shouldLoad()??!1)),this.renderOrder=l(0),this.detached=f(()=>{let e=this.source(),i=this.target();if(!e||!i)return!0;let n=!1,r=!1;return this.edge.sourceHandle?n=!!e.handles().find(a=>a.rawHandle.id===this.edge.sourceHandle):n=!!e.handles().find(a=>a.rawHandle.type==="source"),this.edge.targetHandle?r=!!i.handles().find(a=>a.rawHandle.id===this.edge.targetHandle):r=!!i.handles().find(a=>a.rawHandle.type==="target"),!n||!r}),this.detached$=b(this.detached),this.path=f(()=>{let e=this.sourceHandle(),i=this.targetHandle();if(!e||!i)return{path:""};let n=this.getPathFactoryParams(e,i),r=this.curve();switch(r){case"straight":return ft(n);case"bezier":return gt(n);case"smooth-step":return Ne(n);case"step":return Ne(n,0);default:return r(n)}}),this.sourceHandle=Ge(e=>{let i=null;return this.floating()?i=this.closestHandles().sourceHandle:this.edge.sourceHandle?i=this.source()?.handles().find(n=>n.rawHandle.id===this.edge.sourceHandle)??null:i=this.source()?.handles().find(n=>n.rawHandle.type==="source")??null,i===null?e:i}),this.targetHandle=Ge(e=>{let i=null;return this.floating()?i=this.closestHandles().targetHandle:this.edge.targetHandle?i=this.target()?.handles().find(n=>n.rawHandle.id===this.edge.targetHandle)??null:i=this.target()?.handles().find(n=>n.rawHandle.type==="target")??null,i===null?e:i}),this.closestHandles=f(()=>{let e=this.source(),i=this.target();if(!e||!i)return{sourceHandle:null,targetHandle:null};let n=this.flowEntitiesService.connection().mode==="strict"?e.handles().filter(u=>u.rawHandle.type==="source"):e.handles(),r=this.flowEntitiesService.connection().mode==="strict"?i.handles().filter(u=>u.rawHandle.type==="target"):i.handles();if(n.length===0||r.length===0)return{sourceHandle:null,targetHandle:null};let a=1/0,c=null,m=null;for(let u of n)for(let p of r){let M=u.pointAbsolute(),h=p.pointAbsolute(),T=Math.sqrt(Math.pow(M.x-h.x,2)+Math.pow(M.y-h.y,2));T<a&&(a=T,c=u,m=p)}return{sourceHandle:c,targetHandle:m}}),this.markerStartUrl=f(()=>{let e=this.markers()?.start;return e?`url(#${De(JSON.stringify(e))})`:""}),this.markerEndUrl=f(()=>{let e=this.markers()?.end;return e?`url(#${De(JSON.stringify(e))})`:""}),this.labelModels=f(()=>{let e={},i=this.edgeLabels();return i?.start&&(e.start=new nt(i.start)),i?.center&&(e.center=new nt(i.center)),i?.end&&(e.end=new nt(i.end)),e}),this.type=o.type??oe.type,o.curve&&(this.curve=o.curve),o.reconnectable&&(this.reconnectable=o.reconnectable),o.floating&&(this.floating=o.floating),o.selected&&(this.selected=o.selected),o.markers&&(this.markers=o.markers),o.edgeLabels&&(this.edgeLabels=o.edgeLabels),this.context={$implicit:{edge:this.edge,data:this.edge.data??l({}),path:f(()=>this.path().path),markerStart:this.markerStartUrl,markerEnd:this.markerEndUrl,selected:this.selected.asReadonly(),shouldLoad:this.shouldLoad}},this.selected$=b(this.selected)}getPathFactoryParams(o,e){return{mode:"edge",edge:this.edge,sourcePoint:o.pointAbsolute(),targetPoint:e.pointAbsolute(),sourcePosition:o.rawHandle.position,targetPosition:e.rawHandle.position,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}};var vt=class{static nodes(o,e){let i=new Map;return e.forEach(n=>i.set(n.rawNode,n)),o.map(n=>i.get(n)??new Nt(n))}static edges(o,e){let i=new Map;return e.forEach(n=>i.set(n.edge,n)),o.map(n=>i.has(n)?i.get(n):new Vt(n))}};var no=25,St=(()=>{class t{constructor(){this.entitiesService=s(B),this.nodesPositionChange$=b(this.entitiesService.nodes).pipe(ne(e=>U(...e.map(i=>i.point$.pipe(me(1),S(()=>i))))),S(e=>[{type:"position",id:e.rawNode.id,point:e.point()},...this.entitiesService.nodes().filter(i=>i!==e&&i.selected()).map(i=>({type:"position",id:i.rawNode.id,point:i.point()}))])),this.nodeSizeChange$=b(this.entitiesService.nodes).pipe(ne(e=>U(...e.map(i=>U(i.width$.pipe(me(1)),i.height$.pipe(me(1))).pipe(S(()=>i))))),S(e=>[{type:"size",id:e.rawNode.id,size:{width:e.width(),height:e.height()}}])),this.nodeAddChange$=b(this.entitiesService.nodes).pipe(we(),S(([e,i])=>i.filter(n=>!e.includes(n))),H(e=>!!e.length),S(e=>e.map(i=>({type:"add",id:i.rawNode.id})))),this.nodeRemoveChange$=b(this.entitiesService.nodes).pipe(we(),S(([e,i])=>e.filter(n=>!i.includes(n))),H(e=>!!e.length),S(e=>e.map(i=>({type:"remove",id:i.rawNode.id})))),this.nodeSelectedChange$=b(this.entitiesService.nodes).pipe(ne(e=>U(...e.map(i=>i.selected$.pipe(at(),me(1),S(()=>i))))),S(e=>[{type:"select",id:e.rawNode.id,selected:e.selected()}])),this.changes$=U(this.nodesPositionChange$,this.nodeSizeChange$,this.nodeAddChange$,this.nodeRemoveChange$,this.nodeSelectedChange$).pipe(be(Xe,no))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var oo=(t,o)=>t.length===o.length&&[...new Set([...t,...o])].every(e=>t.filter(i=>i===e).length===o.filter(i=>i===e).length),yt=(()=>{class t{constructor(){this.entitiesService=s(B),this.edgeDetachedChange$=U(b(f(()=>{let e=this.entitiesService.nodes();return Je(this.entitiesService.edges).filter(({source:n,target:r})=>!e.includes(n())||!e.includes(r()))})),b(this.entitiesService.edges).pipe(ne(e=>mi(...e.map(i=>i.detached$.pipe(S(()=>i))))),S(e=>e.filter(i=>i.detached())),me(2))).pipe(at(oo),H(e=>!!e.length),S(e=>e.map(({edge:i})=>({type:"detached",id:i.id})))),this.edgeAddChange$=b(this.entitiesService.edges).pipe(we(),S(([e,i])=>i.filter(n=>!e.includes(n))),H(e=>!!e.length),S(e=>e.map(({edge:i})=>({type:"add",id:i.id})))),this.edgeRemoveChange$=b(this.entitiesService.edges).pipe(we(),S(([e,i])=>e.filter(n=>!i.includes(n))),H(e=>!!e.length),S(e=>e.map(({edge:i})=>({type:"remove",id:i.id})))),this.edgeSelectChange$=b(this.entitiesService.edges).pipe(ne(e=>U(...e.map(i=>i.selected$.pipe(at(),me(1),S(()=>i))))),S(e=>[{type:"select",id:e.edge.id,selected:e.selected()}])),this.changes$=U(this.edgeDetachedChange$,this.edgeAddChange$,this.edgeRemoveChange$,this.edgeSelectChange$).pipe(be(Xe))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var sn=(()=>{class t{constructor(){this.nodesChangeService=s(St),this.edgesChangeService=s(yt),this.nodesChanges=X(this.nodesChangeService.changes$),this.nodesChangesPosition=X(this.nodeChangesOfType("position"),{alias:"nodesChanges.position"}),this.nodesChangesSize=X(this.nodeChangesOfType("size"),{alias:"nodesChanges.size"}),this.nodesChangesAdd=X(this.nodeChangesOfType("add"),{alias:"nodesChanges.add"}),this.nodesChangesRemove=X(this.nodeChangesOfType("remove"),{alias:"nodesChanges.remove"}),this.nodesChangesSelect=X(this.nodeChangesOfType("select"),{alias:"nodesChanges.select"}),this.edgesChanges=X(this.edgesChangeService.changes$),this.edgesChangesDetached=X(this.edgeChangesOfType("detached"),{alias:"edgesChanges.detached"}),this.edgesChangesAdd=X(this.edgeChangesOfType("add"),{alias:"edgesChanges.add"}),this.edgesChangesRemove=X(this.edgeChangesOfType("remove"),{alias:"edgesChanges.remove"}),this.edgesChangesSelect=X(this.edgeChangesOfType("select"),{alias:"edgesChanges.select"})}nodeChangesOfType(e){return this.nodesChangeService.changes$.pipe(S(i=>i.filter(n=>n.type===e)),H(i=>!!i.length))}edgeChangesOfType(e){return this.edgesChangeService.changes$.pipe(S(i=>i.filter(n=>n.type===e)),H(i=>!!i.length))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","changesController",""]],outputs:{nodesChanges:"nodesChanges",nodesChangesPosition:"nodesChanges.position",nodesChangesSize:"nodesChanges.size",nodesChangesAdd:"nodesChanges.add",nodesChangesRemove:"nodesChanges.remove",nodesChangesSelect:"nodesChanges.select",edgesChanges:"edgesChanges",edgesChangesDetached:"edgesChanges.detached",edgesChangesAdd:"edgesChanges.add",edgesChangesRemove:"edgesChanges.remove",edgesChangesSelect:"edgesChanges.select"}})}}return t})();function an(t){return typeof t=="string"?{type:"solid",color:t}:t}var Pt=(()=>{class t{constructor(){this.afService=s(ze),this.toolbars=l([]),this.nodeToolbarsMap=f(()=>{let e=new Map;return this.toolbars().forEach(i=>{let n=e.get(i.node)??[];e.set(i.node,[...n,i])}),e})}addToolbar(e){this.afService.batchAnimationFrame(()=>{this.toolbars.update(i=>[...i,e])})}removeToolbar(e){this.afService.batchAnimationFrame(()=>{this.toolbars.update(i=>i.filter(n=>n!==e))})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function Ft(t,o){return new Ct(e=>{let i=new ResizeObserver(n=>{o.run(()=>e.next(n))});return t.forEach(n=>i.observe(n)),()=>i.disconnect()})}var so=["edgeLabelWrapper"],ao=["edgeLabel",""];function lo(t,o){t&1&&ae(0)}function co(t,o){if(t&1&&(C(),_(0,"foreignObject"),He(),_(1,"div",1,0),D(3,lo,1,0,"ng-container",2),z()()),t&2){let e=d(2),i=d();w("x",i.edgeLabelPoint().x)("y",i.edgeLabelPoint().y)("width",e.size().width)("height",e.size().height),g(3),N("ngTemplateOutlet",o)("ngTemplateOutletContext",i.getLabelContext())}}function po(t,o){if(t&1&&D(0,co,4,6,":svg:foreignObject"),t&2){let e,i=d(2);v((e=i.htmlTemplate())?0:-1,e)}}function ho(t,o){if(t&1&&(C(),_(0,"foreignObject"),He(),_(1,"div",1,0),Di(3),z()()),t&2){let e=d(),i=d();w("x",i.edgeLabelPoint().x)("y",i.edgeLabelPoint().y)("width",e.size().width)("height",e.size().height),g(),bi(i.edgeLabelStyle()),g(2),Ei(" ",e.edgeLabel.text," ")}}function mo(t,o){if(t&1&&D(0,po,1,1)(1,ho,4,7,":svg:foreignObject"),t&2){let e=o,i=d();v(e.edgeLabel.type==="html-template"&&i.htmlTemplate()?0:-1),g(),v(e.edgeLabel.type==="default"?1:-1)}}var ln=(()=>{class t{constructor(){this.zone=s(fe),this.destroyRef=s(qe),this.settingsService=s(P),this.model=R.required(),this.edgeModel=R.required(),this.point=R({x:0,y:0}),this.htmlTemplate=R(),this.edgeLabelWrapperRef=Ie.required("edgeLabelWrapper"),this.edgeLabelPoint=f(()=>{let e=this.point(),{width:i,height:n}=this.model().size();return{x:e.x-i/2,y:e.y-n/2}}),this.edgeLabelStyle=f(()=>{let e=this.model().edgeLabel;if(e.type==="default"&&e.style){let i=this.settingsService.background(),n="transparent";return i.type==="dots"&&(n=i.backgroundColor??"#fff"),i.type==="solid"&&(n=i.color),e.style.backgroundColor=e.style.backgroundColor??n,e.style}return null})}ngAfterViewInit(){let e=this.edgeLabelWrapperRef().nativeElement;Ft([e],this.zone).pipe(vi(null),I(()=>{let i=e.clientWidth+2,n=e.clientHeight+2;this.model().size.set({width:i,height:n})}),Z(this.destroyRef)).subscribe()}getLabelContext(){return{$implicit:{edge:this.edgeModel().edge,label:this.model().edgeLabel}}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["g","edgeLabel",""]],viewQuery:function(i,n){i&1&&Le(n.edgeLabelWrapperRef,so,5),i&2&&Ae()},inputs:{model:[1,"model"],edgeModel:[1,"edgeModel"],point:[1,"point"],htmlTemplate:[1,"htmlTemplate"]},attrs:ao,decls:1,vars:1,consts:[["edgeLabelWrapper",""],[1,"edge-label-wrapper"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(i,n){if(i&1&&D(0,mo,2,2),i&2){let r;v((r=n.model())?0:-1,r)}},dependencies:[xe],styles:[".edge-label-wrapper[_ngcontent-%COMP%]{width:max-content;margin-top:1px;margin-left:1px}"],changeDetection:0})}}return t})();var Be=(()=>{class t{constructor(){this.flowEntitiesService=s(B),this.flowSettingsService=s(P),this.edges=f(()=>this.flowSettingsService.optimization().virtualization?this.viewportEdges().sort((e,i)=>e.renderOrder()-i.renderOrder()):[...this.flowEntitiesService.validEdges()].sort((e,i)=>e.renderOrder()-i.renderOrder())),this.viewportEdges=f(()=>this.flowEntitiesService.validEdges().filter(e=>{let i=e.sourceHandle(),n=e.targetHandle();return i&&n})),this.maxOrder=f(()=>Math.max(...this.flowEntitiesService.validEdges().map(e=>e.renderOrder())))}pull(e){e.renderOrder()!==0&&this.maxOrder()===e.renderOrder()||e.renderOrder.set(this.maxOrder()+1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var uo=["edge",""];function fo(t,o){if(t&1){let e=ie();C(),V(0,"path",0),_(1,"path",1),A("click",function(){j(e);let n=d();return n.select(),L(n.pull())}),z()}if(t&2){let e=d();Ze("edge_selected",e.model().selected()),w("d",e.model().path().path)("marker-start",e.model().markerStartUrl())("marker-end",e.model().markerEndUrl()),g(),w("d",e.model().path().path)}}function go(t,o){if(t&1&&ae(0,2),t&2){let e=d(2);N("ngTemplateOutlet",o)("ngTemplateOutletContext",e.model().context)("ngTemplateOutletInjector",e.injector)}}function vo(t,o){if(t&1&&D(0,go,1,3,"ng-container",2),t&2){let e,i=d();v((e=i.edgeTemplate())?0:-1,e)}}function So(t,o){if(t&1&&(C(),V(0,"g",3)),t&2){let e=d(),i=d();N("model",e)("point",o)("edgeModel",i.model())("htmlTemplate",i.edgeLabelHtmlTemplate())}}function yo(t,o){if(t&1&&D(0,So,1,4,":svg:g",3),t&2){let e,i=d();v((e=(e=i.model().path().labelPoints)==null?null:e.start)?0:-1,e)}}function wo(t,o){if(t&1&&(C(),V(0,"g",3)),t&2){let e=d(),i=d();N("model",e)("point",o)("edgeModel",i.model())("htmlTemplate",i.edgeLabelHtmlTemplate())}}function Co(t,o){if(t&1&&D(0,wo,1,4,":svg:g",3),t&2){let e,i=d();v((e=(e=i.model().path().labelPoints)==null?null:e.center)?0:-1,e)}}function xo(t,o){if(t&1&&(C(),V(0,"g",3)),t&2){let e=d(),i=d();N("model",e)("point",o)("edgeModel",i.model())("htmlTemplate",i.edgeLabelHtmlTemplate())}}function _o(t,o){if(t&1&&D(0,xo,1,4,":svg:g",3),t&2){let e,i=d();v((e=(e=i.model().path().labelPoints)==null?null:e.end)?0:-1,e)}}function bo(t,o){if(t&1){let e=ie();C(),_(0,"circle",5),A("pointerStart",function(n){j(e);let r=d(2);return L(r.startReconnection(n,r.model().targetHandle()))}),z()}if(t&2){let e=d(2);w("cx",e.model().sourceHandle().pointAbsolute().x)("cy",e.model().sourceHandle().pointAbsolute().y)}}function To(t,o){if(t&1){let e=ie();C(),_(0,"circle",5),A("pointerStart",function(n){j(e);let r=d(2);return L(r.startReconnection(n,r.model().sourceHandle()))}),z()}if(t&2){let e=d(2);w("cx",e.model().targetHandle().pointAbsolute().x)("cy",e.model().targetHandle().pointAbsolute().y)}}function Do(t,o){if(t&1&&D(0,bo,1,2,":svg:circle",4)(1,To,1,2,":svg:circle",4),t&2){let e=d();v(e.model().reconnectable()===!0||e.model().reconnectable()==="source"?0:-1),g(),v(e.model().reconnectable()===!0||e.model().reconnectable()==="target"?1:-1)}}var cn=(()=>{class t{constructor(){this.injector=s(ue),this.selectionService=s(ke),this.flowSettingsService=s(P),this.flowStatusService=s(Q),this.edgeRenderingService=s(Be),this.connectionController=s(Ht,{optional:!0}),this.model=R.required(),this.edgeTemplate=R(),this.edgeLabelHtmlTemplate=R(),this.isReconnecting=f(()=>{let e=this.flowStatusService.status();return(e.state==="reconnection-start"||e.state==="reconnection-validation")&&e.payload.oldEdge===this.model()})}select(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}pull(){this.flowSettingsService.elevateEdgesOnSelect()&&this.edgeRenderingService.pull(this.model())}startReconnection(e,i){e.stopPropagation(),this.connectionController?.startReconnection(i,this.model())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["g","edge",""]],hostAttrs:[1,"selectable"],hostVars:2,hostBindings:function(i,n){i&2&&Ce("visibility",n.isReconnecting()?"hidden":"visible")},inputs:{model:[1,"model"],edgeTemplate:[1,"edgeTemplate"],edgeLabelHtmlTemplate:[1,"edgeLabelHtmlTemplate"]},attrs:uo,decls:6,vars:6,consts:[[1,"edge"],[1,"interactive-edge",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["edgeLabel","",3,"model","point","edgeModel","htmlTemplate"],["r","10",1,"reconnect-handle"],["r","10",1,"reconnect-handle",3,"pointerStart"]],template:function(i,n){if(i&1&&D(0,fo,2,6)(1,vo,1,1)(2,yo,1,1)(3,Co,1,1)(4,_o,1,1)(5,Do,2,2),i&2){let r,a,c;v(n.model().type==="default"?0:-1),g(),v(n.model().type==="template"&&n.edgeTemplate()?1:-1),g(),v((r=n.model().labelModels().start)?2:-1,r),g(),v((a=n.model().labelModels().center)?3:-1,a),g(),v((c=n.model().labelModels().end)?4:-1,c),g(),v(n.model().sourceHandle()&&n.model().targetHandle()?5:-1)}},dependencies:[xe,ln,it],styles:[".edge[_ngcontent-%COMP%]{fill:none;stroke-width:2;stroke:#b1b1b7}.edge_selected[_ngcontent-%COMP%]{stroke-width:2.5;stroke:#0f4c75}.interactive-edge[_ngcontent-%COMP%]{fill:none;stroke-width:20;stroke:transparent}.reconnect-handle[_ngcontent-%COMP%]{fill:transparent;cursor:move}"],changeDetection:0})}}return t})();var dn=(()=>{class t{constructor(){this.handleModel=R.required({alias:"handleSizeController"}),this.handleWrapper=s(Y)}ngAfterViewInit(){let e=this.handleWrapper.nativeElement,i=e.getBBox(),n=Eo(e);this.handleModel().size.set({width:i.width+n,height:i.height+n})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","handleSizeController",""]],inputs:{handleModel:[1,"handleSizeController","handleModel"]}})}}return t})();function Eo(t){let o=t.firstElementChild;if(o){let e=getComputedStyle(o).strokeWidth,i=Number(e.replace("px",""));return isNaN(i)?0:i}return 0}var Ho=["*"],pn=(()=>{class t{constructor(){this.selected=R(!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["default-node"]],hostVars:2,hostBindings:function(i,n){i&2&&Ze("selected",n.selected())},inputs:{selected:[1,"selected"]},ngContentSelectors:Ho,decls:1,vars:0,template:function(i,n){i&1&&(xt(),_t(0))},styles:["[_nghost-%COMP%]{border:1.5px solid #1b262c;border-radius:5px;display:flex;align-items:center;justify-content:center;color:#000;background-color:#fff}.selected[_nghost-%COMP%]{border-width:2px}"],changeDetection:0})}}return t})();var ot=(()=>{class t{constructor(){this.zone=s(fe),this.thingsToObserve=new Map,this.resizeObserver=new ResizeObserver(e=>{this.zone.run(()=>{for(let i of e){let n=this.thingsToObserve.get(i.target);n!==void 0&&n.forEach(r=>r(i))}})})}addObserver(e,i){let n=this.thingsToObserve.get(e);n===void 0?this.thingsToObserve.set(e,[i]):n.push(i),this.resizeObserver.observe(e)}removeObserver(e){this.thingsToObserve.delete(e),this.resizeObserver&&this.resizeObserver.unobserve(e)}ngOnDestroy(){this.resizeObserver.disconnect()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var hn=(()=>{class t{constructor(){this.nodeAccessor=s(Te),this.destroyRef=s(qe),this.hostElementRef=s(Y),this.resizeObserverService=s(ot),this.requestAnimationFrameBatchingService=s(ze)}ngOnInit(){let e=this.nodeAccessor.model(),i=!1;e.handles$.pipe(we(),I(([n,r])=>{n.filter(m=>r.find(u=>u.hostReference===m.hostReference)===void 0).forEach(m=>this.resizeObserverService.removeObserver(m.hostReference));let c=r.filter(m=>n.find(u=>m.hostReference===u.hostReference)===void 0);i||(this.resizeObserverService.addObserver(this.hostElementRef.nativeElement,()=>{r.forEach(m=>m.updateHost())}),i=!0),c.forEach(m=>this.resizeObserverService.addObserver(m.hostReference,()=>{r.forEach(u=>u.updateHost())})),this.requestAnimationFrameBatchingService.batchAnimationFrame(()=>{r.forEach(m=>m.updateHost())})}),Z(this.destroyRef)).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","nodeHandlesController",""]]})}}return t})();var mn=(()=>{class t{constructor(){this.nodeAccessor=s(Te),this.resizeObserverService=s(ot),this.hostElementRef=s(Y)}ngOnInit(){let e=this.nodeAccessor.model();this.resizeObserverService.addObserver(this.hostElementRef.nativeElement,i=>{e.width.set(i.target.clientWidth),e.height.set(i.target.clientHeight)})}ngOnDestroy(){this.resizeObserverService.removeObserver(this.hostElementRef.nativeElement)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","nodeResizeController",""]]})}}return t})();var zo=["node",""];function Oo(t,o){if(t&1){let e=ie();C(),_(0,"foreignObject",3),A("click",function(){j(e);let n=d();return n.pullNode(),L(n.selectNode())}),He(),_(1,"default-node",4),V(2,"div",5)(3,"handle",6)(4,"handle",7),z()()}if(t&2){let e=d();w("width",e.model().foWidth())("height",e.model().foHeight()),g(),Ce("width",e.model().styleWidth())("height",e.model().styleHeight())("max-width",e.model().styleWidth())("max-height",e.model().styleHeight()),N("selected",e.model().selected()),g(),N("outerHTML",e.model().text(),Ci)}}function Ro(t,o){if(t&1){let e=ie();C(),_(0,"foreignObject",3),A("click",function(){j(e);let n=d();return L(n.pullNode())}),He(),_(1,"div",8),ae(2,9),z()()}if(t&2){let e,i=d();w("width",i.model().foWidth())("height",i.model().foHeight()),g(),Ce("width",i.model().styleWidth())("height",i.model().styleHeight()),g(),N("ngTemplateOutlet",(e=i.nodeTemplate())!==null&&e!==void 0?e:null)("ngTemplateOutletContext",i.model().context)("ngTemplateOutletInjector",i.injector)}}function ko(t,o){if(t&1){let e=ie();C(),_(0,"g",10),A("click",function(){j(e);let n=d();return L(n.pullNode())}),ae(1,9),z()}if(t&2){let e,i=d();g(),N("ngTemplateOutlet",(e=i.nodeSvgTemplate())!==null&&e!==void 0?e:null)("ngTemplateOutletContext",i.model().context)("ngTemplateOutletInjector",i.injector)}}function Mo(t,o){if(t&1){let e=ie();C(),_(0,"foreignObject",3),A("click",function(){j(e);let n=d(2);return L(n.pullNode())}),He(),_(1,"div",8),ae(2,11),z()()}if(t&2){let e=d(2);w("width",e.model().foWidth())("height",e.model().foHeight()),g(),Ce("width",e.model().styleWidth())("height",e.model().styleHeight()),g(),N("ngComponentOutlet",o)("ngComponentOutletInputs",e.model().componentTypeInputs)("ngComponentOutletInjector",e.injector)}}function No(t,o){if(t&1&&(D(0,Mo,3,9,":svg:foreignObject",0),Tt(1,"async")),t&2){let e,i=d();v((e=Dt(1,1,i.model().componentInstance$))?0:-1,e)}}function Vo(t,o){if(t&1){let e=ie();C(),_(0,"rect",12),A("click",function(){j(e);let n=d();return n.pullNode(),L(n.selectNode())}),z()}if(t&2){let e=d();Ce("stroke",e.model().color())("fill",e.model().color()),Ze("default-group-node_selected",e.model().selected()),N("resizable",e.model().resizable())("gap",3)("resizerColor",e.model().color()),w("width",e.model().width())("height",e.model().height())}}function Po(t,o){if(t&1){let e=ie();C(),_(0,"g",10),A("click",function(){j(e);let n=d();return L(n.pullNode())}),ae(1,9),z()}if(t&2){let e,i=d();g(),N("ngTemplateOutlet",(e=i.groupNodeTemplate())!==null&&e!==void 0?e:null)("ngTemplateOutletContext",i.model().context)("ngTemplateOutletInjector",i.injector)}}function Fo(t,o){}function Io(t,o){if(t&1&&D(0,Fo,0,0,"ng-template",13),t&2){let e=d();N("ngTemplateOutlet",e)}}function $o(t,o){if(t&1&&D(0,Io,1,1,null,13),t&2){let e=d();v(e.model().resizable()?0:-1)}}function jo(t,o){if(t&1){let e=ie();C(),_(0,"circle",17),A("pointerStart",function(n){j(e);let r=d().$implicit,a=d();return L(a.startConnection(n,r))})("pointerEnd",function(){j(e);let n=d(2);return L(n.endConnection())}),z()}if(t&2){let e=d().$implicit;w("cx",e.hostOffset().x)("cy",e.hostOffset().y)("stroke-width",e.strokeWidth)}}function Lo(t,o){if(t&1){let e=ie();C(),_(0,"g",18),A("pointerStart",function(n){j(e);let r=d().$implicit,a=d();return L(a.startConnection(n,r))})("pointerEnd",function(){j(e);let n=d(2);return L(n.endConnection())}),z()}if(t&2){let e=d().$implicit;N("handleSizeController",e)}}function Ao(t,o){t&1&&(C(),ae(0))}function Go(t,o){if(t&1){let e=ie();C(),_(0,"g",18),A("pointerStart",function(n){j(e);let r=d().$implicit,a=d();return L(a.startConnection(n,r))})("pointerEnd",function(){j(e);let n=d(2);return L(n.endConnection())}),D(1,Ao,1,0,"ng-container",19),z()}if(t&2){let e=d().$implicit;N("handleSizeController",e),g(),N("ngTemplateOutlet",e.template)("ngTemplateOutletContext",e.templateContext)}}function Bo(t,o){if(t&1){let e=ie();C(),_(0,"circle",20),A("pointerEnd",function(){j(e);let n=d().$implicit,r=d();return r.endConnection(),L(r.resetValidateConnection(n))})("pointerOver",function(){j(e);let n=d().$implicit,r=d();return L(r.validateConnection(n))})("pointerOut",function(){j(e);let n=d().$implicit,r=d();return L(r.resetValidateConnection(n))}),z()}if(t&2){let e=d().$implicit,i=d();w("r",i.model().magnetRadius)("cx",e.hostOffset().x)("cy",e.hostOffset().y)}}function Wo(t,o){if(t&1&&D(0,jo,1,3,":svg:circle",14)(1,Lo,1,1,":svg:g",15)(2,Go,2,3,":svg:g",15)(3,Bo,1,3,":svg:circle",16),t&2){let e=o.$implicit,i=d();v(e.template===void 0?0:-1),g(),v(e.template===null?1:-1),g(),v(e.template?2:-1),g(),v(i.showMagnet()?3:-1)}}function Xo(t,o){if(t&1&&(C(),_(0,"foreignObject"),He(),ae(1,13),z()),t&2){let e=o.$implicit;w("width",e.size().width)("height",e.size().height)("transform",e.transform()),g(),N("ngTemplateOutlet",e.template())}}var un=(()=>{class t{constructor(){this.injector=s(ue),this.handleService=s(Bt),this.draggableService=s(Mt),this.flowStatusService=s(Q),this.nodeRenderingService=s(pe),this.flowSettingsService=s(P),this.selectionService=s(ke),this.hostRef=s(Y),this.nodeAccessor=s(Te),this.overlaysService=s(Pt),this.connectionController=s(Ht,{optional:!0}),this.model=R.required(),this.nodeTemplate=R(),this.nodeSvgTemplate=R(),this.groupNodeTemplate=R(),this.showMagnet=f(()=>this.flowStatusService.status().state==="connection-start"||this.flowStatusService.status().state==="connection-validation"||this.flowStatusService.status().state==="reconnection-start"||this.flowStatusService.status().state==="reconnection-validation"),this.toolbars=f(()=>this.overlaysService.nodeToolbarsMap().get(this.model()))}ngOnInit(){this.model().isVisible.set(!0),this.nodeAccessor.model.set(this.model()),this.handleService.node.set(this.model()),Se(()=>{this.model().draggable()?this.draggableService.enable(this.hostRef.nativeElement,this.model()):this.draggableService.disable(this.hostRef.nativeElement)},{injector:this.injector})}ngOnDestroy(){this.model().isVisible.set(!1),this.draggableService.destroy(this.hostRef.nativeElement)}startConnection(e,i){e.stopPropagation(),this.connectionController?.startConnection(i)}validateConnection(e){this.connectionController?.validateConnection(e)}resetValidateConnection(e){this.connectionController?.resetValidateConnection(e)}endConnection(){this.connectionController?.endConnection()}pullNode(){this.flowSettingsService.elevateNodesOnSelect()&&this.nodeRenderingService.pullNode(this.model())}selectNode(){this.flowSettingsService.entitiesSelectable()&&this.selectionService.select(this.model())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["g","node",""]],hostAttrs:[1,"vflow-node"],inputs:{model:[1,"model"],nodeTemplate:[1,"nodeTemplate"],nodeSvgTemplate:[1,"nodeSvgTemplate"],groupNodeTemplate:[1,"groupNodeTemplate"]},features:[bt([Bt,Te])],attrs:zo,decls:11,vars:7,consts:[[1,"selectable"],["nodeHandlesController","",1,"selectable"],["rx","5","ry","5",1,"default-group-node",3,"resizable","gap","resizerColor","default-group-node_selected","stroke","fill"],[1,"selectable",3,"click"],["nodeHandlesController","",3,"selected"],[3,"outerHTML"],["type","source","position","right"],["type","target","position","left"],["nodeHandlesController","","nodeResizeController","",1,"wrapper"],[3,"ngTemplateOutlet","ngTemplateOutletContext","ngTemplateOutletInjector"],["nodeHandlesController","",1,"selectable",3,"click"],[3,"ngComponentOutlet","ngComponentOutletInputs","ngComponentOutletInjector"],["rx","5","ry","5",1,"default-group-node",3,"click","resizable","gap","resizerColor"],[3,"ngTemplateOutlet"],["r","5",1,"default-handle"],[3,"handleSizeController"],[1,"magnet"],["r","5",1,"default-handle",3,"pointerStart","pointerEnd"],[3,"pointerStart","pointerEnd","handleSizeController"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"magnet",3,"pointerEnd","pointerOver","pointerOut"]],template:function(i,n){if(i&1&&(D(0,Oo,5,12,":svg:foreignObject",0)(1,Ro,3,9,":svg:foreignObject",0)(2,ko,2,3,":svg:g",1)(3,No,2,3)(4,Vo,1,11,":svg:rect",2)(5,Po,2,3,":svg:g",1)(6,$o,1,1),ce(7,Wo,4,4,null,null,dt),ce(9,Xo,2,4,":svg:foreignObject",null,dt)),i&2){let r;v(n.model().rawNode.type==="default"?0:-1),g(),v(n.model().rawNode.type==="html-template"&&n.nodeTemplate()?1:-1),g(),v(n.model().rawNode.type==="svg-template"&&n.nodeSvgTemplate()?2:-1),g(),v(n.model().isComponentType?3:-1),g(),v(n.model().rawNode.type==="default-group"?4:-1),g(),v(n.model().rawNode.type==="template-group"&&n.groupNodeTemplate()?5:-1),g(),v((r=n.model().resizerTemplate())?6:-1,r),g(),de(n.model().handles()),g(2),de(n.toolbars())}},dependencies:[it,pn,Vi,xe,zi,Ki,dn,hn,mn,Oi],styles:[".magnet[_ngcontent-%COMP%]{opacity:0}.wrapper[_ngcontent-%COMP%]{display:table-cell}.default-group-node[_ngcontent-%COMP%]{stroke-width:1.5px;fill-opacity:.05}.default-group-node_selected[_ngcontent-%COMP%]{stroke-width:2px}.default-handle[_ngcontent-%COMP%]{stroke:#fff;fill:#1b262c}"],changeDetection:0})}}return t})();var Yo=["connection",""];function Uo(t,o){if(t&1&&(C(),V(0,"path",0)),t&2){let e=d(2);w("d",o)("marker-end",e.markerUrl())("stroke",e.defaultColor)}}function qo(t,o){if(t&1&&D(0,Uo,1,3,":svg:path",0),t&2){let e,i=d();v((e=i.path())?0:-1,e)}}function Zo(t,o){t&1&&ae(0)}function Qo(t,o){if(t&1&&D(0,Zo,1,0,"ng-container",1),t&2){let e=d(2);N("ngTemplateOutlet",o)("ngTemplateOutletContext",e.getContext())}}function Jo(t,o){if(t&1&&D(0,Qo,1,2,"ng-container"),t&2){let e,i=d();v((e=i.template())?0:-1,e)}}var gn=(()=>{class t{constructor(){this.flowStatusService=s(Q),this.spacePointContext=s(Re),this.flowEntitiesService=s(B),this.model=R.required(),this.template=R(),this.path=f(()=>{let e=this.flowStatusService.status(),i=this.model().curve;if(e.state==="connection-start"||e.state==="reconnection-start"){let n=e.payload.sourceHandle,r=n.pointAbsolute(),a=n.rawHandle.position,c=this.spacePointContext.svgCurrentSpacePoint(),m=fn(n.rawHandle.position),u=this.getPathFactoryParams(r,c,a,m);switch(i){case"straight":return ft(u).path;case"bezier":return gt(u).path;case"smooth-step":return Ne(u).path;case"step":return Ne(u,0).path;default:return i(u).path}}if(e.state==="connection-validation"||e.state==="reconnection-validation"){let n=e.payload.sourceHandle,r=n.pointAbsolute(),a=n.rawHandle.position,c=e.payload.targetHandle,m=e.payload.valid?c.pointAbsolute():this.spacePointContext.svgCurrentSpacePoint(),u=e.payload.valid?c.rawHandle.position:fn(n.rawHandle.position),p=this.getPathFactoryParams(r,m,a,u);switch(i){case"straight":return ft(p).path;case"bezier":return gt(p).path;case"smooth-step":return Ne(p).path;case"step":return Ne(p,0).path;default:return i(p).path}}return null}),this.markerUrl=f(()=>{let e=this.model().settings.marker;return e?`url(#${De(JSON.stringify(e))})`:""}),this.defaultColor="rgb(177, 177, 183)"}getContext(){return{$implicit:{path:this.path,marker:this.markerUrl}}}getPathFactoryParams(e,i,n,r){return{mode:"connection",sourcePoint:e,targetPoint:i,sourcePosition:n,targetPosition:r,allEdges:this.flowEntitiesService.rawEdges(),allNodes:this.flowEntitiesService.rawNodes()}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["g","connection",""]],inputs:{model:[1,"model"],template:[1,"template"]},attrs:Yo,decls:2,vars:2,consts:[["fill","none","stroke-width","2"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(i,n){i&1&&D(0,qo,1,1)(1,Jo,1,1),i&2&&(v(n.model().type==="default"?0:-1),g(),v(n.model().type==="template"?1:-1))},dependencies:[xe],encapsulation:2,changeDetection:0})}}return t})();function fn(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}}function vn(){return String.fromCharCode(65+Math.floor(Math.random()*26))+Date.now()}var Ko=["background",""];function er(t,o){if(t&1&&(C(),_(0,"pattern",0),V(1,"circle"),z(),V(2,"rect",1)),t&2){let e=d();w("id",e.patternId)("x",e.x())("y",e.y())("width",e.scaledGap())("height",e.scaledGap()),g(),w("cx",e.patternSize())("cy",e.patternSize())("r",e.patternSize())("fill",e.patternColor()),g(),w("fill",e.patternUrl)}}function tr(t,o){if(t&1&&(C(),_(0,"pattern",0),V(1,"image"),z(),V(2,"rect",1)),t&2){let e=d(2);w("id",e.patternId)("x",e.imageX())("y",e.imageY())("width",e.scaledImageWidth())("height",e.scaledImageHeight()),g(),w("href",e.bgImageSrc())("width",e.scaledImageWidth())("height",e.scaledImageHeight()),g(),w("fill",e.patternUrl)}}function ir(t,o){if(t&1&&(C(),V(0,"image")),t&2){let e=d(2);w("x",e.imageX())("y",e.imageY())("width",e.scaledImageWidth())("height",e.scaledImageHeight())("href",e.bgImageSrc())}}function nr(t,o){if(t&1&&D(0,tr,3,9)(1,ir,1,5,":svg:image"),t&2){let e=d();v(e.repeated()?0:-1),g(),v(e.repeated()?-1:1)}}function or(t,o){if(t&1&&(C(),_(0,"pattern",0),V(1,"path",2),z(),V(2,"rect",1)),t&2){let e=d();w("id",e.patternId)("x",e.x())("y",e.y())("width",e.patternSize())("height",e.patternSize()),g(),w("d","M "+e.patternSize()+" 0 L 0 0 0 "+e.patternSize())("stroke",e.patternColor())("stroke-width",e.strokeWidth()),g(),w("fill",e.patternUrl)}}var Sn="#fff",rr=20,sr=2,yn="rgb(177, 177, 183)",wn=20,ar=2,Cn=.1,lr=!0,xn=(()=>{class t{constructor(){this.viewportService=s(ee),this.rootSvg=s(_e).element,this.settingsService=s(P),this.backgroundSignal=this.settingsService.background,this.x=f(()=>this.viewportService.readableViewport().x%this.scaledGap()),this.y=f(()=>this.viewportService.readableViewport().y%this.scaledGap()),this.patternColor=f(()=>{let e=this.backgroundSignal();return e.type==="dots"||e.type==="grid"?e.color??yn:yn}),this.patternSize=f(()=>{let e=this.backgroundSignal();return e.type==="dots"?this.viewportService.readableViewport().zoom*(e.size??sr)/2:e.type==="grid"?this.viewportService.readableViewport().zoom*(e.size??wn):0}),this.scaledGap=f(()=>{let e=this.backgroundSignal(),i=this.viewportService.readableViewport().zoom;return e.type==="dots"?i*(e.gap??rr):e.type==="grid"?i*(e.size??wn):0}),this.strokeWidth=f(()=>{let e=this.backgroundSignal();return e.type==="grid"?this.viewportService.readableViewport().zoom*((e.strokeWidth??ar)/2):0}),this.bgImageSrc=f(()=>{let e=this.backgroundSignal();return e.type==="image"?e.src:""}),this.imageSize=Me(b(this.backgroundSignal).pipe(ne(()=>cr(this.bgImageSrc())),S(e=>({width:e.naturalWidth,height:e.naturalHeight}))),{initialValue:{width:0,height:0}}),this.scaledImageWidth=f(()=>{let e=this.backgroundSignal();if(e.type==="image"){let i=e.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().width*i*(e.scale??Cn)}return 0}),this.scaledImageHeight=f(()=>{let e=this.backgroundSignal();if(e.type==="image"){let i=e.fixed?1:this.viewportService.readableViewport().zoom;return this.imageSize().height*i*(e.scale??Cn)}return 0}),this.imageX=f(()=>{let e=this.backgroundSignal();return e.type==="image"?e.repeat?e.fixed?0:this.viewportService.readableViewport().x%this.scaledImageWidth():e.fixed?0:this.viewportService.readableViewport().x:0}),this.imageY=f(()=>{let e=this.backgroundSignal();return e.type==="image"?e.repeat?e.fixed?0:this.viewportService.readableViewport().y%this.scaledImageHeight():e.fixed?0:this.viewportService.readableViewport().y:0}),this.repeated=f(()=>{let e=this.backgroundSignal();return e.type==="image"&&(e.repeat??lr)}),this.patternId=vn(),this.patternUrl=`url(#${this.patternId})`,Se(()=>{let e=this.backgroundSignal();e.type==="dots"&&(this.rootSvg.style.backgroundColor=e.backgroundColor??Sn),e.type==="grid"&&(this.rootSvg.style.backgroundColor=e.backgroundColor??Sn),e.type==="solid"&&(this.rootSvg.style.backgroundColor=e.color)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["g","background",""]],attrs:Ko,decls:3,vars:3,consts:[["patternUnits","userSpaceOnUse"],["x","0","y","0","width","100%","height","100%"],["fill","none"]],template:function(i,n){i&1&&D(0,er,3,10)(1,nr,2,2)(2,or,3,9),i&2&&(v(n.backgroundSignal().type==="dots"?0:-1),g(),v(n.backgroundSignal().type==="image"?1:-1),g(),v(n.backgroundSignal().type==="grid"?2:-1))},encapsulation:2,changeDetection:0})}}return t})();function cr(t){let o=new Image;return o.src=t,new Promise(e=>{o.onload=()=>e(o)})}var dr=["flowDefs",""];function pr(t,o){if(t&1&&(C(),V(0,"polyline",3)),t&2){let e,i,n,r=d().$implicit,a=d();Ce("stroke",(e=r.value.color)!==null&&e!==void 0?e:a.defaultColor)("stroke-width",(i=r.value.strokeWidth)!==null&&i!==void 0?i:2)("fill",(n=r.value.color)!==null&&n!==void 0?n:a.defaultColor)}}function hr(t,o){if(t&1&&(C(),V(0,"polyline",4)),t&2){let e,i,n=d().$implicit,r=d();Ce("stroke",(e=n.value.color)!==null&&e!==void 0?e:r.defaultColor)("stroke-width",(i=n.value.strokeWidth)!==null&&i!==void 0?i:2)}}function mr(t,o){if(t&1&&(C(),_(0,"marker",0),D(1,pr,1,6,":svg:polyline",1)(2,hr,1,4,":svg:polyline",2),z()),t&2){let e,i,n,r,a=o.$implicit;w("id",a.key)("markerWidth",(e=a.value.width)!==null&&e!==void 0?e:16.5)("markerHeight",(i=a.value.height)!==null&&i!==void 0?i:16.5)("orient",(n=a.value.orient)!==null&&n!==void 0?n:"auto-start-reverse")("markerUnits",(r=a.value.markerUnits)!==null&&r!==void 0?r:"userSpaceOnUse"),g(),v(a.value.type==="arrow-closed"||!a.value.type?1:-1),g(),v(a.value.type==="arrow"?2:-1)}}var _n=(()=>{class t{constructor(){this.markers=R.required(),this.defaultColor="rgb(177, 177, 183)"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["defs","flowDefs",""]],inputs:{markers:[1,"markers"]},attrs:dr,decls:3,vars:2,consts:[["viewBox","-10 -10 20 20","refX","0","refY","0"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed",3,"stroke","stroke-width","fill"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default",3,"stroke","stroke-width"],["points","-5,-4 1,0 -5,4 -5,-4",1,"marker__arrow_closed"],["points","-5,-4 0,0 -5,4",1,"marker__arrow_default"]],template:function(i,n){i&1&&(ce(0,mr,3,7,":svg:marker",0,dt),Tt(2,"keyvalue")),i&2&&de(Dt(2,0,n.markers()))},dependencies:[Ri],styles:[".marker__arrow_default[_ngcontent-%COMP%]{stroke-width:1px;stroke-linecap:round;stroke-linejoin:round;fill:none}.marker__arrow_closed[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}"],changeDetection:0})}}return t})();var bn=(()=>{class t{constructor(){this.host=s(Y),this.flowSettingsService=s(P),this.flowWidth=f(()=>{let e=this.flowSettingsService.view();return e==="auto"?"100%":e[0]}),this.flowHeight=f(()=>{let e=this.flowSettingsService.view();return e==="auto"?"100%":e[1]}),Ft([this.host.nativeElement],s(fe)).pipe(I(([e])=>{this.flowSettingsService.computedFlowWidth.set(e.contentRect.width),this.flowSettingsService.computedFlowHeight.set(e.contentRect.height)}),Z()).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["svg","flowSizeController",""]],hostVars:2,hostBindings:function(i,n){i&2&&w("width",n.flowWidth())("height",n.flowHeight())}})}}return t})();var Tn=(()=>{class t{constructor(){this.flowStatusService=s(Q)}resetConnection(){let e=this.flowStatusService.status();e.state==="connection-start"&&this.flowStatusService.setConnectionDroppedStatus(e.payload.source,e.payload.sourceHandle),e.state==="reconnection-start"&&this.flowStatusService.setReconnectionDroppedStatus(e.payload.source,e.payload.sourceHandle,e.payload.oldEdge)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["svg","rootSvgContext",""]],hostBindings:function(i,n){i&1&&A("mouseup",function(){return n.resetConnection()},!1,jt)("touchend",function(){return n.resetConnection()},!1,jt)("contextmenu",function(){return n.resetConnection()})}})}}return t})();function ri(t,o){let e=[];for(let i of o){let{x:n,y:r}=i.globalPoint();t.x>=n&&t.x<=n+i.width()&&t.y>=r&&t.y<=r+i.height()&&e.push({x:t.x-n,y:t.y-r,spaceNodeId:i.rawNode.id})}return e.reverse(),e.push({spaceNodeId:null,x:t.x,y:t.y}),e}var wt=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})(),Dn=(()=>{class t extends wt{shouldRenderNode(e){return!e.isVisible()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=wi(t)))(n||t)}})()}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function En(t,o){if(Object.keys(o.preview().style).length){gr(t,o);return}if(o.rawNode.type==="default"){ur(t,o);return}if(o.rawNode.type==="default-group"){fr(t,o);return}vr(t,o)}function ur(t,o){let e=o.globalPoint(),i=o.width(),n=o.height();Hn(t,o,5),t.fillStyle="white",t.fill(),t.strokeStyle="#1b262c",t.lineWidth=1.5,t.stroke(),t.fillStyle="black",t.font="14px Arial",t.textAlign="center",t.textBaseline="middle";let r=e.x+i/2,a=e.y+n/2;t.fillText(o.text(),r,a)}function fr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height();t.globalAlpha=.05,t.fillStyle=o.color(),t.fillRect(e.x,e.y,i,n),t.globalAlpha=1,t.strokeStyle=o.color(),t.lineWidth=1.5,t.strokeRect(e.x,e.y,i,n)}function gr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height(),r=o.preview().style;if(r.borderRadius){let a=parseFloat(r.borderRadius);Hn(t,o,a)}else t.beginPath(),t.rect(e.x,e.y,i,n),t.closePath();r.backgroundColor&&(t.fillStyle=r.backgroundColor),r.borderColor&&(t.strokeStyle=r.borderColor),r.borderWidth&&(t.lineWidth=parseFloat(r.borderWidth)),t.fill(),t.stroke()}function vr(t,o){let e=o.globalPoint(),i=o.width(),n=o.height();t.fillStyle="rgb(0 0 0 / 10%)",t.fillRect(e.x,e.y,i,n)}function Hn(t,o,e){let i=o.globalPoint(),n=o.width(),r=o.height();t.beginPath(),t.moveTo(i.x+e,i.y),t.lineTo(i.x+n-e,i.y),t.quadraticCurveTo(i.x+n,i.y,i.x+n,i.y+e),t.lineTo(i.x+n,i.y+r-e),t.quadraticCurveTo(i.x+n,i.y+r,i.x+n-e,i.y+r),t.lineTo(i.x+e,i.y+r),t.quadraticCurveTo(i.x,i.y+r,i.x,i.y+r-e),t.lineTo(i.x,i.y+e),t.quadraticCurveTo(i.x,i.y,i.x+e,i.y),t.closePath()}var Sr=["previewFlow",""],zn=(()=>{class t{constructor(){this.viewportService=s(ee),this.renderStrategy=s(wt),this.nodeRenderingService=s(pe),this.renderer2=s(xi),this.element=s(Y).nativeElement,this.ctx=this.element.getContext("2d"),this.width=R(0),this.height=R(0),this.dpr=window.devicePixelRatio,Se(()=>{this.renderer2.setProperty(this.element,"width",this.width()*this.dpr),this.renderer2.setProperty(this.element,"height",this.height()*this.dpr),this.renderer2.setStyle(this.element,"width",`${this.width()}px`),this.renderer2.setStyle(this.element,"height",`${this.height()}px`),this.ctx.scale(this.dpr,this.dpr)}),Se(()=>{let e=this.viewportService.readableViewport();this.ctx.clearRect(0,0,this.width(),this.height()),this.ctx.save(),this.ctx.setTransform(e.zoom*this.dpr,0,0,e.zoom*this.dpr,e.x*this.dpr,e.y*this.dpr);for(let i=0;i<this.nodeRenderingService.viewportNodes().length;i++){let n=this.nodeRenderingService.viewportNodes()[i];this.renderStrategy.shouldRenderNode(n)&&En(this.ctx,n)}this.ctx.restore()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["canvas","previewFlow",""]],inputs:{width:[1,"width"],height:[1,"height"]},attrs:Sr,decls:0,vars:0,template:function(i,n){},encapsulation:2,changeDetection:0})}}return t})();var si=(()=>{class t{constructor(){this.nodeRenderingService=s(pe),this.edgeRenderingService=s(Be),this.flowEntitiesService=s(B),this.settingsService=s(P),this.flowInitialized=l(!1),s(fe).runOutsideAngular(async()=>{await yr(2),this.flowInitialized.set(!0)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function yr(t){return new Promise(o=>{let e=0;function i(){e++,e<t?requestAnimationFrame(i):o()}requestAnimationFrame(i)})}function ai(t){return K(W({},t),{left:t.x,right:t.x+t.width,top:t.y,bottom:t.y+t.height})}var wr=["alignmentHelper",""];function Cr(t,o){if(t&1&&(C(),V(0,"line")),t&2){let e=o.$implicit,i=d(3);w("stroke",i.lineColor())("stroke-dasharray",e.isCenter?4:null)("x1",e.x)("y1",e.y)("x2",e.x2)("y2",e.y2)}}function xr(t,o){t&1&&ce(0,Cr,1,6,":svg:line",null,Ti),t&2&&de(o.lines)}function _r(t,o){if(t&1&&D(0,xr,2,0),t&2){let e,i=d();v((e=i.intersections())?0:-1,e)}}var On=(()=>{class t{constructor(){this.nodeRenderingService=s(pe),this.flowStatus=s(Q),this.tolerance=R(10),this.lineColor=R("#1b262c"),this.isNodeDragging=f(()=>Qt(this.flowStatus.status())||Jt(this.flowStatus.status())),this.intersections=Ge(e=>{let i=this.flowStatus.status();if(Qt(i)||Jt(i)){let n=i.payload.node,r=ai(mt(n)),a=this.nodeRenderingService.viewportNodes().filter(h=>h!==n).filter(h=>!n.children().includes(h)).map(h=>ai(mt(h))),c=[],m=r.x,u=r.y,p=1/0,M=1/0;return a.forEach(h=>{let T=r.left+r.width/2,x=h.left+h.width/2;for(let[te,ge,st,se]of[[T,x,x-r.width/2,!0],[r.left,h.left,h.left,!1],[r.left,h.right,h.right,!1],[r.right,h.left,h.left-r.width,!1],[r.right,h.right,h.right-r.width,!1]]){let J=Math.abs(te-ge);if(J<=this.tolerance()){let ve=Math.min(r.top,h.top),he=Math.max(r.bottom,h.bottom);if(c.push({x:ge,y:ve,x2:ge,y2:he,isCenter:se}),J<p&&(p=J,m=st),se)break}}let O=r.top+r.height/2,$=h.top+h.height/2;for(let[te,ge,st,se]of[[O,$,$-r.height/2,!0],[r.top,h.top,h.top,!1],[r.top,h.bottom,h.bottom,!1],[r.bottom,h.top,h.top-r.height,!1],[r.bottom,h.bottom,h.bottom-r.height,!1]]){let J=Math.abs(te-ge);if(J<=this.tolerance()){let ve=Math.min(r.left,h.left),he=Math.max(r.right,h.right);if(c.push({x:ve,y:ge,x2:he,y2:ge,isCenter:se}),J<M&&(M=J,u=st),se)break}}}),{lines:c,snappedX:m,snappedY:u}}return e}),b(this.flowStatus.status).pipe(H($i),S(e=>e.payload.node),S(e=>[e,this.intersections()]),I(([e,i])=>{if(i){let n={x:i.snappedX,y:i.snappedY},r=e.parent();r?e.setPoint({x:n.x-r.globalPoint().x,y:n.y-r.globalPoint().y}):e.setPoint(n)}}),Z()).subscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["g","alignmentHelper",""]],inputs:{tolerance:[1,"tolerance"],lineColor:[1,"lineColor"]},attrs:wr,decls:1,vars:1,template:function(i,n){i&1&&D(0,_r,1,1),i&2&&v(n.isNodeDragging()?0:-1)},encapsulation:2,changeDetection:0})}}return t})();function Rn(){return hi(()=>{let t=Pe.now();return new Ct(o=>Pe.schedule(function(){o.next(Pe.now()),o.closed||this.schedule()})).pipe(S(o=>({timestamp:o,elapsed:o-t})))})}var rt=48,It=10,br=["node-drag-start","connection-start","reconnection-start"],kn=(()=>{class t{constructor(){this.statusService=s(Q),this.viewportService=s(ee),this.flowSettingsService=s(P),this.rootSvg=s(_e).element,this.injector=s(ue),this.destroyRef=s(qe),this.documentPoint$=U(le(document,"pointerdown",{capture:!0}),le(document,"pointermove",{capture:!0})).pipe(S(e=>({x:e.clientX,y:e.clientY})),S(e=>this.toViewportPoint(e)),Ue({bufferSize:1,refCount:!0}))}ngOnInit(){this.flowSettingsService.autoPan()&&b(this.statusService.status,{injector:this.injector}).pipe(ne(e=>br.includes(e.state)?this.documentPoint$.pipe(gi(1),ne(()=>Rn().pipe(Si(this.documentPoint$),S(([,i])=>i),I(i=>this.pan(i))))):di),Z(this.destroyRef)).subscribe()}toViewportPoint(e){let i=this.rootSvg.getBoundingClientRect();return{x:e.x-i.left,y:e.y-i.top}}pan(e){let i=this.viewportService.readableViewport(),{x:n,y:r,zoom:a}=i,c=this.flowSettingsService.computedFlowWidth(),m=this.flowSettingsService.computedFlowHeight(),u=e.x,p=c-e.x,M=e.y,h=m-e.y,T=0,x=0;if(u<rt){let O=It*$t(u);T+=O}if(p<rt){let O=It*$t(p);T-=O}if(M<rt){let O=It*$t(M);x+=O}if(h<rt){let O=It*$t(h);x-=O}(T!==0||x!==0)&&this.viewportService.writableViewport.set({changeType:"absolute",state:{x:n+T,y:r+x,zoom:a},duration:0})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,selectors:[["","autoPan",""]]})}}return t})();function Tr(t){return Math.max(0,Math.min(1,t))}function $t(t){let o=Tr((rt-t)/rt);return o*o}var Mn=(()=>{class t{constructor(){this.statusService=s(Q),this.nodeDragStart=X(this.statusService.status$.pipe(H(e=>e.state==="node-drag-start"),S(e=>({node:e.payload.node.rawNode})))),this.nodeDrag=X(this.statusService.status$.pipe(H(e=>e.state==="node-drag"),S(e=>({node:e.payload.node.rawNode})))),this.nodeDragEnd=X(this.statusService.status$.pipe(H(e=>e.state==="node-drag-end"),S(e=>({node:e.payload.node.rawNode}))))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=k({type:t,outputs:{nodeDragStart:"nodeDragStart",nodeDrag:"nodeDrag",nodeDragEnd:"nodeDragEnd"}})}}return t})();function Er(t,o){t&1&&(C(),V(0,"g",8))}function Hr(t,o){if(t&1&&(C(),V(0,"g",9)),t&2){let e=d();N("tolerance",e.tolerance)("lineColor",e.lineColor)}}function zr(t,o){t&1&&D(0,Er,1,0,":svg:g",8)(1,Hr,1,2,":svg:g",9),t&2&&v(o===!0?0:1)}function Or(t,o){if(t&1&&(C(),V(0,"g",10)),t&2){let e,i=o.$implicit,n=d(2);N("model",i)("groupNodeTemplate",(e=n.groupNodeTemplateDirective())==null?null:e.templateRef),w("transform",i.pointTransform())}}function Rr(t,o){if(t&1&&(C(),V(0,"g",11)),t&2){let e,i,n=o.$implicit,r=d(2);N("model",n)("edgeTemplate",(e=r.edgeTemplateDirective())==null?null:e.templateRef)("edgeLabelHtmlTemplate",(i=r.edgeLabelHtmlDirective())==null?null:i.templateRef)}}function kr(t,o){if(t&1&&(C(),V(0,"g",12)),t&2){let e,i,n=o.$implicit,r=d(2);N("model",n)("nodeTemplate",(e=r.nodeTemplateDirective())==null?null:e.templateRef)("nodeSvgTemplate",(i=r.nodeSvgTemplateDirective())==null?null:i.templateRef),w("transform",n.pointTransform())}}function Mr(t,o){if(t&1&&(ce(0,Or,1,3,":svg:g",10,Qe().trackNodes,!0),ce(2,Rr,1,3,":svg:g",11,Qe().trackEdges,!0),ce(4,kr,1,4,":svg:g",12,Qe().trackNodes,!0)),t&2){let e=d();de(e.groups()),g(2),de(e.edgeModels()),g(2),de(e.nonGroups())}}function Nr(t,o){if(t&1&&(C(),V(0,"g",11)),t&2){let e,i,n=o.$implicit,r=d(2);N("model",n)("edgeTemplate",(e=r.edgeTemplateDirective())==null?null:e.templateRef)("edgeLabelHtmlTemplate",(i=r.edgeLabelHtmlDirective())==null?null:i.templateRef)}}function Vr(t,o){if(t&1&&(C(),V(0,"g",13)),t&2){let e,i,n,r=o.$implicit,a=d(2);N("model",r)("nodeTemplate",(e=a.nodeTemplateDirective())==null?null:e.templateRef)("nodeSvgTemplate",(i=a.nodeSvgTemplateDirective())==null?null:i.templateRef)("groupNodeTemplate",(n=a.groupNodeTemplateDirective())==null?null:n.templateRef),w("transform",r.pointTransform())}}function Pr(t,o){if(t&1&&(ce(0,Nr,1,3,":svg:g",11,Qe().trackEdges,!0),ce(2,Vr,1,5,":svg:g",13,Qe().trackNodes,!0)),t&2){let e=d();de(e.edgeModels()),g(2),de(e.nodeModels())}}function Fr(t,o){t&1&&(C(),ae(0,6)),t&2&&N("ngTemplateOutlet",o.template())}function Ir(t,o){if(t&1&&V(0,"canvas",7),t&2){let e=d();N("width",e.flowWidth())("height",e.flowHeight())}}var qm=(()=>{class t{constructor(){this.viewportService=s(ee),this.flowEntitiesService=s(B),this.nodesChangeService=s(St),this.edgesChangeService=s(yt),this.nodeRenderingService=s(pe),this.edgeRenderingService=s(Be),this.flowSettingsService=s(P),this.componentEventBusService=s(Gt),this.keyboardService=s(ut),this.injector=s(ue),this.flowRenderingService=s(si),this.alignmentHelper=R(!1),this.nodeModels=this.nodeRenderingService.nodes,this.groups=this.nodeRenderingService.groups,this.nonGroups=this.nodeRenderingService.nonGroups,this.edgeModels=this.edgeRenderingService.edges,this.componentNodeEvent=X(this.componentEventBusService.event$),this.nodeTemplateDirective=$e(Ut),this.nodeSvgTemplateDirective=$e(qt),this.groupNodeTemplateDirective=$e(Zt),this.edgeTemplateDirective=$e(Wt),this.edgeLabelHtmlDirective=$e(Yt),this.connectionTemplateDirective=$e(Xt),this.mapContext=Ie(kt),this.spacePointContext=Ie.required(Re),this.viewport=this.viewportService.readableViewport.asReadonly(),this.nodesChange=Me(this.nodesChangeService.changes$,{initialValue:[]}),this.edgesChange=Me(this.edgesChangeService.changes$,{initialValue:[]}),this.initialized=this.flowRenderingService.flowInitialized.asReadonly(),this.viewportChange$=b(this.viewportService.readableViewport).pipe(me(1)),this.nodesChange$=this.nodesChangeService.changes$,this.edgesChange$=this.edgesChangeService.changes$,this.initialized$=b(this.flowRenderingService.flowInitialized),this.markers=this.flowEntitiesService.markers,this.minimap=this.flowEntitiesService.minimap,this.flowOptimization=this.flowSettingsService.optimization,this.flowWidth=this.flowSettingsService.computedFlowWidth,this.flowHeight=this.flowSettingsService.computedFlowHeight}set view(e){this.flowSettingsService.view.set(e)}set minZoom(e){this.flowSettingsService.minZoom.set(e)}set maxZoom(e){this.flowSettingsService.maxZoom.set(e)}set background(e){this.flowSettingsService.background.set(an(e))}set optimization(e){this.flowSettingsService.optimization.update(i=>W(W({},i),e))}set entitiesSelectable(e){this.flowSettingsService.entitiesSelectable.set(e)}set selectionMode(e){this.flowSettingsService.selectionMode.set(e)}set keyboardShortcuts(e){this.keyboardService.setShortcuts(e)}set connection(e){this.flowEntitiesService.connection.set(e)}get connection(){return this.flowEntitiesService.connection()}set snapGrid(e){this.flowSettingsService.snapGrid.set(e)}set elevateNodesOnSelect(e){this.flowSettingsService.elevateNodesOnSelect.set(e)}set elevateEdgesOnSelect(e){this.flowSettingsService.elevateEdgesOnSelect.set(e)}set autoPan(e){this.flowSettingsService.autoPan.set(e)}set nodes(e){let i=lt(this.injector,()=>vt.nodes(e,this.flowEntitiesService.nodes()));ii(i,this.flowEntitiesService.edges()),this.flowEntitiesService.nodes.set(i),i.forEach(n=>this.nodeRenderingService.pullNode(n))}set edges(e){let i=lt(this.injector,()=>vt.edges(e,this.flowEntitiesService.edges()));ii(this.flowEntitiesService.nodes(),i),this.flowEntitiesService.edges.set(i)}viewportTo(e){this.viewportService.writableViewport.set({changeType:"absolute",state:e,duration:0})}zoomTo(e){this.viewportService.writableViewport.set({changeType:"absolute",state:{zoom:e},duration:0})}panTo(e){this.viewportService.writableViewport.set({changeType:"absolute",state:e,duration:0})}fitView(e){this.viewportService.fitView(e)}getNode(e){return this.flowEntitiesService.getNode(e)?.rawNode}getDetachedEdges(){return this.flowEntitiesService.getDetachedEdges().map(e=>e.edge)}documentPointToFlowPoint(e,i){let n=this.spacePointContext().documentPointToFlowPoint(e);return i?.spaces?ri(n,this.nodeRenderingService.groups()):n}getIntesectingNodes(e,i={partially:!0}){return Ui(e,this.nodeModels(),i).map(n=>n.rawNode)}toNodeSpace(e,i){let n=this.nodeModels().find(a=>a.rawNode.id===e);if(!n)return{x:1/0,y:1/0};if(i===null)return n.globalPoint();let r=this.nodeModels().find(a=>a.rawNode.id===i);return r?ri(n.globalPoint(),[r])[0]:{x:1/0,y:1/0}}trackNodes(e,{rawNode:i}){return i}trackEdges(e,{edge:i}){return i}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=q({type:t,selectors:[["vflow"]],contentQueries:function(i,n,r){i&1&&(je(r,n.nodeTemplateDirective,Ut,5),je(r,n.nodeSvgTemplateDirective,qt,5),je(r,n.groupNodeTemplateDirective,Zt,5),je(r,n.edgeTemplateDirective,Wt,5),je(r,n.edgeLabelHtmlDirective,Yt,5),je(r,n.connectionTemplateDirective,Xt,5)),i&2&&Ae(6)},viewQuery:function(i,n){i&1&&(Le(n.mapContext,kt,5),Le(n.spacePointContext,Re,5)),i&2&&Ae(2)},inputs:{view:"view",minZoom:"minZoom",maxZoom:"maxZoom",background:"background",optimization:"optimization",entitiesSelectable:"entitiesSelectable",selectionMode:"selectionMode",keyboardShortcuts:"keyboardShortcuts",connection:[2,"connection","connection",e=>new et(e)],snapGrid:"snapGrid",elevateNodesOnSelect:"elevateNodesOnSelect",elevateEdgesOnSelect:"elevateEdgesOnSelect",autoPan:"autoPan",nodes:"nodes",alignmentHelper:[1,"alignmentHelper"],edges:"edges"},outputs:{componentNodeEvent:"componentNodeEvent"},features:[bt([Mt,ee,Q,B,St,yt,pe,Be,ke,P,Gt,ut,Pt,{provide:wt,useClass:Dn},si,ot,Ni,ze]),_i([{directive:sn,outputs:["nodesChanges","nodesChanges","nodesChanges.position","nodesChanges.position","nodesChanges.size","nodesChanges.size","nodesChanges.add","nodesChanges.add","nodesChanges.remove","nodesChanges.remove","nodesChanges.select","nodesChanges.select","edgesChanges","edgesChanges","edgesChanges.detached","edgesChanges.detached","edgesChanges.add","edgesChanges.add","edgesChanges.remove","edgesChanges.remove","edgesChanges.select","edgesChanges.select"]},{directive:Mn,outputs:["nodeDragStart","nodeDragStart","nodeDrag","nodeDrag","nodeDragEnd","nodeDragEnd"]}])],decls:11,vars:8,consts:[["flow",""],["rootSvgRef","","rootSvgContext","","rootPointer","","flowSizeController","",1,"root-svg"],["flowDefs","",3,"markers"],["background",""],["mapContext","","spacePointContext","","autoPan",""],["connection","",3,"model","template"],[3,"ngTemplateOutlet"],["previewFlow","",1,"preview-flow",3,"width","height"],["alignmentHelper",""],["alignmentHelper","",3,"tolerance","lineColor"],["node","",3,"model","groupNodeTemplate"],["edge","",3,"model","edgeTemplate","edgeLabelHtmlTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate"],["node","",3,"model","nodeTemplate","nodeSvgTemplate","groupNodeTemplate"]],template:function(i,n){if(i&1&&(C(),_(0,"svg",1,0),V(2,"defs",2)(3,"g",3),_(4,"g",4),D(5,zr,2,1),V(6,"g",5),D(7,Mr,6,0)(8,Pr,4,0),z(),D(9,Fr,1,1,":svg:ng-container",6),z(),D(10,Ir,1,2,"canvas",7)),i&2){let r,a,c;g(2),N("markers",n.markers()),g(3),v((r=n.alignmentHelper())?5:-1,r),g(),N("model",n.connection)("template",(a=n.connectionTemplateDirective())==null?null:a.templateRef),g(),v(n.flowOptimization().detachedGroupsLayer?7:-1),g(),v(n.flowOptimization().detachedGroupsLayer?-1:8),g(),v((c=n.minimap())?9:-1,c),g(),v(n.flowOptimization().virtualization?10:-1)}},dependencies:[_e,Tn,Oe,bn,_n,xn,kt,Re,gn,un,cn,xe,zn,On,kn],styles:["[_nghost-%COMP%]{display:grid;grid-template-columns:1fr;width:100%;height:100%;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]     *{box-sizing:border-box}.root-svg[_ngcontent-%COMP%]{grid-row-start:1;grid-column-start:1}.preview-flow[_ngcontent-%COMP%]{pointer-events:none;grid-row-start:1;grid-column-start:1}"],changeDetection:0})}}return t})();export{zt as a,B as b,qi as c,P as d,ee as e,ke as f,Wt as g,Yt as h,Ut as i,qt as j,Zt as k,Qr as l,Jr as m,Kr as n,Ii as o,os as p,Pt as q,Ft as r,Ht as s,Be as t,cn as u,pn as v,Ki as w,un as x,qm as y};
